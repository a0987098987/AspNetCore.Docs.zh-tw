---
uid: web-forms/overview/older-versions-security/membership/storing-additional-user-information-vb
title: 儲存額外的使用者資訊 (VB) |Microsoft 文件
author: rick-anderson
description: 在此教學課程中我們將回答這個問題，藉由建置非常初步的訪客簿應用程式。 在此情況下，我們將探討 modeli 不同的選項...
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/18/2008
ms.topic: article
ms.assetid: ee4b924e-8002-4dc3-819f-695fca1ff867
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/membership/storing-additional-user-information-vb
msc.type: authoredcontent
ms.openlocfilehash: 9a8673e764ae94b12fbc01f81ef12ea4c133b7d5
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/10/2018
---
<a name="storing-additional-user-information-vb"></a><span data-ttu-id="80e4d-104">儲存額外的使用者資訊 (VB)</span><span class="sxs-lookup"><span data-stu-id="80e4d-104">Storing Additional User Information (VB)</span></span>
====================
<span data-ttu-id="80e4d-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="80e4d-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="80e4d-106">[下載程式碼](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_VB.zip)或[下載 PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="80e4d-106">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_VB.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_vb.pdf)</span></span>

> <span data-ttu-id="80e4d-107">在此教學課程中我們將回答這個問題，藉由建置非常初步的訪客簿應用程式。</span><span class="sxs-lookup"><span data-stu-id="80e4d-107">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="80e4d-108">在此情況下，我們會查看不同資料庫中的使用者資訊模型化的選項，然後了解如何將這項資料與成員資格 framework 所建立的使用者帳戶產生關聯。</span><span class="sxs-lookup"><span data-stu-id="80e4d-108">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span>


## <a name="introduction"></a><span data-ttu-id="80e4d-109">簡介</span><span class="sxs-lookup"><span data-stu-id="80e4d-109">Introduction</span></span>

<span data-ttu-id="80e4d-110">ASP。網路的成員資格 framework 會提供彈性的介面，來管理使用者。</span><span class="sxs-lookup"><span data-stu-id="80e4d-110">ASP.NET's Membership framework offers a flexible interface for managing users.</span></span> <span data-ttu-id="80e4d-111">成員資格應用程式開發介面包含方法驗證認證、 擷取目前登入使用者的相關資訊，建立新的使用者帳戶，以及刪除使用者帳戶，和其他項目。</span><span class="sxs-lookup"><span data-stu-id="80e4d-111">The Membership API includes methods for validating credentials, retrieving information about the currently logged on user, creating a new user account, and deleting a user account, among others.</span></span> <span data-ttu-id="80e4d-112">成員資格 framework 中的每個使用者帳戶包含只針對所需的驗證認證，並執行必要的使用者帳戶相關工作的屬性。</span><span class="sxs-lookup"><span data-stu-id="80e4d-112">Each user account in the Membership framework contains only the properties needed for validating credentials and performing essential user account-related tasks.</span></span> <span data-ttu-id="80e4d-113">這證明方法和屬性[`MembershipUser`類別](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx)的模型中的成員資格架構的使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="80e4d-113">This is evidenced by the methods and properties of the [`MembershipUser` class](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx), which models a user account in the Membership framework.</span></span> <span data-ttu-id="80e4d-114">這個類別具有屬性，例如[ `UserName` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx)， [ `Email` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx)，和[ `IsLockedOut` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx)，如同方法和[ `GetPassword` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx)和[ `UnlockUser` ](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-114">This class has properties like [`UserName`](https://msdn.microsoft.com/library/system.web.security.membershipuser.username.aspx), [`Email`](https://msdn.microsoft.com/library/system.web.security.membershipuser.email.aspx), and [`IsLockedOut`](https://msdn.microsoft.com/library/system.web.security.membershipuser.islockedout.aspx), and methods like [`GetPassword`](https://msdn.microsoft.com/library/system.web.security.membershipuser.getpassword.aspx) and [`UnlockUser`](https://msdn.microsoft.com/library/system.web.security.membershipuser.unlockuser.aspx).</span></span>

<span data-ttu-id="80e4d-115">有時候，應用程式必須儲存在成員資格 framework 未包含的其他使用者資訊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-115">Oftentimes, applications need to store additional user information not included in the Membership framework.</span></span> <span data-ttu-id="80e4d-116">例如，線上零售店可能需要讓每個使用者儲存其出貨和帳單地址、 付款資訊、 傳送喜好設定，並連絡電話號碼。</span><span class="sxs-lookup"><span data-stu-id="80e4d-116">For example, an online retailer might need to let each user store her shipping and billing addresses, payment information, delivery preferences, and contact phone number.</span></span> <span data-ttu-id="80e4d-117">此外，在系統中的每筆訂單為特定使用者帳戶相關聯。</span><span class="sxs-lookup"><span data-stu-id="80e4d-117">Furthermore, each order in the system is associated with a particular user account.</span></span>

<span data-ttu-id="80e4d-118">`MembershipUser`類別不包含屬性，例如`PhoneNumber`或`DeliveryPreferences`或`PastOrders`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-118">The `MembershipUser` class does not include properties like `PhoneNumber` or `DeliveryPreferences` or `PastOrders`.</span></span> <span data-ttu-id="80e4d-119">我們該如何追蹤應用程式所需的使用者資訊，讓它與成員資格架構整合？</span><span class="sxs-lookup"><span data-stu-id="80e4d-119">So how do we track the user information needed by the application and have it integrate with the Membership framework?</span></span> <span data-ttu-id="80e4d-120">在此教學課程中我們將回答這個問題，藉由建置非常初步的訪客簿應用程式。</span><span class="sxs-lookup"><span data-stu-id="80e4d-120">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="80e4d-121">在此情況下，我們會查看不同資料庫中的使用者資訊模型化的選項，然後了解如何將這項資料與成員資格 framework 所建立的使用者帳戶產生關聯。</span><span class="sxs-lookup"><span data-stu-id="80e4d-121">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="80e4d-122">讓我們開始吧 ！</span><span class="sxs-lookup"><span data-stu-id="80e4d-122">Let's get started!</span></span>

## <a name="step-1-creating-the-guestbook-applications-data-model"></a><span data-ttu-id="80e4d-123">步驟 1： 建立訪客簿應用程式的資料模型</span><span class="sxs-lookup"><span data-stu-id="80e4d-123">Step 1: Creating the Guestbook Application's Data Model</span></span>

<span data-ttu-id="80e4d-124">有各種不同的技術，可以用來擷取資料庫中的使用者資訊和其關聯的成員資格 framework 所建立的使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="80e4d-124">There are a variety of techniques that can be employed to capture user information in a database and associate it with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="80e4d-125">為了說明這些技術，我們需要來增強教學課程的 web 應用程式，讓它會擷取某些類型的使用者相關資料。</span><span class="sxs-lookup"><span data-stu-id="80e4d-125">In order to illustrate these techniques, we will need to augment the tutorial web application so that it captures some sort of user-related data.</span></span> <span data-ttu-id="80e4d-126">(目前，應用程式服務所需的資料表只會包含應用程式的資料模型`SqlMembershipProvider`。)</span><span class="sxs-lookup"><span data-stu-id="80e4d-126">(Currently, the application's data model contains only the application services tables needed by the `SqlMembershipProvider`.)</span></span>

<span data-ttu-id="80e4d-127">讓我們來建立已驗證的使用者可以留下註解的其中一個非常簡單的訪客簿應用程式。</span><span class="sxs-lookup"><span data-stu-id="80e4d-127">Let's create a very simple guestbook application where an authenticated user can leave a comment.</span></span> <span data-ttu-id="80e4d-128">除了儲存訪客簿註解，讓我們允許每位使用者儲存其家用城鎮、 首頁和簽章。</span><span class="sxs-lookup"><span data-stu-id="80e4d-128">In addition to storing guestbook comments, let's allow each user to store his home town, homepage, and signature.</span></span> <span data-ttu-id="80e4d-129">如果提供，使用者的家用城鎮、 首頁及簽章會顯示在他已離開訪客簿中的每個訊息中。</span><span class="sxs-lookup"><span data-stu-id="80e4d-129">If provided, the user's home town, homepage, and signature will appear on each message he has left in the guestbook.</span></span>

### <a name="adding-theguestbookcommentstable"></a><span data-ttu-id="80e4d-130">加入`GuestbookComments`資料表</span><span class="sxs-lookup"><span data-stu-id="80e4d-130">Adding the`GuestbookComments`Table</span></span>

<span data-ttu-id="80e4d-131">若要擷取的訪客簿註解，我們要建立資料庫資料表，名為`GuestbookComments`具有類似的資料行`CommentId`， `Subject`， `Body`，和`CommentDate`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-131">In order to capture the guestbook comments, we need to create a database table named `GuestbookComments` that has columns like `CommentId`, `Subject`, `Body`, and `CommentDate`.</span></span> <span data-ttu-id="80e4d-132">我們也必須將每一筆記錄`GuestbookComments`資料表參考保留註解的使用者。</span><span class="sxs-lookup"><span data-stu-id="80e4d-132">We also need to have each record in the `GuestbookComments` table reference the user who left the comment.</span></span>

<span data-ttu-id="80e4d-133">若要將此資料表加入至我們的資料庫，請移至 Visual Studio 中的 資料庫總管和向下鑽研至`SecurityTutorials`資料庫。</span><span class="sxs-lookup"><span data-stu-id="80e4d-133">To add this table to our database, go to the Database Explorer in Visual Studio and drill down into the `SecurityTutorials` database.</span></span> <span data-ttu-id="80e4d-134">「 資料表 」 資料夾上按一下滑鼠右鍵，然後選擇 加入新的資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-134">Right-click on the Tables folder and choose Add New Table.</span></span> <span data-ttu-id="80e4d-135">這會開啟可讓我們來定義新的資料表資料行的介面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-135">This brings up an interface that allows us to define the columns for the new table.</span></span>


<span data-ttu-id="80e4d-136">[![將新的資料表加入至 SecurityTutorials 資料庫](storing-additional-user-information-vb/_static/image2.png)](storing-additional-user-information-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-136">[![Add a New Table to the SecurityTutorials Database](storing-additional-user-information-vb/_static/image2.png)](storing-additional-user-information-vb/_static/image1.png)</span></span>

<span data-ttu-id="80e4d-137">**圖 1**： 加入新的資料表，以便`SecurityTutorials`資料庫 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-137">**Figure 1**: Add a New Table to the `SecurityTutorials` Database  ([Click to view full-size image](storing-additional-user-information-vb/_static/image3.png))</span></span>


<span data-ttu-id="80e4d-138">接下來，定義`GuestbookComments`的資料行。</span><span class="sxs-lookup"><span data-stu-id="80e4d-138">Next, define the `GuestbookComments`'s columns.</span></span> <span data-ttu-id="80e4d-139">加入名為資料行開始`CommentId`型別的`uniqueidentifier`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-139">Start by adding a column named `CommentId` of type `uniqueidentifier`.</span></span> <span data-ttu-id="80e4d-140">此資料行中會唯一識別每個訪客簿中的註解，因此不允許`NULL`s 並將它標示為資料表的主索引鍵。</span><span class="sxs-lookup"><span data-stu-id="80e4d-140">This column will uniquely identify each comment in the guestbook, so disallow `NULL` s and mark it as the table's primary key.</span></span> <span data-ttu-id="80e4d-141">而不是提供值`CommentId`上每個欄位`INSERT`，我們可以表示新`uniqueidentifier`值應該自動產生此欄位上`INSERT`資料行的預設值設定為`NEWID()`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-141">Rather than providing a value for the `CommentId` field on each `INSERT`, we can indicate that a new `uniqueidentifier` value should be automatically generated for this field on `INSERT` by setting the column's default value to `NEWID()`.</span></span> <span data-ttu-id="80e4d-142">加入這個第一個欄位，使它成為主索引鍵，並設定為預設值之後, 您的畫面看起來應該類似螢幕擷取畫面顯示在圖 2 中。</span><span class="sxs-lookup"><span data-stu-id="80e4d-142">After adding this first field, marking it as the primary key, and settings its default value, your screen should look similar to the screen shot shown in Figure 2.</span></span>


<span data-ttu-id="80e4d-143">[![加入名為 CommentId 主要資料行](storing-additional-user-information-vb/_static/image5.png)](storing-additional-user-information-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-143">[![Add a Primary Column Named CommentId](storing-additional-user-information-vb/_static/image5.png)](storing-additional-user-information-vb/_static/image4.png)</span></span>

<span data-ttu-id="80e4d-144">**圖 2**： 加入主要的資料行名為`CommentId`([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-144">**Figure 2**: Add a Primary Column Named `CommentId` ([Click to view full-size image](storing-additional-user-information-vb/_static/image6.png))</span></span>


<span data-ttu-id="80e4d-145">接下來，加入名為資料行`Subject`型別的`nvarchar(50)`和資料行名為`Body`型別的`nvarchar(MAX)`、 允許`NULL`中兩個資料行。</span><span class="sxs-lookup"><span data-stu-id="80e4d-145">Next, add a column named `Subject` of type `nvarchar(50)` and a column named `Body` of type `nvarchar(MAX)`, disallowing `NULL` s in both columns.</span></span> <span data-ttu-id="80e4d-146">接下來，加入名為資料行`CommentDate`型別的`datetime`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-146">Following that, add a column named `CommentDate` of type `datetime`.</span></span> <span data-ttu-id="80e4d-147">不允許`NULL`s 和組`CommentDate`資料行的預設值`getdate()`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-147">Disallow `NULL` s and set the `CommentDate` column's default value to `getdate()`.</span></span>

<span data-ttu-id="80e4d-148">剩下的就是加入將使用者帳戶與每個訪客簿註解產生關聯的資料行。</span><span class="sxs-lookup"><span data-stu-id="80e4d-148">All that remains is to add a column that associates a user account with each guestbook comment.</span></span> <span data-ttu-id="80e4d-149">其中一個選項，可加入資料行名為`UserName`型別的`nvarchar(256)`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-149">One option would be to add a column named `UserName` of type `nvarchar(256)`.</span></span> <span data-ttu-id="80e4d-150">除了使用成員資格提供者時，這會是適合的選擇`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-150">This is a suitable choice when using a Membership provider other than the `SqlMembershipProvider`.</span></span> <span data-ttu-id="80e4d-151">但當使用`SqlMembershipProvider`、 因為我們已在此教學課程系列，`UserName`中的資料行`aspnet_Users`資料表不保證是唯一的。</span><span class="sxs-lookup"><span data-stu-id="80e4d-151">But when using the `SqlMembershipProvider`, as we are in this tutorial series, the `UserName` column in the `aspnet_Users` table is not guaranteed to be unique.</span></span> <span data-ttu-id="80e4d-152">`aspnet_Users`資料表的主索引鍵是`UserId`是型別`uniqueidentifier`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-152">The `aspnet_Users` table's primary key is `UserId` and is of type `uniqueidentifier`.</span></span> <span data-ttu-id="80e4d-153">因此，`GuestbookComments`需要的資料行的資料表`UserId`型別的`uniqueidentifier`(不允許`NULL`值)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-153">Therefore, the `GuestbookComments` table needs a column named `UserId` of type `uniqueidentifier` (disallowing `NULL` values).</span></span> <span data-ttu-id="80e4d-154">請繼續並加入這欄。</span><span class="sxs-lookup"><span data-stu-id="80e4d-154">Go ahead and add this column.</span></span>

> [!NOTE]
> <span data-ttu-id="80e4d-155">如我們所述[*在 SQL Server 中建立成員資格結構描述*](creating-the-membership-schema-in-sql-server-vb.md)教學課程，成員資格架構設計用來啟用多個 web 應用程式使用不同的使用者帳戶會共用相同使用者存放區。</span><span class="sxs-lookup"><span data-stu-id="80e4d-155">As we discussed in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-vb.md) tutorial, the Membership framework is designed to enable multiple web applications with different user accounts to share the same user store.</span></span> <span data-ttu-id="80e4d-156">它會藉由分割成不同的應用程式的使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="80e4d-156">It does this by partitioning user accounts into different applications.</span></span> <span data-ttu-id="80e4d-157">和中使用相同的使用者存放區的不同應用程式時，每個使用者名稱保證是唯一的應用程式中，可能使用相同的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="80e4d-157">And while each username is guaranteed to be unique within an application, the same username may be used in different applications using the same user store.</span></span> <span data-ttu-id="80e4d-158">沒有複合`UNIQUE`中的條件約束`aspnet_Users`資料表`UserName`和`ApplicationId`欄位，但不是其中上只`UserName`欄位。</span><span class="sxs-lookup"><span data-stu-id="80e4d-158">There is a composite `UNIQUE` constraint in the `aspnet_Users` table on the `UserName` and `ApplicationId` fields, but not one on just the `UserName` field.</span></span> <span data-ttu-id="80e4d-159">因此，很可能讓 aspnet\_使用者資料表擁有具有相同的兩個 （或以上） 資料錄`UserName`值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-159">Consequently, it is possible for the aspnet\_Users table to have two (or more) records with the same `UserName` value.</span></span> <span data-ttu-id="80e4d-160">不過，`UNIQUE`條件約束`aspnet_Users`資料表的`UserId`欄位 （因為它是主索引鍵）。</span><span class="sxs-lookup"><span data-stu-id="80e4d-160">There is, however, a `UNIQUE` constraint on the `aspnet_Users` table's `UserId` field (since it is the primary key).</span></span> <span data-ttu-id="80e4d-161">A`UNIQUE`條件約束很重要，因為沒有它，我們無法建立之間的外部索引鍵條件約束`GuestbookComments`和`aspnet_Users`資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-161">A `UNIQUE` constraint is important because without it we cannot establish a foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables.</span></span>


<span data-ttu-id="80e4d-162">在新增之後`UserId`資料行中，依序按一下工具列中的 [儲存] 圖示上的資料表儲存。</span><span class="sxs-lookup"><span data-stu-id="80e4d-162">After adding the `UserId` column, save the table by clicking on the Save icon in the Toolbar.</span></span> <span data-ttu-id="80e4d-163">命名新資料表`GuestbookComments`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-163">Name the new table `GuestbookComments`.</span></span>

<span data-ttu-id="80e4d-164">我們已處理的最後一個問題`GuestbookComments`資料表： 我們需要建立[foreign key 條件約束](https://msdn.microsoft.com/library/ms175464.aspx)之間`GuestbookComments.UserId`資料行和`aspnet_Users.UserId`資料行。</span><span class="sxs-lookup"><span data-stu-id="80e4d-164">We have one last issue to attend to with the `GuestbookComments` table: we need to create a [foreign key constraint](https://msdn.microsoft.com/library/ms175464.aspx) between the `GuestbookComments.UserId` column and the `aspnet_Users.UserId` column.</span></span> <span data-ttu-id="80e4d-165">若要達成此目的，按一下工具列啟動外部索引鍵關聯性 對話方塊中的關聯性圖示。</span><span class="sxs-lookup"><span data-stu-id="80e4d-165">To achieve this, click the Relationship icon in the Toolbar to launch the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="80e4d-166">（或者，您可以啟動此對話方塊中移至 資料表設計工具 功能表，然後選擇 關聯性。）</span><span class="sxs-lookup"><span data-stu-id="80e4d-166">(Alternatively, you can launch this dialog box by going to the Table Designer menu and choosing Relationships.)</span></span>

<span data-ttu-id="80e4d-167">按一下 [外部索引鍵關聯性] 對話方塊的左下角中的 [新增] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="80e4d-167">Click the Add button in the lower left corner of the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="80e4d-168">這會新增新外部索引鍵條件約束，雖然我們仍需要定義關聯性中參與的資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-168">This will add a new foreign key constraint, although we still need to define the tables that participate in the relationship.</span></span>


<span data-ttu-id="80e4d-169">[![使用外部索引鍵關聯性 對話方塊來管理資料表的 Foreign Key 條件約束](storing-additional-user-information-vb/_static/image8.png)](storing-additional-user-information-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-169">[![Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints](storing-additional-user-information-vb/_static/image8.png)](storing-additional-user-information-vb/_static/image7.png)</span></span>

<span data-ttu-id="80e4d-170">**圖 3**： 用於管理資料表的 Foreign Key 條件約束的外部索引鍵關聯性對話方塊 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-170">**Figure 3**: Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints  ([Click to view full-size image](storing-additional-user-information-vb/_static/image9.png))</span></span>


<span data-ttu-id="80e4d-171">接下來，按一下 「 資料表和資料行規格 」 上的資料列右邊的省略符號圖示。</span><span class="sxs-lookup"><span data-stu-id="80e4d-171">Next, click the ellipses icon in the "Table and Columns Specifications" row on the right.</span></span> <span data-ttu-id="80e4d-172">這樣就會啟動 [資料表和資料行] 對話方塊，我們可以從中指定主索引鍵的資料表和資料行的外部索引鍵資料行從`GuestbookComments`資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-172">This will launch the Tables and Columns dialog box, from which we can specify the primary key table and column and the foreign key column from the `GuestbookComments` table.</span></span> <span data-ttu-id="80e4d-173">具體來說，選取`aspnet_Users`和`UserId`作為主索引鍵資料表與資料行和`UserId`從`GuestbookComments`做外部索引鍵資料行的資料表 （請參閱圖 4）。</span><span class="sxs-lookup"><span data-stu-id="80e4d-173">In particular, select `aspnet_Users` and `UserId` as the primary key table and column, and `UserId` from the `GuestbookComments` table as the foreign key column (see Figure 4).</span></span> <span data-ttu-id="80e4d-174">定義後的主要和外部索引鍵的資料表和資料行，按一下 [確定] 以返回 [外部索引鍵關聯性] 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-174">After defining the primary and foreign key tables and columns, click OK to return to the Foreign Key Relationships dialog box.</span></span>


<span data-ttu-id="80e4d-175">[![建立外部索引鍵條件約束之間 aspnet_Users 和 GuesbookComments 資料表](storing-additional-user-information-vb/_static/image11.png)](storing-additional-user-information-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-175">[![Establish a Foreign Key Constraint Between the aspnet_Users and GuesbookComments Tables](storing-additional-user-information-vb/_static/image11.png)](storing-additional-user-information-vb/_static/image10.png)</span></span>

<span data-ttu-id="80e4d-176">**圖 4**: 外部索引鍵條件約束之間建立`aspnet_Users`和`GuesbookComments`資料表 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-176">**Figure 4**: Establish a Foreign Key Constraint Between the `aspnet_Users` and `GuesbookComments` Tables  ([Click to view full-size image](storing-additional-user-information-vb/_static/image12.png))</span></span>


<span data-ttu-id="80e4d-177">此時，已建立的外部索引鍵條件約束。</span><span class="sxs-lookup"><span data-stu-id="80e4d-177">At this point the foreign key constraint has been established.</span></span> <span data-ttu-id="80e4d-178">這個條件約束的存在可確保[關聯式完整性](http://en.wikipedia.org/wiki/Referential_integrity)，將不會參考到不存在的使用者帳戶的訪客簿項目，以及確保兩個資料表之間。</span><span class="sxs-lookup"><span data-stu-id="80e4d-178">The presence of this constraint ensures [relational integrity](http://en.wikipedia.org/wiki/Referential_integrity) between the two tables by guaranteeing that there will never be a guestbook entry referring to a non-existent user account.</span></span> <span data-ttu-id="80e4d-179">根據預設，外部索引鍵條件約束將不允許那里對應的子記錄，如果刪除父記錄。</span><span class="sxs-lookup"><span data-stu-id="80e4d-179">By default, a foreign key constraint will disallow a parent record to be deleted if there are corresponding child records.</span></span> <span data-ttu-id="80e4d-180">也就是說，如果使用者對一或多個訪客簿註解，然後我們嘗試刪除該使用者帳戶，則刪除會失敗，除非他的訪客簿註解會先刪除。</span><span class="sxs-lookup"><span data-stu-id="80e4d-180">That is, if a user makes one or more guestbook comments, and then we attempt to delete that user account, the delete will fail unless his guestbook comments are deleted first.</span></span>

<span data-ttu-id="80e4d-181">Foreign key 條件約束可以設定為父記錄會被刪除時，自動刪除相關聯的子記錄。</span><span class="sxs-lookup"><span data-stu-id="80e4d-181">Foreign key constraints can be configured to automatically delete the associated child records when a parent record is deleted.</span></span> <span data-ttu-id="80e4d-182">換句話說，我們可以設定這個外部索引鍵條件約束，以便刪除其使用者帳戶時，會自動刪除使用者的訪客簿項目。</span><span class="sxs-lookup"><span data-stu-id="80e4d-182">In other words, we can setup this foreign key constraint so that a user's guestbook entries are automatically deleted when her user account is deleted.</span></span> <span data-ttu-id="80e4d-183">若要達成此目的，展開 < INSERT 和 UPDATE 規格 > 一節並將 [刪除規則] 屬性設定為 Cascade。</span><span class="sxs-lookup"><span data-stu-id="80e4d-183">To accomplish this, expand the "INSERT And UPDATE Specification" section and set the "Delete Rule" property to Cascade.</span></span>


<span data-ttu-id="80e4d-184">[![設定串聯刪除外部索引鍵條件約束](storing-additional-user-information-vb/_static/image14.png)](storing-additional-user-information-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-184">[![Configure the Foreign Key Constraint to Cascade Deletes](storing-additional-user-information-vb/_static/image14.png)](storing-additional-user-information-vb/_static/image13.png)</span></span>

<span data-ttu-id="80e4d-185">**圖 5**： 設定要串聯刪除 Foreign Key 條件約束 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-185">**Figure 5**: Configure the Foreign Key Constraint to Cascade Deletes  ([Click to view full-size image](storing-additional-user-information-vb/_static/image15.png))</span></span>


<span data-ttu-id="80e4d-186">若要儲存的外部索引鍵條件約束，請按一下 [關閉] 按鈕結束外部索引鍵關聯性。</span><span class="sxs-lookup"><span data-stu-id="80e4d-186">To save the foreign key constraint, click the Close button to exit out of the Foreign Key Relationships.</span></span> <span data-ttu-id="80e4d-187">然後按一下 [儲存] 圖示以儲存資料表，然後此工具列中的關聯性。</span><span class="sxs-lookup"><span data-stu-id="80e4d-187">Then click the Save icon in the Toolbar to save the table and the this relationship.</span></span>

### <a name="storing-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="80e4d-188">儲存使用者的家用城鎮、 首頁和簽章</span><span class="sxs-lookup"><span data-stu-id="80e4d-188">Storing the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="80e4d-189">`GuestbookComments`表格將說明如何儲存使用者帳戶與共用的一對多關聯性的資訊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-189">The `GuestbookComments` table illustrates how to store information that shares a one-to-many relationship with user accounts.</span></span> <span data-ttu-id="80e4d-190">由於每個使用者帳戶可能有任意數目的相關聯的註解，此關聯性是由建立來保存 註解的集合，包括連結回特定使用者的每個註解的資料行的資料表模型化。</span><span class="sxs-lookup"><span data-stu-id="80e4d-190">Since each user account may have an arbitrary number of associated comments, this relationship is modeled by creating a table to hold the set of comments that includes a column that links back each comment to a particular user.</span></span> <span data-ttu-id="80e4d-191">使用時`SqlMembershipProvider`，藉由建立名為資料行最好建立此連結`UserId`型別的`uniqueidentifier`及此資料行之間的外部索引鍵條件約束和`aspnet_Users.UserId`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-191">When using the `SqlMembershipProvider`, this link is best established by creating a column named `UserId` of type `uniqueidentifier` and a foreign key constraint between this column and `aspnet_Users.UserId`.</span></span>

<span data-ttu-id="80e4d-192">我們現在需要將三個資料行與儲存使用者的家用城鎮、 首頁和簽章，會出現在他的訪客簿註解每個使用者帳戶產生關聯。</span><span class="sxs-lookup"><span data-stu-id="80e4d-192">We now need to associate three columns with each user account to store the user's home town, homepage, and signature, which will appear in his guestbook comments.</span></span> <span data-ttu-id="80e4d-193">有數個不同方式來完成這項作業：</span><span class="sxs-lookup"><span data-stu-id="80e4d-193">There are number of different ways to accomplish this:</span></span>

- <span data-ttu-id="80e4d-194"><strong>將新的資料行加入</strong><strong>`aspnet_Users`</strong><strong>或</strong><strong>`aspnet_Membership`</strong><strong>資料表。</strong></span><span class="sxs-lookup"><span data-stu-id="80e4d-194"><strong>Add new columns to the</strong><strong>`aspnet_Users`</strong><strong>or</strong><strong>`aspnet_Membership`</strong><strong>tables.</strong></span></span> <span data-ttu-id="80e4d-195">我不會建議這種方法，因為它會修改所使用的結構描述`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-195">I would not recommend this approach because it modifies the schema used by the `SqlMembershipProvider`.</span></span> <span data-ttu-id="80e4d-196">這項決策可能回顧天您日後。</span><span class="sxs-lookup"><span data-stu-id="80e4d-196">This decision may come back to haunt you down the road.</span></span> <span data-ttu-id="80e4d-197">例如，如果未來版本的 ASP.NET 會使用不同`SqlMembershipProvider`結構描述。</span><span class="sxs-lookup"><span data-stu-id="80e4d-197">For example, what if a future version of ASP.NET uses a different `SqlMembershipProvider` schema.</span></span> <span data-ttu-id="80e4d-198">Microsoft 可能會包含一個工具，可移轉 ASP.NET 2.0`SqlMembershipProvider`資料到新的結構描述，但如果您已經修改 ASP.NET 2.0`SqlMembershipProvider`結構描述中，這類轉換可能不適用。</span><span class="sxs-lookup"><span data-stu-id="80e4d-198">Microsoft may include a tool to migrate the ASP.NET 2.0 `SqlMembershipProvider` data to the new schema, but if you have modified the ASP.NET 2.0 `SqlMembershipProvider` schema, such a conversion may not be possible.</span></span>

- <span data-ttu-id="80e4d-199">**使用 ASP。網路的設定檔架構，定義設定檔屬性，如家用城鎮、 首頁和簽章。**</span><span class="sxs-lookup"><span data-stu-id="80e4d-199">**Use ASP.NET's Profile framework, defining a profile property for the home town, homepage, and signature.**</span></span> <span data-ttu-id="80e4d-200">ASP.NET 包含了設定檔架構是設計用來儲存使用者專屬的其他資料。</span><span class="sxs-lookup"><span data-stu-id="80e4d-200">ASP.NET includes a Profile framework that is designed to store additional user-specific data.</span></span> <span data-ttu-id="80e4d-201">成員資格架構，例如設定檔 framework 是建置在提供者模型之上。</span><span class="sxs-lookup"><span data-stu-id="80e4d-201">Like the Membership framework, the Profile framework is built atop the provider model.</span></span> <span data-ttu-id="80e4d-202">.NET Framework 隨附`SqlProfileProvider`存放區分析 SQL Server 資料庫中的資料。</span><span class="sxs-lookup"><span data-stu-id="80e4d-202">The .NET Framework ships with a `SqlProfileProvider` that stores profile data in a SQL Server database.</span></span> <span data-ttu-id="80e4d-203">事實上，我們的資料庫中已經有資料表由`SqlProfileProvider`(`aspnet_Profile`)，當我們新增回應用程式服務已加入[*在 SQL Server 中建立成員資格結構描述*](creating-the-membership-schema-in-sql-server-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="80e4d-203">In fact, our database already has the table used by the `SqlProfileProvider` (`aspnet_Profile`), as it was added when we added the application services back in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-vb.md) tutorial.</span></span>   
  <span data-ttu-id="80e4d-204">設定檔架構的主要優點是，它可讓開發人員定義中的設定檔屬性`Web.config`– 沒有程式碼以供需要寫序列化設定檔資料，以及從基礎資料存放區。</span><span class="sxs-lookup"><span data-stu-id="80e4d-204">The main benefit of the Profile framework is that it allows for developers to define the profile properties in `Web.config` – no code needs to be written to serialize the profile data to and from the underlying data store.</span></span> <span data-ttu-id="80e4d-205">簡單地說，是非常簡單，來定義一組設定檔屬性，並在程式碼中使用它們。</span><span class="sxs-lookup"><span data-stu-id="80e4d-205">In short, it is incredibly easy to define a set of profile properties and to work with them in code.</span></span> <span data-ttu-id="80e4d-206">不過，設定檔系統不夠令人需要進行版本控制時，如果您的應用程式預期新的使用者特定屬性，以在稍後的時間或要移除或修改現有的加入，然後設定檔架構可能不是 最佳的選項。</span><span class="sxs-lookup"><span data-stu-id="80e4d-206">However, the Profile system leaves a lot to be desired when it comes to versioning, so if you have an application where you expect new user-specific properties to be added at a later time, or existing ones to be removed or modified, then the Profile framework may not be the best option.</span></span> <span data-ttu-id="80e4d-207">此外，`SqlProfileProvider`儲存設定檔屬性以高非正規化的方式下, 一步 無法直接對設定檔資料 （例如，多少使用者擁有 New York 家用城鎮） 執行查詢。</span><span class="sxs-lookup"><span data-stu-id="80e4d-207">Moreover, the `SqlProfileProvider` stores the profile properties in a highly denormalized fashion, making it next to impossible to run queries directly against the profile data (such as, how many users have a home town of New York).</span></span>   
  <span data-ttu-id="80e4d-208">如需有關設定檔架構的詳細資訊，請參閱本教學課程結尾處的 「 進一步讀數 」 一節。</span><span class="sxs-lookup"><span data-stu-id="80e4d-208">For more information on the Profile framework, consult the "Further Readings" section at the end of this tutorial.</span></span>

- <span data-ttu-id="80e4d-209"><strong>將下列三個資料行加入至資料庫中的新資料表，並建立此資料表之間的一對一關聯性和</strong><strong>`aspnet_Users`</strong><strong>。</strong></span><span class="sxs-lookup"><span data-stu-id="80e4d-209"><strong>Add these three columns to a new table in the database and establish a one-to-one relationship between this table and</strong><strong>`aspnet_Users`</strong><strong>.</strong></span></span> <span data-ttu-id="80e4d-210">這種方法牽涉到更多工作的設定檔架構，但提供了相當大的彈性資料庫中其他使用者屬性所建立的模型。</span><span class="sxs-lookup"><span data-stu-id="80e4d-210">This approach involves a bit more work than with the Profile framework, but offers maximum flexibility in how the additional user properties are modeled in the database.</span></span> <span data-ttu-id="80e4d-211">這是我們將在本教學課程中使用的選項。</span><span class="sxs-lookup"><span data-stu-id="80e4d-211">This is the option we will use in this tutorial.</span></span>

<span data-ttu-id="80e4d-212">我們將建立新的資料表，稱為`UserProfiles`儲存家用城鎮、 首頁上，並為每個使用者的簽章。</span><span class="sxs-lookup"><span data-stu-id="80e4d-212">We will create a new table called `UserProfiles` to save the home town, homepage, and signature for each user.</span></span> <span data-ttu-id="80e4d-213">在 [資料庫總管] 視窗中的 [資料表] 資料夾上按一下滑鼠右鍵，然後選擇要建立新的資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-213">Right-click on the Tables folder in the Database Explorer window and choose to create a new table.</span></span> <span data-ttu-id="80e4d-214">名稱的第一個資料行`UserId`並將其類型設定為`uniqueidentifier`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-214">Name the first column `UserId` and set its type to `uniqueidentifier`.</span></span> <span data-ttu-id="80e4d-215">不允許`NULL`值，並標示為主索引鍵資料行。</span><span class="sxs-lookup"><span data-stu-id="80e4d-215">Disallow `NULL` values and mark the column as a primary key.</span></span> <span data-ttu-id="80e4d-216">接下來，加入名為資料行：`HomeTown`型別的`nvarchar(50)`;`HomepageUrl`型別的`nvarchar(100)`; 和類型的簽章`nvarchar(500)`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-216">Next, add columns named: `HomeTown` of type `nvarchar(50)`; `HomepageUrl` of type `nvarchar(100)`; and Signature of type `nvarchar(500)`.</span></span> <span data-ttu-id="80e4d-217">每個這些三個資料行可以接受`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-217">Each of these three columns can accept a `NULL` value.</span></span>


<span data-ttu-id="80e4d-218">[![建立 UserProfiles 資料表](storing-additional-user-information-vb/_static/image17.png)](storing-additional-user-information-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-218">[![Create the UserProfiles Table](storing-additional-user-information-vb/_static/image17.png)](storing-additional-user-information-vb/_static/image16.png)</span></span>

<span data-ttu-id="80e4d-219">**圖 6**： 建立`UserProfiles`資料表 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-219">**Figure 6**: Create the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image18.png))</span></span>


<span data-ttu-id="80e4d-220">儲存資料表並將其命名`UserProfiles`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-220">Save the table and name it `UserProfiles`.</span></span> <span data-ttu-id="80e4d-221">最後，建立之間的外部索引鍵條件約束`UserProfiles`資料表的`UserId`欄位和`aspnet_Users.UserId`欄位。</span><span class="sxs-lookup"><span data-stu-id="80e4d-221">Lastly, establish a foreign key constraint between the `UserProfiles` table's `UserId` field and the `aspnet_Users.UserId` field.</span></span> <span data-ttu-id="80e4d-222">如同我們一樣之間的外部索引鍵條件約束`GuestbookComments`和`aspnet_Users`資料表，具有串聯刪除這個條件約束。</span><span class="sxs-lookup"><span data-stu-id="80e4d-222">As we did with the foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables, have this constraint cascade deletes.</span></span> <span data-ttu-id="80e4d-223">因為`UserId`欄位`UserProfiles`是主要索引鍵，這可確保會有超過一筆記錄`UserProfiles`資料表每個使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="80e4d-223">Since the `UserId` field in `UserProfiles` is the primary key, this ensures that there will be no more than one record in the `UserProfiles` table for each user account.</span></span> <span data-ttu-id="80e4d-224">這種類型的關聯性被指為一對一。</span><span class="sxs-lookup"><span data-stu-id="80e4d-224">This type of relationship is referred to as one-to-one.</span></span>

<span data-ttu-id="80e4d-225">現在，我們已經建立的資料模型，我們準備要使用它。</span><span class="sxs-lookup"><span data-stu-id="80e4d-225">Now that we have the data model created, we are ready to use it.</span></span> <span data-ttu-id="80e4d-226">步驟 2 和 3 中我們將探討如何目前登入的使用者可以檢視和編輯其主城鎮、 首頁和簽章資訊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-226">In Steps 2 and 3 we will look at how the currently logged on user can view and edit their home town, homepage, and signature information.</span></span> <span data-ttu-id="80e4d-227">步驟 4 中，我們將建立來送出的訪客簿新註解，以及檢視現有的已驗證的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-227">In Step 4 we will create the interface for authenticated users to submit new comments to the guestbook and view the existing ones.</span></span>

## <a name="step-2-displaying-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="80e4d-228">步驟 2： 顯示使用者的家用城鎮、 首頁和簽章</span><span class="sxs-lookup"><span data-stu-id="80e4d-228">Step 2: Displaying the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="80e4d-229">有各種不同的方式，讓目前登入的使用者，來檢視和編輯其主城鎮、 首頁和簽章資訊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-229">There are a variety of ways to allow the currently logged on user to view and edit his home town, homepage, and signature information.</span></span> <span data-ttu-id="80e4d-230">我們無法使用文字方塊中手動建立使用者介面和 Label 控制項抑或我們無法使用其中一種 Web 控制項，例如 DetailsView 控制項的資料。</span><span class="sxs-lookup"><span data-stu-id="80e4d-230">We could manually create the user interface with TextBox and Label controls or we could use one of the data Web controls, such as the DetailsView control.</span></span> <span data-ttu-id="80e4d-231">若要執行資料庫`SELECT`和`UPDATE`陳述式我們可以撰寫 ADO.NET 我們的網頁程式碼後置類別中的程式碼或，或者，使用宣告式與 SqlDataSource 方法。</span><span class="sxs-lookup"><span data-stu-id="80e4d-231">To perform the database `SELECT` and `UPDATE` statements we could write ADO.NET code in our page's code-behind class or, alternatively, employ a declarative approach with the SqlDataSource.</span></span> <span data-ttu-id="80e4d-232">在理想情況下我們的應用程式會包含階層式的架構，我們可能是程式設計方式叫用網頁的程式碼後置類別或以宣告方式透過 ObjectDataSource 控制項。</span><span class="sxs-lookup"><span data-stu-id="80e4d-232">Ideally our application would contain a tiered architecture, which we could either invoke programmatically from the page's code-behind class or declaratively via the ObjectDataSource control.</span></span>

<span data-ttu-id="80e4d-233">因為這個教學課程系列著重於表單驗證、 授權、 使用者帳戶和角色，則不會有這些不同的資料存取選項或階層式的架構為何慣用透過直接執行 SQL 陳述式的完整討論從 ASP.NET 頁面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-233">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, there will not be a thorough discussion of these different data access options or why a tiered architecture is preferred over executing SQL statements directly from the ASP.NET page.</span></span> <span data-ttu-id="80e4d-234">我們即將逐步解說使用 DetailsView 和 SqlDataSource – 最快速而且簡單選項 – 但討論的概念確實可套用至替代 Web 控制項與資料存取邏輯。</span><span class="sxs-lookup"><span data-stu-id="80e4d-234">I am going to walk through using a DetailsView and SqlDataSource – the quickest and easiest option – but the concepts discussed can certainly be applied to alternative Web controls and data access logic.</span></span> <span data-ttu-id="80e4d-235">如需在 ASP.NET 中的資料搭配使用的詳細資訊，請參閱我*[在 ASP.NET 2.0 中使用資料](../../data-access/index.md)*教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="80e4d-235">For more information on working with data in ASP.NET, refer to my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="80e4d-236">開啟`AdditionalUserInfo.aspx`頁面`Membership`資料夾並將 DetailsView 控制項加入至頁面上，將它的 ID 屬性設定為`UserProfile`和清除其`Width`和`Height`屬性。</span><span class="sxs-lookup"><span data-stu-id="80e4d-236">Open the `AdditionalUserInfo.aspx` page in the `Membership` folder and add a DetailsView control to the page, setting its ID property to `UserProfile` and clearing out its `Width` and `Height` properties.</span></span> <span data-ttu-id="80e4d-237">展開 DetailsView 的智慧標籤，然後選擇將它繫結至新的資料來源控制項。</span><span class="sxs-lookup"><span data-stu-id="80e4d-237">Expand the DetailsView's Smart Tag and choose to bind it to a new data source control.</span></span> <span data-ttu-id="80e4d-238">這樣就會啟動資料來源組態精靈 （請參閱圖 7）。</span><span class="sxs-lookup"><span data-stu-id="80e4d-238">This will launch the DataSource Configuration Wizard (see Figure 7).</span></span> <span data-ttu-id="80e4d-239">第一個步驟會要求您指定的資料來源類型。</span><span class="sxs-lookup"><span data-stu-id="80e4d-239">The first step asks you to specify the data source type.</span></span> <span data-ttu-id="80e4d-240">因為我們將直接連接到`SecurityTutorials`資料庫，請選擇 [資料庫] 圖示上，指定`ID`為`UserProfileDataSource`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-240">Since we are going to connect directly to the `SecurityTutorials` database, choose the Database icon, specifying the `ID` as `UserProfileDataSource`.</span></span>


<span data-ttu-id="80e4d-241">[![新增名為 UserProfileDataSource SqlDataSource 控制項](storing-additional-user-information-vb/_static/image20.png)](storing-additional-user-information-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-241">[![Add a New SqlDataSource Control Named UserProfileDataSource](storing-additional-user-information-vb/_static/image20.png)](storing-additional-user-information-vb/_static/image19.png)</span></span>

<span data-ttu-id="80e4d-242">**圖 7**： 加入新的 SqlDataSource 控制項命名`UserProfileDataSource`([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-242">**Figure 7**: Add a New SqlDataSource Control Named `UserProfileDataSource` ([Click to view full-size image](storing-additional-user-information-vb/_static/image21.png))</span></span>


<span data-ttu-id="80e4d-243">下一個畫面會提示輸入要使用的資料庫。</span><span class="sxs-lookup"><span data-stu-id="80e4d-243">The next screen prompts for the database to use.</span></span> <span data-ttu-id="80e4d-244">我們已經定義中的連接字串`Web.config`如`SecurityTutorials`資料庫。</span><span class="sxs-lookup"><span data-stu-id="80e4d-244">We have already defined a connection string in `Web.config` for the `SecurityTutorials` database.</span></span> <span data-ttu-id="80e4d-245">此連接字串名稱中 – `SecurityTutorialsConnectionString` – 應該會在下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="80e4d-245">This connection string name – `SecurityTutorialsConnectionString` – should be in the drop-down list.</span></span> <span data-ttu-id="80e4d-246">選取此選項，然後按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="80e4d-246">Select this option and click Next.</span></span>


<span data-ttu-id="80e4d-247">[![從下拉式清單中選擇 SecurityTutorialsConnectionString](storing-additional-user-information-vb/_static/image23.png)](storing-additional-user-information-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-247">[![Choose SecurityTutorialsConnectionString from the Drop-Down List](storing-additional-user-information-vb/_static/image23.png)](storing-additional-user-information-vb/_static/image22.png)</span></span>

<span data-ttu-id="80e4d-248">**圖 8**： 選擇`SecurityTutorialsConnectionString`從下拉式清單 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-248">**Figure 8**: Choose `SecurityTutorialsConnectionString` from the Drop-Down List  ([Click to view full-size image](storing-additional-user-information-vb/_static/image24.png))</span></span>


<span data-ttu-id="80e4d-249">後續的畫面會詢問我們指定的資料表和查詢的資料行。</span><span class="sxs-lookup"><span data-stu-id="80e4d-249">The subsequent screen asks us to specify the table and columns to query.</span></span> <span data-ttu-id="80e4d-250">選擇`UserProfiles`資料表下拉式清單中，並檢查所有資料行。</span><span class="sxs-lookup"><span data-stu-id="80e4d-250">Choose the `UserProfiles` table from the drop-down list and check all of the columns.</span></span>


<span data-ttu-id="80e4d-251">[![將從 UserProfiles 資料表傳回所有資料行](storing-additional-user-information-vb/_static/image26.png)](storing-additional-user-information-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-251">[![Bring Back All of the Columns from the UserProfiles Table](storing-additional-user-information-vb/_static/image26.png)](storing-additional-user-information-vb/_static/image25.png)</span></span>

<span data-ttu-id="80e4d-252">**圖 9**： 帶回所有資料行`UserProfiles`資料表 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-252">**Figure 9**: Bring Back All of the Columns from the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image27.png))</span></span>


<span data-ttu-id="80e4d-253">圖 9 傳回目前查詢*所有*中記錄的`UserProfiles`，但是您只想要在目前登入的使用者記錄中。</span><span class="sxs-lookup"><span data-stu-id="80e4d-253">The current query in Figure 9 returns *all* of the records in `UserProfiles`, but we are only interested in the currently logged on user's record.</span></span> <span data-ttu-id="80e4d-254">若要加入`WHERE`子句中，按一下 `WHERE`即可啟動 新增 按鈕`WHERE`子句對話方塊 （請參閱圖 10）。</span><span class="sxs-lookup"><span data-stu-id="80e4d-254">To add a `WHERE` clause, click the `WHERE` button to bring up the Add `WHERE` Clause dialog box (see Figure 10).</span></span> <span data-ttu-id="80e4d-255">您可以選取要篩選的資料行、 運算子和篩選參數的來源。</span><span class="sxs-lookup"><span data-stu-id="80e4d-255">Here you can select the column to filter on, the operator, and the source of the filter parameter.</span></span> <span data-ttu-id="80e4d-256">選取`UserId`做為資料行和"="做為運算子。</span><span class="sxs-lookup"><span data-stu-id="80e4d-256">Select `UserId` as the column and "=" as the Operator.</span></span>

<span data-ttu-id="80e4d-257">不幸的是要傳回目前登入的使用者沒有內建參數來源我們`UserId`值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-257">Unfortunately there is no built-in parameter source to return the currently logged on user's `UserId` value.</span></span> <span data-ttu-id="80e4d-258">我們必須以程式設計方式擷取此值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-258">We will need to grab this value programmatically.</span></span> <span data-ttu-id="80e4d-259">因此，設定為 [無，] 按一下 [新增] 按鈕以新增參數，然後按一下 [確定] 的 [來源] 下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="80e4d-259">Therefore, set the Source drop-down list to "None," click the Add button to add the parameter, and then click OK.</span></span>


<span data-ttu-id="80e4d-260">[![使用者識別碼資料行上加入篩選參數](storing-additional-user-information-vb/_static/image29.png)](storing-additional-user-information-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-260">[![Add a Filter Parameter on the UserId Column](storing-additional-user-information-vb/_static/image29.png)](storing-additional-user-information-vb/_static/image28.png)</span></span>

<span data-ttu-id="80e4d-261">**圖 10**： 上加入 Filter 參數`UserId`資料行 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-261">**Figure 10**: Add a Filter Parameter on the `UserId` Column  ([Click to view full-size image](storing-additional-user-information-vb/_static/image30.png))</span></span>


<span data-ttu-id="80e4d-262">按一下 [確定] 之後您將返回圖 9 所示的畫面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-262">After clicking OK you will be returned to the screen shown in Figure 9.</span></span> <span data-ttu-id="80e4d-263">這個時間，不過，SQL 查詢，在畫面底部應包括`WHERE`子句。</span><span class="sxs-lookup"><span data-stu-id="80e4d-263">This time, however, the SQL query at the bottom of the screen should include a `WHERE` clause.</span></span> <span data-ttu-id="80e4d-264">按下一步移至 「 測試查詢 」 畫面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-264">Click Next to move on to the "Test Query" screen.</span></span> <span data-ttu-id="80e4d-265">您可以在這裡執行查詢並查看結果。</span><span class="sxs-lookup"><span data-stu-id="80e4d-265">Here you can run the query and see the results.</span></span> <span data-ttu-id="80e4d-266">按一下 [完成] 5d; 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="80e4d-266">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="80e4d-267">完成資料來源組態精靈，Visual Studio 會建立 SqlDataSource 控制項，取決於精靈中指定的設定。</span><span class="sxs-lookup"><span data-stu-id="80e4d-267">Upon completing the DataSource Configuration Wizard, Visual Studio creates the SqlDataSource control based on the settings specified in the wizard.</span></span> <span data-ttu-id="80e4d-268">此外，它以手動方式加入 BoundFields 每個資料行傳回 SqlDataSource DetailsView `SelectCommand`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-268">Moreover, it manually adds BoundFields to the DetailsView for each column returned by the SqlDataSource's `SelectCommand`.</span></span> <span data-ttu-id="80e4d-269">若要顯示不需要`UserId`欄位中 DetailsView，因為使用者不需要知道此值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-269">There's no need to show the `UserId` field in the DetailsView, since the user does not need to know this value.</span></span> <span data-ttu-id="80e4d-270">您可以直接從 DetailsView 控制項的宣告式標記中移除此欄位，或按一下 「 編輯欄位 」 連結的智慧標記。</span><span class="sxs-lookup"><span data-stu-id="80e4d-270">You can remove this field directly from the DetailsView control's declarative markup or by clicking the "Edit Fields" link from its Smart Tag.</span></span>

<span data-ttu-id="80e4d-271">此時網頁的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="80e4d-271">At this point your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample1.aspx)]

<span data-ttu-id="80e4d-272">我們需要以程式設計方式設定 SqlDataSource 控制項`UserId`參數，目前登入的使用者以`UserId`之前選取的資料。</span><span class="sxs-lookup"><span data-stu-id="80e4d-272">We need to programmatically set the SqlDataSource control's `UserId` parameter to the currently logged in user's `UserId` before the data is selected.</span></span> <span data-ttu-id="80e4d-273">這可藉由建立事件處理常式的 SqlDataSource`Selecting`事件，並加入下列程式碼那里：</span><span class="sxs-lookup"><span data-stu-id="80e4d-273">This can be accomplished by creating an event handler for the SqlDataSource's `Selecting` event and adding the following code there:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample2.vb)]

<span data-ttu-id="80e4d-274">上述的程式碼開始，取得目前登入使用者的參考，藉由呼叫`Membership`類別的`GetUser`方法。</span><span class="sxs-lookup"><span data-stu-id="80e4d-274">The above code starts by obtaining a reference to the currently logged on user by calling the `Membership` class's `GetUser` method.</span></span> <span data-ttu-id="80e4d-275">這會傳回`MembershipUser`物件，其`ProviderUserKey`屬性包含`UserId`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-275">This returns a `MembershipUser` object, whose `ProviderUserKey` property contains the `UserId`.</span></span> <span data-ttu-id="80e4d-276">`UserId`值接著會指派給 SqlDataSource`@UserId`參數。</span><span class="sxs-lookup"><span data-stu-id="80e4d-276">The `UserId` value is then assigned to the SqlDataSource's `@UserId` parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="80e4d-277">`Membership.GetUser()`方法會傳回目前登入使用者的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-277">The `Membership.GetUser()` method returns information about the currently logged on user.</span></span> <span data-ttu-id="80e4d-278">如果匿名使用者已瀏覽頁面，則會傳回值為`Nothing`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-278">If an anonymous user is visiting the page, it will return a value of `Nothing`.</span></span> <span data-ttu-id="80e4d-279">在這種情況下，這會導致`NullReferenceException`的程式碼時嘗試讀取下一行`ProviderUserKey`屬性。</span><span class="sxs-lookup"><span data-stu-id="80e4d-279">In such a case, this will lead to a `NullReferenceException` on the following line of code when attempting to read the `ProviderUserKey` property.</span></span> <span data-ttu-id="80e4d-280">當然，我們不需要擔心`Membership.GetUser()`傳回中為 Nothing`AdditionalUserInfo.aspx`頁面上，因為我們將設定 URL 授權在上一個教學課程中，以便只有驗證的使用者無法存取此資料夾中的 ASP.NET 資源。</span><span class="sxs-lookup"><span data-stu-id="80e4d-280">Of course, we don't have to worry about `Membership.GetUser()` returning Nothing in the `AdditionalUserInfo.aspx` page because we configured URL authorization in a previous tutorial so that only authenticated users could access the ASP.NET resources in this folder.</span></span> <span data-ttu-id="80e4d-281">如果您需要存取目前登入的使用者允許匿名存取的位置在頁面的相關資訊，請務必檢查`MembershipUser`從傳回的物件`GetUser()`方法不是 Nothing 之前參考其屬性。</span><span class="sxs-lookup"><span data-stu-id="80e4d-281">If you need to access information about the currently logged on user in a page where anonymous access is permitted, make sure to check that the `MembershipUser` object returned from the `GetUser()` method is not Nothing before referencing its properties.</span></span>


<span data-ttu-id="80e4d-282">如果您瀏覽`AdditionalUserInfo.aspx`頁面透過瀏覽器您會看到一個空白網頁，因為我們尚未將任何資料列加入`UserProfiles`資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-282">If you visit the `AdditionalUserInfo.aspx` page through a browser you will see a blank page because we have yet to add any rows to the `UserProfiles` table.</span></span> <span data-ttu-id="80e4d-283">步驟 6 中我們將探討如何自訂適用於 CreateUserWizard 控制項，以自動新增至新的資料列`UserProfiles`資料表時建立新的使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="80e4d-283">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span> <span data-ttu-id="80e4d-284">不過，現在，我們將需要手動建立記錄資料表中。</span><span class="sxs-lookup"><span data-stu-id="80e4d-284">For now, however, we will need to manually create a record in the table.</span></span>

<span data-ttu-id="80e4d-285">巡覽至 Visual Studio 中的 [資料庫總管] 並展開 [資料表] 資料夾。</span><span class="sxs-lookup"><span data-stu-id="80e4d-285">Navigate to the Database Explorer in Visual Studio and expand the Tables folder.</span></span> <span data-ttu-id="80e4d-286">以滑鼠右鍵按一下`aspnet_Users`資料表並選擇 顯示資料表資料 」 以查看資料表中的記錄; 執行相同的動作，`UserProfiles`資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-286">Right-click on the `aspnet_Users` table and choose "Show Table Data" to see the records in the table; do the same thing for the `UserProfiles` table.</span></span> <span data-ttu-id="80e4d-287">圖 11 顯示垂直並排顯示時，這些結果。</span><span class="sxs-lookup"><span data-stu-id="80e4d-287">Figure 11 shows these results when tiled vertically.</span></span> <span data-ttu-id="80e4d-288">在 我的資料庫中目前沒有`aspnet_Users`Bruce、 Fred 和 Tito，記錄，但沒有記錄在`UserProfiles`資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-288">In my database there are currently `aspnet_Users` records for Bruce, Fred, and Tito, but no records in the `UserProfiles` table.</span></span>


<span data-ttu-id="80e4d-289">[![Aspnet_Users 的內容和 UserProfiles 資料表會顯示](storing-additional-user-information-vb/_static/image32.png)](storing-additional-user-information-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-289">[![The Contents of the aspnet_Users and UserProfiles Tables are Displayed](storing-additional-user-information-vb/_static/image32.png)](storing-additional-user-information-vb/_static/image31.png)</span></span>

<span data-ttu-id="80e4d-290">**圖 11**: 內容`aspnet_Users`和`UserProfiles`資料表會顯示 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-290">**Figure 11**: The Contents of the `aspnet_Users` and `UserProfiles` Tables are Displayed  ([Click to view full-size image](storing-additional-user-information-vb/_static/image33.png))</span></span>


<span data-ttu-id="80e4d-291">新增新記錄以`UserProfiles`手動輸入的值中的資料表`HomeTown`， `HomepageUrl`，和`Signature`欄位。</span><span class="sxs-lookup"><span data-stu-id="80e4d-291">Add a new record to the `UserProfiles` table by manually typing in values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span> <span data-ttu-id="80e4d-292">若要取得有效的最簡單的方式`UserId`在新的值`UserProfiles`記錄是選取`UserId`欄位中的特定使用者帳戶從`aspnet_Users`資料表，然後複製並貼到`UserId`欄位`UserProfiles`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-292">The easiest way to get a valid `UserId` value in the new `UserProfiles` record is to select the `UserId` field from a particular user account in the `aspnet_Users` table and copy and paste it into the `UserId` field in `UserProfiles`.</span></span> <span data-ttu-id="80e4d-293">圖 12 顯示`UserProfiles`資料表之後 Bruce 已加入新的記錄。</span><span class="sxs-lookup"><span data-stu-id="80e4d-293">Figure 12 shows the `UserProfiles` table after a new record has been added for Bruce.</span></span>


<span data-ttu-id="80e4d-294">[![記錄新增至 UserProfiles Bruce 的](storing-additional-user-information-vb/_static/image35.png)](storing-additional-user-information-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-294">[![A Record was Added to UserProfiles for Bruce](storing-additional-user-information-vb/_static/image35.png)](storing-additional-user-information-vb/_static/image34.png)</span></span>

<span data-ttu-id="80e4d-295">**圖 12**: A 記錄已加入至`UserProfiles`如 Bruce ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-295">**Figure 12**: A Record was Added to `UserProfiles` for Bruce  ([Click to view full-size image](storing-additional-user-information-vb/_static/image36.png))</span></span>


<span data-ttu-id="80e4d-296">返回`AdditionalUserInfo.aspx page`、 Bruce 為登入。</span><span class="sxs-lookup"><span data-stu-id="80e4d-296">Return to the `AdditionalUserInfo.aspx page`, logged in as Bruce.</span></span> <span data-ttu-id="80e4d-297">如圖 13 所示，Bruce 的設定會顯示。</span><span class="sxs-lookup"><span data-stu-id="80e4d-297">As Figure 13 shows, Bruce's settings are displayed.</span></span>


<span data-ttu-id="80e4d-298">[![目前瀏覽使用者是顯示 His 的設定](storing-additional-user-information-vb/_static/image38.png)](storing-additional-user-information-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-298">[![The Currently Visiting User is Shown His Settings](storing-additional-user-information-vb/_static/image38.png)](storing-additional-user-information-vb/_static/image37.png)</span></span>

<span data-ttu-id="80e4d-299">**圖 13**: 目前瀏覽使用者是顯示 His 設定 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-299">**Figure 13**: The Currently Visiting User is Shown His Settings  ([Click to view full-size image](storing-additional-user-information-vb/_static/image39.png))</span></span>


> [!NOTE]
> <span data-ttu-id="80e4d-300">移往前或以手動方式新增記錄`UserProfiles`資料表針對每個成員資格使用者。</span><span class="sxs-lookup"><span data-stu-id="80e4d-300">Go ahead and manually add records in the `UserProfiles` table for each Membership user.</span></span> <span data-ttu-id="80e4d-301">步驟 6 中我們將探討如何自訂適用於 CreateUserWizard 控制項，以自動新增至新的資料列`UserProfiles`資料表時建立新的使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="80e4d-301">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span>


## <a name="step-3-allowing-the-user-to-edit-his-home-town-homepage-and-signature"></a><span data-ttu-id="80e4d-302">步驟 3： 允許使用者編輯他首頁城鎮、 首頁和簽章</span><span class="sxs-lookup"><span data-stu-id="80e4d-302">Step 3: Allowing the User to Edit His Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="80e4d-303">此時目前登入的使用者可以檢視其主城鎮、 首頁上，以及簽章設定，但他們不能尚未修改。</span><span class="sxs-lookup"><span data-stu-id="80e4d-303">At this point the currently logged in user can view their home town, homepage, and signature setting, but they cannot yet modify them.</span></span> <span data-ttu-id="80e4d-304">讓我們來更新 DetailsView 控制項，讓資料可供編輯。</span><span class="sxs-lookup"><span data-stu-id="80e4d-304">Let's update the DetailsView control so that the data can be edited.</span></span>

<span data-ttu-id="80e4d-305">我們要做的第一件事就是加入`UpdateCommand`SqlDataSource，如指定`UPDATE`陳述式執行和其相對應的參數。</span><span class="sxs-lookup"><span data-stu-id="80e4d-305">The first thing we need to do is add an `UpdateCommand` for the SqlDataSource, specifying the `UPDATE` statement to execute and its corresponding parameters.</span></span> <span data-ttu-id="80e4d-306">選取 SqlDataSource，並從 屬性 視窗中，按一下即可啟動 命令及參數編輯器對話方塊的 UpdateQuery 屬性旁邊的省略符號。</span><span class="sxs-lookup"><span data-stu-id="80e4d-306">Select the SqlDataSource and, from the Properties window, click on the ellipses next to the UpdateQuery property to bring up the Command and Parameter Editor dialog box.</span></span> <span data-ttu-id="80e4d-307">輸入下列`UPDATE` 文字方塊中的陳述式：</span><span class="sxs-lookup"><span data-stu-id="80e4d-307">Enter the following `UPDATE` statement into the textbox:</span></span>

[!code-sql[Main](storing-additional-user-information-vb/samples/sample3.sql)]

<span data-ttu-id="80e4d-308">接下來，按一下 [重新整理參數] 按鈕，將會在 SqlDataSource 控制項的建立參數`UpdateParameters`中的參數集合`UPDATE`陳述式。</span><span class="sxs-lookup"><span data-stu-id="80e4d-308">Next, click the "Refresh Parameters" button, which will create a parameter in the SqlDataSource control's `UpdateParameters` collection for each of the parameters in the `UPDATE` statement.</span></span> <span data-ttu-id="80e4d-309">保留所有的參數集來源為 None，然後按一下 [確定] 按鈕以完成對話方塊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-309">Leave the source for all of the parameters set to None and click the OK button to complete the dialog box.</span></span>


<span data-ttu-id="80e4d-310">[![指定 SqlDataSource UpdateCommand 和 UpdateParameters](storing-additional-user-information-vb/_static/image41.png)](storing-additional-user-information-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-310">[![Specify the SqlDataSource's UpdateCommand and UpdateParameters](storing-additional-user-information-vb/_static/image41.png)](storing-additional-user-information-vb/_static/image40.png)</span></span>

<span data-ttu-id="80e4d-311">**圖 14**： 指定 SqlDataSource`UpdateCommand`和`UpdateParameters`([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-311">**Figure 14**: Specify the SqlDataSource's `UpdateCommand` and `UpdateParameters` ([Click to view full-size image](storing-additional-user-information-vb/_static/image42.png))</span></span>


<span data-ttu-id="80e4d-312">新增的項目因為我們對 SqlDataSource 控制項，DetailsView 控制項現在可以支援編輯。</span><span class="sxs-lookup"><span data-stu-id="80e4d-312">Due to the additions we made to the SqlDataSource control, the DetailsView control can now support editing.</span></span> <span data-ttu-id="80e4d-313">在 DetailsView 的智慧標籤上，從選取 「 啟用編輯 」 核取方塊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-313">From the DetailsView's Smart Tag, check the "Enable Editing" checkbox.</span></span> <span data-ttu-id="80e4d-314">這會加入控制項的 CommandField`Fields`集合，其`ShowEditButton`屬性設定為 True。</span><span class="sxs-lookup"><span data-stu-id="80e4d-314">This adds a CommandField to the control's `Fields` collection with its `ShowEditButton` property set to True.</span></span> <span data-ttu-id="80e4d-315">在 DetailsView 會顯示在唯讀模式和更新和取消按鈕時顯示在編輯模式時，這會呈現編輯 按鈕。</span><span class="sxs-lookup"><span data-stu-id="80e4d-315">This renders an Edit button when the DetailsView is displayed in read-only mode and Update and Cancel buttons when displayed in edit mode.</span></span> <span data-ttu-id="80e4d-316">不需要按一下 編輯使用者，不過，我們中可以有 DetailsView 呈現"一律可編輯的 「 狀態藉由設定 DetailsView 控制項的[`DefaultMode`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx)至`Edit`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-316">Rather than requiring the user to click Edit, though, we can have the DetailsView render in an "always editable" state by setting the DetailsView control's [`DefaultMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) to `Edit`.</span></span>

<span data-ttu-id="80e4d-317">這些變更，DetailsView 控制項的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="80e4d-317">With these changes, your DetailsView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample4.aspx)]

<span data-ttu-id="80e4d-318">請注意 CommandField 的加法和`DefaultMode`屬性。</span><span class="sxs-lookup"><span data-stu-id="80e4d-318">Note the addition of the CommandField and the `DefaultMode` property.</span></span>

<span data-ttu-id="80e4d-319">請繼續並測試此頁面，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="80e4d-319">Go ahead and test this page through a browser.</span></span> <span data-ttu-id="80e4d-320">當具有對應的記錄中的使用者使用瀏覽`UserProfiles`，使用者的設定會顯示在可編輯的介面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-320">When visiting with a user that has a corresponding record in `UserProfiles`, the user's settings are displayed in an editable interface.</span></span>


<span data-ttu-id="80e4d-321">[![在 DetailsView 呈現可編輯的介面](storing-additional-user-information-vb/_static/image44.png)](storing-additional-user-information-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-321">[![The DetailsView Renders an Editable Interface](storing-additional-user-information-vb/_static/image44.png)](storing-additional-user-information-vb/_static/image43.png)</span></span>

<span data-ttu-id="80e4d-322">**圖 15**: DetailsView 呈現可編輯的介面 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-322">**Figure 15**: The DetailsView Renders an Editable Interface  ([Click to view full-size image](storing-additional-user-information-vb/_static/image45.png))</span></span>


<span data-ttu-id="80e4d-323">再試一次變更的值，然後按一下 [更新] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="80e4d-323">Try changing the values and clicking the Update button.</span></span> <span data-ttu-id="80e4d-324">它會顯示一樣會發生任何事。</span><span class="sxs-lookup"><span data-stu-id="80e4d-324">It appears as if nothing happens.</span></span> <span data-ttu-id="80e4d-325">沒有回傳和值會儲存到資料庫，但是沒有儲存發生沒有視覺回應。</span><span class="sxs-lookup"><span data-stu-id="80e4d-325">There is a postback and the values are saved to the database, but there's no visual feedback that the save occurred.</span></span>

<span data-ttu-id="80e4d-326">若要補救這種情況，返回 Visual Studio，加入上述 DetailsView 的標籤控制項。</span><span class="sxs-lookup"><span data-stu-id="80e4d-326">To remedy this, return to Visual Studio and add a Label control above the DetailsView.</span></span> <span data-ttu-id="80e4d-327">設定其`ID`至`SettingsUpdatedMessage`、 其`Text`」 您的設定已更新，"的屬性和其`Visible`和`EnableViewState`屬性，以`False`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-327">Set its `ID` to `SettingsUpdatedMessage`, its `Text` property to "Your settings have been updated," and its `Visible` and `EnableViewState` properties to `False`.</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample5.aspx)]

<span data-ttu-id="80e4d-328">我們需要顯示`SettingsUpdatedMessage`只要更新 DetailsView 的標籤。</span><span class="sxs-lookup"><span data-stu-id="80e4d-328">We need to display the `SettingsUpdatedMessage` Label whenever the DetailsView is updated.</span></span> <span data-ttu-id="80e4d-329">若要達成此目的，建立事件處理常式在 DetailsView 的`ItemUpdated`事件並加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="80e4d-329">To accomplish this, create an event handler for the DetailsView's `ItemUpdated` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample6.vb)]

<span data-ttu-id="80e4d-330">返回`AdditionalUserInfo.aspx`頁面上透過瀏覽器及更新資料。</span><span class="sxs-lookup"><span data-stu-id="80e4d-330">Return to the `AdditionalUserInfo.aspx` page through a browser and update the data.</span></span> <span data-ttu-id="80e4d-331">此時，很有幫助的狀態訊息會顯示。</span><span class="sxs-lookup"><span data-stu-id="80e4d-331">This time, a helpful status message is displayed.</span></span>


<span data-ttu-id="80e4d-332">[![短訊息會顯示當設定會更新](storing-additional-user-information-vb/_static/image47.png)](storing-additional-user-information-vb/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-332">[![A Short Message is Displayed When the Settings are Updated](storing-additional-user-information-vb/_static/image47.png)](storing-additional-user-information-vb/_static/image46.png)</span></span>

<span data-ttu-id="80e4d-333">**圖 16**: 短訊息會顯示更新的設定時 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-333">**Figure 16**: A Short Message is Displayed When the Settings are Updated  ([Click to view full-size image](storing-additional-user-information-vb/_static/image48.png))</span></span>


> [!NOTE]
> <span data-ttu-id="80e4d-334">DetailsView 控制項的編輯介面讓人滿意。</span><span class="sxs-lookup"><span data-stu-id="80e4d-334">The DetailsView control's editing interface leaves a lot to be desired.</span></span> <span data-ttu-id="80e4d-335">它會使用標準大小的文字方塊中，但簽章欄位可能應該是多行文字方塊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-335">It uses standard-sized textboxes, but the Signature field should probably be a multi-line textbox.</span></span> <span data-ttu-id="80e4d-336">RegularExpressionValidator 應該用來確保首頁的 URL，如果輸入，會啟動以"http://"或"https://"。</span><span class="sxs-lookup"><span data-stu-id="80e4d-336">A RegularExpressionValidator should be used to ensure that the homepage URL, if entered, starts with "http://" or "https://".</span></span> <span data-ttu-id="80e4d-337">此外，因為 DetailsView 控制項有其`DefaultMode`屬性設定為`Edit`，[取消] 按鈕不會執行任何動作。</span><span class="sxs-lookup"><span data-stu-id="80e4d-337">Moreover, since the DetailsView control has its `DefaultMode` property set to `Edit`, the Cancel button does not do anything.</span></span> <span data-ttu-id="80e4d-338">它應該是或移除，按一下時，將使用者重新導向至其他網頁 (例如`~/Default.aspx`)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-338">It should either be removed or, when clicked, redirect the user to some other page (such as `~/Default.aspx`).</span></span> <span data-ttu-id="80e4d-339">做為練習保留這些增強功能時，我的讀取器。</span><span class="sxs-lookup"><span data-stu-id="80e4d-339">I leave these enhancements as an exercise for the reader.</span></span>


### <a name="adding-a-link-to-theadditionaluserinfoaspxpage-in-the-master-page"></a><span data-ttu-id="80e4d-340">加入連結`AdditionalUserInfo.aspx`[Master] 頁面中</span><span class="sxs-lookup"><span data-stu-id="80e4d-340">Adding a Link to the`AdditionalUserInfo.aspx`Page in the Master Page</span></span>

<span data-ttu-id="80e4d-341">目前，網站不提供任何連結`AdditionalUserInfo.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-341">Currently, the website does not provide any links to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="80e4d-342">連線到它的唯一方式是直接在瀏覽器的網址列中輸入網頁的 URL。</span><span class="sxs-lookup"><span data-stu-id="80e4d-342">The only way to reach it is to enter the page's URL directly into the browser's Address bar.</span></span> <span data-ttu-id="80e4d-343">讓我們將連結加入到此頁面在`Site.master`主版頁面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-343">Let's add a link to this page in the `Site.master` master page.</span></span>

<span data-ttu-id="80e4d-344">前文提過的主版頁面包含 LoginView Web 控制項在其`LoginContent`ContentPlaceHolder 顯示不同的標記為已驗證和匿名的訪客。</span><span class="sxs-lookup"><span data-stu-id="80e4d-344">Recall that the master page contains a LoginView Web control in its `LoginContent` ContentPlaceHolder that displays different markup for authenticated and anonymous visitors.</span></span> <span data-ttu-id="80e4d-345">更新 LoginView 控制項`LoggedInTemplate`加入連結`AdditionalUserInfo.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-345">Update the LoginView control's `LoggedInTemplate` to include a link to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="80e4d-346">這些變更後 LoginView 控制項的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="80e4d-346">After making these changes the LoginView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample7.aspx)]

<span data-ttu-id="80e4d-347">請注意新增`lnkUpdateSettings`超連結控制項以`LoggedInTemplate`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-347">Note the addition of the `lnkUpdateSettings` HyperLink control to the `LoggedInTemplate`.</span></span> <span data-ttu-id="80e4d-348">與就地這個連結，已驗證的使用者可以快速跳至頁面，檢視並修改其主城鎮、 首頁和簽章設定。</span><span class="sxs-lookup"><span data-stu-id="80e4d-348">With this link in place, authenticated users can quickly jump to the page to view and modify their home town, homepage, and signature settings.</span></span>

## <a name="step-4-adding-new-guestbook-comments"></a><span data-ttu-id="80e4d-349">步驟 4： 加入新的訪客簿註解</span><span class="sxs-lookup"><span data-stu-id="80e4d-349">Step 4: Adding New Guestbook Comments</span></span>

<span data-ttu-id="80e4d-350">`Guestbook.aspx`頁面是已驗證的使用者可檢視的訪客簿並留下註解。</span><span class="sxs-lookup"><span data-stu-id="80e4d-350">The `Guestbook.aspx` page is where authenticated users can view the guestbook and leave a comment.</span></span> <span data-ttu-id="80e4d-351">讓我們開始建立要加入新的訪客簿註解的介面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-351">Let's start with creating the interface to add new guestbook comments.</span></span>

<span data-ttu-id="80e4d-352">開啟`Guestbook.aspx`Visual Studio 中的頁面上，並建構兩個文字方塊控制項，一個用於新的註解主體，一個用於其本文所組成的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-352">Open the `Guestbook.aspx` page in Visual Studio and construct a user interface consisting of two TextBox controls, one for the new comment's subject and one for its body.</span></span> <span data-ttu-id="80e4d-353">將第一個文字方塊控制項的`ID`屬性`Subject`及其`Columns`為 40 的屬性，則將第二個`ID`至`Body`、 其`TextMode`至`MultiLine`，及其`Width`和`Rows`屬性，以"95%"和 8，分別。</span><span class="sxs-lookup"><span data-stu-id="80e4d-353">Set the first TextBox control's `ID` property to `Subject` and its `Columns` property to 40; set second's `ID` to `Body`, its `TextMode` to `MultiLine`, and its `Width` and `Rows` properties to "95%" and 8, respectively.</span></span> <span data-ttu-id="80e4d-354">若要完成的使用者介面，加入按鈕 Web 控制項，名為`PostCommentButton`並設定其`Text`「 張貼您的註解 」 的屬性。</span><span class="sxs-lookup"><span data-stu-id="80e4d-354">To complete the user interface, add a Button Web control named `PostCommentButton` and set its `Text` property to "Post Your Comment".</span></span>

<span data-ttu-id="80e4d-355">由於主旨和本文中需要每個訪客簿註解，請針對每個文字方塊加入 RequiredFieldValidator。</span><span class="sxs-lookup"><span data-stu-id="80e4d-355">Since each guestbook comment requires a subject and body, add a RequiredFieldValidator for each of the TextBoxes.</span></span> <span data-ttu-id="80e4d-356">設定`ValidationGroup`屬性的這些控制項，以 「 EnterComment"; 同樣地，設定`PostCommentButton`控制項的`ValidationGroup`"EnterComment"的屬性。</span><span class="sxs-lookup"><span data-stu-id="80e4d-356">Set the `ValidationGroup` property of these controls to "EnterComment"; likewise, set the `PostCommentButton` control's `ValidationGroup` property to "EnterComment".</span></span> <span data-ttu-id="80e4d-357">如需有關 ASP 的詳細資訊。網路的驗證控制項、 簽出[中 ASP.NET 表單驗證](http://www.4guysfromrolla.com/webtech/090200-1.shtml)，[將 ASP.NET 2.0 中的驗證控制項的分解](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)，而[驗證伺服器控制項教學課程](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp)在[W3Schools](http://www.w3schools.com/)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-357">For more information on ASP.NET's validation controls, check out [Form Validation in ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx), and the [Validation Server Controls Tutorial](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) on [W3Schools](http://www.w3schools.com/).</span></span>

<span data-ttu-id="80e4d-358">之後製作的使用者介面頁面的宣告式標記看起來應該像下面這樣：</span><span class="sxs-lookup"><span data-stu-id="80e4d-358">After crafting the user interface your page's declarative markup should look something like the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample8.aspx)]

<span data-ttu-id="80e4d-359">完整的使用者介面下, 一步是要插入新的記錄，到`GuestbookComments`資料表`PostCommentButton`按下。</span><span class="sxs-lookup"><span data-stu-id="80e4d-359">With the user interface complete, our next task is to insert a new record into the `GuestbookComments` table when the `PostCommentButton` is clicked.</span></span> <span data-ttu-id="80e4d-360">達成這點可以數種方式： 我們可以撰寫 ADO.NET 程式碼中的按鈕`Click`事件處理常式，我們可以將 SqlDataSource 控制項加入至頁面，設定其`InsertCommand`，然後呼叫其`Insert`方法從`Click`事件處理常式。或者我們可以建立負責插入新的訪客簿註解，將中介層，並叫用此功能，從`Click`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="80e4d-360">This can be accomplished in a number of ways: we can write ADO.NET code in the Button's `Click` event handler; we can add a SqlDataSource control to the page, configure its `InsertCommand`, and then call its `Insert` method from the `Click` event handler; or we could build a middle tier that was responsible for inserting new guestbook comments, and invoke this functionality from the `Click` event handler.</span></span> <span data-ttu-id="80e4d-361">因為我們還在使用 SqlDataSource 在步驟 3 中，讓我們這裡使用的 ADO.NET 程式碼。</span><span class="sxs-lookup"><span data-stu-id="80e4d-361">Since we looked at using a SqlDataSource in Step 3, let's use ADO.NET code here.</span></span>

> [!NOTE]
> <span data-ttu-id="80e4d-362">用來以程式設計方式存取資料，從 Microsoft SQL Server 資料庫的 ADO.NET 類別位於`System.Data.SqlClient`命名空間。</span><span class="sxs-lookup"><span data-stu-id="80e4d-362">The ADO.NET classes used to programmatically access data from a Microsoft SQL Server database are located in the `System.Data.SqlClient` namespace.</span></span> <span data-ttu-id="80e4d-363">您可能需要此命名空間匯入網頁的程式碼後置類別 (亦即， `Imports System.Data.SqlClient`)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-363">You may need to import this namespace into your page's code-behind class (i.e., `Imports System.Data.SqlClient`).</span></span>


<span data-ttu-id="80e4d-364">建立事件處理常式`PostCommentButton`的`Click`事件並加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="80e4d-364">Create an event handler for the `PostCommentButton`'s `Click` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample9.vb)]

<span data-ttu-id="80e4d-365">`Click`事件處理常式開始檢查使用者提供的資料無效。</span><span class="sxs-lookup"><span data-stu-id="80e4d-365">The `Click` event handler starts by checking that the user-supplied data is valid.</span></span> <span data-ttu-id="80e4d-366">如果不是，事件處理常式會在插入記錄之前結束。</span><span class="sxs-lookup"><span data-stu-id="80e4d-366">If it is not, the event handler exits before inserting a record.</span></span> <span data-ttu-id="80e4d-367">假設您所提供的資料是否有效，目前登入的使用者`UserId`值會擷取並儲存在`currentUserId`本機變數。</span><span class="sxs-lookup"><span data-stu-id="80e4d-367">Assuming the supplied data is valid, the currently logged on user's `UserId` value is retrieved and stored in the `currentUserId` local variable.</span></span> <span data-ttu-id="80e4d-368">需要此值，因為我們必須提供`UserId`值時插入記錄，到`GuestbookComments`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-368">This value is needed because we must supply a `UserId` value when inserting a record into `GuestbookComments`.</span></span>

<span data-ttu-id="80e4d-369">接下來的連接字串`SecurityTutorials`資料庫擷取自`Web.config`和`INSERT`指定 SQL 陳述式。</span><span class="sxs-lookup"><span data-stu-id="80e4d-369">Following that, the connection string for the `SecurityTutorials` database is retrieved from `Web.config` and the `INSERT` SQL statement is specified.</span></span> <span data-ttu-id="80e4d-370">A`SqlConnection`物件然後建立並開啟。</span><span class="sxs-lookup"><span data-stu-id="80e4d-370">A `SqlConnection` object is then created and opened.</span></span> <span data-ttu-id="80e4d-371">下一步`SqlCommand`物件建構和參數的值用於`INSERT`查詢指派。</span><span class="sxs-lookup"><span data-stu-id="80e4d-371">Next, a `SqlCommand` object is constructed and the values for the parameters used in the `INSERT` query are assigned.</span></span> <span data-ttu-id="80e4d-372">`INSERT`然後執行陳述式並關閉連線。</span><span class="sxs-lookup"><span data-stu-id="80e4d-372">The `INSERT` statement is then executed and the connection closed.</span></span> <span data-ttu-id="80e4d-373">事件處理常式結尾`Subject`和`Body`文字方塊`Text`，讓使用者的值不會保存跨回傳，將會清除的內容。</span><span class="sxs-lookup"><span data-stu-id="80e4d-373">At the end of the event handler, the `Subject` and `Body` TextBoxes' `Text` properties are cleared out so that the user's values are not persisted across the postback.</span></span>

<span data-ttu-id="80e4d-374">請繼續並測試這個瀏覽器中。</span><span class="sxs-lookup"><span data-stu-id="80e4d-374">Go ahead and test out this page in a browser.</span></span> <span data-ttu-id="80e4d-375">因為此頁面是在`Membership`資料夾不能存取為匿名的訪客。</span><span class="sxs-lookup"><span data-stu-id="80e4d-375">Since this page is in the `Membership` folder it is not accessible to anonymous visitors.</span></span> <span data-ttu-id="80e4d-376">因此，您必須先登入 （如果您還沒有）。</span><span class="sxs-lookup"><span data-stu-id="80e4d-376">Therefore, you will need to first log on (if you have not already).</span></span> <span data-ttu-id="80e4d-377">輸入值`Subject`和`Body`文字方塊按一下`PostCommentButton` 按鈕。</span><span class="sxs-lookup"><span data-stu-id="80e4d-377">Enter a value into the `Subject` and `Body` TextBoxes and click the `PostCommentButton` button.</span></span> <span data-ttu-id="80e4d-378">這會導致新的記錄加入至`GuestbookComments`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-378">This will cause a new record to be added to `GuestbookComments`.</span></span> <span data-ttu-id="80e4d-379">在回傳時，會抹除的主旨和本文您提供的文字方塊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-379">On postback, the subject and body you provided are wiped from the TextBoxes.</span></span>

<span data-ttu-id="80e4d-380">按一下後`PostCommentButton`有按鈕是沒有視覺回應可註解加入至訪客簿。</span><span class="sxs-lookup"><span data-stu-id="80e4d-380">After clicking the `PostCommentButton` button there is no visual feedback that the comment was added to the guestbook.</span></span> <span data-ttu-id="80e4d-381">我們仍需要更新以顯示現有的訪客簿註解，我們會執行步驟 5 中的此頁面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-381">We still need to update this page to display the existing guestbook comments, which we will do in Step 5.</span></span> <span data-ttu-id="80e4d-382">一旦我們達到此目的，只加入註解會出現在清單中的註解，提供適當的視覺化回應。</span><span class="sxs-lookup"><span data-stu-id="80e4d-382">Once we accomplish that, the just-added comment will appear in the list of comments, providing adequate visual feedback.</span></span> <span data-ttu-id="80e4d-383">現在，確認您的訪客簿註解已檢查的內容儲存`GuestbookComments`資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-383">For now, confirm that your guestbook comment was saved by examining the contents of the `GuestbookComments` table.</span></span>

<span data-ttu-id="80e4d-384">圖 17 顯示的內容`GuestbookComments`資料表後兩個註解已保留。</span><span class="sxs-lookup"><span data-stu-id="80e4d-384">Figure 17 shows the contents of the `GuestbookComments` table after two comments have been left.</span></span>


<span data-ttu-id="80e4d-385">[![您可以看到的訪客簿中的註解 GuestbookComments 資料表](storing-additional-user-information-vb/_static/image50.png)](storing-additional-user-information-vb/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-385">[![You Can See the Guestbook Comments in the GuestbookComments Table](storing-additional-user-information-vb/_static/image50.png)](storing-additional-user-information-vb/_static/image49.png)</span></span>

<span data-ttu-id="80e4d-386">**圖 17**： 您可以查看中的訪客簿註解`GuestbookComments`資料表 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-386">**Figure 17**: You Can See the Guestbook Comments in the `GuestbookComments` Table  ([Click to view full-size image](storing-additional-user-information-vb/_static/image51.png))</span></span>


> [!NOTE]
> <span data-ttu-id="80e4d-387">如果使用者嘗試插入的訪客簿註解，其中包含可能會擲回危險標記 – 例如 HTML – ASP.NET `HttpRequestValidationException`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-387">If a user attempts to insert a guestbook comment that contains potentially dangerous markup – such as HTML – ASP.NET will throw an `HttpRequestValidationException`.</span></span> <span data-ttu-id="80e4d-388">若要深入了解這個例外狀況，它會擲回原因，以及如何允許使用者提交具有潛在危險性的值，請參閱[要求驗證白皮書](../../../../whitepapers/request-validation.md)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-388">To learn more about this exception, why it's thrown, and how to permit users to submit potentially dangerous values, consult the [Request Validation Whitepaper](../../../../whitepapers/request-validation.md).</span></span>


## <a name="step-5-listing-the-existing-guestbook-comments"></a><span data-ttu-id="80e4d-389">步驟 5： 列出現有的訪客簿註解</span><span class="sxs-lookup"><span data-stu-id="80e4d-389">Step 5: Listing the Existing Guestbook Comments</span></span>

<span data-ttu-id="80e4d-390">除了保留註解、 使用者瀏覽`Guestbook.aspx`頁面應該也可以檢視的訪客簿現有註解。</span><span class="sxs-lookup"><span data-stu-id="80e4d-390">In addition to leaving comments, a user visiting the `Guestbook.aspx` page should also be able to view the guestbook's existing comments.</span></span> <span data-ttu-id="80e4d-391">若要完成這項作業，加入名為 ListView 控制項`CommentList`頁面的底部。</span><span class="sxs-lookup"><span data-stu-id="80e4d-391">To accomplish this, add a ListView control named `CommentList` to the bottom of the page.</span></span>

> [!NOTE]
> <span data-ttu-id="80e4d-392">ListView 控制項的新 asp.net 3.5 版。</span><span class="sxs-lookup"><span data-stu-id="80e4d-392">The ListView control is new to ASP.NET version 3.5.</span></span> <span data-ttu-id="80e4d-393">它被設計來顯示項目清單以非常可自訂且彈性的配置，但仍然可以提供內建編輯、 插入、 刪除、 分頁和排序 GridView 等功能。</span><span class="sxs-lookup"><span data-stu-id="80e4d-393">It is designed to display a list of items in a very customizable and flexible layout, yet still offer built-in editing, inserting, deleting, paging, and sorting functionality like the GridView.</span></span> <span data-ttu-id="80e4d-394">如果您使用 ASP.NET 2.0，您必須改用 DataList 或中繼器控制項。</span><span class="sxs-lookup"><span data-stu-id="80e4d-394">If you are using ASP.NET 2.0, you will need to use the DataList or Repeater control instead.</span></span> <span data-ttu-id="80e4d-395">如需有關如何使用清單檢視的詳細資訊，請參閱[Scott Guthrie](https://weblogs.asp.net/scottgu/)的部落格項目[asp: ListView 控制項](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)，和 我的文件： [ListView 控制項顯示的資料](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-395">For more information on using the ListView, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry, [The asp:ListView Control](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx), and my article, [Displaying Data with the ListView Control](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span></span>


<span data-ttu-id="80e4d-396">開啟 ListView 的智慧標籤，然後從 [選擇資料來源] 下拉式清單中，將控制項繫結至新的資料來源。</span><span class="sxs-lookup"><span data-stu-id="80e4d-396">Open the ListView's Smart Tag and, from the Choose Data Source drop-down list, bind the control to a new data source.</span></span> <span data-ttu-id="80e4d-397">如我們所見在步驟 2 中，這會啟動 資料來源組態精靈。</span><span class="sxs-lookup"><span data-stu-id="80e4d-397">As we saw in Step 2, this will launch the Data Source Configuration Wizard.</span></span> <span data-ttu-id="80e4d-398">選取資料庫圖示，產生 SqlDataSource `CommentsDataSource`，按一下 [確定]。</span><span class="sxs-lookup"><span data-stu-id="80e4d-398">Select the Database icon, name the resulting SqlDataSource `CommentsDataSource`, and click OK.</span></span> <span data-ttu-id="80e4d-399">接下來，選取`SecurityTutorialsConnectionString`連接字串從下拉式清單，並按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="80e4d-399">Next, select the `SecurityTutorialsConnectionString` connection string from the drop-down list and click Next.</span></span>

<span data-ttu-id="80e4d-400">此時在步驟 2 中我們要查詢的資料所指定挑選`UserProfiles`資料表下拉式清單中，選取要傳回的資料行 （請參閱上一步圖 9）。</span><span class="sxs-lookup"><span data-stu-id="80e4d-400">At this point in Step 2 we specified the data to query by picking the `UserProfiles` table from the drop-down list and selecting the columns to return (refer back to Figure 9).</span></span> <span data-ttu-id="80e4d-401">此時，不過，我們想要製作提取回不只記錄的 SQL 陳述式`GuestbookComments`，但也註解的家用城鎮、 首頁、 簽章和使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="80e4d-401">This time, however, we want to craft a SQL statement that pulls back not only the records from `GuestbookComments`, but also the commenter's home town, homepage, signature, and username.</span></span> <span data-ttu-id="80e4d-402">因此，選取的 「 指定的自訂 SQL 陳述式或預存程序 」 選項按鈕，然後按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="80e4d-402">Therefore, select the "Specify a custom SQL statement or stored procedure" radio button and click Next.</span></span>

<span data-ttu-id="80e4d-403">這會顯示 「 定義自訂陳述式或預存程序 」 畫面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-403">This will bring up the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="80e4d-404">按一下 [查詢產生器] 按鈕，以圖形方式建立查詢。</span><span class="sxs-lookup"><span data-stu-id="80e4d-404">Click the Query Builder button to graphically build the query.</span></span> <span data-ttu-id="80e4d-405">查詢產生器一開始會提示我們指定我們想要從查詢的資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-405">The Query Builder starts by prompting us to specify the tables we want to query from.</span></span> <span data-ttu-id="80e4d-406">選取`GuestbookComments`， `UserProfiles`，和`aspnet_Users`資料表，並按一下 [確定]。</span><span class="sxs-lookup"><span data-stu-id="80e4d-406">Select the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables and click OK.</span></span> <span data-ttu-id="80e4d-407">這會將所有的三個資料表加入設計介面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-407">This will add all three tables to the design surface.</span></span> <span data-ttu-id="80e4d-408">由於有之間的 foreign key 條件約束`GuestbookComments`， `UserProfiles`，和`aspnet_Users`資料表，查詢產生器自動`JOIN`s 這些資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-408">Since there are foreign key constraints amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables, the Query Builder automatically `JOIN` s these tables.</span></span>

<span data-ttu-id="80e4d-409">剩下的就是指定要傳回的資料行。</span><span class="sxs-lookup"><span data-stu-id="80e4d-409">All that remains is to specify the columns to return.</span></span> <span data-ttu-id="80e4d-410">從`GuestbookComments`資料表選取`Subject`， `Body`，和`CommentDate`資料行; 傳回`HomeTown`， `HomepageUrl`，和`Signature`中的資料行`UserProfiles`資料表;，並傳回`UserName`從`aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="80e4d-410">From the `GuestbookComments` table select the `Subject`, `Body`, and `CommentDate` columns; return the `HomeTown`, `HomepageUrl`, and `Signature` columns from the `UserProfiles` table; and return `UserName` from `aspnet_Users`.</span></span> <span data-ttu-id="80e4d-411">此外，請加入"`ORDER BY CommentDate DESC`"結尾`SELECT`查詢，以便先傳回最新的文章。</span><span class="sxs-lookup"><span data-stu-id="80e4d-411">Also, add "`ORDER BY CommentDate DESC`" to the end of the `SELECT` query so that the most recent posts are returned first.</span></span> <span data-ttu-id="80e4d-412">這些選取項目之後，您查詢產生器的介面應該類似螢幕擷取畫面圖 18。</span><span class="sxs-lookup"><span data-stu-id="80e4d-412">After making these selections, your Query Builder interface should look similar to the screen shot in Figure 18.</span></span>


<span data-ttu-id="80e4d-413">[![建構查詢聯結 GuestbookComments、 UserProfiles 和 aspnet_Users 資料表](storing-additional-user-information-vb/_static/image53.png)](storing-additional-user-information-vb/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-413">[![The Constructed Query JOINs the GuestbookComments, UserProfiles, and aspnet_Users Tables](storing-additional-user-information-vb/_static/image53.png)](storing-additional-user-information-vb/_static/image52.png)</span></span>

<span data-ttu-id="80e4d-414">**圖 18**： 建構查詢`JOIN`s `GuestbookComments`， `UserProfiles`，和`aspnet_Users`資料表 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-414">**Figure 18**: The Constructed Query `JOIN` s the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` Tables  ([Click to view full-size image](storing-additional-user-information-vb/_static/image54.png))</span></span>


<span data-ttu-id="80e4d-415">按一下 [確定] 關閉 [查詢產生器] 視窗，然後回到 「 定義自訂陳述式或預存程序 」 畫面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-415">Click OK to close the Query Builder window and return to the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="80e4d-416">按一下前進至 「 測試查詢 」 畫面上，其中您可以檢視查詢結果，依序按一下 [測試查詢] 按鈕旁邊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-416">Click Next to advance to the "Test Query" screen, where you may view the query results by clicking the Test Query button.</span></span> <span data-ttu-id="80e4d-417">當您準備好時，請按一下 [完成] 來完成設定資料來源精靈。</span><span class="sxs-lookup"><span data-stu-id="80e4d-417">When you're ready, click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="80e4d-418">當我們完成設定資料來源精靈，在步驟 2 中，關聯的 DetailsView 控制項的`Fields`集合已更新為包含每個資料行所傳回的 BoundField `SelectCommand`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-418">When we completed the Configure Data Source wizard in Step 2, the associated DetailsView control's `Fields` collection was updated to include a BoundField for each column returned by the `SelectCommand`.</span></span> <span data-ttu-id="80e4d-419">清單檢視，不過，維持不變;我們仍需要定義它的版面配置。</span><span class="sxs-lookup"><span data-stu-id="80e4d-419">The ListView, however, remains unchanged; we still need to define its layout.</span></span> <span data-ttu-id="80e4d-420">透過其宣告式標記，或在其智慧標籤 」 設定 ListView"選項中，可以手動建構 ListView 的配置。</span><span class="sxs-lookup"><span data-stu-id="80e4d-420">The ListView's layout can be constructed manually through its declarative markup or from the "Configure ListView" option in its Smart Tag.</span></span> <span data-ttu-id="80e4d-421">我通常偏好以手動方式定義標記，但使用為您最自然階層的任何方法。</span><span class="sxs-lookup"><span data-stu-id="80e4d-421">I usually prefer defining the markup by hand, but use whatever method is most natural to you.</span></span>

<span data-ttu-id="80e4d-422">我全數使用下列`LayoutTemplate`， `ItemTemplate`，和`ItemSeparatorTemplate`我的 ListView 控制項：</span><span class="sxs-lookup"><span data-stu-id="80e4d-422">I ended up using the following `LayoutTemplate`, `ItemTemplate`, and `ItemSeparatorTemplate` for my ListView control:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample10.aspx)]

<span data-ttu-id="80e4d-423">`LayoutTemplate`定義標記控制項所發出，而`ItemTemplate`呈現 SqlDataSource 所傳回的每個項目。</span><span class="sxs-lookup"><span data-stu-id="80e4d-423">The `LayoutTemplate` defines the markup emitted by the control, while the `ItemTemplate` renders each item returned by the SqlDataSource.</span></span> <span data-ttu-id="80e4d-424">`ItemTemplate`的結果標記置於`LayoutTemplate`的`itemPlaceholder`控制項。</span><span class="sxs-lookup"><span data-stu-id="80e4d-424">The `ItemTemplate`'s resulting markup is placed in the `LayoutTemplate`'s `itemPlaceholder` control.</span></span> <span data-ttu-id="80e4d-425">除了`itemPlaceholder`、`LayoutTemplate`包含 DataPager 控制項，這會限制在清單檢視顯示每一頁 （預設值） 的 10 個訪客簿註解，並呈現分頁介面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-425">In addition to the `itemPlaceholder`, the `LayoutTemplate` includes a DataPager control, which limits the ListView to showing just 10 guestbook comments per page (the default) and renders a paging interface.</span></span>

<span data-ttu-id="80e4d-426">我`ItemTemplate`顯示中的每個訪客簿註解主體`<h4>`具有以下主旨平均分攤工作量的主體項目。</span><span class="sxs-lookup"><span data-stu-id="80e4d-426">My `ItemTemplate` displays each guestbook comment's subject in an `<h4>` element with the body situated below the subject.</span></span> <span data-ttu-id="80e4d-427">請注意，用來顯示內文的語法採用所傳回的資料`Eval("Body")`資料繫結陳述式，將它轉換為字串，並取代分行符號與`<br />`項目。</span><span class="sxs-lookup"><span data-stu-id="80e4d-427">Note that syntax used for displaying the body takes the data returned by the `Eval("Body")` databinding statement, converts it to a string, and replaces line breaks with the `<br />` element.</span></span> <span data-ttu-id="80e4d-428">若要顯示輸入提交的註解，因為 HTML 會忽略空白字元時換行需要這項轉換。</span><span class="sxs-lookup"><span data-stu-id="80e4d-428">This conversion is needed in order to show the line breaks entered when submitting the comment since whitespace is ignored by HTML.</span></span> <span data-ttu-id="80e4d-429">使用者的簽章會顯示下方斜體使用者的家用城鎮，他首頁、 日期和時間進行註解，以及保留註解之人員的使用者名稱的連結中的主體。</span><span class="sxs-lookup"><span data-stu-id="80e4d-429">The user's signature is displayed beneath the body in italics, followed by the user's home town, a link to his homepage, the date and time the comment was made, and the username of the person who left the comment.</span></span>

<span data-ttu-id="80e4d-430">花點時間檢視透過瀏覽器頁面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-430">Take a moment to view the page through a browser.</span></span> <span data-ttu-id="80e4d-431">您應該會看到您加入的訪客簿在此處顯示的步驟 5 中的註解。</span><span class="sxs-lookup"><span data-stu-id="80e4d-431">You should see the comments that you added to the guestbook in Step 5 displayed here.</span></span>


<span data-ttu-id="80e4d-432">[![Guestbook.aspx 現在會顯示的訪客簿註解](storing-additional-user-information-vb/_static/image56.png)](storing-additional-user-information-vb/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-432">[![Guestbook.aspx Now Displays the Guestbook's Comments](storing-additional-user-information-vb/_static/image56.png)](storing-additional-user-information-vb/_static/image55.png)</span></span>

<span data-ttu-id="80e4d-433">**圖 19**:`Guestbook.aspx`現在會顯示的訪客簿註解 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-433">**Figure 19**: `Guestbook.aspx` Now Displays the Guestbook's Comments  ([Click to view full-size image](storing-additional-user-information-vb/_static/image57.png))</span></span>


<span data-ttu-id="80e4d-434">請嘗試將新註解加入至訪客簿。</span><span class="sxs-lookup"><span data-stu-id="80e4d-434">Try adding a new comment to the guestbook.</span></span> <span data-ttu-id="80e4d-435">按一下後`PostCommentButton`按鈕頁面回傳和註解加入至資料庫，但 ListView 控制項不會更新以顯示新的註解。</span><span class="sxs-lookup"><span data-stu-id="80e4d-435">Upon clicking the `PostCommentButton` button the page posts back and the comment is added to the database, but the ListView control is not updated to show the new comment.</span></span> <span data-ttu-id="80e4d-436">這可以透過其中一種以進行修正：</span><span class="sxs-lookup"><span data-stu-id="80e4d-436">This can be fixed by either:</span></span>

- <span data-ttu-id="80e4d-437">更新`PostCommentButton`按鈕的`Click`事件處理常式，它會叫用的 ListView 控制項的`DataBind()`方法之後的新註解插入資料庫，或</span><span class="sxs-lookup"><span data-stu-id="80e4d-437">Updating the `PostCommentButton` button's `Click` event handler so that it invokes the ListView control's `DataBind()` method after inserting the new comment into the database, or</span></span>
- <span data-ttu-id="80e4d-438">設定 ListView 控制項的`EnableViewState`屬性`False`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-438">Setting the ListView control's `EnableViewState` property to `False`.</span></span> <span data-ttu-id="80e4d-439">這種方式運作，因為停用控制項的檢視狀態，它必須重新繫結至基礎資料在每次回傳。</span><span class="sxs-lookup"><span data-stu-id="80e4d-439">This approach works because by disabling the control's view state, it must rebind to the underlying data on every postback.</span></span>

<span data-ttu-id="80e4d-440">教學課程的網站下載此教學課程將說明這兩種技術。</span><span class="sxs-lookup"><span data-stu-id="80e4d-440">The tutorial website downloadable from this tutorial illustrates both techniques.</span></span> <span data-ttu-id="80e4d-441">ListView 控制項的`EnableViewState`屬性`False`並且以程式設計方式重新繫結至清單資料所需的程式碼出現在`Click`事件處理常式，但標記為註解。</span><span class="sxs-lookup"><span data-stu-id="80e4d-441">The ListView control's `EnableViewState` property to `False` and the code needed to programmatically rebind the data to the ListView is present in the `Click` event handler, but is commented out.</span></span>

> [!NOTE]
> <span data-ttu-id="80e4d-442">目前`AdditionalUserInfo.aspx`頁面可讓使用者檢視和編輯其主城鎮、 首頁和簽章的設定。</span><span class="sxs-lookup"><span data-stu-id="80e4d-442">Currently the `AdditionalUserInfo.aspx` page allows the user to view and edit their home town, homepage, and signature settings.</span></span> <span data-ttu-id="80e4d-443">可能是很好更新`AdditionalUserInfo.aspx`顯示登入使用者的訪客簿註解。</span><span class="sxs-lookup"><span data-stu-id="80e4d-443">It might be nice to update `AdditionalUserInfo.aspx` to display the logged in user's guestbook comments.</span></span> <span data-ttu-id="80e4d-444">也就是說，除了檢查和修改其資訊，使用者可以瀏覽`AdditionalUserInfo.aspx`頁面，以查看哪些訪客簿註解她已在過去。</span><span class="sxs-lookup"><span data-stu-id="80e4d-444">That is, in addition to examining and modifying her information, a user can visit the `AdditionalUserInfo.aspx` page to see what guestbook comments she's made in the past.</span></span> <span data-ttu-id="80e4d-445">我將保留這為一項工作有興趣的讀取器。</span><span class="sxs-lookup"><span data-stu-id="80e4d-445">I leave this as an exercise for the interested reader.</span></span>


## <a name="step-6-customizing-the-createuserwizard-control-to-include-an-interface-for-the-home-town-homepage-and-signature"></a><span data-ttu-id="80e4d-446">步驟 6： 自訂適用於 CreateUserWizard 控制項包含首頁城鎮、 首頁和簽章的介面</span><span class="sxs-lookup"><span data-stu-id="80e4d-446">Step 6: Customizing the CreateUserWizard Control to Include an Interface for the Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="80e4d-447">`SELECT`所使用的查詢`Guestbook.aspx`頁面使用`INNER JOIN`合併相關的記錄之間`GuestbookComments`， `UserProfiles`，和`aspnet_Users`資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-447">The `SELECT` query used by the `Guestbook.aspx` page uses an `INNER JOIN` to combine the related records amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables.</span></span> <span data-ttu-id="80e4d-448">如果不有任何記錄中的使用者`UserProfiles`訪客簿發出，註解的註解不會顯示在清單檢視，因為`INNER JOIN`只會傳回`GuestbookComments`記錄中的相符記錄時`UserProfiles`和`aspnet_Users`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-448">If a user that has no record in `UserProfiles` makes a guestbook comment, the comment won't be displayed in the ListView because the `INNER JOIN` only returns `GuestbookComments` records when there are matching records in `UserProfiles` and `aspnet_Users`.</span></span> <span data-ttu-id="80e4d-449">以及我們了解在步驟 3 中，如果使用者沒有記錄`UserProfiles`她無法檢視或編輯其設定在`AdditionalUserInfo.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-449">And as we saw in Step 3, if a user does not have a record in `UserProfiles` she cannot view or edit her settings in the `AdditionalUserInfo.aspx` page.</span></span>

<span data-ttu-id="80e4d-450">不用說，因為我們的設計決策很重要的成員資格系統中每個使用者帳戶沒有相對應的記錄中`UserProfiles`資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-450">Needless to say, due to our design decisions it is important that every user account in the Membership system have a matching record in the `UserProfiles` table.</span></span> <span data-ttu-id="80e4d-451">我們想要為對應的記錄加入至`UserProfiles`透過適用於 CreateUserWizard 每次建立新的成員資格使用者帳戶時。</span><span class="sxs-lookup"><span data-stu-id="80e4d-451">What we want is for a corresponding record to be added to `UserProfiles` whenever a new Membership user account is created through the CreateUserWizard.</span></span>

<span data-ttu-id="80e4d-452">中所述[*建立使用者帳戶*](creating-user-accounts-vb.md)教學課程中，新的成員資格使用者帳戶建立適用於 CreateUserWizard 控制項之後會引發其[`CreatedUser`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="80e4d-452">As discussed in the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial, after the new Membership user account is created the CreateUserWizard control raises its [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span></span> <span data-ttu-id="80e4d-453">我們可以建立此事件的事件處理常式為剛建立的使用者，取得使用者識別碼，然後插入一筆記錄，到`UserProfiles`針對使用預設值的資料表`HomeTown`， `HomepageUrl`，和`Signature`資料行。</span><span class="sxs-lookup"><span data-stu-id="80e4d-453">We can create an event handler for this event, get the UserId for the just-created user, and then insert a record into the `UserProfiles` table with default values for the `HomeTown`, `HomepageUrl`, and `Signature` columns.</span></span> <span data-ttu-id="80e4d-454">不僅如此，很可能透過自訂適用於 CreateUserWizard 控制項的介面，以加入其他文字方塊會提示使用者輸入這些值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-454">What's more, it is possible to prompt the user for these values by customizing the CreateUserWizard control's interface to include additional TextBoxes.</span></span>

<span data-ttu-id="80e4d-455">讓我們先看看如何加入新的資料列`UserProfiles`資料表中`CreatedUser`事件處理常式和預設值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-455">Let's first look at how to add a new row to the `UserProfiles` table in the `CreatedUser` event handler with default values.</span></span> <span data-ttu-id="80e4d-456">接下來，我們會了解如何自訂適用於 CreateUserWizard 控制項的使用者介面，以包含新使用者的家用城鎮、 首頁和簽章所收集的其他表單欄位。</span><span class="sxs-lookup"><span data-stu-id="80e4d-456">Following that, we will see how to customize the CreateUserWizard control's user interface to include additional form fields to collect the new user's home town, homepage, and signature.</span></span>

### <a name="adding-a-default-row-touserprofiles"></a><span data-ttu-id="80e4d-457">加入到預設資料列`UserProfiles`</span><span class="sxs-lookup"><span data-stu-id="80e4d-457">Adding a Default Row to`UserProfiles`</span></span>

<span data-ttu-id="80e4d-458">在[*建立使用者帳戶*](creating-user-accounts-vb.md)教學課程中我們加入了適用於 CreateUserWizard 控制項`CreatingUserAccounts.aspx`頁面`Membership`資料夾。</span><span class="sxs-lookup"><span data-stu-id="80e4d-458">In the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial we added a CreateUserWizard control to the `CreatingUserAccounts.aspx` page in the `Membership` folder.</span></span> <span data-ttu-id="80e4d-459">為了有適用於 CreateUserWizard 控制項將記錄新增至`UserProfiles`資料表時建立使用者帳戶，我們需要更新適用於 CreateUserWizard 控制項的功能。</span><span class="sxs-lookup"><span data-stu-id="80e4d-459">In order to have the CreateUserWizard control add a record to `UserProfiles` table upon user account creation, we need to update the CreateUserWizard control's functionality.</span></span> <span data-ttu-id="80e4d-460">而不是執行這些變更`CreatingUserAccounts.aspx`頁面上，讓我們改為加入新的適用於 CreateUserWizard 控制項以`EnhancedCreateUserWizard.aspx`頁面上，並在此教學課程那里進行修改。</span><span class="sxs-lookup"><span data-stu-id="80e4d-460">Rather than making these changes to the `CreatingUserAccounts.aspx` page, let's instead add a new CreateUserWizard control to `EnhancedCreateUserWizard.aspx` page and make the modifications for this tutorial there.</span></span>

<span data-ttu-id="80e4d-461">開啟`EnhancedCreateUserWizard.aspx`Visual Studio 中的頁面上，並從 [工具箱] 拖曳至網頁拖曳適用於 CreateUserWizard 控制項。</span><span class="sxs-lookup"><span data-stu-id="80e4d-461">Open the `EnhancedCreateUserWizard.aspx` page in Visual Studio and drag a CreateUserWizard control from the Toolbox onto the page.</span></span> <span data-ttu-id="80e4d-462">設定適用於 CreateUserWizard 控制項`ID`屬性`NewUserWizard`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-462">Set the CreateUserWizard control's `ID` property to `NewUserWizard`.</span></span> <span data-ttu-id="80e4d-463">如我們所述[*建立使用者帳戶*](creating-user-accounts-vb.md)教學課程，適用於 CreateUserWizard 的預設使用者介面提示的訪客所需的資訊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-463">As we discussed in the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial, the CreateUserWizard's default user interface prompts the visitor for the necessary information.</span></span> <span data-ttu-id="80e4d-464">已提供這項資訊，控制項在內部會建立新的使用者帳戶在成員資格 framework 中，而不需我們需要撰寫一行程式碼。</span><span class="sxs-lookup"><span data-stu-id="80e4d-464">Once this information has been supplied, the control internally creates a new user account in the Membership framework, all without us having to write a single line of code.</span></span>

<span data-ttu-id="80e4d-465">適用於 CreateUserWizard 控制項在其工作流程期間引發的事件數目。</span><span class="sxs-lookup"><span data-stu-id="80e4d-465">The CreateUserWizard control raises a number of events during its workflow.</span></span> <span data-ttu-id="80e4d-466">適用於 CreateUserWizard 控制項訪客提供要求資訊並提交表單之後，一開始會引發其[`CreatingUser`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-466">After a visitor supplies the request information and submits the form, the CreateUserWizard control initially fires its [`CreatingUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span></span> <span data-ttu-id="80e4d-467">如果在建立過程中，問題[`CreateUserError`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx)引發; 不過，如果已成功建立使用者，然後在[`CreatedUser`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx)，就會引發。</span><span class="sxs-lookup"><span data-stu-id="80e4d-467">If there is a problem during the create process, the [`CreateUserError` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) is fired; however, if the user is successfully created, then the [`CreatedUser` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) is raised.</span></span> <span data-ttu-id="80e4d-468">在[*建立使用者帳戶*](creating-user-accounts-vb.md)教學課程中我們建立的事件處理常式`CreatingUser`事件以確保提供的使用者名稱未包含任何開頭或尾端空格，而且，使用者名稱中沒有出現任何位置的密碼。</span><span class="sxs-lookup"><span data-stu-id="80e4d-468">In the [*Creating User Accounts*](creating-user-accounts-vb.md) tutorial we created an event handler for the `CreatingUser` event to ensure that the supplied username did not contain any leading or trailing spaces, and that the username did not appear anywhere in the password.</span></span>

<span data-ttu-id="80e4d-469">若要加入的資料列中`UserProfiles`資料表剛建立的使用者，我們需要建立事件處理常式`CreatedUser`事件。</span><span class="sxs-lookup"><span data-stu-id="80e4d-469">In order to add a row in the `UserProfiles` table for the just-created user, we need to create an event handler for the `CreatedUser` event.</span></span> <span data-ttu-id="80e4d-470">依時間`CreatedUser`引發事件，使用者帳戶已建立在成員資格 framework 中，讓我們能夠擷取帳戶的使用者識別碼值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-470">By the time the `CreatedUser` event has fired, the user account has already been created in the Membership framework, enabling us to retrieve the account's UserId value.</span></span>

<span data-ttu-id="80e4d-471">建立事件處理常式`NewUserWizard`的`CreatedUser`事件並加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="80e4d-471">Create an event handler for the `NewUserWizard`'s `CreatedUser` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample11.vb)]

<span data-ttu-id="80e4d-472">上述程式碼身藉由擷取剛加入的使用者帳戶的使用者識別碼。</span><span class="sxs-lookup"><span data-stu-id="80e4d-472">The above code beings by retrieving the UserId of the just-added user account.</span></span> <span data-ttu-id="80e4d-473">這會透過使用`Membership.GetUser(username)`方法以傳回特定的使用者，然後將相關的資訊`ProviderUserKey`屬性，以擷取其使用者識別碼。</span><span class="sxs-lookup"><span data-stu-id="80e4d-473">This is accomplished by using the `Membership.GetUser(username)` method to return information about a particular user, and then using the `ProviderUserKey` property to retrieve their UserId.</span></span> <span data-ttu-id="80e4d-474">適用於 CreateUserWizard 控制項中的使用者所輸入的使用者名稱是可透過其[`UserName`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-474">The username entered by the user in the CreateUserWizard control is available via its [`UserName` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span></span>

<span data-ttu-id="80e4d-475">接下來，從擷取連接字串`Web.config`和`INSERT`指定陳述式。</span><span class="sxs-lookup"><span data-stu-id="80e4d-475">Next, the connection string is retrieved from `Web.config` and the `INSERT` statement is specified.</span></span> <span data-ttu-id="80e4d-476">必要的 ADO.NET 物件具現化並執行命令。</span><span class="sxs-lookup"><span data-stu-id="80e4d-476">The necessary ADO.NET objects are instantiated and the command executed.</span></span> <span data-ttu-id="80e4d-477">程式碼指派[ `DBNull` ](https://msdn.microsoft.com/library/system.dbnull.aspx)執行個體`@HomeTown`， `@HomepageUrl`，和`@Signature`參數，已插入資料庫的效果`NULL`值`HomeTown`， `HomepageUrl`，和`Signature`欄位。</span><span class="sxs-lookup"><span data-stu-id="80e4d-477">The code assigns a [`DBNull`](https://msdn.microsoft.com/library/system.dbnull.aspx) instance to the `@HomeTown`, `@HomepageUrl`, and `@Signature` parameters, which has the effect of inserting database `NULL` values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span>

<span data-ttu-id="80e4d-478">請瀏覽`EnhancedCreateUserWizard.aspx`頁面上透過瀏覽器，並建立新的使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="80e4d-478">Visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account.</span></span> <span data-ttu-id="80e4d-479">之後，請返回 Visual Studio，並檢查內容`aspnet_Users`和`UserProfiles`資料表 （如同我們在圖 12）。</span><span class="sxs-lookup"><span data-stu-id="80e4d-479">After doing so, return to Visual Studio and examine the contents of the `aspnet_Users` and `UserProfiles` tables (like we did back in Figure 12).</span></span> <span data-ttu-id="80e4d-480">您應該會看到新的使用者帳戶在`aspnet_Users`和對應`UserProfiles`資料列 (與`NULL`值`HomeTown`， `HomepageUrl`，和`Signature`)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-480">You should see the new user account in `aspnet_Users` and a corresponding `UserProfiles` row (with `NULL` values for `HomeTown`, `HomepageUrl`, and `Signature`).</span></span>


<span data-ttu-id="80e4d-481">[![已加入新的使用者帳戶和 UserProfiles 記錄](storing-additional-user-information-vb/_static/image59.png)](storing-additional-user-information-vb/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-481">[![A New User Account and UserProfiles Record Have Been Added](storing-additional-user-information-vb/_static/image59.png)](storing-additional-user-information-vb/_static/image58.png)</span></span>

<span data-ttu-id="80e4d-482">**圖 20**: 新的使用者帳戶和`UserProfiles`已加入資料錄 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-482">**Figure 20**: A New User Account and `UserProfiles` Record Have Been Added  ([Click to view full-size image](storing-additional-user-information-vb/_static/image60.png))</span></span>


<span data-ttu-id="80e4d-483">訪客具有提供其新的帳戶資訊，並按一下 [建立使用者] 按鈕，建立使用者帳戶，並加入一個資料列之後`UserProfiles`資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-483">After the visitor has supplied his new account information and clicked the "Create User" button, the user account is created and a row added to the `UserProfiles` table.</span></span> <span data-ttu-id="80e4d-484">適用於 CreateUserWizard 接著會顯示其`CompleteWizardStep`，其中顯示成功訊息並繼續 按鈕。</span><span class="sxs-lookup"><span data-stu-id="80e4d-484">The CreateUserWizard then displays its `CompleteWizardStep`, which displays a success message and a Continue button.</span></span> <span data-ttu-id="80e4d-485">按一下 [繼續] 按鈕會導致回傳，但未採取任何動作，而讓使用者卡上`EnhancedCreateUserWizard.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-485">Clicking the Continue button causes a postback, but no action is taken, leaving the user stuck on the `EnhancedCreateUserWizard.aspx` page.</span></span>

<span data-ttu-id="80e4d-486">我們可以指定要將使用者傳送至適用於 CreateUserWizard 控制項透過按一下 [繼續] 按鈕時的 URL [ `ContinueDestinationPageUrl`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-486">We can specify a URL to send the user to when the Continue button is clicked via the CreateUserWizard control's [`ContinueDestinationPageUrl` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span></span> <span data-ttu-id="80e4d-487">設定`ContinueDestinationPageUrl`屬性為"~ / Membership/AdditionalUserInfo.aspx"。</span><span class="sxs-lookup"><span data-stu-id="80e4d-487">Set the `ContinueDestinationPageUrl` property to "~/Membership/AdditionalUserInfo.aspx".</span></span> <span data-ttu-id="80e4d-488">這會帶到新的使用者`AdditionalUserInfo.aspx`，其中也可以檢視和更新其設定。</span><span class="sxs-lookup"><span data-stu-id="80e4d-488">This takes the new user to `AdditionalUserInfo.aspx`, where they can view and update their settings.</span></span>

### <a name="customizing-the-createuserwizards-interface-to-prompt-for-the-new-users-home-town-homepage-and-signature"></a><span data-ttu-id="80e4d-489">自訂適用於 CreateUserWizard 的介面，以提示輸入新使用者的家用城鎮、 首頁及簽章</span><span class="sxs-lookup"><span data-stu-id="80e4d-489">Customizing the CreateUserWizard's Interface to Prompt for the New User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="80e4d-490">適用於 CreateUserWizard 控制項的預設介面便足以讓簡單帳戶建立案例需要收集只有核心使用者帳戶資訊，例如使用者名稱、 密碼及電子郵件的位置。</span><span class="sxs-lookup"><span data-stu-id="80e4d-490">The CreateUserWizard control's default interface is sufficient for simple account creation scenarios where only core user account information like username, password, and email need be collected.</span></span> <span data-ttu-id="80e4d-491">但我們想要提示的訪客建立她的帳戶時輸入她家用城鎮、 首頁和簽章的該怎麼辦？</span><span class="sxs-lookup"><span data-stu-id="80e4d-491">But what if we wanted to prompt the visitor to enter her home town, homepage, and signature while creating her account?</span></span> <span data-ttu-id="80e4d-492">便可自訂適用於 CreateUserWizard 控制項的介面，以收集其他資訊在註冊期間取得，而這項資訊可能用於`CreatedUser`基礎資料庫中插入其他記錄的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="80e4d-492">It is possible to customize the CreateUserWizard control's interface to collect additional information at signup, and this information may be used in the `CreatedUser` event handler to insert additional records into the underlying database.</span></span>

<span data-ttu-id="80e4d-493">適用於 CreateUserWizard 控制項擴充 ASP.NET 精靈控制項的控制項，可讓網頁開發人員定義一系列的排序`WizardSteps`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-493">The CreateUserWizard control extends the ASP.NET Wizard control, which is a control that allows a page developer to define a series of ordered `WizardSteps`.</span></span> <span data-ttu-id="80e4d-494">精靈控制項轉譯使用中的步驟，並提供瀏覽介面，可將這些步驟的訪客。</span><span class="sxs-lookup"><span data-stu-id="80e4d-494">The Wizard control renders the active step and provides a navigation interface that allows the visitor to move through these steps.</span></span> <span data-ttu-id="80e4d-495">精靈控制項非常適用於較長的工作分成幾個簡短步驟。</span><span class="sxs-lookup"><span data-stu-id="80e4d-495">The Wizard control is ideal for breaking down a long task into several short steps.</span></span> <span data-ttu-id="80e4d-496">如需有關精靈控制項的詳細資訊，請參閱[逐步使用者介面建立與 ASP.NET 2.0 精靈控制項](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-496">For more information on the Wizard control, see [Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span></span>

<span data-ttu-id="80e4d-497">適用於 CreateUserWizard 控制項的預設標記會定義兩個`WizardSteps`:`CreateUserWizardStep`和`CompleteWizardStep`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-497">The CreateUserWizard control's default markup defines two `WizardSteps`: `CreateUserWizardStep` and `CompleteWizardStep`.</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample12.aspx)]

<span data-ttu-id="80e4d-498">第一個`WizardStep`， `CreateUserWizardStep`，呈現提示輸入使用者名稱、 密碼、 電子郵件、 等等的介面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-498">The first `WizardStep`, `CreateUserWizardStep`, renders the interface that prompts for the username, password, email, and so on.</span></span> <span data-ttu-id="80e4d-499">訪客提供這項資訊，並按一下 建立使用者 之後，她會顯示`CompleteWizardStep`，其中顯示成功訊息並繼續 按鈕。</span><span class="sxs-lookup"><span data-stu-id="80e4d-499">After the visitor supplies this information and clicks "Create User", she is shown the `CompleteWizardStep`, which shows the success message and a Continue button.</span></span>

<span data-ttu-id="80e4d-500">若要自訂適用於 CreateUserWizard 控制項的介面，以加入其他表單欄位，我們可以：</span><span class="sxs-lookup"><span data-stu-id="80e4d-500">To customize the CreateUserWizard control's interface to include additional form fields, we can:</span></span>

- <span data-ttu-id="80e4d-501"><strong>建立新的一或多個</strong><strong>`WizardStep`</strong><strong>以包含額外的使用者介面項目</strong>。</span><span class="sxs-lookup"><span data-stu-id="80e4d-501"><strong>Create one or more new</strong><strong>`WizardStep`</strong><strong>s to contain the additional user interface elements</strong>.</span></span> <span data-ttu-id="80e4d-502">若要將新`WizardStep`至適用於 CreateUserWizard，按一下 「 新增/移除`WizardStep`s 」 連結來啟動其智慧標籤`WizardStep`集合編輯器。</span><span class="sxs-lookup"><span data-stu-id="80e4d-502">To add a new `WizardStep` to the CreateUserWizard, click the "Add/Remove `WizardStep` s" link from its Smart Tag to launch the `WizardStep` Collection Editor.</span></span> <span data-ttu-id="80e4d-503">您可以從該處加入、 移除或重新排序精靈中的步驟。</span><span class="sxs-lookup"><span data-stu-id="80e4d-503">From there you can add, remove, or reorder the steps in the wizard.</span></span> <span data-ttu-id="80e4d-504">這是我們將使用此教學課程中的方法。</span><span class="sxs-lookup"><span data-stu-id="80e4d-504">This is the approach we will use for this tutorial.</span></span>

- <span data-ttu-id="80e4d-505"><strong>轉換</strong><strong>`CreateUserWizardStep`</strong><strong>成可編輯</strong><strong>`WizardStep`</strong><strong>。</strong></span><span class="sxs-lookup"><span data-stu-id="80e4d-505"><strong>Convert the</strong><strong>`CreateUserWizardStep`</strong><strong>into an editable</strong><strong>`WizardStep`</strong><strong>.</strong></span></span> <span data-ttu-id="80e4d-506">這會取代`CreateUserWizardStep`等同`WizardStep`其標記定義比對的使用者介面`CreateUserWizardStep`' s。</span><span class="sxs-lookup"><span data-stu-id="80e4d-506">This replaces the `CreateUserWizardStep` with an equivalent `WizardStep` whose markup defines a user interface that matches the `CreateUserWizardStep`'s.</span></span> <span data-ttu-id="80e4d-507">藉由轉換`CreateUserWizardStep`到`WizardStep`我們可以重新調整控制項位置，或將額外的使用者介面項目加入至這個步驟。</span><span class="sxs-lookup"><span data-stu-id="80e4d-507">By converting the `CreateUserWizardStep` into a `WizardStep` we can reposition the controls or add additional user interface elements to this step.</span></span> <span data-ttu-id="80e4d-508">要轉換`CreateUserWizardStep`或`CompleteWizardStep`成可編輯`WizardStep`、 按一下 自訂建立使用者步驟 」 或 「 自訂完成逐步 」 連結從控制項的智慧標籤。</span><span class="sxs-lookup"><span data-stu-id="80e4d-508">To convert the `CreateUserWizardStep` or `CompleteWizardStep` into an editable `WizardStep`, click the "Customize Create User Step" or "Customize Complete Step" link from the control's Smart Tag.</span></span>

- <span data-ttu-id="80e4d-509">**使用上述兩個選項的一些組合。**</span><span class="sxs-lookup"><span data-stu-id="80e4d-509">**Use some combination of the above two options.**</span></span>

<span data-ttu-id="80e4d-510">適用於 CreateUserWizard 控制項在中按一下 [建立使用者] 按鈕時，會執行其使用者帳戶建立程序是一個重要的事情，記住其`CreateUserWizardStep`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-510">One important thing to keep in mind is that the CreateUserWizard control executes its user account creation process when the "Create User" button is clicked from within its `CreateUserWizardStep`.</span></span> <span data-ttu-id="80e4d-511">不論是否有其他`WizardStep`之後 s`CreateUserWizardStep`與否。</span><span class="sxs-lookup"><span data-stu-id="80e4d-511">It doesn't matter if there are additional `WizardStep` s after the `CreateUserWizardStep` or not.</span></span>

<span data-ttu-id="80e4d-512">當加入自訂`WizardStep`至適用於 CreateUserWizard 控制項，以收集其他的使用者輸入，自訂`WizardStep`放之前或之後`CreateUserWizardStep`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-512">When adding a custom `WizardStep` to the CreateUserWizard control to collect additional user input, the custom `WizardStep` can be placed before or after the `CreateUserWizardStep`.</span></span> <span data-ttu-id="80e4d-513">如果它前面`CreateUserWizardStep`額外的使用者輸入再收集來自自訂`WizardStep`供`CreatedUser`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="80e4d-513">If it comes before the `CreateUserWizardStep` then the additional user input collected from the custom `WizardStep` is available for the `CreatedUser` event handler.</span></span> <span data-ttu-id="80e4d-514">不過，如果自訂`WizardStep`之後`CreateUserWizardStep`時再以自訂`WizardStep`會顯示已建立新的使用者帳戶和`CreatedUser`已經引發事件。</span><span class="sxs-lookup"><span data-stu-id="80e4d-514">However, if the custom `WizardStep` comes after `CreateUserWizardStep` then by the time the custom `WizardStep` is displayed the new user account has already been created and the `CreatedUser` event has already fired.</span></span>

<span data-ttu-id="80e4d-515">圖 21 顯示工作流程時加入`WizardStep`之前`CreateUserWizardStep`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-515">Figure 21 shows the workflow when the added `WizardStep` precedes the `CreateUserWizardStep`.</span></span> <span data-ttu-id="80e4d-516">因為已收集的其他使用者資訊的時間`CreatedUser`事件引發，我們只需要為 update`CreatedUser`事件處理常式，以擷取這些輸入使用的`INSERT`陳述式的參數值 （而非`DBNull.Value`).</span><span class="sxs-lookup"><span data-stu-id="80e4d-516">Since the additional user information has been collected by the time the `CreatedUser` event fires, all we have to do is update the `CreatedUser` event handler to retrieve these inputs and use those for the `INSERT` statement's parameter values (rather than `DBNull.Value`).</span></span>


<span data-ttu-id="80e4d-517">[![其他的 WizardStep 之前 CreateUserWizardStep 時適用於 CreateUserWizard 工作流程](storing-additional-user-information-vb/_static/image62.png)](storing-additional-user-information-vb/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-517">[![The CreateUserWizard Workflow When an Additional WizardStep Precedes the CreateUserWizardStep](storing-additional-user-information-vb/_static/image62.png)](storing-additional-user-information-vb/_static/image61.png)</span></span>

<span data-ttu-id="80e4d-518">**圖 21**: 適用於 CreateUserWizard 工作流程時其他`WizardStep`Precedes `CreateUserWizardStep` ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-518">**Figure 21**: The CreateUserWizard Workflow When an Additional `WizardStep` Precedes the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-vb/_static/image63.png))</span></span>


<span data-ttu-id="80e4d-519">如果自訂`WizardStep`放置*之後* `CreateUserWizardStep`，不過，建立使用者帳戶的處理程序，就會發生之前的使用者有機會來輸入她家用城鎮、 首頁或簽章。</span><span class="sxs-lookup"><span data-stu-id="80e4d-519">If the custom `WizardStep` is placed *after* the `CreateUserWizardStep`, however, the create user account process occurs before the user has had a chance to enter her home town, homepage, or signature.</span></span> <span data-ttu-id="80e4d-520">在這種情況下，這項額外資訊必須要插入至資料庫之後建立的使用者帳戶，如圖 22 所示。</span><span class="sxs-lookup"><span data-stu-id="80e4d-520">In such a case, this additional information needs to be inserted into the database after the user account has been created, as Figure 22 illustrates.</span></span>


<span data-ttu-id="80e4d-521">[![其他的 WizardStep 出現後 CreateUserWizardStep 時適用於 CreateUserWizard 工作流程](storing-additional-user-information-vb/_static/image65.png)](storing-additional-user-information-vb/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-521">[![The CreateUserWizard Workflow When an Additional WizardStep Comes After the CreateUserWizardStep](storing-additional-user-information-vb/_static/image65.png)](storing-additional-user-information-vb/_static/image64.png)</span></span>

<span data-ttu-id="80e4d-522">**圖 22**: 適用於 CreateUserWizard 工作流程時其他`WizardStep`出現之後`CreateUserWizardStep`([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-522">**Figure 22**: The CreateUserWizard Workflow When an Additional `WizardStep` Comes After the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-vb/_static/image66.png))</span></span>


<span data-ttu-id="80e4d-523">22 圖所示的工作流程等候插入到資料錄`UserProfiles`步驟 2 完成後，直到資料表。</span><span class="sxs-lookup"><span data-stu-id="80e4d-523">The workflow shown in Figure 22 waits to insert a record into the `UserProfiles` table until after Step 2 completes.</span></span> <span data-ttu-id="80e4d-524">若造訪者在步驟 1 之後關閉瀏覽器，不過，我們將達到的狀態，其中已建立的使用者帳戶，但沒有記錄已加入至`UserProfiles`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-524">If the visitor closes her browser after step 1, however, we will have reached a state where a user account was created, but no record was added to `UserProfiles`.</span></span> <span data-ttu-id="80e4d-525">解決方法之一是讓資料錄`NULL`或預設值插入至`UserProfiles`中`CreatedUser`（可在步驟 1 之後引發） 事件處理常式，並更新步驟 2 完成後，此記錄。</span><span class="sxs-lookup"><span data-stu-id="80e4d-525">One workaround is to have a record with `NULL` or default values inserted into `UserProfiles` in the `CreatedUser` event handler (which fires after step 1), and then update this record after step 2 completes.</span></span> <span data-ttu-id="80e4d-526">如此可確保`UserProfiles`記錄將會新增使用者帳戶，即使在使用者結束註冊程序中途島，透過。</span><span class="sxs-lookup"><span data-stu-id="80e4d-526">This ensures that a `UserProfiles` record will be added for the user account even if the user quits the registration process midway through.</span></span>

<span data-ttu-id="80e4d-527">此教學課程中我們來建立新`WizardStep`後出現`CreateUserWizardStep`前`CompleteWizardStep`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-527">For this tutorial let's create a new `WizardStep` that occurs after the `CreateUserWizardStep` but before the `CompleteWizardStep`.</span></span> <span data-ttu-id="80e4d-528">讓我們先取得中的 WizardStep 放置和設定，然後我們會查看程式碼。</span><span class="sxs-lookup"><span data-stu-id="80e4d-528">Let's first get the WizardStep in place and configured and then we'll look at the code.</span></span>

<span data-ttu-id="80e4d-529">從適用於 CreateUserWizard 控制項的智慧標籤上，選取 「 新增/移除`WizardStep`s"，它會啟動`WizardStep`集合編輯器對話方塊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-529">From the CreateUserWizard control's Smart Tag, select the "Add/Remove `WizardStep` s", which brings up the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="80e4d-530">加入新`WizardStep`，設定其`ID`至`UserSettings`、 其`Title`到 [您的設定] 並將其`StepType`至`Step`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-530">Add a new `WizardStep`, setting its `ID` to `UserSettings`, its `Title` to "Your Settings" and its `StepType` to `Step`.</span></span> <span data-ttu-id="80e4d-531">然後將它定位，讓它出現後`CreateUserWizardStep`（「 登入您的新帳戶的"），以及之前`CompleteWizardStep`（「 完成 」），如圖 23 所示。</span><span class="sxs-lookup"><span data-stu-id="80e4d-531">Then position it so that it comes after the `CreateUserWizardStep` ("Sign Up for Your New Account") and before the `CompleteWizardStep` ("Complete"), as shown in Figure 23.</span></span>


<span data-ttu-id="80e4d-532">[![適用於 CreateUserWizard 控制項中加入新的 WizardStep](storing-additional-user-information-vb/_static/image68.png)](storing-additional-user-information-vb/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="80e4d-532">[![Add a New WizardStep to the CreateUserWizard Control](storing-additional-user-information-vb/_static/image68.png)](storing-additional-user-information-vb/_static/image67.png)</span></span>

<span data-ttu-id="80e4d-533">**圖 23**： 加入新`WizardStep`適用於 CreateUserWizard 控制項 ([按一下以檢視完整大小的影像](storing-additional-user-information-vb/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="80e4d-533">**Figure 23**: Add a New `WizardStep` to the CreateUserWizard Control  ([Click to view full-size image](storing-additional-user-information-vb/_static/image69.png))</span></span>


<span data-ttu-id="80e4d-534">按一下 [確定] 關閉`WizardStep`集合編輯器對話方塊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-534">Click OK to close the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="80e4d-535">新`WizardStep`總合由適用於 CreateUserWizard 控制項的更新的宣告式標記：</span><span class="sxs-lookup"><span data-stu-id="80e4d-535">The new `WizardStep` is evidenced by the CreateUserWizard control's updated declarative markup:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample13.aspx)]

<span data-ttu-id="80e4d-536">請注意新`<asp:WizardStep>`項目。</span><span class="sxs-lookup"><span data-stu-id="80e4d-536">Note the new `<asp:WizardStep>` element.</span></span> <span data-ttu-id="80e4d-537">我們需要加入使用者介面，以收集新使用者的家用城鎮、 首頁上，與此簽章。</span><span class="sxs-lookup"><span data-stu-id="80e4d-537">We need to add the user interface to collect the new user's home town, homepage, and signature here.</span></span> <span data-ttu-id="80e4d-538">宣告式語法中，或透過設計工具，您可以輸入此內容。</span><span class="sxs-lookup"><span data-stu-id="80e4d-538">You can enter this content in the declarative syntax or through the Designer.</span></span> <span data-ttu-id="80e4d-539">若要使用設計工具，請從下拉式清單，請參閱 < 設計工具中的步驟在智慧標籤在選取 「 您的設定 」 步驟。</span><span class="sxs-lookup"><span data-stu-id="80e4d-539">To use the Designer, select the "Your Settings" step from the drop-down list in the Smart Tag to see the step in the Designer.</span></span>

> [!NOTE]
> <span data-ttu-id="80e4d-540">選取透過智慧標籤的下拉式清單中的步驟更新適用於 CreateUserWizard 控制項[`ActiveStepIndex`屬性](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx)，以指定的索引開始的步驟。</span><span class="sxs-lookup"><span data-stu-id="80e4d-540">Selecting a step through the Smart Tag's drop-down list updates the CreateUserWizard control's [`ActiveStepIndex` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), which specifies the index of the starting step.</span></span> <span data-ttu-id="80e4d-541">因此，如果您使用此下拉式清單來編輯設計工具中的 「 您的設定 」 步驟，請確定服務設回 「 登註冊您新帳戶 」，讓使用者第一次瀏覽時顯示此步驟`EnhancedCreateUserWizard.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-541">Therefore, if you use this drop-down list to edit the "Your Settings" step in the Designer, be sure to set it back to "Sign Up for Your New Account" so that this step is shown when users first visit the `EnhancedCreateUserWizard.aspx` page.</span></span>


<span data-ttu-id="80e4d-542">建立使用者介面包含三個文字方塊控制項，名為 「 您的設定 」 步驟內`HomeTown`， `HomepageUrl`，和`Signature`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-542">Create a user interface within the "Your Settings" step that contains three TextBox controls named `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="80e4d-543">之後建構這個介面時，適用於 CreateUserWizard 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="80e4d-543">After constructing this interface, the CreateUserWizard's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-vb/samples/sample14.aspx)]

<span data-ttu-id="80e4d-544">請繼續並造訪此頁透過瀏覽器，並建立新的使用者帳戶，指定主城鎮、 首頁和簽章的值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-544">Go ahead and visit this page through a browser and create a new user account, specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="80e4d-545">完成之後`CreateUserWizardStep`成員資格架構中建立使用者帳戶和`CreatedUser`事件處理常式執行時，這會將新的資料列`UserProfiles`，但資料庫`NULL`值`HomeTown`， `HomepageUrl`，和`Signature`.</span><span class="sxs-lookup"><span data-stu-id="80e4d-545">After completing the `CreateUserWizardStep` the user account is created in the Membership framework and the `CreatedUser` event handler runs, which adds a new row to `UserProfiles`, but with a database `NULL` value for `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="80e4d-546">永遠不會使用家用城鎮、 首頁和簽章的輸入值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-546">The values entered for the home town, homepage, and signature are never used.</span></span> <span data-ttu-id="80e4d-547">最後結果就是新的使用者帳戶`UserProfiles`記錄其`HomeTown`， `HomepageUrl`，和`Signature`欄位尚未指定。</span><span class="sxs-lookup"><span data-stu-id="80e4d-547">The net result is a new user account with a `UserProfiles` record whose `HomeTown`, `HomepageUrl`, and `Signature` fields have yet to be specified.</span></span>

<span data-ttu-id="80e4d-548">我們要在可接受使用者輸入的家用城鎮、 honepage 和簽章值，且更新適當的 「 您的設定 」 步驟之後執行程式碼`UserProfiles`記錄。</span><span class="sxs-lookup"><span data-stu-id="80e4d-548">We need to execute code after the "Your Settings" step that takes the home town, honepage, and signature values entered by the user and updates the appropriate `UserProfiles` record.</span></span> <span data-ttu-id="80e4d-549">每次使用者在精靈中的步驟之間移動控制項，精靈的[`ActiveStepChanged`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx)引發。</span><span class="sxs-lookup"><span data-stu-id="80e4d-549">Each time the user moves between steps in a Wizard control, the Wizard's [`ActiveStepChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) fires.</span></span> <span data-ttu-id="80e4d-550">我們可以建立此事件和更新的事件處理常式`UserProfiles`資料表時已完成 「 您的設定 」 步驟。</span><span class="sxs-lookup"><span data-stu-id="80e4d-550">We can create an event handler for this event and update the `UserProfiles` table when the "Your Settings" step has completed.</span></span>

<span data-ttu-id="80e4d-551">加入事件處理常式適用於 CreateUserWizard`ActiveStepChanged`事件並加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="80e4d-551">Add an event handler for the CreateUserWizard's `ActiveStepChanged` event and add the following code:</span></span>

[!code-vb[Main](storing-additional-user-information-vb/samples/sample15.vb)]

<span data-ttu-id="80e4d-552">上述程式碼一開始會判斷如果我們已到達 [完成] 步驟。</span><span class="sxs-lookup"><span data-stu-id="80e4d-552">The above code starts by determining if we have just reached the "Complete" step.</span></span> <span data-ttu-id="80e4d-553">因為立即在 [您的設定] 步驟之後，就會發生 「 完成 」 步驟，然後訪客達到 「 完成 」 逐步表示她剛剛完成 「 您的設定 」 步驟。</span><span class="sxs-lookup"><span data-stu-id="80e4d-553">Since the "Complete" step occurs immediately after the "Your Settings" step, then when the visitor reaches "Complete" step that means she just finished the "Your Settings" step.</span></span>

<span data-ttu-id="80e4d-554">在這種情況下，我們需要以程式設計方式參考文字方塊控制項內`UserSettings WizardStep`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-554">In such a case, we need to programmatically reference the TextBox controls within the `UserSettings WizardStep`.</span></span> <span data-ttu-id="80e4d-555">做法是先使用`FindControl`方法來以程式設計方式參考`UserSettings WizardStep`，然後再一次參考文字方塊內`WizardStep`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-555">This is accomplished by first using the `FindControl` method to programmatically referencing the `UserSettings WizardStep`, and then again to reference the TextBoxes from within the `WizardStep`.</span></span> <span data-ttu-id="80e4d-556">只要參考的文字方塊，我們可以開始執行`UPDATE`陳述式。</span><span class="sxs-lookup"><span data-stu-id="80e4d-556">Once the TextBoxes have been referenced, we're ready to execute the `UPDATE` statement.</span></span> <span data-ttu-id="80e4d-557">`UPDATE`陳述式有相同數目的參數做為`INSERT`陳述式中的`CreatedUser`事件處理常式，但我們這裡使用的使用者所提供的家用城鎮、 首頁和簽章值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-557">The `UPDATE` statement has the same number of parameters as the `INSERT` statement in the `CreatedUser` event handler, but here we use the home town, homepage, and signature values supplied by the user.</span></span>

<span data-ttu-id="80e4d-558">與就地此事件處理常式，請瀏覽`EnhancedCreateUserWizard.aspx`頁面上透過瀏覽器，並建立新的使用者帳戶指定主城鎮、 首頁和簽章的值。</span><span class="sxs-lookup"><span data-stu-id="80e4d-558">With this event handler in place, visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="80e4d-559">建立新帳戶後您應該會重新導向至`AdditionalUserInfo.aspx`頁面上，其中只輸入家用城鎮、 首頁和簽章會顯示的資訊。</span><span class="sxs-lookup"><span data-stu-id="80e4d-559">After creating the new account you should be redirected to the `AdditionalUserInfo.aspx` page, where the just-entered home town, homepage, and signature information is displayed.</span></span>

> [!NOTE]
> <span data-ttu-id="80e4d-560">我們的網站目前有兩個頁面的訪客可以從中建立新的帳戶：`CreatingUserAccounts.aspx`和`EnhancedCreateUserWizard.aspx`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-560">Our website currently has two pages from which a visitor can create a new account: `CreatingUserAccounts.aspx` and `EnhancedCreateUserWizard.aspx`.</span></span> <span data-ttu-id="80e4d-561">網站的 sitemap 和登入頁面指向`CreatingUserAccounts.aspx` 頁面上，但`CreatingUserAccounts.aspx`頁面不會提示使用者輸入其主城鎮、 首頁和簽章資訊，而且不加入至對應的資料列`UserProfiles`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-561">The website's sitemap and login page point to the `CreatingUserAccounts.aspx` page, but the `CreatingUserAccounts.aspx` page does not prompt the user for their home town, homepage, and signature information and does not add a corresponding row to `UserProfiles`.</span></span> <span data-ttu-id="80e4d-562">因此，更新`CreatingUserAccounts.aspx`頁面，如此它提供這項功能或更新的 sitemap 與登入頁面，即可參考`EnhancedCreateUserWizard.aspx`而不是`CreatingUserAccounts.aspx`。</span><span class="sxs-lookup"><span data-stu-id="80e4d-562">Therefore, either update the `CreatingUserAccounts.aspx` page so that it offers this functionality or update the sitemap and login page to reference `EnhancedCreateUserWizard.aspx` instead of `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="80e4d-563">如果您選擇第二種選項，請務必更新`Membership`資料夾的`Web.config`檔案，以允許匿名使用者存取`EnhancedCreateUserWizard.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="80e4d-563">If you choose the latter option, be sure to update the `Membership` folder's `Web.config` file so as to allow anonymous users access to the `EnhancedCreateUserWizard.aspx` page.</span></span>


## <a name="summary"></a><span data-ttu-id="80e4d-564">總結</span><span class="sxs-lookup"><span data-stu-id="80e4d-564">Summary</span></span>

<span data-ttu-id="80e4d-565">在此教學課程中我們探討了成員資格架構中的使用者帳戶相關的資料模型化的技術。</span><span class="sxs-lookup"><span data-stu-id="80e4d-565">In this tutorial we looked at techniques for modeling data that is related to user accounts within the Membership framework.</span></span> <span data-ttu-id="80e4d-566">特別是，我們會探討模型與使用者帳戶，以及共用一對一關聯性的資料共用一個對多關聯性的實體。</span><span class="sxs-lookup"><span data-stu-id="80e4d-566">In particular, we looked at modeling entities that share a one-to-many relationship with user accounts as well as data that shares a one-to-one relationship.</span></span> <span data-ttu-id="80e4d-567">此外，我們可了解這與資訊無法顯示、 插入和更新，透過使用 SqlDataSource 控制項和其他一些範例使用 ADO.NET 程式碼。</span><span class="sxs-lookup"><span data-stu-id="80e4d-567">Furthermore, we saw how this related information could be displayed, inserted, and updated, with some examples using the SqlDataSource control and others using ADO.NET code.</span></span>

<span data-ttu-id="80e4d-568">本教學課程完成我們查看使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="80e4d-568">This tutorial completes our look at user accounts.</span></span> <span data-ttu-id="80e4d-569">開頭為下一個教學課程中我們將會開啟我們注意到角色。</span><span class="sxs-lookup"><span data-stu-id="80e4d-569">Starting with the next tutorial we will turn our attention to roles.</span></span> <span data-ttu-id="80e4d-570">透過下幾個教學課程，我們將探討角色架構，請參閱 < 如何建立新的角色，如何將角色指派給使用者，來判斷哪些角色在使用者屬於，以及如何套用以角色為基礎的授權。</span><span class="sxs-lookup"><span data-stu-id="80e4d-570">Over the next several tutorials we will look at the Roles framework, see how to create new roles, how to assign roles to users, how to determine what roles a user belongs to, and how to apply role-based authorization.</span></span>

<span data-ttu-id="80e4d-571">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="80e4d-571">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="80e4d-572">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="80e4d-572">Further Reading</span></span>

<span data-ttu-id="80e4d-573">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="80e4d-573">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="80e4d-574">存取及更新 ASP.NET 2.0 中的資料</span><span class="sxs-lookup"><span data-stu-id="80e4d-574">Accessing and Updating Data in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="80e4d-575">ASP.NET 2.0 精靈控制項</span><span class="sxs-lookup"><span data-stu-id="80e4d-575">ASP.NET 2.0 Wizard Control</span></span>](https://weblogs.asp.net/scottgu/archive/2006/02/21/438732.aspx)
- [<span data-ttu-id="80e4d-576">建立與 ASP.NET 2.0 精靈控制項的逐步使用者介面</span><span class="sxs-lookup"><span data-stu-id="80e4d-576">Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)
- [<span data-ttu-id="80e4d-577">建立自訂的資料來源控制項參數</span><span class="sxs-lookup"><span data-stu-id="80e4d-577">Creating Custom DataSource Control Parameters</span></span>](http://aspnet.4guysfromrolla.com/articles/110106-1.aspx)
- [<span data-ttu-id="80e4d-578">自訂適用於 CreateUserWizard 控制項</span><span class="sxs-lookup"><span data-stu-id="80e4d-578">Customizing the CreateUserWizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx)
- [<span data-ttu-id="80e4d-579">在 DetailsView 控制項快速入門</span><span class="sxs-lookup"><span data-stu-id="80e4d-579">DetailsView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/detailsview.aspx)
- [<span data-ttu-id="80e4d-580">利用 ListView 控制項顯示資料</span><span class="sxs-lookup"><span data-stu-id="80e4d-580">Displaying Data with the ListView Control</span></span>](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx)
- [<span data-ttu-id="80e4d-581">將 ASP.NET 2.0 中的驗證控制項的分解</span><span class="sxs-lookup"><span data-stu-id="80e4d-581">Dissecting the Validation Controls in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)
- [<span data-ttu-id="80e4d-582">編輯插入和刪除資料</span><span class="sxs-lookup"><span data-stu-id="80e4d-582">Editing Insert and Deleting Data</span></span>](../../data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)
- [<span data-ttu-id="80e4d-583">在 ASP.NET 表單驗證</span><span class="sxs-lookup"><span data-stu-id="80e4d-583">Form Validation in ASP.NET</span></span>](http://www.4guysfromrolla.com/webtech/090200-1.shtml)
- [<span data-ttu-id="80e4d-584">正在蒐集的自訂使用者註冊資訊</span><span class="sxs-lookup"><span data-stu-id="80e4d-584">Gathering Custom User Registration Information</span></span>](https://weblogs.asp.net/scottgu/archive/2006/07/05/Tip_2F00_Trick_3A00_-Gathering-Custom-User-Registration-Information.aspx)
- [<span data-ttu-id="80e4d-585">在 ASP.NET 2.0 設定檔</span><span class="sxs-lookup"><span data-stu-id="80e4d-585">Profiles in ASP.NET 2.0</span></span>](http://www.odetocode.com/Articles/440.aspx)
- [<span data-ttu-id="80e4d-586">Asp: ListView 控制項</span><span class="sxs-lookup"><span data-stu-id="80e4d-586">The asp:ListView Control</span></span>](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)
- [<span data-ttu-id="80e4d-587">使用者設定檔快速入門</span><span class="sxs-lookup"><span data-stu-id="80e4d-587">User Profiles QuickStart</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/profile/default.aspx)

### <a name="about-the-author"></a><span data-ttu-id="80e4d-588">關於作者</span><span class="sxs-lookup"><span data-stu-id="80e4d-588">About the Author</span></span>

<span data-ttu-id="80e4d-589">Scott Mitchell，多個 ASP/ASP.NET 書籍的作者和創辦的 4GuysFromRolla.com，具有已經使用 Microsoft Web 技術從 1998 年。</span><span class="sxs-lookup"><span data-stu-id="80e4d-589">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="80e4d-590">Scott 可做為獨立顧問、 訓練和寫入器。</span><span class="sxs-lookup"><span data-stu-id="80e4d-590">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="80e4d-591">他最新的活頁簿 *[Sam 教導您自己 ASP.NET 2.0 24 小時內](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*。</span><span class="sxs-lookup"><span data-stu-id="80e4d-591">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="80e4d-592">在可到達 Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或透過在他的部落格[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-592">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="80e4d-593">特別感謝...</span><span class="sxs-lookup"><span data-stu-id="80e4d-593">Special Thanks To…</span></span>

<span data-ttu-id="80e4d-594">許多有用的檢閱者已檢閱本教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="80e4d-594">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="80e4d-595">檢閱我即將推出的 MSDN 文件有興趣嗎？</span><span class="sxs-lookup"><span data-stu-id="80e4d-595">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="80e4d-596">如果是這樣，卸除我一行[ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com)。</span><span class="sxs-lookup"><span data-stu-id="80e4d-596">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="80e4d-597">上一步</span><span class="sxs-lookup"><span data-stu-id="80e4d-597">Previous</span></span>](user-based-authorization-vb.md)
