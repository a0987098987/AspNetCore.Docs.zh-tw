---
uid: web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
title: 建立資料存取層 (C#) |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們將從頭開始，並建立資料存取層 (DAL)，使用具類型的資料集，來存取資料庫中的資訊。
ms.author: aspnetcontent
ms.date: 04/05/2010
ms.assetid: cfe2a6a0-1e56-4dc8-9537-c8ec76ba96a4
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-data-access-layer-cs
msc.type: authoredcontent
ms.openlocfilehash: 556771994fd80773ec1e86bcbab0f60f2bb821e4
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/05/2018
ms.locfileid: "37838750"
---
<a name="creating-a-data-access-layer-c"></a><span data-ttu-id="551a1-103">建立資料存取層 (C#)</span><span class="sxs-lookup"><span data-stu-id="551a1-103">Creating a Data Access Layer (C#)</span></span>
====================
<span data-ttu-id="551a1-104">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="551a1-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="551a1-105">[下載範例應用程式](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_1_CS.exe)或[下載 PDF](creating-a-data-access-layer-cs/_static/datatutorial01cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="551a1-105">[Download Sample App](http://download.microsoft.com/download/4/6/3/463cf87c-4724-4cbc-b7b5-3f866f43ba50/ASPNET_Data_Tutorial_1_CS.exe) or [Download PDF](creating-a-data-access-layer-cs/_static/datatutorial01cs1.pdf)</span></span>

> <span data-ttu-id="551a1-106">在本教學課程中，我們將從頭開始，並建立資料存取層 (DAL)，使用具類型的資料集，來存取資料庫中的資訊。</span><span class="sxs-lookup"><span data-stu-id="551a1-106">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), using typed DataSets, to access the information in a database.</span></span>


## <a name="introduction"></a><span data-ttu-id="551a1-107">簡介</span><span class="sxs-lookup"><span data-stu-id="551a1-107">Introduction</span></span>

<span data-ttu-id="551a1-108">身為 web 開發人員，我們的生活主要是因為使用的資料。</span><span class="sxs-lookup"><span data-stu-id="551a1-108">As web developers, our lives revolve around working with data.</span></span> <span data-ttu-id="551a1-109">我們會建立資料庫來儲存資料，也就是程式碼來擷取並修改它，並收集和彙總的網頁。</span><span class="sxs-lookup"><span data-stu-id="551a1-109">We create databases to store the data, code to retrieve and modify it, and web pages to collect and summarize it.</span></span> <span data-ttu-id="551a1-110">這是將探討 ASP.NET 2.0 中實作這些常見的模式的技術長系列的第一個教學課程。</span><span class="sxs-lookup"><span data-stu-id="551a1-110">This is the first tutorial in a lengthy series that will explore techniques for implementing these common patterns in ASP.NET 2.0.</span></span> <span data-ttu-id="551a1-111">我們將開始建立[軟體架構](http://en.wikipedia.org/wiki/Software_architecture)組成的資料存取層 (DAL) 使用具類型的資料集，商務邏輯層 (BLL)，會強制執行自訂的商務規則，並展示層包含 ASP.NET 的頁面共用通用的頁面配置。</span><span class="sxs-lookup"><span data-stu-id="551a1-111">We'll start with creating a [software architecture](http://en.wikipedia.org/wiki/Software_architecture) composed of a Data Access Layer (DAL) using Typed DataSets, a Business Logic Layer (BLL) that enforces custom business rules, and a presentation layer composed of ASP.NET pages that share a common page layout.</span></span> <span data-ttu-id="551a1-112">一旦這個後端基礎已配置，我們將移動到報告，顯示如何顯示，彙總、 收集和驗證的 web 應用程式的資料。</span><span class="sxs-lookup"><span data-stu-id="551a1-112">Once this backend groundwork has been laid, we'll move into reporting, showing how to display, summarize, collect, and validate data from a web application.</span></span> <span data-ttu-id="551a1-113">這些教學課程都被為了很簡潔，並提供足夠的螢幕擷取畫面的逐步指示，可逐步引導您完成此程序以視覺化方式而定。</span><span class="sxs-lookup"><span data-stu-id="551a1-113">These tutorials are geared to be concise and provide step-by-step instructions with plenty of screen shots to walk you through the process visually.</span></span> <span data-ttu-id="551a1-114">每個教學課程適用於 C# 和 Visual Basic 版本，而且包含的下載時，使用完整的程式碼。</span><span class="sxs-lookup"><span data-stu-id="551a1-114">Each tutorial is available in C# and Visual Basic versions and includes a download of the complete code used.</span></span> <span data-ttu-id="551a1-115">（本教學課程中第一個是相當冗長，但其餘部分會更容易吸收的區塊 （chunk）。</span><span class="sxs-lookup"><span data-stu-id="551a1-115">(This first tutorial is quite lengthy, but the rest are presented in much more digestible chunks.)</span></span>

<span data-ttu-id="551a1-116">這些教學課程中我們將使用放在 Northwind 資料庫的 Microsoft SQL Server 2005 Express 的 Edition 版本**應用程式\_資料**目錄。</span><span class="sxs-lookup"><span data-stu-id="551a1-116">For these tutorials we'll be using a Microsoft SQL Server 2005 Express Edition version of the Northwind database placed in the **App\_Data** directory.</span></span> <span data-ttu-id="551a1-117">資料庫檔案，除了**應用程式\_資料**資料夾也包含 SQL 指令碼，用於建立資料庫，如果您想要使用不同的資料庫版本。</span><span class="sxs-lookup"><span data-stu-id="551a1-117">In addition to the database file, the **App\_Data** folder also contains the SQL scripts for creating the database, in case you want to use a different database version.</span></span> <span data-ttu-id="551a1-118">這些指令碼也可以[直接從 Microsoft 下載](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en)，如果您想使用。</span><span class="sxs-lookup"><span data-stu-id="551a1-118">These scripts can be also be [downloaded directly from Microsoft](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en), if you'd prefer.</span></span> <span data-ttu-id="551a1-119">如果您使用不同的 SQL Server 版本的 Northwind 資料庫，您必須更新**NORTHWNDConnectionString**設定應用程式的**Web.config**檔案。</span><span class="sxs-lookup"><span data-stu-id="551a1-119">If you use a different SQL Server version of the Northwind database, you will need to update the **NORTHWNDConnectionString** setting in the application's **Web.config** file.</span></span> <span data-ttu-id="551a1-120">為檔案系統為基礎的網站專案使用 Visual Studio 2005 Professional Edition 建置 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="551a1-120">The web application was built using Visual Studio 2005 Professional Edition as a file system-based Web site project.</span></span> <span data-ttu-id="551a1-121">不過，所有教學課程會運作，也能用於免費版本的 Visual Studio 2005 [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/)。</span><span class="sxs-lookup"><span data-stu-id="551a1-121">However, all of the tutorials will work equally well with the free version of Visual Studio 2005, [Visual Web Developer](https://msdn.microsoft.com/vstudio/express/vwd/).</span></span>  
  
<span data-ttu-id="551a1-122">在本教學課程中，我們將從頭開始，並建立資料存取層 (DAL)，後面接著在第二個教學課程中，建立商務邏輯層 (BLL) 和頁面配置和第三個中的導覽。</span><span class="sxs-lookup"><span data-stu-id="551a1-122">In this tutorial we'll start from the very beginning and create the Data Access Layer (DAL), followed by creating the Business Logic Layer (BLL) in the second tutorial, and working on page layout and navigation in the third.</span></span> <span data-ttu-id="551a1-123">之後的第三個將以 foundation 為基礎的教學課程所配置的第三個。</span><span class="sxs-lookup"><span data-stu-id="551a1-123">The tutorials after the third one will build upon the foundation laid in the first three.</span></span> <span data-ttu-id="551a1-124">我們有許多来涵蓋此第一個教學課程中，因此啟動 Visual Studio 並讓我們開始 ！</span><span class="sxs-lookup"><span data-stu-id="551a1-124">We've got a lot to cover in this first tutorial, so fire up Visual Studio and let's get started!</span></span>

## <a name="step-1-creating-a-web-project-and-connecting-to-the-database"></a><span data-ttu-id="551a1-125">步驟 1： 建立 Web 專案，並連接到資料庫</span><span class="sxs-lookup"><span data-stu-id="551a1-125">Step 1: Creating a Web Project and Connecting to the Database</span></span>

<span data-ttu-id="551a1-126">我們建立我們的資料存取層 (DAL) 之前，我們首先要建立的網站，並設定我們的資料庫。</span><span class="sxs-lookup"><span data-stu-id="551a1-126">Before we can create our Data Access Layer (DAL), we first need to create a web site and setup our database.</span></span> <span data-ttu-id="551a1-127">開始建立新檔案系統為基礎 ASP.NET 網站。</span><span class="sxs-lookup"><span data-stu-id="551a1-127">Start by creating a new file system-based ASP.NET web site.</span></span> <span data-ttu-id="551a1-128">若要這麼做，請移至 檔案 功能表並選擇新的網站上，顯示新的網站 對話方塊。</span><span class="sxs-lookup"><span data-stu-id="551a1-128">To accomplish this, go to the File menu and choose New Web Site, displaying the New Web Site dialog box.</span></span> <span data-ttu-id="551a1-129">選擇 ASP.NET 網站範本、 到檔案系統設定 位置 下拉式清單、 選擇要放置 web 站台的資料夾和設定的語言為 C#。</span><span class="sxs-lookup"><span data-stu-id="551a1-129">Choose the ASP.NET Web Site template, set the Location drop-down list to File System, choose a folder to place the web site, and set the language to C#.</span></span>


<span data-ttu-id="551a1-130">[![建立新檔案系統為基礎的網站](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-130">[![Create a New File System-Based Web Site](creating-a-data-access-layer-cs/_static/image2.png)](creating-a-data-access-layer-cs/_static/image1.png)</span></span>

<span data-ttu-id="551a1-131">**圖 1**： 建立 New File System-Based 網站 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-131">**Figure 1**: Create a New File System-Based Web Site ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image3.png))</span></span>


<span data-ttu-id="551a1-132">這會建立新的網站與**Default.aspx** ASP.NET 網頁並**應用程式\_資料**資料夾。</span><span class="sxs-lookup"><span data-stu-id="551a1-132">This will create a new web site with a **Default.aspx** ASP.NET page and an **App\_Data** folder.</span></span>

<span data-ttu-id="551a1-133">建立網站後下, 一步是要在 Visual Studio 伺服器總管 中加入資料庫參考。</span><span class="sxs-lookup"><span data-stu-id="551a1-133">With the web site created, the next step is to add a reference to the database in Visual Studio's Server Explorer.</span></span> <span data-ttu-id="551a1-134">將資料庫加入至 [伺服器總管] 中，您可以新增資料表、 預存程序、 檢視和等全部從 Visual Studio 內。</span><span class="sxs-lookup"><span data-stu-id="551a1-134">By adding a database to the Server Explorer you can add tables, stored procedures, views, and so on all from within Visual Studio.</span></span> <span data-ttu-id="551a1-135">您也可以檢視資料表資料，或透過 查詢產生器以手動方式或以圖形方式建立您自己的查詢。</span><span class="sxs-lookup"><span data-stu-id="551a1-135">You can also view table data or create your own queries either by hand or graphically via the Query Builder.</span></span> <span data-ttu-id="551a1-136">此外，當我們建置具類型資料集為 DAL 我們必須點 Visual Studio 應該從中建構輸入資料集的資料庫。</span><span class="sxs-lookup"><span data-stu-id="551a1-136">Furthermore, when we build the Typed DataSets for the DAL we'll need to point Visual Studio to the database from which the Typed DataSets should be constructed.</span></span> <span data-ttu-id="551a1-137">雖然我們可以提供在該時間點的此連接資訊，Visual Studio 會自動填入下拉式清單中，已在 [伺服器總管] 中註冊的資料庫。</span><span class="sxs-lookup"><span data-stu-id="551a1-137">While we can provide this connection information at that point in time, Visual Studio automatically populates a drop-down list of the databases already registered in the Server Explorer.</span></span>

<span data-ttu-id="551a1-138">將 Northwind 資料庫新增至 [伺服器總管] 中的步驟取決於您是否想要使用 SQL Server 2005 Express Edition 資料庫中的**應用程式\_資料**資料夾，或如果您有 Microsoft SQL Server 2000 或 2005年您想要改為使用的資料庫伺服器設定。</span><span class="sxs-lookup"><span data-stu-id="551a1-138">The steps for adding the Northwind database to the Server Explorer depend on whether you want to use the SQL Server 2005 Express Edition database in the **App\_Data** folder or if you have a Microsoft SQL Server 2000 or 2005 database server setup that you want to use instead.</span></span>

## <a name="using-a-database-in-theappdatafolder"></a><span data-ttu-id="551a1-139">使用資料庫中 theApp\_DataFolder</span><span class="sxs-lookup"><span data-stu-id="551a1-139">Using a Database in theApp\_DataFolder</span></span>

<span data-ttu-id="551a1-140">如果您沒有 SQL Server 2000 或 2005年資料庫伺服器連接，或您只想要避免將資料庫加入至資料庫伺服器，您可以使用位於已下載的應有的 Northwind 資料庫的 SQL Server 2005 Express Edition 版本e's**應用程式\_資料**資料夾 (**NORTHWND。MDF**)。</span><span class="sxs-lookup"><span data-stu-id="551a1-140">If you do not have a SQL Server 2000 or 2005 database server to connect to, or you simply want to avoid having to add the database to a database server, you can use the SQL Server 2005 Express Edition version of the Northwind database that is located in the downloaded website's **App\_Data** folder (**NORTHWND.MDF**).</span></span>

<span data-ttu-id="551a1-141">將資料庫置於**應用程式\_資料**資料夾會自動新增至 [伺服器總管] 中。</span><span class="sxs-lookup"><span data-stu-id="551a1-141">A database placed in the **App\_Data** folder is automatically added to the Server Explorer.</span></span> <span data-ttu-id="551a1-142">假設您有 SQL Server 2005 Express Edition 安裝在您的電腦上應該會看到名為 NORTHWND 的節點。MDF 在 伺服器總管 中，您可以展開及探索其資料表、 檢視、 預存程序，等等 （請參閱 圖 2）。</span><span class="sxs-lookup"><span data-stu-id="551a1-142">Assuming you have SQL Server 2005 Express Edition installed on your machine you should see a node named NORTHWND.MDF in the Server Explorer, which you can expand and explore its tables, views, stored procedure, and so on (see Figure 2).</span></span>

<span data-ttu-id="551a1-143">**應用程式\_資料**資料夾也可以保存 Microsoft Access **.mdb**檔案，如同其 SQL Server 對應項目，會自動新增至 [伺服器總管] 中。</span><span class="sxs-lookup"><span data-stu-id="551a1-143">The **App\_Data** folder can also hold Microsoft Access **.mdb** files, which, like their SQL Server counterparts, are automatically added to the Server Explorer.</span></span> <span data-ttu-id="551a1-144">如果您不想使用的任何 SQL Server 選項，您可以隨時[下載 Microsoft Access 版本的 Northwind 資料庫檔案](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN)拖放到**應用程式\_資料**目錄。</span><span class="sxs-lookup"><span data-stu-id="551a1-144">If you don't want to use any of the SQL Server options, you can always [download a Microsoft Access version of the Northwind database file](https://www.microsoft.com/downloads/details.aspx?FamilyID=C6661372-8DBE-422B-8676-C632D66C529C&amp;displaylang=EN) and drop into the **App\_Data** directory.</span></span> <span data-ttu-id="551a1-145">請記住，不過，為的 Access 資料庫不是功能豐富與 SQL Server 和其設計目的並非要用於網站案例。</span><span class="sxs-lookup"><span data-stu-id="551a1-145">Keep in mind, however, that Access databases aren't as feature-rich as SQL Server, and aren't designed to be used in web site scenarios.</span></span> <span data-ttu-id="551a1-146">此外，數個 35 個以上教學課程會使用某些不支援的存取權的資料庫層級功能。</span><span class="sxs-lookup"><span data-stu-id="551a1-146">Furthermore, a couple of the 35+ tutorials will utilize certain database-level features that aren't supported by Access.</span></span>

## <a name="connecting-to-the-database-in-a-microsoft-sql-server-2000-or-2005-database-server"></a><span data-ttu-id="551a1-147">連接到 Microsoft SQL Server 2000 或 2005年的資料庫伺服器中的資料庫</span><span class="sxs-lookup"><span data-stu-id="551a1-147">Connecting to the Database in a Microsoft SQL Server 2000 or 2005 Database Server</span></span>

<span data-ttu-id="551a1-148">或者，您可能會連線至資料庫伺服器上安裝 Northwind 資料庫。</span><span class="sxs-lookup"><span data-stu-id="551a1-148">Alternatively, you may connect to a Northwind database installed on a database server.</span></span> <span data-ttu-id="551a1-149">如果資料庫伺服器還沒有安裝 Northwind 資料庫，您首先必須將它新增至資料庫伺服器執行包含在本教學課程下載或安裝指令碼[下載 Northwind SQL Server 2000 版安裝指令碼和](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en)直接從 Microsoft 的網站。</span><span class="sxs-lookup"><span data-stu-id="551a1-149">If the database server does not already have the Northwind database installed, you first must add it to database server by running the installation script included in this tutorial's download or by [downloading the SQL Server 2000 version of Northwind and installation script](https://www.microsoft.com/downloads/details.aspx?FamilyID=06616212-0356-46a0-8da2-eebc53a68034&amp;DisplayLang=en) directly from Microsoft's web site.</span></span>

<span data-ttu-id="551a1-150">一旦您已安裝的資料庫，請移以在 Visual Studio 伺服器總管] 中，以滑鼠右鍵按一下 [資料連線] 節點中，然後選擇 [加入連接。</span><span class="sxs-lookup"><span data-stu-id="551a1-150">Once you have the database installed, go to the Server Explorer in Visual Studio, right-click on the Data Connections node, and choose Add Connection.</span></span> <span data-ttu-id="551a1-151">如果您沒有看到 [伺服器總管] 中移至 [檢視 / 伺服器總管] 中或叫用的 Ctrl + Alt + S。</span><span class="sxs-lookup"><span data-stu-id="551a1-151">If you don't see the Server Explorer go to the View / Server Explorer, or hit Ctrl+Alt+S.</span></span> <span data-ttu-id="551a1-152">這會顯示 加入連接對話方塊中，其中您可以指定要連接到伺服器，驗證資訊，並輸入資料庫名稱。</span><span class="sxs-lookup"><span data-stu-id="551a1-152">This will bring up the Add Connection dialog box, where you can specify the server to connect to, the authentication information, and the database name.</span></span> <span data-ttu-id="551a1-153">一旦您已成功設定資料庫連線資訊並按一下 [確定] 按鈕，資料庫將會新增為 [資料連線] 節點底下的節點。</span><span class="sxs-lookup"><span data-stu-id="551a1-153">Once you have successfully configured the database connection information and clicked the OK button, the database will be added as a node underneath the Data Connections node.</span></span> <span data-ttu-id="551a1-154">您可以展開 [資料庫] 節點，若要瀏覽資料表、 檢視、 預存程序，等等。</span><span class="sxs-lookup"><span data-stu-id="551a1-154">You can expand the database node to explore its tables, views, stored procedures, and so on.</span></span>


![將連線新增至您的資料庫伺服器的 Northwind 資料庫](creating-a-data-access-layer-cs/_static/image4.png)

<span data-ttu-id="551a1-156">**圖 2**： 將連接加入您的資料庫伺服器的 Northwind 資料庫</span><span class="sxs-lookup"><span data-stu-id="551a1-156">**Figure 2**: Add a Connection to Your Database Server's Northwind Database</span></span>


## <a name="step-2-creating-the-data-access-layer"></a><span data-ttu-id="551a1-157">步驟 2： 建立資料存取層</span><span class="sxs-lookup"><span data-stu-id="551a1-157">Step 2: Creating the Data Access Layer</span></span>

<span data-ttu-id="551a1-158">使用資料的其中一個選項時的特定資料的邏輯直接嵌入展示層 （在 web 應用程式中，按一下 ASP.NET 網頁會構成的展示層）。</span><span class="sxs-lookup"><span data-stu-id="551a1-158">When working with data one option is to embed the data-specific logic directly into the presentation layer (in a web application, the ASP.NET pages make up the presentation layer).</span></span> <span data-ttu-id="551a1-159">這可能需要在 ASP.NET 網頁的程式碼部分，撰寫 ADO.NET 程式碼或使用 SqlDataSource 控制項標記部分的形式。</span><span class="sxs-lookup"><span data-stu-id="551a1-159">This may take the form of writing ADO.NET code in the ASP.NET page's code portion or using the SqlDataSource control from the markup portion.</span></span> <span data-ttu-id="551a1-160">在任一情況下，這種方法會緊密結合的資料存取邏輯兩者與展示層。</span><span class="sxs-lookup"><span data-stu-id="551a1-160">In either case, this approach tightly couples the data access logic with the presentation layer.</span></span> <span data-ttu-id="551a1-161">建議的方法，不過，為分開的展示層中的資料存取邏輯。</span><span class="sxs-lookup"><span data-stu-id="551a1-161">The recommended approach, however, is to separate the data access logic from the presentation layer.</span></span> <span data-ttu-id="551a1-162">此獨立的圖層指資料的存取層，簡稱 DAL，通常會實作為個別的類別庫專案。</span><span class="sxs-lookup"><span data-stu-id="551a1-162">This separate layer is referred to as the Data Access Layer, DAL for short, and is typically implemented as a separate Class Library project.</span></span> <span data-ttu-id="551a1-163">此多層式架構的優點有詳細的記錄 （結尾的本教學課程中的這些優點的詳細資訊，請參閱 「 進一步的數據 」 一節），而且我們要在這一系列的方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-163">The benefits of this layered architecture are well documented (see the "Further Readings" section at the end of this tutorial for information on these advantages) and is the approach we will take in this series.</span></span>

<span data-ttu-id="551a1-164">所有的程式碼的特定基礎的資料來源，例如建立資料庫連接，發出**選取 **，**插入**， **UPDATE**，和**刪除**DAL 應該位於命令，並依此類推。</span><span class="sxs-lookup"><span data-stu-id="551a1-164">All code that is specific to the underlying data source such as creating a connection to the database, issuing **SELECT**, **INSERT**, **UPDATE**, and **DELETE** commands, and so on should be located in the DAL.</span></span> <span data-ttu-id="551a1-165">展示層不應該包含這類資料存取程式碼中，任何參考，但應該改為對進行呼叫的所有資料要求 DAL。</span><span class="sxs-lookup"><span data-stu-id="551a1-165">The presentation layer should not contain any references to such data access code, but should instead make calls into the DAL for any and all data requests.</span></span> <span data-ttu-id="551a1-166">資料存取層級通常會包含存取基礎資料庫資料的方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-166">Data Access Layers typically contain methods for accessing the underlying database data.</span></span> <span data-ttu-id="551a1-167">Northwind 資料庫中，例如，具有**產品**並**類別**記錄所屬的類別目錄銷售的產品的資料表。</span><span class="sxs-lookup"><span data-stu-id="551a1-167">The Northwind database, for example, has **Products** and **Categories** tables that record the products for sale and the categories to which they belong.</span></span> <span data-ttu-id="551a1-168">在我們的 DAL 中我們會有類似的方法：</span><span class="sxs-lookup"><span data-stu-id="551a1-168">In our DAL we will have methods like:</span></span>

- <span data-ttu-id="551a1-169">**GetCategories()，** 這會傳回所有類別的相關資訊</span><span class="sxs-lookup"><span data-stu-id="551a1-169">**GetCategories(),** which will return information about all of the categories</span></span>
- <span data-ttu-id="551a1-170">**GetProducts()**，這會傳回所有產品的相關資訊</span><span class="sxs-lookup"><span data-stu-id="551a1-170">**GetProducts()**, which will return information about all of the products</span></span>
- <span data-ttu-id="551a1-171">**GetProductsByCategoryID (*categoryID*)**，這會傳回屬於指定分類的所有產品</span><span class="sxs-lookup"><span data-stu-id="551a1-171">**GetProductsByCategoryID(*categoryID*)**, which will return all products that belong to a specified category</span></span>
- <span data-ttu-id="551a1-172">**GetProductByProductID (*productID*)**，這會傳回特定產品的相關資訊</span><span class="sxs-lookup"><span data-stu-id="551a1-172">**GetProductByProductID(*productID*)**, which will return information about a particular product</span></span>

<span data-ttu-id="551a1-173">這些方法，叫用時，將會連接到資料庫、 發出適當的查詢，並傳回結果。</span><span class="sxs-lookup"><span data-stu-id="551a1-173">These methods, when invoked, will connect to the database, issue the appropriate query, and return the results.</span></span> <span data-ttu-id="551a1-174">我們將會如何傳回這些結果很重要。</span><span class="sxs-lookup"><span data-stu-id="551a1-174">How we return these results is important.</span></span> <span data-ttu-id="551a1-175">這些方法可能只會傳回資料集或資料庫查詢中所填入的 DataReader，但在理想情況下這些結果應傳回使用*強型別物件*。</span><span class="sxs-lookup"><span data-stu-id="551a1-175">These methods could simply return a DataSet or DataReader populated by the database query, but ideally these results should be returned using *strongly-typed objects*.</span></span> <span data-ttu-id="551a1-176">強型別物件是一個結構描述嚴格定義在編譯時期，而相反，也就是鬆散型的物件，是其中一個執行階段之前不知道其結構描述。</span><span class="sxs-lookup"><span data-stu-id="551a1-176">A strongly-typed object is one whose schema is rigidly defined at compile time, whereas the opposite, a loosely-typed object, is one whose schema is not known until runtime.</span></span>

<span data-ttu-id="551a1-177">例如，DataReader 與 （根據預設值） 的資料集是鬆散型別物件，因為其結構描述由用來填入這些資料庫查詢所傳回的資料行定義。</span><span class="sxs-lookup"><span data-stu-id="551a1-177">For example, the DataReader and the DataSet (by default) are loosely-typed objects since their schema is defined by the columns returned by the database query used to populate them.</span></span> <span data-ttu-id="551a1-178">若要從鬆散型別的 DataTable，我們必須使用下列語法： 存取特定的資料行：  <strong><em>DataTable</em>。資料列 [<em>index</em>] [」<em>columnName</em>"]</strong>。</span><span class="sxs-lookup"><span data-stu-id="551a1-178">To access a particular column from a loosely-typed DataTable we need to use syntax like: <strong><em>DataTable</em>.Rows[<em>index</em>]["<em>columnName</em>"]</strong>.</span></span> <span data-ttu-id="551a1-179">DataTable 的鬆散型別在此範例中的事實，我們需要存取使用字串或序數索引的資料行名稱時顯露出來。</span><span class="sxs-lookup"><span data-stu-id="551a1-179">The DataTable's loose typing in this example is exhibited by the fact that we need to access the column name using a string or ordinal index.</span></span> <span data-ttu-id="551a1-180">強型別的 DataTable，相反地，會有每個實作為屬性，其資料行如下所示的程式碼所導致：  <strong><em>DataTable</em>。資料列 [<em>index</em>]。*columnName</strong>*。</span><span class="sxs-lookup"><span data-stu-id="551a1-180">A strongly-typed DataTable, on the other hand, will have each of its columns implemented as properties, resulting in code that looks like: <strong><em>DataTable</em>.Rows[<em>index</em>].*columnName</strong>*.</span></span>

<span data-ttu-id="551a1-181">若要傳回強型別物件，開發人員可以建立自己的自訂商務物件或使用具類型資料集。</span><span class="sxs-lookup"><span data-stu-id="551a1-181">To return strongly-typed objects, developers can either create their own custom business objects or use Typed DataSets.</span></span> <span data-ttu-id="551a1-182">類別，其屬性通常會反映基礎資料庫資料表的商務物件的資料行代表商務物件被實作由開發人員。</span><span class="sxs-lookup"><span data-stu-id="551a1-182">A business object is implemented by the developer as a class whose properties typically reflect the columns of the underlying database table the business object represents.</span></span> <span data-ttu-id="551a1-183">輸入資料集是根據資料庫結構描述和其成員是強型別根據此結構描述的 Visual Studio 為您產生的類別。</span><span class="sxs-lookup"><span data-stu-id="551a1-183">A Typed DataSet is a class generated for you by Visual Studio based on a database schema and whose members are strongly-typed according to this schema.</span></span> <span data-ttu-id="551a1-184">輸入資料集本身包含的擴充 ADO.NET DataSet、 DataTable 和 DataRow 類別的類別。</span><span class="sxs-lookup"><span data-stu-id="551a1-184">The Typed DataSet itself consists of classes that extend the ADO.NET DataSet, DataTable, and DataRow classes.</span></span> <span data-ttu-id="551a1-185">除了強型別 DataTables，具類型資料集現在也包含 TableAdapters，也就是類別的方法來填入資料集的 Datatable 和傳播 Datatable 內回到資料庫的修改。</span><span class="sxs-lookup"><span data-stu-id="551a1-185">In addition to strongly-typed DataTables, Typed DataSets now also include TableAdapters, which are classes with methods for populating the DataSet's DataTables and propagating modifications within the DataTables back to the database.</span></span>

> [!NOTE]
> <span data-ttu-id="551a1-186">如需有關使用具類型資料集與自訂商務物件的優缺點的詳細資訊，請參閱[設計資料層元件和傳遞資料透過層](https://msdn.microsoft.com/library/ms978496.aspx)。</span><span class="sxs-lookup"><span data-stu-id="551a1-186">For more information on the advantages and disadvantages of using Typed DataSets versus custom business objects, refer to [Designing Data Tier Components and Passing Data Through Tiers](https://msdn.microsoft.com/library/ms978496.aspx).</span></span>


<span data-ttu-id="551a1-187">這些教學課程的架構中，我們將使用強型別資料集。</span><span class="sxs-lookup"><span data-stu-id="551a1-187">We'll use strongly-typed DataSets for these tutorials' architecture.</span></span> <span data-ttu-id="551a1-188">[圖 3] 說明使用具類型資料集的應用程式的不同層之間的工作流程。</span><span class="sxs-lookup"><span data-stu-id="551a1-188">Figure 3 illustrates the workflow between the different layers of an application that uses Typed DataSets.</span></span>


<span data-ttu-id="551a1-189">[![所有的資料存取程式碼會轉移到 DAL](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-189">[![All Data Access Code is Relegated to the DAL](creating-a-data-access-layer-cs/_static/image6.png)](creating-a-data-access-layer-cs/_static/image5.png)</span></span>

<span data-ttu-id="551a1-190">**圖 3**： 所有的資料存取程式碼會轉移到 DAL ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image7.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-190">**Figure 3**: All Data Access Code is Relegated to the DAL ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image7.png))</span></span>


## <a name="creating-a-typed-dataset-and-table-adapter"></a><span data-ttu-id="551a1-191">建立具類型資料集和資料表配接器</span><span class="sxs-lookup"><span data-stu-id="551a1-191">Creating a Typed DataSet and Table Adapter</span></span>

<span data-ttu-id="551a1-192">若要開始建立我們的 DAL 中，我們先將具類型資料集加入至我們的專案。</span><span class="sxs-lookup"><span data-stu-id="551a1-192">To begin creating our DAL, we start by adding a Typed DataSet to our project.</span></span> <span data-ttu-id="551a1-193">若要完成這項作業，以滑鼠右鍵按一下 方案總管 中的專案節點並選擇 加入新項目。</span><span class="sxs-lookup"><span data-stu-id="551a1-193">To accomplish this, right-click on the project node in the Solution Explorer and choose Add a New Item.</span></span> <span data-ttu-id="551a1-194">從範本清單中選取 [資料集] 選項並將它命名**Northwind.xsd**。</span><span class="sxs-lookup"><span data-stu-id="551a1-194">Select the DataSet option from the list of templates and name it **Northwind.xsd**.</span></span>


<span data-ttu-id="551a1-195">[![選擇將新的資料集加入至您的專案](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-195">[![Choose to Add a New DataSet to Your Project](creating-a-data-access-layer-cs/_static/image9.png)](creating-a-data-access-layer-cs/_static/image8.png)</span></span>

<span data-ttu-id="551a1-196">**圖 4**： 選擇將新的資料集加入至您的專案 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-196">**Figure 4**: Choose to Add a New DataSet to Your Project ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image10.png))</span></span>


<span data-ttu-id="551a1-197">當系統提示您加入資料集，請按一下 [新增] 之後,**應用程式\_程式碼**資料夾中，選擇 [是]。</span><span class="sxs-lookup"><span data-stu-id="551a1-197">After clicking Add, when prompted to add the DataSet to the **App\_Code** folder, choose Yes.</span></span> <span data-ttu-id="551a1-198">輸入資料集的設計工具接著會出現，並將啟動 TableAdapter 組態精靈，可讓您將您的第一個 TableAdapter 加入至具類型資料集。</span><span class="sxs-lookup"><span data-stu-id="551a1-198">The Designer for the Typed DataSet will then be displayed, and the TableAdapter Configuration Wizard will start, allowing you to add your first TableAdapter to the Typed DataSet.</span></span>

<span data-ttu-id="551a1-199">輸入資料集做為強型別集合的資料;它是由強型別的 DataTable 執行個體，其中每個則包含強型別 DataRow 執行個體所組成。</span><span class="sxs-lookup"><span data-stu-id="551a1-199">A Typed DataSet serves as a strongly-typed collection of data; it is composed of strongly-typed DataTable instances, each of which is in turn composed of strongly-typed DataRow instances.</span></span> <span data-ttu-id="551a1-200">針對每個基礎資料庫資料表，我們需要使用在本教學課程系列中，我們將建立強型別的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="551a1-200">We will create a strongly-typed DataTable for each of the underlying database tables that we need to work with in this tutorials series.</span></span> <span data-ttu-id="551a1-201">讓我們開始建立的 DataTable**產品**資料表。</span><span class="sxs-lookup"><span data-stu-id="551a1-201">Let's start with creating a DataTable for the **Products** table.</span></span>

<span data-ttu-id="551a1-202">請注意，強型別 DataTables 不包含任何有關如何存取其基礎資料庫資料表的資料。</span><span class="sxs-lookup"><span data-stu-id="551a1-202">Keep in mind that strongly-typed DataTables do not include any information on how to access data from their underlying database table.</span></span> <span data-ttu-id="551a1-203">若要擷取的資料來填入 DataTable，我們會使用 TableAdapter 類別，作為我們的資料存取層。</span><span class="sxs-lookup"><span data-stu-id="551a1-203">In order to retrieve the data to populate the DataTable, we use a TableAdapter class, which functions as our Data Access Layer.</span></span> <span data-ttu-id="551a1-204">如我們**產品**DataTable，TableAdapter 將包含方法**GetProducts()**， **GetProductByCategoryID (*categoryID*)** 等等，我們將從展示層叫用。</span><span class="sxs-lookup"><span data-stu-id="551a1-204">For our **Products** DataTable, the TableAdapter will contain the methods **GetProducts()**, **GetProductByCategoryID(*categoryID*)**, and so on that we'll invoke from the presentation layer.</span></span> <span data-ttu-id="551a1-205">DataTable 的角色是做為用來在各層之間傳遞資料的強型別物件。</span><span class="sxs-lookup"><span data-stu-id="551a1-205">The DataTable's role is to serve as the strongly-typed objects used to pass data between the layers.</span></span>

<span data-ttu-id="551a1-206">TableAdapter 組態精靈 一開始會提示您選取要使用哪一個資料庫。</span><span class="sxs-lookup"><span data-stu-id="551a1-206">The TableAdapter Configuration Wizard begins by prompting you to select which database to work with.</span></span> <span data-ttu-id="551a1-207">下拉式清單會顯示伺服器總管 中的這些資料庫。</span><span class="sxs-lookup"><span data-stu-id="551a1-207">The drop-down list shows those databases in the Server Explorer.</span></span> <span data-ttu-id="551a1-208">如果您沒有 Northwind 資料庫新增到 [伺服器總管] 中，您可以按一下 [新增連接] 按鈕，此時若要這樣做。</span><span class="sxs-lookup"><span data-stu-id="551a1-208">If you did not add the Northwind database to the Server Explorer, you can click the New Connection button at this time to do so.</span></span>


<span data-ttu-id="551a1-209">[![從下拉式清單中選擇 Northwind 資料庫](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-209">[![Choose the Northwind Database from the Drop-Down List](creating-a-data-access-layer-cs/_static/image12.png)](creating-a-data-access-layer-cs/_static/image11.png)</span></span>

<span data-ttu-id="551a1-210">**圖 5**： 從下拉式清單中選擇 Northwind 資料庫 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-210">**Figure 5**: Choose the Northwind Database from the Drop-Down List ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image13.png))</span></span>


<span data-ttu-id="551a1-211">之後選取資料庫，然後按一下 下一步，您需要您是否想要儲存中的連接字串**Web.config**檔案。</span><span class="sxs-lookup"><span data-stu-id="551a1-211">After selecting the database and clicking Next, you'll be asked if you want to save the connection string in the **Web.config** file.</span></span> <span data-ttu-id="551a1-212">儲存連接字串中，您會避免讓硬式編碼在 TableAdapter 類別，可簡化項目，如果連接字串資訊在未來變更。</span><span class="sxs-lookup"><span data-stu-id="551a1-212">By saving the connection string you'll avoid having it hard coded in the TableAdapter classes, which simplifies things if the connection string information changes in the future.</span></span> <span data-ttu-id="551a1-213">如果您選擇將連接字串儲存在組態檔中將它放在**&lt;connectionStrings&gt;** 區段中，它可以是[選擇性地加密](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)改善安全性或稍後透過 IIS GUI 管理工具，更適合用於系統管理員在新的 ASP.NET 2.0 屬性頁修改過。</span><span class="sxs-lookup"><span data-stu-id="551a1-213">If you opt to save the connection string in the configuration file it's placed in the **&lt;connectionStrings&gt;** section, which can be [optionally encrypted](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx) for improved security or modified later through the new ASP.NET 2.0 Property Page within the IIS GUI Admin Tool, which is more ideal for administrators.</span></span>


<span data-ttu-id="551a1-214">[![將連接字串儲存至 Web.config](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-214">[![Save the Connection String to Web.config](creating-a-data-access-layer-cs/_static/image15.png)](creating-a-data-access-layer-cs/_static/image14.png)</span></span>

<span data-ttu-id="551a1-215">**圖 6**： 將連接字串儲存到**Web.config** ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-215">**Figure 6**: Save the Connection String to **Web.config** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image16.png))</span></span>


<span data-ttu-id="551a1-216">接下來，我們需要定義結構描述的第一個強型別的 DataTable，並提供我們 TableAdapter 填入強型別資料集時所要使用的第一個方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-216">Next, we need to define the schema for the first strongly-typed DataTable and provide the first method for our TableAdapter to use when populating the strongly-typed DataSet.</span></span> <span data-ttu-id="551a1-217">這兩個步驟來建立我們想要在我們的 DataTable 中反映從資料表傳回資料行的查詢會同時完成的。</span><span class="sxs-lookup"><span data-stu-id="551a1-217">These two steps are accomplished simultaneously by creating a query that returns the columns from the table that we want reflected in our DataTable.</span></span> <span data-ttu-id="551a1-218">在精靈結尾處我們將提供的方法名稱，此查詢。</span><span class="sxs-lookup"><span data-stu-id="551a1-218">At the end of the wizard we'll give a method name to this query.</span></span> <span data-ttu-id="551a1-219">一旦已達成，則可以叫用這個方法從我們的展示層。</span><span class="sxs-lookup"><span data-stu-id="551a1-219">Once that's been accomplished, this method can be invoked from our presentation layer.</span></span> <span data-ttu-id="551a1-220">方法會執行已定義的查詢，並填入強型別的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="551a1-220">The method will execute the defined query and populate a strongly-typed DataTable.</span></span>

<span data-ttu-id="551a1-221">若要開始定義 SQL 查詢，我們必須先指示我們要如何讓發出查詢的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="551a1-221">To get started defining the SQL query we must first indicate how we want the TableAdapter to issue the query.</span></span> <span data-ttu-id="551a1-222">我們可以使用特定 SQL 陳述式，建立新的預存程序，或使用現有的預存程序。</span><span class="sxs-lookup"><span data-stu-id="551a1-222">We can use an ad-hoc SQL statement, create a new stored procedure, or use an existing stored procedure.</span></span> <span data-ttu-id="551a1-223">這些教學課程中，我們將使用特定 SQL 陳述式。</span><span class="sxs-lookup"><span data-stu-id="551a1-223">For these tutorials we'll use ad-hoc SQL statements.</span></span> <span data-ttu-id="551a1-224">請參閱[Brian Noyes](http://briannoyes.net/)的文章[建置以 Visual Studio 2005 的 DataSet 設計工具的資料存取層](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)如需使用預存程序的範例。</span><span class="sxs-lookup"><span data-stu-id="551a1-224">Refer to [Brian Noyes](http://briannoyes.net/)'s article, [Build a Data Access Layer with the Visual Studio 2005 DataSet Designer](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner) for an example of using stored procedures.</span></span>


<span data-ttu-id="551a1-225">[![查詢使用特定 SQL 陳述式的資料](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-225">[![Query the Data Using an Ad-Hoc SQL Statement](creating-a-data-access-layer-cs/_static/image18.png)](creating-a-data-access-layer-cs/_static/image17.png)</span></span>

<span data-ttu-id="551a1-226">**圖 7**： 查詢使用特定 SQL 陳述式的資料 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image19.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-226">**Figure 7**: Query the Data Using an Ad-Hoc SQL Statement ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image19.png))</span></span>


<span data-ttu-id="551a1-227">此時我們可以輸入 SQL 查詢中以手動方式。</span><span class="sxs-lookup"><span data-stu-id="551a1-227">At this point we can type in the SQL query by hand.</span></span> <span data-ttu-id="551a1-228">在 TableAdapter 中建立第一種方法時您通常會想要讓查詢傳回需要來表示對應的 DataTable 中的資料行。</span><span class="sxs-lookup"><span data-stu-id="551a1-228">When creating the first method in the TableAdapter you typically want to have the query return those columns that need to be expressed in the corresponding DataTable.</span></span> <span data-ttu-id="551a1-229">我們可以達成此目的建立的查詢會傳回所有資料行和所有資料列**產品**資料表：</span><span class="sxs-lookup"><span data-stu-id="551a1-229">We can accomplish this by creating a query that returns all columns and all rows from the **Products** table:</span></span>


<span data-ttu-id="551a1-230">[![在文字方塊中輸入 SQL 查詢](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-230">[![Enter the SQL Query Into the Textbox](creating-a-data-access-layer-cs/_static/image21.png)](creating-a-data-access-layer-cs/_static/image20.png)</span></span>

<span data-ttu-id="551a1-231">**圖 8**： 輸入 SQL 查詢至文字方塊中 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-231">**Figure 8**: Enter the SQL Query Into the Textbox ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image22.png))</span></span>


<span data-ttu-id="551a1-232">或者，使用查詢產生器，並以圖形方式建立查詢，如 圖 9 所示。</span><span class="sxs-lookup"><span data-stu-id="551a1-232">Alternatively, use the Query Builder and graphically construct the query, as shown in Figure 9.</span></span>


<span data-ttu-id="551a1-233">[![透過查詢編輯器中，以圖形方式建立查詢](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-233">[![Create the Query Graphically, through the Query Editor](creating-a-data-access-layer-cs/_static/image24.png)](creating-a-data-access-layer-cs/_static/image23.png)</span></span>

<span data-ttu-id="551a1-234">**圖 9**： 建立查詢，以圖形方式透過查詢編輯器中 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-234">**Figure 9**: Create the Query Graphically, through the Query Editor ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image25.png))</span></span>


<span data-ttu-id="551a1-235">建立查詢，之後再移到下一個畫面中，按一下 [進階選項] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="551a1-235">After creating the query, but before moving onto the next screen, click the Advanced Options button.</span></span> <span data-ttu-id="551a1-236">在網站專案中，「 產生 Insert、 Update 和 Delete 陳述式 」 是唯一進階預設; 選取的選項如果您從類別庫或 Windows 專案執行此精靈也會選取 使用開放式並行存取 」 選項。</span><span class="sxs-lookup"><span data-stu-id="551a1-236">In Web Site Projects, "Generate Insert, Update, and Delete statements" is the only advanced option selected by default; if you run this wizard from a Class Library or a Windows Project the "Use optimistic concurrency" option will also be selected.</span></span> <span data-ttu-id="551a1-237">核取 使用開放式並行存取 」 選項現在。</span><span class="sxs-lookup"><span data-stu-id="551a1-237">Leave the "Use optimistic concurrency" option unchecked for now.</span></span> <span data-ttu-id="551a1-238">在未來的教學課程中，我們將檢驗開放式並行存取。</span><span class="sxs-lookup"><span data-stu-id="551a1-238">We'll examine optimistic concurrency in future tutorials.</span></span>


<span data-ttu-id="551a1-239">[![選取 只產生 Insert、 Update 和 Delete 陳述式選項](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-239">[![Select Only the Generate Insert, Update, and Delete statements Option](creating-a-data-access-layer-cs/_static/image27.png)](creating-a-data-access-layer-cs/_static/image26.png)</span></span>

<span data-ttu-id="551a1-240">**圖 10**： 選取 只產生 Insert、 Update 和 Delete 陳述式選項 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-240">**Figure 10**: Select Only the Generate Insert, Update, and Delete statements Option ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image28.png))</span></span>


<span data-ttu-id="551a1-241">驗證之後的進階的選項，按一下 [下一步] 繼續進行最後的畫面。</span><span class="sxs-lookup"><span data-stu-id="551a1-241">After verifying the advanced options, click Next to proceed to the final screen.</span></span> <span data-ttu-id="551a1-242">這裡我們會要求選取要加入至 TableAdapter 方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-242">Here we are asked to select which methods to add to the TableAdapter.</span></span> <span data-ttu-id="551a1-243">有兩種模式適用於填入資料：</span><span class="sxs-lookup"><span data-stu-id="551a1-243">There are two patterns for populating data:</span></span>

- <span data-ttu-id="551a1-244">**填入 DataTable**使用這種方法建立方法會採用做為參數的 DataTable 中，並填入它根據查詢的結果。</span><span class="sxs-lookup"><span data-stu-id="551a1-244">**Fill a DataTable** with this approach a method is created that takes in a DataTable as a parameter and populates it based on the results of the query.</span></span> <span data-ttu-id="551a1-245">ADO.NET DataAdapter 類別，例如，實作此模式，以其**fill （)** 方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-245">The ADO.NET DataAdapter class, for example, implements this pattern with its **Fill()** method.</span></span>
- <span data-ttu-id="551a1-246">**傳回 DataTable**使用這種方法方法會建立並會為您填入 DataTable，並傳回為方法傳回值。</span><span class="sxs-lookup"><span data-stu-id="551a1-246">**Return a DataTable** with this approach the method creates and fills the DataTable for you and returns it as the methods return value.</span></span>

<span data-ttu-id="551a1-247">您可以實作一個或以上兩種模式的 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="551a1-247">You can have the TableAdapter implement one or both of these patterns.</span></span> <span data-ttu-id="551a1-248">您也可以重新命名此處提供的方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-248">You can also rename the methods provided here.</span></span> <span data-ttu-id="551a1-249">我們將保持核取，這兩個核取方塊，即使我們將只使用在這些教學課程的第二個模式。</span><span class="sxs-lookup"><span data-stu-id="551a1-249">Let's leave both checkboxes checked, even though we'll only be using the latter pattern throughout these tutorials.</span></span> <span data-ttu-id="551a1-250">此外，請將重新命名而不是泛型**GetData**方法來**GetProducts**。</span><span class="sxs-lookup"><span data-stu-id="551a1-250">Also, let's rename the rather generic **GetData** method to **GetProducts**.</span></span>

<span data-ttu-id="551a1-251">最後一個核取方塊，「 GenerateDBDirectMethods 」，若選取此選項，建立**insert （)**， **update （)**，並**delete （)** TableAdapter 方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-251">If checked, the final checkbox, "GenerateDBDirectMethods," creates **Insert()**, **Update()**, and **Delete()** methods for the TableAdapter.</span></span> <span data-ttu-id="551a1-252">如果您核取此選項，所有的更新必須透過 TableAdapter 的唯一**update （)** 方法，後者會採用型別資料集、 DataTable、 單一的 DataRow 或陣列中的 Datarow。</span><span class="sxs-lookup"><span data-stu-id="551a1-252">If you leave this option unchecked, all updates will need to be done through the TableAdapter's sole **Update()** method, which takes in the Typed DataSet, a DataTable, a single DataRow, or an array of DataRows.</span></span> <span data-ttu-id="551a1-253">(如果您已經圖 9 中的進階屬性此核取方塊未核取產生 Insert、 Update 和 Delete 陳述式 > 」 選項設定不會影響。)讓我們保留選取此核取方塊。</span><span class="sxs-lookup"><span data-stu-id="551a1-253">(If you've unchecked the "Generate Insert, Update, and Delete statements" option from the advanced properties in Figure 9 this checkbox's setting will have no effect.) Let's leave this checkbox selected.</span></span>


<span data-ttu-id="551a1-254">[![從 GetData 中變成 GetProducts 的方法名稱](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-254">[![Change the Method Name from GetData to GetProducts](creating-a-data-access-layer-cs/_static/image30.png)](creating-a-data-access-layer-cs/_static/image29.png)</span></span>

<span data-ttu-id="551a1-255">**圖 11**： 將方法名稱，從**GetData**要**GetProducts** ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-255">**Figure 11**: Change the Method Name from **GetData** to **GetProducts** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image31.png))</span></span>


<span data-ttu-id="551a1-256">按一下 [完成] 來完成精靈。</span><span class="sxs-lookup"><span data-stu-id="551a1-256">Complete the wizard by clicking Finish.</span></span> <span data-ttu-id="551a1-257">精靈關閉之後我們會回到 DataSet 設計工具會顯示我們剛才建立的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="551a1-257">After the wizard closes we are returned to the DataSet Designer which shows the DataTable we just created.</span></span> <span data-ttu-id="551a1-258">您可以看到清單中的資料行**產品**DataTable (**ProductID**， **ProductName**等等)，以及方法的**ProductsTableAdapter** (**fill （)** 並**GetProducts()**)。</span><span class="sxs-lookup"><span data-stu-id="551a1-258">You can see the list of columns in the **Products** DataTable (**ProductID**, **ProductName**, and so on), as well as the methods of the **ProductsTableAdapter** (**Fill()** and **GetProducts()**).</span></span>


<span data-ttu-id="551a1-259">[![產品 DataTable 和 ProductsTableAdapter 已加入至具類型資料集](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-259">[![The Products DataTable and ProductsTableAdapter have been Added to the Typed DataSet](creating-a-data-access-layer-cs/_static/image33.png)](creating-a-data-access-layer-cs/_static/image32.png)</span></span>

<span data-ttu-id="551a1-260">**圖 12**:**產品**DataTable 和**ProductsTableAdapter**已加入至具類型資料集 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-260">**Figure 12**: The **Products** DataTable and **ProductsTableAdapter** have been Added to the Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image34.png))</span></span>


<span data-ttu-id="551a1-261">現在我們有單一的 datatable 的具類型資料集 (**Northwind.Products**) 和強型別資料配接器類別 (**NorthwindTableAdapters.ProductsTableAdapter**) 與**GetProducts()** 方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-261">At this point we have a Typed DataSet with a single DataTable (**Northwind.Products**) and a strongly-typed DataAdapter class (**NorthwindTableAdapters.ProductsTableAdapter**) with a **GetProducts()** method.</span></span> <span data-ttu-id="551a1-262">這些物件可以用來從類似的程式碼存取的所有產品清單中：</span><span class="sxs-lookup"><span data-stu-id="551a1-262">These objects can be used to access a list of all products from code like:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample1.html)]

<span data-ttu-id="551a1-263">此程式碼不需要我們編寫一個位元的資料存取特定的程式碼。</span><span class="sxs-lookup"><span data-stu-id="551a1-263">This code did not require us to write one bit of data access-specific code.</span></span> <span data-ttu-id="551a1-264">我們不需要任何 ADO.NET 類別具現化，我們沒有參考任何連接字串，SQL 查詢或預存程序。</span><span class="sxs-lookup"><span data-stu-id="551a1-264">We did not have to instantiate any ADO.NET classes, we didn't have to refer to any connection strings, SQL queries, or stored procedures.</span></span> <span data-ttu-id="551a1-265">相反地，TableAdapter 將為我們提供低層級的資料存取程式碼。</span><span class="sxs-lookup"><span data-stu-id="551a1-265">Instead, the TableAdapter provides the low-level data access code for us.</span></span>

<span data-ttu-id="551a1-266">此範例中使用的每個物件也是強型別，讓 Visual Studio 提供 IntelliSense 和編譯時期類型檢查。</span><span class="sxs-lookup"><span data-stu-id="551a1-266">Each object used in this example is also strongly-typed, allowing Visual Studio to provide IntelliSense and compile-time type checking.</span></span> <span data-ttu-id="551a1-267">和最佳的 TableAdapter 所傳回的所有通用值可以繫結至 ASP.NET 資料 Web 控制項，例如 GridView、 DetailsView、 DropDownList、 CheckBoxList 和其他許多選項。</span><span class="sxs-lookup"><span data-stu-id="551a1-267">And best of all the DataTables returned by the TableAdapter can be bound to ASP.NET data Web controls, such as the GridView, DetailsView, DropDownList, CheckBoxList, and several others.</span></span> <span data-ttu-id="551a1-268">下列範例說明繫結所傳回 DataTable **GetProducts()** 方法，以在只掃描三行程式碼內的 GridView**頁\_負載**事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="551a1-268">The following example illustrates binding the DataTable returned by the **GetProducts()** method to a GridView in just a scant three lines of code within the **Page\_Load** event handler.</span></span>

<span data-ttu-id="551a1-269">AllProducts.aspx</span><span class="sxs-lookup"><span data-stu-id="551a1-269">AllProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample2.aspx)]

<span data-ttu-id="551a1-270">AllProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="551a1-270">AllProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample3.cs)]


<span data-ttu-id="551a1-271">[![在 GridView 中顯示產品清單](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-271">[![The List of Products is Displayed in a GridView](creating-a-data-access-layer-cs/_static/image36.png)](creating-a-data-access-layer-cs/_static/image35.png)</span></span>

<span data-ttu-id="551a1-272">**圖 13**: The List of Products GridView 中顯示 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-272">**Figure 13**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image37.png))</span></span>


<span data-ttu-id="551a1-273">雖然此範例會要求我們在我們的 ASP.NET 網頁中撰寫三行程式碼**網頁\_負載**事件處理常式中，在未來我們將檢驗如何以宣告方式擷取資料的使用 ObjectDataSource 教學課程DAL。</span><span class="sxs-lookup"><span data-stu-id="551a1-273">While this example required that we write three lines of code in our ASP.NET page's **Page\_Load** event handler, in future tutorials we'll examine how to use the ObjectDataSource to declaratively retrieve the data from the DAL.</span></span> <span data-ttu-id="551a1-274">使用 ObjectDataSource 我們將不需要撰寫任何程式碼，並將取得以及分頁和排序支援 ！</span><span class="sxs-lookup"><span data-stu-id="551a1-274">With the ObjectDataSource we'll not have to write any code and will get paging and sorting support as well!</span></span>

## <a name="step-3-adding-parameterized-methods-to-the-data-access-layer"></a><span data-ttu-id="551a1-275">步驟 3： 加入參數化資料存取層的方法</span><span class="sxs-lookup"><span data-stu-id="551a1-275">Step 3: Adding Parameterized Methods to the Data Access Layer</span></span>

<span data-ttu-id="551a1-276">此時我們**ProductsTableAdapter**類別具有一種方法，但**GetProducts()**，它會先傳回的所有產品，在資料庫中。</span><span class="sxs-lookup"><span data-stu-id="551a1-276">At this point our **ProductsTableAdapter** class has but one method, **GetProducts()**, which returns all of the products in the database.</span></span> <span data-ttu-id="551a1-277">時能夠使用 所有產品一定很有用，但也有我們會的想来擷取特定產品或屬於特定類別的所有產品的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="551a1-277">While being able to work with all products is definitely useful, there are times when we'll want to retrieve information about a specific product, or all products that belong to a particular category.</span></span> <span data-ttu-id="551a1-278">若要將這類功能加入我們的資料存取層中，我們可以參數化的方法加入 TableAdapter 中。</span><span class="sxs-lookup"><span data-stu-id="551a1-278">To add such functionality to our Data Access Layer we can add parameterized methods to the TableAdapter.</span></span>

<span data-ttu-id="551a1-279">讓我們新增**GetProductsByCategoryID (*categoryID*)** 方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-279">Let's add the **GetProductsByCategoryID(*categoryID*)** method.</span></span> <span data-ttu-id="551a1-280">若要將新方法新增至 DAL，返回 DataSet 設計工具中，以滑鼠右鍵按一下**ProductsTableAdapter**區段，然後選擇 加入查詢。</span><span class="sxs-lookup"><span data-stu-id="551a1-280">To add a new method to the DAL, return to the DataSet Designer, right-click in the **ProductsTableAdapter** section, and choose Add Query.</span></span>


![TableAdapter 上按一下滑鼠右鍵，然後選擇 新增查詢](creating-a-data-access-layer-cs/_static/image38.png)

<span data-ttu-id="551a1-282">**圖 14**: TableAdapter 上按一下滑鼠右鍵，然後選擇 新增查詢</span><span class="sxs-lookup"><span data-stu-id="551a1-282">**Figure 14**: Right-Click on the TableAdapter and Choose Add Query</span></span>


<span data-ttu-id="551a1-283">我們先提示您有關我們是否想要存取使用特定 SQL 陳述式或新的或現有的預存程序的資料庫。</span><span class="sxs-lookup"><span data-stu-id="551a1-283">We are first prompted about whether we want to access the database using an ad-hoc SQL statement or a new or existing stored procedure.</span></span> <span data-ttu-id="551a1-284">讓我們選擇使用特定 SQL 陳述式一次。</span><span class="sxs-lookup"><span data-stu-id="551a1-284">Let's choose to use an ad-hoc SQL statement again.</span></span> <span data-ttu-id="551a1-285">接下來，我們會要求我們想要使用的 SQL 查詢的類型。</span><span class="sxs-lookup"><span data-stu-id="551a1-285">Next, we are asked what type of SQL query we'd like to use.</span></span> <span data-ttu-id="551a1-286">因為我們想要傳回屬於指定分類的所有產品，我們想要撰寫**選取**陳述式會傳回資料列。</span><span class="sxs-lookup"><span data-stu-id="551a1-286">Since we want to return all products that belong to a specified category, we want to write a **SELECT** statement which returns rows.</span></span>


<span data-ttu-id="551a1-287">[![選擇建立 SELECT 陳述式會傳回資料列](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-287">[![Choose to Create a SELECT Statement Which Returns Rows](creating-a-data-access-layer-cs/_static/image40.png)](creating-a-data-access-layer-cs/_static/image39.png)</span></span>

<span data-ttu-id="551a1-288">**圖 15**： 選擇建立**選取**陳述式的傳回資料列 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image41.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-288">**Figure 15**: Choose to Create a **SELECT** Statement Which Returns Rows ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image41.png))</span></span>


<span data-ttu-id="551a1-289">下一個步驟是定義用來存取資料的 SQL 查詢。</span><span class="sxs-lookup"><span data-stu-id="551a1-289">The next step is to define the SQL query used to access the data.</span></span> <span data-ttu-id="551a1-290">因為我們想要傳回屬於特定類別目錄的產品，我會使用相同<strong>選取 </strong>陳述式，從<strong>GetProducts()</strong>，但新增下列<strong>其中</strong>子句：<strong>其中 CategoryID = @CategoryID</strong> 。</span><span class="sxs-lookup"><span data-stu-id="551a1-290">Since we want to return only those products that belong to a particular category, I use the same <strong>SELECT</strong> statement from <strong>GetProducts()</strong>, but add the following <strong>WHERE</strong> clause: <strong>WHERE CategoryID = @CategoryID</strong>.</span></span> <span data-ttu-id="551a1-291"><strong>@CategoryID</strong>參數表示 TableAdapter 精靈，我們要建立的方法需要對應的型別 （也就是可為 null 的整數） 的輸入的參數。</span><span class="sxs-lookup"><span data-stu-id="551a1-291">The <strong>@CategoryID</strong> parameter indicates to the TableAdapter wizard that the method we're creating will require an input parameter of the corresponding type (namely, a nullable integer).</span></span>


<span data-ttu-id="551a1-292">[![輸入查詢，以便只傳回指定類別中的 產品](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-292">[![Enter a Query to Only Return Products in a Specified Category](creating-a-data-access-layer-cs/_static/image43.png)](creating-a-data-access-layer-cs/_static/image42.png)</span></span>

<span data-ttu-id="551a1-293">**圖 16**： 輸入的查詢只傳回產品在指定的類別 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image44.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-293">**Figure 16**: Enter a Query to Only Return Products in a Specified Category ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image44.png))</span></span>


<span data-ttu-id="551a1-294">最後一個步驟中，我們可以選擇什麼資料存取模式來使用，以及自訂產生的方法的名稱。</span><span class="sxs-lookup"><span data-stu-id="551a1-294">In the final step we can choose which data access patterns to use, as well as customize the names of the methods generated.</span></span> <span data-ttu-id="551a1-295">填滿模式，讓我們變更名稱以<strong>FillByCategoryID</strong> ，並傳回的 DataTable 傳回模式 (<strong>取得*X</strong>* 方法)，讓我們使用<strong>GetProductsByCategoryID</strong>。</span><span class="sxs-lookup"><span data-stu-id="551a1-295">For the Fill pattern, let's change the name to <strong>FillByCategoryID</strong> and for the return a DataTable return pattern (the <strong>Get*X</strong>* methods), let's use <strong>GetProductsByCategoryID</strong>.</span></span>


<span data-ttu-id="551a1-296">[![選擇 TableAdapter 方法的名稱](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-296">[![Choose the Names for the TableAdapter Methods](creating-a-data-access-layer-cs/_static/image46.png)](creating-a-data-access-layer-cs/_static/image45.png)</span></span>

<span data-ttu-id="551a1-297">**圖 17**： 選擇 TableAdapter 方法的名稱 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image47.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-297">**Figure 17**: Choose the Names for the TableAdapter Methods ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image47.png))</span></span>


<span data-ttu-id="551a1-298">完成精靈之後，DataSet 設計工具會包含新的 TableAdapter 方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-298">After completing the wizard, the DataSet Designer includes the new TableAdapter methods.</span></span>


![產品可以現在查詢依類別目錄](creating-a-data-access-layer-cs/_static/image48.png)

<span data-ttu-id="551a1-300">**圖 18**: 產品可以現在查詢依類別目錄</span><span class="sxs-lookup"><span data-stu-id="551a1-300">**Figure 18**: The Products Can Now be Queried by Category</span></span>


<span data-ttu-id="551a1-301">請花一點時間加入**GetProductByProductID (*productID*)** 方法使用相同的技巧。</span><span class="sxs-lookup"><span data-stu-id="551a1-301">Take a moment to add a **GetProductByProductID(*productID*)** method using the same technique.</span></span>

<span data-ttu-id="551a1-302">您可以測試這些參數化的查詢，直接從 DataSet 設計工具。</span><span class="sxs-lookup"><span data-stu-id="551a1-302">These parameterized queries can be tested directly from the DataSet Designer.</span></span> <span data-ttu-id="551a1-303">TableAdapter 中的方法上按一下滑鼠右鍵，然後選擇 預覽資料。</span><span class="sxs-lookup"><span data-stu-id="551a1-303">Right-click on the method in the TableAdapter and choose Preview Data.</span></span> <span data-ttu-id="551a1-304">接下來，輸入要使用參數，並按一下 [預覽] 的值。</span><span class="sxs-lookup"><span data-stu-id="551a1-304">Next, enter the values to use for the parameters and click Preview.</span></span>


<span data-ttu-id="551a1-305">[![會顯示 「 飲料 」 分類這些產品屬於](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-305">[![Those Products Belonging to the Beverages Category are Shown](creating-a-data-access-layer-cs/_static/image50.png)](creating-a-data-access-layer-cs/_static/image49.png)</span></span>

<span data-ttu-id="551a1-306">**圖 19**： 會顯示這些產品屬於 「 飲料 」 分類 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-306">**Figure 19**: Those Products Belonging to the Beverages Category are Shown ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image51.png))</span></span>


<span data-ttu-id="551a1-307">具有**GetProductsByCategoryID (*categoryID*)** 方法我們的 DAL 中，我們現在可以建立 ASP.NET 網頁，只會顯示這些產品在指定的分類。</span><span class="sxs-lookup"><span data-stu-id="551a1-307">With the **GetProductsByCategoryID(*categoryID*)** method in our DAL, we can now create an ASP.NET page that displays only those products in a specified category.</span></span> <span data-ttu-id="551a1-308">下列範例會顯示所有產品中的飲料類別目錄中，具有**CategoryID**為 1。</span><span class="sxs-lookup"><span data-stu-id="551a1-308">The following example shows all products that are in the Beverages category, which have a **CategoryID** of 1.</span></span>

<span data-ttu-id="551a1-309">Beverages.asp</span><span class="sxs-lookup"><span data-stu-id="551a1-309">Beverages.asp</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample4.aspx)]

<span data-ttu-id="551a1-310">Beverages.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="551a1-310">Beverages.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample5.cs)]


<span data-ttu-id="551a1-311">[![會顯示 「 飲料 」 分類中的這些產品](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-311">[![Those Products in the Beverages Category are Displayed](creating-a-data-access-layer-cs/_static/image53.png)](creating-a-data-access-layer-cs/_static/image52.png)</span></span>

<span data-ttu-id="551a1-312">**圖 20**： 會顯示這些產品中的飲料類別目錄 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-312">**Figure 20**: Those Products in the Beverages Category are Displayed ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image54.png))</span></span>


## <a name="step-4-inserting-updating-and-deleting-data"></a><span data-ttu-id="551a1-313">步驟 4： 插入、 更新和刪除資料</span><span class="sxs-lookup"><span data-stu-id="551a1-313">Step 4: Inserting, Updating, and Deleting Data</span></span>

<span data-ttu-id="551a1-314">有兩個常用於插入、 更新和刪除資料的模式。</span><span class="sxs-lookup"><span data-stu-id="551a1-314">There are two patterns commonly used for inserting, updating, and deleting data.</span></span> <span data-ttu-id="551a1-315">第一個模式，我將稱之為資料庫直接存取模式，牽涉到建立方法，叫用時，問題**插入**，**更新**，或**刪除**命令單一資料庫記錄運作的資料庫。</span><span class="sxs-lookup"><span data-stu-id="551a1-315">The first pattern, which I'll call the database direct pattern, involves creating methods that, when invoked, issue an **INSERT**, **UPDATE**, or **DELETE** command to the database that operates on a single database record.</span></span> <span data-ttu-id="551a1-316">一系列對應的純量值 （整數、 字串、 布林值、 日期時間等等） 通常會傳遞這類方法，將值插入、 更新或刪除。</span><span class="sxs-lookup"><span data-stu-id="551a1-316">Such methods are typically passed in a series of scalar values (integers, strings, Booleans, DateTimes, and so on) that correspond to the values to insert, update, or delete.</span></span> <span data-ttu-id="551a1-317">例如，使用此模式**產品**資料表的 delete 方法會採用整數參數，指出**ProductID**要插入方法會需要時刪除的記錄字串，表示**ProductName**、 針對十進位**UnitPrice**，整數**UnitsOnStock**，依此類推。</span><span class="sxs-lookup"><span data-stu-id="551a1-317">For example, with this pattern for the **Products** table the delete method would take in an integer parameter, indicating the **ProductID** of the record to delete, while the insert method would take in a string for the **ProductName**, a decimal for the **UnitPrice**, an integer for the **UnitsOnStock**, and so on.</span></span>


<span data-ttu-id="551a1-318">[![每個插入、 更新和刪除要求傳送至立即資料庫](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-318">[![Each Insert, Update, and Delete Request is Sent to the Database Immediately](creating-a-data-access-layer-cs/_static/image56.png)](creating-a-data-access-layer-cs/_static/image55.png)</span></span>

<span data-ttu-id="551a1-319">**圖 21**： 每個插入、 更新和刪除要求傳送至立即資料庫 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-319">**Figure 21**: Each Insert, Update, and Delete Request is Sent to the Database Immediately ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image57.png))</span></span>


<span data-ttu-id="551a1-320">其他模式，我將稱它為批次更新模式，是更新整個資料集、 DataTable 或 Datarow 的一個方法呼叫中的集合。</span><span class="sxs-lookup"><span data-stu-id="551a1-320">The other pattern, which I'll refer to as the batch update pattern, is to update an entire DataSet, DataTable, or collection of DataRows in one method call.</span></span> <span data-ttu-id="551a1-321">利用此模式為開發人員會刪除、 插入、 和修改 Datarow 的 DataTable 中並接著將這些資料行或 DataTable 傳遞到更新方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-321">With this pattern a developer deletes, inserts, and modifies the DataRows in a DataTable and then passes those DataRows or DataTable into an update method.</span></span> <span data-ttu-id="551a1-322">然後此方法列舉傳入 Datarow，決定是否它們已被修改、 新增或刪除 (透過 DataRow [RowState 屬性](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx)值)，以及發出適當的資料庫要求每一筆記錄。</span><span class="sxs-lookup"><span data-stu-id="551a1-322">This method then enumerates the DataRows passed in, determines whether or not they've been modified, added, or deleted (via the DataRow's [RowState property](https://msdn.microsoft.com/library/system.data.datarow.rowstate.aspx) value), and issues the appropriate database request for each record.</span></span>


<span data-ttu-id="551a1-323">[![在叫用 Update 方法時與資料庫同步的所有變更](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-323">[![All Changes are Synchronized with the Database When the Update Method is Invoked](creating-a-data-access-layer-cs/_static/image59.png)](creating-a-data-access-layer-cs/_static/image58.png)</span></span>

<span data-ttu-id="551a1-324">**圖 22**： 所有變更會與同步都處理資料庫時叫用 Update 方法 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-324">**Figure 22**: All Changes are Synchronized with the Database When the Update Method is Invoked ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image60.png))</span></span>


<span data-ttu-id="551a1-325">TableAdapter 會根據預設，會使用批次更新模式，但也支援 DB 直接模式。</span><span class="sxs-lookup"><span data-stu-id="551a1-325">The TableAdapter uses the batch update pattern by default, but also supports the DB direct pattern.</span></span> <span data-ttu-id="551a1-326">我們選取 產生 Insert、 Update 和 Delete 陳述式 > 」 選項從 進階內容時建立我們的 TableAdapter，因為**ProductsTableAdapter**包含**update （)** 方法它會實作批次更新模式。</span><span class="sxs-lookup"><span data-stu-id="551a1-326">Since we selected the "Generate Insert, Update, and Delete statements" option from the Advanced Properties when creating our TableAdapter, the **ProductsTableAdapter** contains an **Update()** method, which implements the batch update pattern.</span></span> <span data-ttu-id="551a1-327">具體來說，包含 TableAdapter **update （)** 可以傳遞具類型資料集、 強型別的 DataTable 或一或多個 Datarow 的方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-327">Specifically, the TableAdapter contains an **Update()** method that can be passed the Typed DataSet, a strongly-typed DataTable, or one or more DataRows.</span></span> <span data-ttu-id="551a1-328">如果您選取當第一次建立 TableAdapter 的 DB 直接模式會也可透過實作 「 GenerateDBDirectMethods 」 核取方塊**insert （)**， **update （)**，和**delete （)** 方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-328">If you left the "GenerateDBDirectMethods" checkbox checked when first creating the TableAdapter the DB direct pattern will also be implemented via **Insert()**, **Update()**, and **Delete()** methods.</span></span>

<span data-ttu-id="551a1-329">這兩個資料修改模式使用的 TableAdapter **InsertCommand**， **UpdateCommand**，並**DeleteCommand**屬性，以發出其**插入**，**更新**，以及**刪除**命令至資料庫。</span><span class="sxs-lookup"><span data-stu-id="551a1-329">Both data modification patterns use the TableAdapter's **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties to issue their **INSERT**, **UPDATE**, and **DELETE** commands to the database.</span></span> <span data-ttu-id="551a1-330">您可以檢查和修改**InsertCommand**， **UpdateCommand**，並**DeleteCommand** DataSet 設計工具的 TableAdapter 上按一下，然後再將屬性到 [屬性] 視窗中。</span><span class="sxs-lookup"><span data-stu-id="551a1-330">You can inspect and modify the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** properties by clicking on the TableAdapter in the DataSet Designer and then going to the Properties window.</span></span> <span data-ttu-id="551a1-331">(請確定您已選取的 TableAdapter，且**ProductsTableAdapter**物件是在 [屬性] 視窗中的下拉式清單中選取。)</span><span class="sxs-lookup"><span data-stu-id="551a1-331">(Make sure you have selected the TableAdapter, and that the **ProductsTableAdapter** object is the one selected in the drop-down list in the Properties window.)</span></span>


<span data-ttu-id="551a1-332">[![TableAdapter 具有 InsertCommand、 UpdateCommand，以及 DeleteCommand 屬性](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-332">[![The TableAdapter has InsertCommand, UpdateCommand, and DeleteCommand Properties](creating-a-data-access-layer-cs/_static/image62.png)](creating-a-data-access-layer-cs/_static/image61.png)</span></span>

<span data-ttu-id="551a1-333">**圖 23**: tableadapter **InsertCommand**， **UpdateCommand**，和**DeleteCommand**屬性 ([按一下可觀看完整大小的檢視映像](creating-a-data-access-layer-cs/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-333">**Figure 23**: The TableAdapter has **InsertCommand**, **UpdateCommand**, and **DeleteCommand** Properties ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image63.png))</span></span>


<span data-ttu-id="551a1-334">若要檢查或修改其中任何一個資料庫的命令屬性，按一下**CommandText**子屬性，這會顯示 查詢產生器。</span><span class="sxs-lookup"><span data-stu-id="551a1-334">To examine or modify any of these database command properties, click on the **CommandText** subproperty, which will bring up the Query Builder.</span></span>


<span data-ttu-id="551a1-335">[![設定 查詢產生器中的 INSERT、 UPDATE 和 DELETE 陳述式](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-335">[![Configure the INSERT, UPDATE, and DELETE Statements in the Query Builder](creating-a-data-access-layer-cs/_static/image65.png)](creating-a-data-access-layer-cs/_static/image64.png)</span></span>

<span data-ttu-id="551a1-336">**圖 24**： 設定**插入**，**更新**，和**刪除**查詢產生器中的陳述式 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-336">**Figure 24**: Configure the **INSERT**, **UPDATE**, and **DELETE** Statements in the Query Builder ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image66.png))</span></span>


<span data-ttu-id="551a1-337">下列程式碼範例示範如何使用批次更新模式，不會停止，且包含 25 個單位庫存以內的所有產品的價格的兩倍：</span><span class="sxs-lookup"><span data-stu-id="551a1-337">The following code example shows how to use the batch update pattern to double the price of all products that are not discontinued and that have 25 units in stock or less:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample6.cs)]

<span data-ttu-id="551a1-338">下列程式碼說明如何使用 DB 直接模式以程式設計方式刪除特定的產品，然後更新其中一個，然後再加入 新的：</span><span class="sxs-lookup"><span data-stu-id="551a1-338">The code below illustrates how to use the DB direct pattern to programmatically delete a particular product, then update one, and then add a new one:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample7.cs)]

## <a name="creating-custom-insert-update-and-delete-methods"></a><span data-ttu-id="551a1-339">建立自訂 Insert、 Update 和 Delete 方法</span><span class="sxs-lookup"><span data-stu-id="551a1-339">Creating Custom Insert, Update, and Delete Methods</span></span>

<span data-ttu-id="551a1-340">**Insert （)**， **update （)**，並**delete （)** DB 直接方法所建立的方法可以是有點麻煩，特別是針對包含許多資料行的資料表。</span><span class="sxs-lookup"><span data-stu-id="551a1-340">The **Insert()**, **Update()**, and **Delete()** methods created by the DB direct method can be a bit cumbersome, especially for tables with many columns.</span></span> <span data-ttu-id="551a1-341">查看先前的程式碼範例中，沒有 IntelliSense 的協助不特別清楚什麼**產品**資料表資料行對應至每個輸入參數**update （)** 和**insert （)** 方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-341">Looking at the previous code example, without IntelliSense's help it's not particularly clear what **Products** table column maps to each input parameter to the **Update()** and **Insert()** methods.</span></span> <span data-ttu-id="551a1-342">有時候我們可能只想要更新單一資料行或兩個，或想要自訂**insert （)** 方法，或許會傳回值的新插入的資料錄**識別**（自動遞增）欄位。</span><span class="sxs-lookup"><span data-stu-id="551a1-342">There may be times when we only want to update a single column or two, or want a customized **Insert()** method that will, perhaps, return the value of the newly inserted record's **IDENTITY** (auto-increment) field.</span></span>

<span data-ttu-id="551a1-343">若要建立這種自訂的方法，請返回 DataSet 設計工具。</span><span class="sxs-lookup"><span data-stu-id="551a1-343">To create such a custom method, return to the DataSet Designer.</span></span> <span data-ttu-id="551a1-344">TableAdapter 上按一下滑鼠右鍵，然後選擇 加入查詢，回到 Tabaleadapter 精靈。</span><span class="sxs-lookup"><span data-stu-id="551a1-344">Right-click on the TableAdapter and choose Add Query, returning to the TableAdapter wizard.</span></span> <span data-ttu-id="551a1-345">在第二個畫面中，我們可以指示來建立查詢的類型。</span><span class="sxs-lookup"><span data-stu-id="551a1-345">On the second screen we can indicate the type of query to create.</span></span> <span data-ttu-id="551a1-346">讓我們建立的方法加入新的產品，然後傳回新加入的資料錄的值**ProductID**。</span><span class="sxs-lookup"><span data-stu-id="551a1-346">Let's create a method that adds a new product and then returns the value of the newly added record's **ProductID**.</span></span> <span data-ttu-id="551a1-347">因此，若要建立 opt**插入**查詢。</span><span class="sxs-lookup"><span data-stu-id="551a1-347">Therefore, opt to create an **INSERT** query.</span></span>


<span data-ttu-id="551a1-348">[![建立方法，以將新的資料列加入至 Products 資料表](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-348">[![Create a Method to Add a New Row to the Products Table](creating-a-data-access-layer-cs/_static/image68.png)](creating-a-data-access-layer-cs/_static/image67.png)</span></span>

<span data-ttu-id="551a1-349">**圖 25**： 建立方法，以加入新資料列**產品**資料表 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-349">**Figure 25**: Create a Method to Add a New Row to the **Products** Table ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image69.png))</span></span>


<span data-ttu-id="551a1-350">在下一個畫面**InsertCommand**的**CommandText**隨即出現。</span><span class="sxs-lookup"><span data-stu-id="551a1-350">On the next screen the **InsertCommand**'s **CommandText** appears.</span></span> <span data-ttu-id="551a1-351">藉由新增增強這項查詢**選取範圍\_IDENTITY()** 查詢的結尾，這會傳回最後插入的 identity 值**識別**相同範圍中的資料行。</span><span class="sxs-lookup"><span data-stu-id="551a1-351">Augment this query by adding **SELECT SCOPE\_IDENTITY()** at the end of the query, which will return the last identity value inserted into an **IDENTITY** column in the same scope.</span></span> <span data-ttu-id="551a1-352">(請參閱[技術文件](https://msdn.microsoft.com/library/ms190315.aspx)如需詳細資訊**範圍\_IDENTITY()** 以及為什麼您可能想要[使用範圍\_IDENTITY() 替代 @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx).)請確定您最終**插入**以分號的陳述式，然後再加入**選取**陳述式。</span><span class="sxs-lookup"><span data-stu-id="551a1-352">(See the [technical documentation](https://msdn.microsoft.com/library/ms190315.aspx) for more information about **SCOPE\_IDENTITY()** and why you probably want to [use SCOPE\_IDENTITY() in lieu of @@IDENTITY](http://weblogs.sqlteam.com/travisl/archive/2003/10/29/405.aspx).) Make sure that you end the **INSERT** statement with a semi-colon before adding the **SELECT** statement.</span></span>


<span data-ttu-id="551a1-353">[![加強查詢傳回 scope_identity （） 值](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-353">[![Augment the Query to Return the SCOPE_IDENTITY() Value](creating-a-data-access-layer-cs/_static/image71.png)](creating-a-data-access-layer-cs/_static/image70.png)</span></span>

<span data-ttu-id="551a1-354">**圖 26**： 增強查詢來傳回**範圍\_IDENTITY()** 值 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image72.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-354">**Figure 26**: Augment the Query to Return the **SCOPE\_IDENTITY()** Value ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image72.png))</span></span>


<span data-ttu-id="551a1-355">最後，名稱的新方法**InsertProduct**。</span><span class="sxs-lookup"><span data-stu-id="551a1-355">Finally, name the new method **InsertProduct**.</span></span>


<span data-ttu-id="551a1-356">[![將新的方法名稱設定為 InsertProduct](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-356">[![Set the New Method Name to InsertProduct](creating-a-data-access-layer-cs/_static/image74.png)](creating-a-data-access-layer-cs/_static/image73.png)</span></span>

<span data-ttu-id="551a1-357">**圖 27**： 將新的方法名稱設定為**InsertProduct** ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image75.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-357">**Figure 27**: Set the New Method Name to **InsertProduct** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image75.png))</span></span>


<span data-ttu-id="551a1-358">當您返回 DataSet 設計工具您會看到**ProductsTableAdapter**包含一個新方法**InsertProduct**。</span><span class="sxs-lookup"><span data-stu-id="551a1-358">When you return to the DataSet Designer you'll see that the **ProductsTableAdapter** contains a new method, **InsertProduct**.</span></span> <span data-ttu-id="551a1-359">如果這個新的方法沒有參數可以用來在每個資料行**產品**資料表，可能會忘記終止**插入**以分號的陳述式。</span><span class="sxs-lookup"><span data-stu-id="551a1-359">If this new method doesn't have a parameter for each column in the **Products** table, chances are you forgot to terminate the **INSERT** statement with a semi-colon.</span></span> <span data-ttu-id="551a1-360">設定**InsertProduct**方法，並確定您有以分號分隔**插入**並**選取**陳述式。</span><span class="sxs-lookup"><span data-stu-id="551a1-360">Configure the **InsertProduct** method and ensure you have a semi-colon delimiting the **INSERT** and **SELECT** statements.</span></span>

<span data-ttu-id="551a1-361">根據預設，insert 方法問題非查詢方法，這表示它們會傳回受影響的資料列數目。</span><span class="sxs-lookup"><span data-stu-id="551a1-361">By default, insert methods issue non-query methods, meaning that they return the number of affected rows.</span></span> <span data-ttu-id="551a1-362">不過，我們想**InsertProduct**方法傳回查詢，而不是受影響的資料列的數目所傳回的值。</span><span class="sxs-lookup"><span data-stu-id="551a1-362">However, we want the **InsertProduct** method to return the value returned by the query, not the number of rows affected.</span></span> <span data-ttu-id="551a1-363">若要達成此目的，調整**InsertProduct**方法的**ExecuteMode**屬性設**純量**。</span><span class="sxs-lookup"><span data-stu-id="551a1-363">To accomplish this, adjust the **InsertProduct** method's **ExecuteMode** property to **Scalar**.</span></span>


<span data-ttu-id="551a1-364">[![將 ExecuteMode 屬性變更為純量](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-364">[![Change the ExecuteMode Property to Scalar](creating-a-data-access-layer-cs/_static/image77.png)](creating-a-data-access-layer-cs/_static/image76.png)</span></span>

<span data-ttu-id="551a1-365">**圖 28**： 變更**ExecuteMode**屬性設**純量**([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image78.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-365">**Figure 28**: Change the **ExecuteMode** Property to **Scalar** ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image78.png))</span></span>


<span data-ttu-id="551a1-366">下列程式碼示範這個新**InsertProduct**作用中的方法：</span><span class="sxs-lookup"><span data-stu-id="551a1-366">The following code shows this new **InsertProduct** method in action:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample8.cs)]

## <a name="step-5-completing-the-data-access-layer"></a><span data-ttu-id="551a1-367">步驟 5： 完成資料存取層</span><span class="sxs-lookup"><span data-stu-id="551a1-367">Step 5: Completing the Data Access Layer</span></span>

<span data-ttu-id="551a1-368">請注意， **ProductsTableAdapters**類別會傳回**CategoryID**並**SupplierID**值**產品**資料表，但不包含**CategoryName**資料行**類別**表格或**CompanyName**資料行從**供應商**資料表中，雖然這些可能是我們想要顯示的產品資訊時顯示的資料行。</span><span class="sxs-lookup"><span data-stu-id="551a1-368">Note that the **ProductsTableAdapters** class returns the **CategoryID** and **SupplierID** values from the **Products** table, but doesn't include the **CategoryName** column from the **Categories** table or the **CompanyName** column from the **Suppliers** table, although these are likely the columns we want to display when showing product information.</span></span> <span data-ttu-id="551a1-369">我們可以擴充 TableAdapter 的第一個方法， **GetProducts()**，以同時包含**CategoryName**並**CompanyName**將更新的資料行值包含這些新資料行以及的強型別的 DataTable。</span><span class="sxs-lookup"><span data-stu-id="551a1-369">We can augment the TableAdapter's initial method, **GetProducts()**, to include both the **CategoryName** and **CompanyName** column values, which will update the strongly-typed DataTable to include these new columns as well.</span></span>

<span data-ttu-id="551a1-370">這可能會造成問題，不過，為 TableAdapter 的方法來插入、 更新和刪除的資料根據這個初始的方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-370">This can present a problem, however, as the TableAdapter's methods for inserting, updating, and deleting data are based off of this initial method.</span></span> <span data-ttu-id="551a1-371">幸運的是，自動產生的方法插入、 更新和刪除不會受到中的子查詢**選取**子句。</span><span class="sxs-lookup"><span data-stu-id="551a1-371">Fortunately, the auto-generated methods for inserting, updating, and deleting are not affected by subqueries in the **SELECT** clause.</span></span> <span data-ttu-id="551a1-372">藉由將我們的查詢，以處理**分類**並**供應商**成子查詢，而非**加入**s，我們將可避免不必重做這些修改資料的方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-372">By taking care to add our queries to **Categories** and **Suppliers** as subqueries, rather than **JOIN** s, we'll avoid having to rework those methods for modifying data.</span></span> <span data-ttu-id="551a1-373">以滑鼠右鍵按一下**GetProducts()** 方法中的**ProductsTableAdapter** ，然後選擇 設定。</span><span class="sxs-lookup"><span data-stu-id="551a1-373">Right-click on the **GetProducts()** method in the **ProductsTableAdapter** and choose Configure.</span></span> <span data-ttu-id="551a1-374">然後，調整**選取**子句，使它看起來像：</span><span class="sxs-lookup"><span data-stu-id="551a1-374">Then, adjust the **SELECT** clause so that it looks like:</span></span>

[!code-sql[Main](creating-a-data-access-layer-cs/samples/sample9.sql)]


<span data-ttu-id="551a1-375">[![SELECT 陳述式更新 GetProducts() 方法](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-375">[![Update the SELECT Statement for the GetProducts() Method](creating-a-data-access-layer-cs/_static/image80.png)](creating-a-data-access-layer-cs/_static/image79.png)</span></span>

<span data-ttu-id="551a1-376">**圖 29**： 更新**選取**陳述式**GetProducts()** 方法 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image81.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-376">**Figure 29**: Update the **SELECT** Statement for the **GetProducts()** Method ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image81.png))</span></span>


<span data-ttu-id="551a1-377">在更新之後**GetProducts()** 方法，以使用此資料表會包含兩個新的資料行的新查詢： **CategoryName**並**供應商名稱**。</span><span class="sxs-lookup"><span data-stu-id="551a1-377">After updating the **GetProducts()** method to use this new query the DataTable will include two new columns: **CategoryName** and **SupplierName**.</span></span>


![產品 DataTable 有兩個新的資料行](creating-a-data-access-layer-cs/_static/image82.png)

<span data-ttu-id="551a1-379">**圖 30**:**產品**DataTable 有兩個新的資料行</span><span class="sxs-lookup"><span data-stu-id="551a1-379">**Figure 30**: The **Products** DataTable has Two New Columns</span></span>


<span data-ttu-id="551a1-380">請花一點時間更新**選取**中的子句**GetProductsByCategoryID (*categoryID*)** 以及方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-380">Take a moment to update the **SELECT** clause in the **GetProductsByCategoryID(*categoryID*)** method as well.</span></span>

<span data-ttu-id="551a1-381">如果您更新**GetProducts()** **選取**使用**聯結**語法 DataSet 設計工具將無法自動產生插入、 更新和刪除方法使用 DB 直接模式的資料庫資料。</span><span class="sxs-lookup"><span data-stu-id="551a1-381">If you update the **GetProducts()** **SELECT** using **JOIN** syntax the DataSet Designer won't be able to auto-generate the methods for inserting, updating, and deleting database data using the DB direct pattern.</span></span> <span data-ttu-id="551a1-382">相反地，您必須手動建立它們更像我們一樣**InsertProduct**稍早在本教學課程中的方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-382">Instead, you'll have to manually create them much like we did with the **InsertProduct** method earlier in this tutorial.</span></span> <span data-ttu-id="551a1-383">此外，您會以手動方式必須提供**InsertCommand**， **UpdateCommand**，並**DeleteCommand**屬性值，如果您想要使用批次更新模式。</span><span class="sxs-lookup"><span data-stu-id="551a1-383">Furthermore, you'll manually have to provide the **InsertCommand**, **UpdateCommand**, and **DeleteCommand** property values if you want to use the batch updating pattern.</span></span>

## <a name="adding-the-remaining-tableadapters"></a><span data-ttu-id="551a1-384">新增其餘的 TableAdapters</span><span class="sxs-lookup"><span data-stu-id="551a1-384">Adding the Remaining TableAdapters</span></span>

<span data-ttu-id="551a1-385">目前為止，我們只探討了使用單一資料庫資料表的單一 TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="551a1-385">Up until now, we've only looked at working with a single TableAdapter for a single database table.</span></span> <span data-ttu-id="551a1-386">不過，Northwind 資料庫包含數個相關的資料表，我們必須在我們的 web 應用程式中使用。</span><span class="sxs-lookup"><span data-stu-id="551a1-386">However, the Northwind database contains several related tables that we'll need to work with in our web application.</span></span> <span data-ttu-id="551a1-387">輸入資料集可以包含多個相關的 Datatable。</span><span class="sxs-lookup"><span data-stu-id="551a1-387">A Typed DataSet can contain multiple, related DataTables.</span></span> <span data-ttu-id="551a1-388">因此，若要完成我們的 DAL 我們需要加入 Datatable，我們將使用這些教學課程中的其他資料表。</span><span class="sxs-lookup"><span data-stu-id="551a1-388">Therefore, to complete our DAL we need to add DataTables for the other tables we'll be using in these tutorials.</span></span> <span data-ttu-id="551a1-389">新增新的 TableAdapter 具類型資料集，請開啟 DataSet 設計工具、 在設計師中，以滑鼠右鍵按一下並選擇 [新增] / TableAdapter。</span><span class="sxs-lookup"><span data-stu-id="551a1-389">To add a new TableAdapter to a Typed DataSet, open the DataSet Designer, right-click in the Designer, and choose Add / TableAdapter.</span></span> <span data-ttu-id="551a1-390">這會建立新的 DataTable 和 TableAdapter，並逐步引導您完成精靈中稍早在本教學課程中，我們檢查。</span><span class="sxs-lookup"><span data-stu-id="551a1-390">This will create a new DataTable and TableAdapter and walk you through the wizard we examined earlier in this tutorial.</span></span>

<span data-ttu-id="551a1-391">需要幾分鐘的時間來建立下列的 TableAdapters 和使用下列查詢的方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-391">Take a few minutes to create the following TableAdapters and methods using the following queries.</span></span> <span data-ttu-id="551a1-392">請注意，在查詢**ProductsTableAdapter**包含子查詢，擷取每個產品類別目錄和供應商的名稱。</span><span class="sxs-lookup"><span data-stu-id="551a1-392">Note that the queries in the **ProductsTableAdapter** include the subqueries to grab each product's category and supplier names.</span></span> <span data-ttu-id="551a1-393">此外，如果您已遵循，您已新增**ProductsTableAdapter**類別的**GetProducts()** 並**GetProductsByCategoryID (*categoryID*)** 方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-393">Additionally, if you've been following along, you've already added the **ProductsTableAdapter** class's **GetProducts()** and **GetProductsByCategoryID(*categoryID*)** methods.</span></span>

- <span data-ttu-id="551a1-394">**ProductsTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="551a1-394">**ProductsTableAdapter**</span></span>

  - <span data-ttu-id="551a1-395">**GetProducts**:</span><span class="sxs-lookup"><span data-stu-id="551a1-395">**GetProducts**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample10.sql)]
  - <span data-ttu-id="551a1-396">**GetProductsByCategoryID**:</span><span class="sxs-lookup"><span data-stu-id="551a1-396">**GetProductsByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample11.sql)]
  - <span data-ttu-id="551a1-397">**GetProductsBySupplierID**:</span><span class="sxs-lookup"><span data-stu-id="551a1-397">**GetProductsBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample12.sql)]
  - <span data-ttu-id="551a1-398">**GetProductByProductID**:</span><span class="sxs-lookup"><span data-stu-id="551a1-398">**GetProductByProductID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample13.sql)]
- <span data-ttu-id="551a1-399">**CategoriesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="551a1-399">**CategoriesTableAdapter**</span></span>

  - <span data-ttu-id="551a1-400">**GetCategories**:</span><span class="sxs-lookup"><span data-stu-id="551a1-400">**GetCategories**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample14.sql)]
  - <span data-ttu-id="551a1-401">**GetCategoryByCategoryID**:</span><span class="sxs-lookup"><span data-stu-id="551a1-401">**GetCategoryByCategoryID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample15.sql)]
- <span data-ttu-id="551a1-402">**SuppliersTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="551a1-402">**SuppliersTableAdapter**</span></span>

  - <span data-ttu-id="551a1-403">**GetSuppliers**:</span><span class="sxs-lookup"><span data-stu-id="551a1-403">**GetSuppliers**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample16.sql)]
  - <span data-ttu-id="551a1-404">**GetSuppliersByCountry**:</span><span class="sxs-lookup"><span data-stu-id="551a1-404">**GetSuppliersByCountry**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample17.sql)]
  - <span data-ttu-id="551a1-405">**GetSupplierBySupplierID**:</span><span class="sxs-lookup"><span data-stu-id="551a1-405">**GetSupplierBySupplierID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample18.sql)]
- <span data-ttu-id="551a1-406">**EmployeesTableAdapter**</span><span class="sxs-lookup"><span data-stu-id="551a1-406">**EmployeesTableAdapter**</span></span>

  - <span data-ttu-id="551a1-407">**GetEmployees**:</span><span class="sxs-lookup"><span data-stu-id="551a1-407">**GetEmployees**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample19.sql)]
  - <span data-ttu-id="551a1-408">**GetEmployeesByManager**:</span><span class="sxs-lookup"><span data-stu-id="551a1-408">**GetEmployeesByManager**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample20.sql)]
  - <span data-ttu-id="551a1-409">**GetEmployeeByEmployeeID**:</span><span class="sxs-lookup"><span data-stu-id="551a1-409">**GetEmployeeByEmployeeID**:</span></span> 

      [!code-sql[Main](creating-a-data-access-layer-cs/samples/sample21.sql)]


<span data-ttu-id="551a1-410">[![DataSet 設計工具後已新增四個 TableAdapters](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-410">[![The DataSet Designer After the Four TableAdapters Have Been Added](creating-a-data-access-layer-cs/_static/image84.png)](creating-a-data-access-layer-cs/_static/image83.png)</span></span>

<span data-ttu-id="551a1-411">**圖 31**: 資料集設計工具後四個 Tableadapter 已新增 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image85.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-411">**Figure 31**: The DataSet Designer After the Four TableAdapters Have Been Added ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image85.png))</span></span>


## <a name="adding-custom-code-to-the-dal"></a><span data-ttu-id="551a1-412">DAL 中加入自訂程式碼</span><span class="sxs-lookup"><span data-stu-id="551a1-412">Adding Custom Code to the DAL</span></span>

<span data-ttu-id="551a1-413">Datatable 加入至具類型資料集與 Tableadapter 會表示為 XML 結構描述定義檔案 (**Northwind.xsd**)。</span><span class="sxs-lookup"><span data-stu-id="551a1-413">The TableAdapters and DataTables added to the Typed DataSet are expressed as an XML Schema Definition file (**Northwind.xsd**).</span></span> <span data-ttu-id="551a1-414">您可以檢視此結構描述資訊，以滑鼠右鍵按一下**Northwind.xsd**檔案在方案總管] 中，然後選擇 [檢視程式碼。</span><span class="sxs-lookup"><span data-stu-id="551a1-414">You can view this schema information by right-clicking on the **Northwind.xsd** file in the Solution Explorer and choosing View Code.</span></span>


<span data-ttu-id="551a1-415">[![XML 結構描述定義 (XSD) 檔案，如 Northwinds 類型資料集](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-415">[![The XML Schema Definition (XSD) File for the Northwinds Typed DataSet](creating-a-data-access-layer-cs/_static/image87.png)](creating-a-data-access-layer-cs/_static/image86.png)</span></span>

<span data-ttu-id="551a1-416">**圖 32**: Northwinds 具類型資料集的 XML 結構描述定義 (XSD) 檔案 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image88.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-416">**Figure 32**: The XML Schema Definition (XSD) File for the Northwinds Typed DataSet ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image88.png))</span></span>


<span data-ttu-id="551a1-417">此結構描述資訊轉譯為 C# 或 Visual Basic 程式碼在執行階段編譯時，或在執行階段 （如有需要），此時您可以透過它與偵錯工具。</span><span class="sxs-lookup"><span data-stu-id="551a1-417">This schema information is translated into C# or Visual Basic code at design time when compiled or at runtime (if needed), at which point you can step through it with the debugger.</span></span> <span data-ttu-id="551a1-418">若要檢視此自動產生的程式碼移至類別檢視] 和 [向下切入向下至 TableAdapter 或類型 DataSet 類別。</span><span class="sxs-lookup"><span data-stu-id="551a1-418">To view this auto-generated code go to the Class View and drill down to the TableAdapter or Typed DataSet classes.</span></span> <span data-ttu-id="551a1-419">如果您沒有看到螢幕上的 [類別] 檢視，請移至 [檢視] 功能表並選取從該處，或按 Ctrl + Shift + C。</span><span class="sxs-lookup"><span data-stu-id="551a1-419">If you don't see the Class View on your screen, go to the View menu and select it from there, or hit Ctrl+Shift+C.</span></span> <span data-ttu-id="551a1-420">從 類別檢視中，您可以看到屬性、 方法和型別資料集和 TableAdapter 類別的事件。</span><span class="sxs-lookup"><span data-stu-id="551a1-420">From the Class View you can see the properties, methods, and events of the Typed DataSet and TableAdapter classes.</span></span> <span data-ttu-id="551a1-421">若要檢視特定方法的程式碼，連按兩下 類別檢視中的方法名稱或以滑鼠右鍵按一下它，並選擇 移至定義。</span><span class="sxs-lookup"><span data-stu-id="551a1-421">To view the code for a particular method, double-click the method name in the Class View or right-click on it and choose Go To Definition.</span></span>


![選擇 移至定義，從 類別檢視中檢查自動產生的程式碼](creating-a-data-access-layer-cs/_static/image89.png)

<span data-ttu-id="551a1-423">**圖 33**： 選擇 移至定義，從 類別檢視中檢查自動產生的程式碼</span><span class="sxs-lookup"><span data-stu-id="551a1-423">**Figure 33**: Inspect the Auto-Generated Code by Selecting Go To Definition from the Class View</span></span>


<span data-ttu-id="551a1-424">雖然自動產生的程式碼可以將大量時間，程式碼通常是非常廣泛，而且需要自訂以符合應用程式的獨特需求。</span><span class="sxs-lookup"><span data-stu-id="551a1-424">While auto-generated code can be a great time saver, the code is often very generic and needs to be customized to meet the unique needs of an application.</span></span> <span data-ttu-id="551a1-425">擴充自動產生的程式碼的風險，是工具產生程式碼可能會決定該是時候 「 重新產生 」，並覆寫您自訂。</span><span class="sxs-lookup"><span data-stu-id="551a1-425">The risk of extending auto-generated code, though, is that the tool that generated the code might decide it's time to "regenerate" and overwrite your customizations.</span></span> <span data-ttu-id="551a1-426">使用.NET 2.0 的新的部分類別概念，很容易將類別分割到多個檔案。</span><span class="sxs-lookup"><span data-stu-id="551a1-426">With .NET 2.0's new partial class concept, it's easy to split a class across multiple files.</span></span> <span data-ttu-id="551a1-427">這可讓我們不必擔心我們的自訂覆寫的 Visual Studio 中將自己的方法、 屬性和事件新增至自動產生的類別。</span><span class="sxs-lookup"><span data-stu-id="551a1-427">This enables us to add our own methods, properties, and events to the auto-generated classes without having to worry about Visual Studio overwriting our customizations.</span></span>

<span data-ttu-id="551a1-428">為了示範如何自訂 DAL，讓我們新增**GetProducts()** 方法來**SuppliersRow**類別。</span><span class="sxs-lookup"><span data-stu-id="551a1-428">To demonstrate how to customize the DAL, let's add a **GetProducts()** method to the **SuppliersRow** class.</span></span> <span data-ttu-id="551a1-429">**SuppliersRow**類別表示中的單一記錄**供應商**資料表，許多產品，每個供應商可以提供者零因此**GetProducts()** 會傳回那些指定的供應商的產品。</span><span class="sxs-lookup"><span data-stu-id="551a1-429">The **SuppliersRow** class represents a single record in the **Suppliers** table; each supplier can provider zero to many products, so **GetProducts()** will return those products of the specified supplier.</span></span> <span data-ttu-id="551a1-430">若要完成這會建立新的類別檔案中**應用程式\_程式碼**名為資料夾**SuppliersRow.cs**並加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="551a1-430">To accomplish this create a new class file in the **App\_Code** folder named **SuppliersRow.cs** and add the following code:</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample22.cs)]

<span data-ttu-id="551a1-431">此部分類別會指示編譯器，當建置**Northwind.SuppliersRow**類別，以包含**GetProducts()** 我們剛才定義的方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-431">This partial class instructs the compiler that when building the **Northwind.SuppliersRow** class to include the **GetProducts()** method we just defined.</span></span> <span data-ttu-id="551a1-432">如果您建置專案，然後返回 類別檢視您會看到**GetProducts()** 現在會列為方法**Northwind.SuppliersRow**。</span><span class="sxs-lookup"><span data-stu-id="551a1-432">If you build your project and then return to the Class View you'll see **GetProducts()** now listed as a method of **Northwind.SuppliersRow**.</span></span>


![GetProducts() 方法屬於現在 Northwind.SuppliersRow 類別](creating-a-data-access-layer-cs/_static/image90.png)

<span data-ttu-id="551a1-434">**圖 34**: **GetProducts()** 方法是現在的一部分**Northwind.SuppliersRow**類別</span><span class="sxs-lookup"><span data-stu-id="551a1-434">**Figure 34**: The **GetProducts()** Method is Now Part of the **Northwind.SuppliersRow** Class</span></span>


<span data-ttu-id="551a1-435">**GetProducts()** 方法現在可用來列舉集合的產品特定供應商，下列程式碼所示：</span><span class="sxs-lookup"><span data-stu-id="551a1-435">The **GetProducts()** method can now be used to enumerate the set of products for a particular supplier, as the following code shows:</span></span>

[!code-html[Main](creating-a-data-access-layer-cs/samples/sample23.html)]

<span data-ttu-id="551a1-436">這項資料也可以在任何 ASP 中顯示。NET 的資料 Web 控制項。</span><span class="sxs-lookup"><span data-stu-id="551a1-436">This data can also be displayed in any of ASP.NET's data Web controls.</span></span> <span data-ttu-id="551a1-437">下列網頁會使用兩個欄位中的 GridView 控制項：</span><span class="sxs-lookup"><span data-stu-id="551a1-437">The following page uses a GridView control with two fields:</span></span>

- <span data-ttu-id="551a1-438">顯示名稱的每個供應商、 BoundField 和</span><span class="sxs-lookup"><span data-stu-id="551a1-438">A BoundField that displays the name of each supplier, and</span></span>
- <span data-ttu-id="551a1-439">包含 BulletedList 控制項繫結至所傳回的結果為 TemplateField **GetProducts()** 每個供應商的方法。</span><span class="sxs-lookup"><span data-stu-id="551a1-439">A TemplateField that contains a BulletedList control that is bound to the results returned by the **GetProducts()** method for each supplier.</span></span>

<span data-ttu-id="551a1-440">我們將檢驗如何顯示在未來的教學課程的這類主版詳細資料報表。</span><span class="sxs-lookup"><span data-stu-id="551a1-440">We'll examine how to display such master-detail reports in future tutorials.</span></span> <span data-ttu-id="551a1-441">現在，此範例設計來說明使用自訂方法加入至**Northwind.SuppliersRow**類別。</span><span class="sxs-lookup"><span data-stu-id="551a1-441">For now, this example is designed to illustrate using the custom method added to the **Northwind.SuppliersRow** class.</span></span>

<span data-ttu-id="551a1-442">SuppliersAndProducts.aspx</span><span class="sxs-lookup"><span data-stu-id="551a1-442">SuppliersAndProducts.aspx</span></span>

[!code-aspx[Main](creating-a-data-access-layer-cs/samples/sample24.aspx)]

<span data-ttu-id="551a1-443">SuppliersAndProducts.aspx.cs</span><span class="sxs-lookup"><span data-stu-id="551a1-443">SuppliersAndProducts.aspx.cs</span></span>

[!code-csharp[Main](creating-a-data-access-layer-cs/samples/sample25.cs)]


<span data-ttu-id="551a1-444">[![供應商的公司名稱會列在左資料行，其在右側的產品](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span><span class="sxs-lookup"><span data-stu-id="551a1-444">[![The Supplier's Company Name is Listed in the Left Column, Their Products in the Right](creating-a-data-access-layer-cs/_static/image92.png)](creating-a-data-access-layer-cs/_static/image91.png)</span></span>

<span data-ttu-id="551a1-445">**圖 35**: 供應商的公司名稱會列在左資料行，其在右側的產品 ([按一下以檢視完整大小的影像](creating-a-data-access-layer-cs/_static/image93.png))</span><span class="sxs-lookup"><span data-stu-id="551a1-445">**Figure 35**: The Supplier's Company Name is Listed in the Left Column, Their Products in the Right ([Click to view full-size image](creating-a-data-access-layer-cs/_static/image93.png))</span></span>


## <a name="summary"></a><span data-ttu-id="551a1-446">總結</span><span class="sxs-lookup"><span data-stu-id="551a1-446">Summary</span></span>

<span data-ttu-id="551a1-447">當建置 web 應用程式建立 DAL 應該是您第一個步驟，開始建立展示層之前發生。</span><span class="sxs-lookup"><span data-stu-id="551a1-447">When building a web application creating the DAL should be one of your first steps, occurring before you start creating your presentation layer.</span></span> <span data-ttu-id="551a1-448">使用 Visual Studio，建立具類型資料集為基礎的 DAL 是可以在 10-15 分鐘內完成，而不需要撰寫一行程式碼的工作。</span><span class="sxs-lookup"><span data-stu-id="551a1-448">With Visual Studio, creating a DAL based on Typed DataSets is a task that can be accomplished in 10-15 minutes without writing a line of code.</span></span> <span data-ttu-id="551a1-449">邁向未來的教學課程會以這個 DAL 為基礎。</span><span class="sxs-lookup"><span data-stu-id="551a1-449">The tutorials moving forward will build upon this DAL.</span></span> <span data-ttu-id="551a1-450">在 [下一個教學課程](creating-a-business-logic-layer-cs.md)我們會定義數個商務規則，並了解如何在不同的商務邏輯層中實作它們。</span><span class="sxs-lookup"><span data-stu-id="551a1-450">In the [next tutorial](creating-a-business-logic-layer-cs.md) we'll define a number of business rules and see how to implement them in a separate Business Logic Layer.</span></span>

<span data-ttu-id="551a1-451">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="551a1-451">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="551a1-452">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="551a1-452">Further Reading</span></span>

<span data-ttu-id="551a1-453">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="551a1-453">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="551a1-454">建置的 DAL 使用強型別 TableAdapters 和 VS 2005 和 ASP.NET 2.0 中的 Datatable</span><span class="sxs-lookup"><span data-stu-id="551a1-454">Building a DAL using Strongly Typed TableAdapters and DataTables in VS 2005 and ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/435498)
- [<span data-ttu-id="551a1-455">設計資料層元件和傳遞資料層</span><span class="sxs-lookup"><span data-stu-id="551a1-455">Designing Data Tier Components and Passing Data Through Tiers</span></span>](https://msdn.microsoft.com/library/ms978496.aspx)
- [<span data-ttu-id="551a1-456">建置以 Visual Studio 2005 的 DataSet 設計工具的資料存取層</span><span class="sxs-lookup"><span data-stu-id="551a1-456">Build a Data Access Layer with the Visual Studio 2005 DataSet Designer</span></span>](http://www.theserverside.net/articles/showarticle.tss?id=DataSetDesigner)
- [<span data-ttu-id="551a1-457">ASP.NET 2.0 中的組態資訊加密應用程式</span><span class="sxs-lookup"><span data-stu-id="551a1-457">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="551a1-458">TableAdapter 概觀</span><span class="sxs-lookup"><span data-stu-id="551a1-458">TableAdapter Overview</span></span>](https://msdn.microsoft.com/library/bz9tthwx.aspx)
- [<span data-ttu-id="551a1-459">使用具類型資料集</span><span class="sxs-lookup"><span data-stu-id="551a1-459">Working with a Typed DataSet</span></span>](https://msdn.microsoft.com/library/esbykkzb.aspx)
- [<span data-ttu-id="551a1-460">使用 Visual Studio 2005 與 ASP.NET 2.0 中的強型別資料存取</span><span class="sxs-lookup"><span data-stu-id="551a1-460">Using Strongly-Typed Data Access in Visual Studio 2005 and ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/020806-1.aspx)
- [<span data-ttu-id="551a1-461">如何擴充 TableAdapter 方法</span><span class="sxs-lookup"><span data-stu-id="551a1-461">How to Extend TableAdapter Methods</span></span>](https://blogs.msdn.com/vbteam/archive/2005/05/04/ExtendingTableAdapters.aspx)
- [<span data-ttu-id="551a1-462">從預存程序中擷取純量資料</span><span class="sxs-lookup"><span data-stu-id="551a1-462">Retrieving Scalar Data from a Stored Procedure</span></span>](http://aspnet.4guysfromrolla.com/articles/062905-1.aspx)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="551a1-463">在本教學課程中所包含的主題的影片訓練</span><span class="sxs-lookup"><span data-stu-id="551a1-463">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="551a1-464">ASP.NET 應用程式中的資料存取層</span><span class="sxs-lookup"><span data-stu-id="551a1-464">Data Access Layers in ASP.NET Applications</span></span>](../../../videos/data-access/adonet-data-services/data-access-layers-in-aspnet-applications.md)
- [<span data-ttu-id="551a1-465">如何以手動方式將資料集繫結到資料格</span><span class="sxs-lookup"><span data-stu-id="551a1-465">How to Manually Bind a Dataset to a Datagrid</span></span>](../../../videos/data-access/adonet-data-services/how-to-manually-bind-a-dataset-to-a-datagrid.md)
- [<span data-ttu-id="551a1-466">如何使用資料集和篩選從 ASP 應用程式</span><span class="sxs-lookup"><span data-stu-id="551a1-466">How to Work with Datasets and Filters from an ASP Application</span></span>](../../../videos/data-access/adonet-data-services/how-to-work-with-datasets-and-filters-from-an-asp-application.md)

## <a name="about-the-author"></a><span data-ttu-id="551a1-467">關於作者</span><span class="sxs-lookup"><span data-stu-id="551a1-467">About the Author</span></span>

<span data-ttu-id="551a1-468">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="551a1-468">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="551a1-469">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="551a1-469">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="551a1-470">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="551a1-470">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="551a1-471">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="551a1-471">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="551a1-472">或透過他的部落格，這位於[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="551a1-472">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="551a1-473">特別感謝</span><span class="sxs-lookup"><span data-stu-id="551a1-473">Special Thanks To</span></span>

<span data-ttu-id="551a1-474">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="551a1-474">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="551a1-475">本教學課程中的潛在客戶檢閱者是 Ron 綠色、 Hilton giesenow 將、 Dennis Patterson、 Liz Shulok，Abel Gomez 和 Carlos Santos。</span><span class="sxs-lookup"><span data-stu-id="551a1-475">Lead reviewers for this tutorial were Ron Green, Hilton Giesenow, Dennis Patterson, Liz Shulok, Abel Gomez, and Carlos Santos.</span></span> <span data-ttu-id="551a1-476">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="551a1-476">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="551a1-477">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="551a1-477">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="551a1-478">下一步</span><span class="sxs-lookup"><span data-stu-id="551a1-478">Next</span></span>](creating-a-business-logic-layer-cs.md)
