---
uid: web-forms/overview/older-versions-security/roles/creating-and-managing-roles-cs
title: 建立及管理角色 (C#) |Microsoft 文件
author: rick-anderson
description: 本教學課程會檢查設定角色架構的必要步驟。 接下來，我們將建立的網頁以建立和刪除角色。
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/24/2008
ms.topic: article
ms.assetid: 113f10b3-a19a-471b-8ff6-db3c79ce8a91
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/roles/creating-and-managing-roles-cs
msc.type: authoredcontent
ms.openlocfilehash: a4ea7e76e023cd436d1d8ac52307a3ac17267fef
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/10/2018
---
<a name="creating-and-managing-roles-c"></a><span data-ttu-id="7da07-104">建立及管理角色 (C#)</span><span class="sxs-lookup"><span data-stu-id="7da07-104">Creating and Managing Roles (C#)</span></span>
====================
<span data-ttu-id="7da07-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7da07-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7da07-106">[下載程式碼](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.09.zip)或[下載 PDF](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="7da07-106">[Download Code](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.09.zip) or [Download PDF](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_cs.pdf)</span></span>

> <span data-ttu-id="7da07-107">本教學課程會檢查設定角色架構的必要步驟。</span><span class="sxs-lookup"><span data-stu-id="7da07-107">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="7da07-108">接下來，我們將建立的網頁以建立和刪除角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-108">Following that, we will build web pages to create and delete roles.</span></span>


## <a name="introduction"></a><span data-ttu-id="7da07-109">簡介</span><span class="sxs-lookup"><span data-stu-id="7da07-109">Introduction</span></span>

<span data-ttu-id="7da07-110">在<a id="_msoanchor_1"> </a> [*使用者為基礎的授權*](../membership/user-based-authorization-cs.md)教學課程中我們探討了一組頁面限制特定使用者使用 URL 授權，因此瀏覽宣告式和以程式設計方式調整正在瀏覽的使用者為基礎的 ASP.NET 網頁的功能的技術。</span><span class="sxs-lookup"><span data-stu-id="7da07-110">In the <a id="_msoanchor_1"></a>[*User-Based Authorization*](../membership/user-based-authorization-cs.md) tutorial we looked at using URL authorization to restrict certain users from a set of pages and explored declarative and programmatic techniques for adjusting an ASP.NET page's functionality based on the visiting user.</span></span> <span data-ttu-id="7da07-111">授與權限存取頁面或使用者的使用者為基礎的功能，不過，可能會變得維護惡夢案例中的有許多使用者帳戶或使用者的權限經常變更時。</span><span class="sxs-lookup"><span data-stu-id="7da07-111">Granting permission for page access or functionality on a user-by-user basis, however, can become a maintenance nightmare in scenarios where there are many user accounts or when users' privileges change often.</span></span> <span data-ttu-id="7da07-112">使用者獲得或失去的授權，才能執行特定工作時，任何時候，系統管理員必須更新適當的 URL 授權規則、 宣告式的標記和程式碼。</span><span class="sxs-lookup"><span data-stu-id="7da07-112">Any time a user gains or loses authorization to perform a particular task, the administrator needs to update the appropriate URL authorization rules, declarative markup, and code.</span></span>

<span data-ttu-id="7da07-113">它有助於分類成群組的使用者或*角色*然後再套用以角色的角色為基礎的權限。</span><span class="sxs-lookup"><span data-stu-id="7da07-113">It usually helps to classify users into groups or *roles* and then to apply permissions on a role-by-role basis.</span></span> <span data-ttu-id="7da07-114">例如，大部分 web 應用程式有一組特定的頁面或保留僅供系統管理使用者的工作。</span><span class="sxs-lookup"><span data-stu-id="7da07-114">For example, most web applications have a certain set of pages or tasks that are reserved only for administrative users.</span></span> <span data-ttu-id="7da07-115">在使用的技術來學習*使用者為基礎的授權*教學課程中，我們會加入適當的 URL 授權規則、 宣告式的標記和程式碼，以允許指定的使用者帳戶來執行管理工作。</span><span class="sxs-lookup"><span data-stu-id="7da07-115">Using the techniques learned in the *User-Based Authorization* tutorial, we would add the appropriate URL authorization rules, declarative markup, and code to allow the specified user accounts to perform administrative tasks.</span></span> <span data-ttu-id="7da07-116">但如果加入新的系統管理員，或現有的系統管理員需要具備撤銷其系統管理權限，我們就必須傳回並更新組態檔和網頁。</span><span class="sxs-lookup"><span data-stu-id="7da07-116">But if a new administrator was added or if an existing administrator needed to have her administration rights revoked, we would have to return and update the configuration files and web pages.</span></span> <span data-ttu-id="7da07-117">與角色，不過，我們無法建立一個稱為系統管理員角色並指派這些受信任的使用者至系統管理員角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-117">With roles, however, we could create a role called Administrators and assign those trusted users to the Administrators role.</span></span> <span data-ttu-id="7da07-118">接下來，我們會加入適當的 URL 授權規則、 宣告式的標記和程式碼，以允許系統管理員角色來執行各種系統管理工作。</span><span class="sxs-lookup"><span data-stu-id="7da07-118">Next, we would add the appropriate URL authorization rules, declarative markup, and code to allow the Administrators role to perform the various administrative tasks.</span></span> <span data-ttu-id="7da07-119">此基礎結構，以將新的系統管理員新增至網站，或移除現有的很簡單，只包含或移除系統管理員角色的使用者。</span><span class="sxs-lookup"><span data-stu-id="7da07-119">With this infrastructure in place, adding new administrators to the site or removing existing ones is as simple as including or removing the user from the Administrators role.</span></span> <span data-ttu-id="7da07-120">沒有設定、 宣告式標記或變更程式碼是必要的。</span><span class="sxs-lookup"><span data-stu-id="7da07-120">No configuration, declarative markup, or code changes are necessary.</span></span>

<span data-ttu-id="7da07-121">ASP.NET 提供了角色架構定義的角色和與使用者帳戶建立關聯。</span><span class="sxs-lookup"><span data-stu-id="7da07-121">ASP.NET offers a Roles framework for defining roles and associating them with user accounts.</span></span> <span data-ttu-id="7da07-122">使用角色架構我們可以建立及刪除角色，將使用者加入或移除角色中的使用者，請判斷一組屬於特定角色，並告知使用者是否屬於特定角色的使用者。</span><span class="sxs-lookup"><span data-stu-id="7da07-122">With the Roles framework we can create and delete roles, add users to or remove users from a role, determine the set of users that belong to a particular role, and tell whether a user belongs to a particular role.</span></span> <span data-ttu-id="7da07-123">一旦已設定角色架構，我們可以限制存取透過 URL 授權規則以角色的角色為基礎的頁面和顯示或隱藏其他資訊或根據目前登入使用者的角色頁面上的功能。</span><span class="sxs-lookup"><span data-stu-id="7da07-123">Once the Roles framework has been configured, we can limit access to pages on a role-by-role basis through URL authorization rules and show or hide additional information or functionality on a page based on the currently logged on user's roles.</span></span>

<span data-ttu-id="7da07-124">本教學課程會檢查設定角色架構的必要步驟。</span><span class="sxs-lookup"><span data-stu-id="7da07-124">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="7da07-125">接下來，我們將建立的網頁以建立和刪除角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-125">Following that, we will build web pages to create and delete roles.</span></span> <span data-ttu-id="7da07-126">在<a id="_msoanchor_2"> </a> [*角色指派使用者給*](assigning-roles-to-users-cs.md)教學課程，我們將探討如何加入和從角色移除使用者。</span><span class="sxs-lookup"><span data-stu-id="7da07-126">In the <a id="_msoanchor_2"></a>[*Assigning Roles to Users*](assigning-roles-to-users-cs.md) tutorial we will look at how to add and remove users from roles.</span></span> <span data-ttu-id="7da07-127">然後在<a id="_msoanchor_3"> </a> [*角色為基礎的授權*](role-based-authorization-cs.md)教學課程中我們會看到如何限制網頁，以及如何調整頁面的功能視角色由角色為基礎的存取權正在瀏覽的使用者角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-127">And in the <a id="_msoanchor_3"></a>[*Role-Based Authorization*](role-based-authorization-cs.md) tutorial we will see how to limit access to pages on a role-by-role basis along with how to adjust page functionality depending on the visiting user's role.</span></span> <span data-ttu-id="7da07-128">讓我們開始吧 ！</span><span class="sxs-lookup"><span data-stu-id="7da07-128">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="7da07-129">步驟 1： 加入新的 ASP.NET 網頁</span><span class="sxs-lookup"><span data-stu-id="7da07-129">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="7da07-130">在本教學課程和後面兩個我們將會檢查各種角色相關的功能與功能。</span><span class="sxs-lookup"><span data-stu-id="7da07-130">In this tutorial and the next two we will be examining various roles-related functions and capabilities.</span></span> <span data-ttu-id="7da07-131">我們需要一系列的 ASP.NET 頁面實作檢查這些教學課程中的主題。</span><span class="sxs-lookup"><span data-stu-id="7da07-131">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="7da07-132">讓我們來建立這些頁面，並更新站台對應。</span><span class="sxs-lookup"><span data-stu-id="7da07-132">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="7da07-133">藉由建立新的資料夾中名為專案啟動`Roles`。</span><span class="sxs-lookup"><span data-stu-id="7da07-133">Start by creating a new folder in the project named `Roles`.</span></span> <span data-ttu-id="7da07-134">接下來，加入四個以新的 ASP.NET 網頁`Roles`資料夾中，連結與每個頁面`Site.master`主版頁面。</span><span class="sxs-lookup"><span data-stu-id="7da07-134">Next, add four new ASP.NET pages to the `Roles` folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="7da07-135">命名頁面：</span><span class="sxs-lookup"><span data-stu-id="7da07-135">Name the pages:</span></span>

- `ManageRoles.aspx`
- `UsersAndRoles.aspx`
- `CreateUserWizardWithRoles.aspx`
- `RoleBasedAuthorization.aspx`

<span data-ttu-id="7da07-136">此時您專案的方案總管 看起來應該類似螢幕擷取畫面中圖 1 所示。</span><span class="sxs-lookup"><span data-stu-id="7da07-136">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>


<span data-ttu-id="7da07-137">[![四個新的頁面已加入至 [角色] 資料夾](creating-and-managing-roles-cs/_static/image2.png)](creating-and-managing-roles-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7da07-137">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-cs/_static/image2.png)](creating-and-managing-roles-cs/_static/image1.png)</span></span>

<span data-ttu-id="7da07-138">**圖 1**： 四個新頁面已加入至`Roles`資料夾 ([按一下以檢視完整大小的影像](creating-and-managing-roles-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="7da07-138">**Figure 1**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image3.png))</span></span>


<span data-ttu-id="7da07-139">每一頁，此時，應有兩個內容控制項，各供一個主版頁面的 ContentPlaceHolders:`MainContent`和`LoginContent`。</span><span class="sxs-lookup"><span data-stu-id="7da07-139">Each page should, at this point, have the two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample1.aspx)]

<span data-ttu-id="7da07-140">請記得， `LoginContent` ContentPlaceHolder 的預設標記會顯示登入或登出的站台，根據是否已驗證使用者的連結。</span><span class="sxs-lookup"><span data-stu-id="7da07-140">Recall that the `LoginContent` ContentPlaceHolder's default markup displays a link to log on or log off the site, depending on whether the user is authenticated.</span></span> <span data-ttu-id="7da07-141">與否`Content2`內容控制項的 ASP.NET 頁面上，不過，會覆寫主版頁面的預設標記。</span><span class="sxs-lookup"><span data-stu-id="7da07-141">The presence of the `Content2` Content control in the ASP.NET page, however, overrides the master page's default markup.</span></span> <span data-ttu-id="7da07-142">如我們所述<a id="_msoanchor_4"> </a> [*的表單驗證概觀*](../introduction/an-overview-of-forms-authentication-cs.md)教學課程中，覆寫預設標記中很有用，我們不想要顯示登入相關的頁面左側資料行中的選項。</span><span class="sxs-lookup"><span data-stu-id="7da07-142">As we discussed in <a id="_msoanchor_4"></a>[*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, overriding the default markup is useful in pages where we do not want to display login-related options in the left column.</span></span>

<span data-ttu-id="7da07-143">這些四個頁面，不過，我們想要顯示在主版頁面的預設標記`LoginContent`ContentPlaceHolder。</span><span class="sxs-lookup"><span data-stu-id="7da07-143">For these four pages, however, we want to show the master page's default markup for the `LoginContent` ContentPlaceHolder.</span></span> <span data-ttu-id="7da07-144">因此，移除的宣告式標記`Content2`內容控制項。</span><span class="sxs-lookup"><span data-stu-id="7da07-144">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="7da07-145">之後，請每四個頁面的標記應該包含單一內容控制項。</span><span class="sxs-lookup"><span data-stu-id="7da07-145">After doing so, each of the four page's markup should contain just one Content control.</span></span>

<span data-ttu-id="7da07-146">最後，讓我們來更新站台對應 (`Web.sitemap`) 以包含這些新的網頁。</span><span class="sxs-lookup"><span data-stu-id="7da07-146">Finally, let's update the site map (`Web.sitemap`) to include these new web pages.</span></span> <span data-ttu-id="7da07-147">加入下列 XML 之後`<siteMapNode>`我們加入的成員資格教學課程。</span><span class="sxs-lookup"><span data-stu-id="7da07-147">Add the following XML after the `<siteMapNode>` we added for the Membership tutorials.</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample2.xml)]

<span data-ttu-id="7da07-148">與更新站台對應，請瀏覽的網站透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="7da07-148">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="7da07-149">如圖 2 所示，現在在左側瀏覽角色教學課程包含項目。</span><span class="sxs-lookup"><span data-stu-id="7da07-149">As Figure 2 shows, the navigation on the left now includes items for the Roles tutorials.</span></span>


<span data-ttu-id="7da07-150">[![四個新的頁面已加入至 [角色] 資料夾](creating-and-managing-roles-cs/_static/image5.png)](creating-and-managing-roles-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="7da07-150">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-cs/_static/image5.png)](creating-and-managing-roles-cs/_static/image4.png)</span></span>

<span data-ttu-id="7da07-151">**圖 2**： 四個新頁面已加入至`Roles`資料夾 ([按一下以檢視完整大小的影像](creating-and-managing-roles-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="7da07-151">**Figure 2**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image6.png))</span></span>


## <a name="step-2-specifying-and-configuring-the-roles-framework-provider"></a><span data-ttu-id="7da07-152">步驟 2： 指定和設定角色架構提供者</span><span class="sxs-lookup"><span data-stu-id="7da07-152">Step 2: Specifying and Configuring the Roles Framework Provider</span></span>

<span data-ttu-id="7da07-153">成員資格架構，例如角色 framework 是建置在提供者模型之上。</span><span class="sxs-lookup"><span data-stu-id="7da07-153">Like the Membership framework, the Roles framework is built atop the provider model.</span></span> <span data-ttu-id="7da07-154">中所述<a id="_msoanchor_5"> </a> [*安全性基本概念和 ASP.NET 支援*](../introduction/security-basics-and-asp-net-support-cs.md)教學課程中，.NET Framework 隨附三個內建的角色提供者： [ `AuthorizationStoreRoleProvider` ](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx)[ `WindowsTokenRoleProvider` ](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx)，和[ `SqlRoleProvider` ](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7da07-154">As discussed in the <a id="_msoanchor_5"></a>[*Security Basics and ASP.NET Support*](../introduction/security-basics-and-asp-net-support-cs.md) tutorial, the .NET Framework ships with three built-in Roles providers: [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx), and [`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span></span> <span data-ttu-id="7da07-155">此教學課程系列著重於`SqlRoleProvider`，使用 Microsoft SQL Server 資料庫為角色存放區。</span><span class="sxs-lookup"><span data-stu-id="7da07-155">This tutorial series focuses on the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span>

<span data-ttu-id="7da07-156">基本上角色架構和`SqlRoleProvider`工作一樣，成員資格架構和`SqlMembershipProvider`。</span><span class="sxs-lookup"><span data-stu-id="7da07-156">Underneath the covers the Roles framework and `SqlRoleProvider` work just like the Membership framework and `SqlMembershipProvider`.</span></span> <span data-ttu-id="7da07-157">.NET Framework 包含`Roles`做為角色架構應用程式開發介面的類別。</span><span class="sxs-lookup"><span data-stu-id="7da07-157">The .NET Framework contains a `Roles` class that serves as the API to the Roles framework.</span></span> <span data-ttu-id="7da07-158">`Roles`類別具有類似的靜態方法`CreateRole`， `DeleteRole`， `GetAllRoles`， `AddUserToRole`， `IsUserInRole`，依此類推。</span><span class="sxs-lookup"><span data-stu-id="7da07-158">The `Roles` class has static methods like `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`, and so forth.</span></span> <span data-ttu-id="7da07-159">叫用其中一種方法時，`Roles`類別委派設定的提供者呼叫。</span><span class="sxs-lookup"><span data-stu-id="7da07-159">When one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="7da07-160">`SqlRoleProvider`適用於的特定角色的資料表 (`aspnet_Roles`和`aspnet_UsersInRoles`) 回應。</span><span class="sxs-lookup"><span data-stu-id="7da07-160">The `SqlRoleProvider` works with the role-specific tables (`aspnet_Roles` and `aspnet_UsersInRoles`) in response.</span></span>

<span data-ttu-id="7da07-161">若要使用`SqlRoleProvider`我們的應用程式中的提供者，我們需要指定哪些資料庫做為存放區。</span><span class="sxs-lookup"><span data-stu-id="7da07-161">In order to use the `SqlRoleProvider` provider in our application, we need to specify what database to use as the store.</span></span> <span data-ttu-id="7da07-162">`SqlRoleProvider`需要有特定的資料庫資料表、 檢視和預存程序的指定的角色存放區。</span><span class="sxs-lookup"><span data-stu-id="7da07-162">The `SqlRoleProvider` expects the specified role store to have certain database tables, views, and stored procedures.</span></span> <span data-ttu-id="7da07-163">這些必要的資料庫物件可以使用加入[`aspnet_regsql.exe`工具](https://msdn.microsoft.com/library/ms229862.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7da07-163">These requisite database objects can be added using the [`aspnet_regsql.exe` tool](https://msdn.microsoft.com/library/ms229862.aspx).</span></span> <span data-ttu-id="7da07-164">現在我們已經有具有所需的結構描述的資料庫`SqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="7da07-164">At this point we already have a database with the schema necessary for the `SqlRoleProvider`.</span></span> <span data-ttu-id="7da07-165">回到<a id="_msoanchor_6"> </a> [*在 SQL Server 中建立成員資格結構描述*](../membership/creating-the-membership-schema-in-sql-server-cs.md)教學課程中我們建立一個名為資料庫`SecurityTutorials.mdf`並用`aspnet_regsql.exe`加入應用程式包含所需的資料庫物件的服務`SqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="7da07-165">Back in the <a id="_msoanchor_6"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial we created a database named `SecurityTutorials.mdf` and used `aspnet_regsql.exe` to add the application services, which included the database objects required by the `SqlRoleProvider`.</span></span> <span data-ttu-id="7da07-166">因此我們只需要判斷角色架構以啟用角色的支援，並使用`SqlRoleProvider`與`SecurityTutorials.mdf`做為角色存放區資料庫。</span><span class="sxs-lookup"><span data-stu-id="7da07-166">Therefore we just need to tell the Roles framework to enable role support and to use the `SqlRoleProvider` with the `SecurityTutorials.mdf` database as the role store.</span></span>

<span data-ttu-id="7da07-167">已透過設定角色架構&lt; `roleManager` &gt;在應用程式中的項目`Web.config`檔案。</span><span class="sxs-lookup"><span data-stu-id="7da07-167">The Roles framework is configured via the &lt;`roleManager`&gt; element in the application's `Web.config` file.</span></span> <span data-ttu-id="7da07-168">根據預設，已停用角色的支援。</span><span class="sxs-lookup"><span data-stu-id="7da07-168">By default, role support is disabled.</span></span> <span data-ttu-id="7da07-169">若要啟用它，您必須設定[ &lt; `roleManager` &gt; ](https://msdn.microsoft.com/library/ms164660.aspx)項目的`enabled`屬性`true`就像這樣：</span><span class="sxs-lookup"><span data-stu-id="7da07-169">To enable it, you must set the [&lt;`roleManager`&gt;](https://msdn.microsoft.com/library/ms164660.aspx) element's `enabled` attribute to `true` like so:</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample3.xml)]

<span data-ttu-id="7da07-170">根據預設，所有的 web 應用程式具有名為角色提供者`AspNetSqlRoleProvider`型別的`SqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="7da07-170">By default, all web applications have a Roles provider named `AspNetSqlRoleProvider` of type `SqlRoleProvider`.</span></span> <span data-ttu-id="7da07-171">此預設提供者會在中註冊`machine.config`(位於`%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span><span class="sxs-lookup"><span data-stu-id="7da07-171">This default provider is registered in `machine.config` (located at `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample4.xml)]

<span data-ttu-id="7da07-172">提供者的`connectionStringName`屬性會指定角色存放區所使用。</span><span class="sxs-lookup"><span data-stu-id="7da07-172">The provider's `connectionStringName` attribute specifies the role store that is used.</span></span> <span data-ttu-id="7da07-173">`AspNetSqlRoleProvider`提供者會設定這個屬性`LocalSqlServer`，也會定義在`machine.config`和點，根據預設，在 SQL Server 2005 Express Edition 資料庫`App_Data`資料夾名為`aspnet.mdf`。</span><span class="sxs-lookup"><span data-stu-id="7da07-173">The `AspNetSqlRoleProvider` provider sets this attribute to `LocalSqlServer`, which is also defined in `machine.config` and points, by default, to a SQL Server 2005 Express Edition database in the `App_Data` folder named `aspnet.mdf`.</span></span>

<span data-ttu-id="7da07-174">因此，如果我們只是未指定任何提供者資訊，在我們的應用程式中啟用角色架構`Web.config`檔案，應用程式使用已註冊的預設角色提供者， `AspNetSqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="7da07-174">Consequently, if we simply enable the Roles framework without specifying any provider information in our application's `Web.config` file, the application uses the default registered Roles provider, `AspNetSqlRoleProvider`.</span></span> <span data-ttu-id="7da07-175">如果`~/App_Data/aspnet.mdf`資料庫不存在，ASP.NET 執行階段會自動建立它，並新增應用程式服務結構描述。</span><span class="sxs-lookup"><span data-stu-id="7da07-175">If the `~/App_Data/aspnet.mdf` database does not exist, the ASP.NET runtime will automatically create it and add the application services schema.</span></span> <span data-ttu-id="7da07-176">不過，我們不想使用`aspnet.mdf`資料庫; 相反地，我們想要使用`SecurityTutorials.mdf`我們已經建立並加入至應用程式服務結構描述的資料庫。</span><span class="sxs-lookup"><span data-stu-id="7da07-176">However, we don't want to use the `aspnet.mdf` database; rather, we want to use the `SecurityTutorials.mdf` database that we have already created and added the application services schema to.</span></span> <span data-ttu-id="7da07-177">其中一種方式可以完成這項修改：</span><span class="sxs-lookup"><span data-stu-id="7da07-177">This modification can be accomplished in one of two ways:</span></span>

- <span data-ttu-id="7da07-178"><strong>指定的值</strong><strong>`LocalSqlServer`</strong><strong>中的連接字串名稱</strong><strong>`Web.config`</strong><strong>。</strong></span><span class="sxs-lookup"><span data-stu-id="7da07-178"><strong>Specify a value for the</strong><strong>`LocalSqlServer`</strong><strong>connection string name in</strong><strong>`Web.config`</strong><strong>.</strong></span></span> <span data-ttu-id="7da07-179">藉由覆寫`LocalSqlServer`中的連接字串名稱值`Web.config`，我們可以使用已註冊的預設角色提供者 (`AspNetSqlRoleProvider`)，並讓它正確使用`SecurityTutorials.mdf`資料庫。</span><span class="sxs-lookup"><span data-stu-id="7da07-179">By overwriting the `LocalSqlServer` connection string name value in `Web.config`, we can use the default registered Roles provider (`AspNetSqlRoleProvider`) and have it correctly work with the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="7da07-180">如需有關這項技術的詳細資訊，請參閱[Scott Guthrie](https://weblogs.asp.net/scottgu/)的部落格文章：[設定 ASP.NET 2.0 應用程式服務設定為使用 SQL Server 2000 或 SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7da07-180">For more information on this technique, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog post, [Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span></span>
- <span data-ttu-id="7da07-181"><strong>新增已註冊的型別提供者</strong><strong>`SqlRoleProvider`</strong><strong>並設定其</strong><strong>`connectionStringName`</strong><strong>設定為指向</strong><strong>`SecurityTutorials.mdf`</strong><strong>資料庫。</strong></span><span class="sxs-lookup"><span data-stu-id="7da07-181"><strong>Add a new registered provider of type</strong><strong>`SqlRoleProvider`</strong><strong>and configure its</strong><strong>`connectionStringName`</strong><strong>setting to point to the</strong><strong>`SecurityTutorials.mdf`</strong><strong>database.</strong></span></span> <span data-ttu-id="7da07-182">這是我建議，並在中使用的方式<a id="_msoanchor_7"> </a> [*在 SQL Server 中建立成員資格結構描述*](../membership/creating-the-membership-schema-in-sql-server-cs.md)教學課程中，且會將在本教學課程中使用的方法。</span><span class="sxs-lookup"><span data-stu-id="7da07-182">This is the approach I recommended and used in the <a id="_msoanchor_7"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial, and it is the approach I will use in this tutorial as well.</span></span>

<span data-ttu-id="7da07-183">加入至下列角色組態標記`Web.config`檔案。</span><span class="sxs-lookup"><span data-stu-id="7da07-183">Add the following Roles configuration markup to the `Web.config` file.</span></span> <span data-ttu-id="7da07-184">這個標記會註冊新的提供者，名為`SecurityTutorialsSqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="7da07-184">This markup registers a new provider named `SecurityTutorialsSqlRoleProvider`.</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample5.xml)]

<span data-ttu-id="7da07-185">上述的標記定義`SecurityTutorialsSqlRoleProvider`做為預設提供者 (透過`defaultProvider`屬性`<roleManager>`項目)。</span><span class="sxs-lookup"><span data-stu-id="7da07-185">The above markup defines the `SecurityTutorialsSqlRoleProvider` as the default provider (via the `defaultProvider` attribute in the `<roleManager>` element).</span></span> <span data-ttu-id="7da07-186">它也會設定`SecurityTutorialsSqlRoleProvider`的`applicationName`設`SecurityTutorials`，相當於`applicationName`成員資格提供者所使用的設定 (`SecurityTutorialsSqlMembershipProvider`)。</span><span class="sxs-lookup"><span data-stu-id="7da07-186">It also sets the `SecurityTutorialsSqlRoleProvider`'s `applicationName` setting to `SecurityTutorials`, which is the same `applicationName` setting used by the Membership provider (`SecurityTutorialsSqlMembershipProvider`).</span></span> <span data-ttu-id="7da07-187">而不顯示在這裡， [ `<add>`元素](https://msdn.microsoft.com/library/ms164662.aspx)如`SqlRoleProvider`也可能包含`commandTimeout`屬性來指定資料庫逾時持續期間，以秒為單位。</span><span class="sxs-lookup"><span data-stu-id="7da07-187">While not shown here, the [`<add>` element](https://msdn.microsoft.com/library/ms164662.aspx) for the `SqlRoleProvider` may also contain a `commandTimeout` attribute to specify the database timeout duration, in seconds.</span></span> <span data-ttu-id="7da07-188">預設值為 30。</span><span class="sxs-lookup"><span data-stu-id="7da07-188">The default value is 30.</span></span>

<span data-ttu-id="7da07-189">與此組態中標記位置，我們會準備好開始使用我們的應用程式中的角色功能。</span><span class="sxs-lookup"><span data-stu-id="7da07-189">With this configuration markup in place, we are ready to start using role functionality within our application.</span></span>

> [!NOTE]
> <span data-ttu-id="7da07-190">上述組態標記說明如何使用&lt; `roleManager` &gt;項目的`enabled`和`defaultProvider`屬性。</span><span class="sxs-lookup"><span data-stu-id="7da07-190">The above configuration markup illustrates using the &lt;`roleManager`&gt; element's `enabled` and `defaultProvider` attributes.</span></span> <span data-ttu-id="7da07-191">有一些角色架構將使用者的使用者為基礎的角色資訊的連結會影響其他屬性。</span><span class="sxs-lookup"><span data-stu-id="7da07-191">There are a number of other attributes that affect how the Roles framework associates role information on a user-by-user basis.</span></span> <span data-ttu-id="7da07-192">我們將檢視中的這些設定<a id="_msoanchor_8"> </a> [*角色為基礎的授權*](role-based-authorization-cs.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="7da07-192">We will examine these settings in the <a id="_msoanchor_8"></a>[*Role-Based Authorization*](role-based-authorization-cs.md) tutorial.</span></span>


## <a name="step-3-examining-the-roles-api"></a><span data-ttu-id="7da07-193">步驟 3： 檢查應用程式開發介面的角色</span><span class="sxs-lookup"><span data-stu-id="7da07-193">Step 3: Examining the Roles API</span></span>

<span data-ttu-id="7da07-194">角色架構的功能可透過公開[`Roles`類別](https://msdn.microsoft.com/library/system.web.security.roles.aspx)，其中包含 13 個靜態方法，來執行以角色為基礎的作業。</span><span class="sxs-lookup"><span data-stu-id="7da07-194">The Roles framework's functionality is exposed via the [`Roles` class](https://msdn.microsoft.com/library/system.web.security.roles.aspx), which contains thirteen static methods for performing role-based operations.</span></span> <span data-ttu-id="7da07-195">當我們建立及刪除角色，在步驟 4 和 6 我們將使用[ `CreateRole` ](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx)和[ `DeleteRole` ](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx)的方法，加入或移除系統中的角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-195">When we look at creating and deleting roles in Steps 4 and 6 we will use the [`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) and [`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) methods, which add or remove a role from the system.</span></span>

<span data-ttu-id="7da07-196">若要取得系統中的所有角色的清單，請使用[`GetAllRoles`方法](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx)（請參閱步驟 5）。</span><span class="sxs-lookup"><span data-stu-id="7da07-196">To get a list of all of the roles in the system, use the [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (see Step 5).</span></span> <span data-ttu-id="7da07-197">[ `RoleExists`方法](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx)傳回布林值，指出指定的角色是否存在。</span><span class="sxs-lookup"><span data-stu-id="7da07-197">The [`RoleExists` method](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) returns a Boolean value indicating whether a specified role exists.</span></span>

<span data-ttu-id="7da07-198">在下一個教學課程中，我們將檢查如何將使用者與角色產生關聯。</span><span class="sxs-lookup"><span data-stu-id="7da07-198">In the next tutorial we will examine how to associate users with roles.</span></span> <span data-ttu-id="7da07-199">`Roles`類別的[ `AddUserToRole` ](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx)， [ `AddUserToRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx)， [ `AddUsersToRole` ](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx)，和[ `AddUsersToRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx)方法會將一或多個使用者加入至一或多個角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-199">The `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx), and [`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) methods add one or more users to one or more roles.</span></span> <span data-ttu-id="7da07-200">若要從角色移除使用者，請使用[ `RemoveUserFromRole` ](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx)， [ `RemoveUserFromRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx)， [ `RemoveUsersFromRole` ](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx)，或[ `RemoveUsersFromRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx)方法。</span><span class="sxs-lookup"><span data-stu-id="7da07-200">To remove users from roles, use the [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx), or [`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) methods.</span></span>

<span data-ttu-id="7da07-201">在<a id="_msoanchor_9"> </a> [*角色為基礎的授權*](role-based-authorization-cs.md)教學課程中我們將探討如何以程式設計方式顯示或隱藏目前登入的使用者角色為基礎的功能。</span><span class="sxs-lookup"><span data-stu-id="7da07-201">In the <a id="_msoanchor_9"></a>[*Role-Based Authorization*](role-based-authorization-cs.md) tutorial we will look at ways to programmatically show or hide functionality based on the currently logged in user's role.</span></span> <span data-ttu-id="7da07-202">若要達成此目的，我們可以使用`Role`類別的[ `FindUsersInRole` ](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx)， [ `GetRolesForUser` ](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx)， [ `GetUsersInRole` ](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx)，或[ `IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx)方法。</span><span class="sxs-lookup"><span data-stu-id="7da07-202">To accomplish this, we can use the `Role` class's [`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx), or [`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) methods.</span></span>

> [!NOTE]
> <span data-ttu-id="7da07-203">請記住，隨時其中一種方法會叫用，`Roles`類別委派設定的提供者呼叫。</span><span class="sxs-lookup"><span data-stu-id="7da07-203">Keep in mind that any time one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="7da07-204">在我們的案例，這表示若要傳送的呼叫`SqlRoleProvider`。</span><span class="sxs-lookup"><span data-stu-id="7da07-204">In our case, this means that the call is being sent to the `SqlRoleProvider`.</span></span> <span data-ttu-id="7da07-205">`SqlRoleProvider`然後會執行叫用的方法為基礎的適當的資料庫作業。</span><span class="sxs-lookup"><span data-stu-id="7da07-205">The `SqlRoleProvider` then performs the appropriate database operation based on the invoked method.</span></span> <span data-ttu-id="7da07-206">例如，程式碼`Roles.CreateRole("Administrators")`導致`SqlRoleProvider`執行`aspnet_Roles_CreateRole`預存程序，它會插入新的記錄，到`aspnet_Roles`資料表名為系統管理員。</span><span class="sxs-lookup"><span data-stu-id="7da07-206">For example, the code `Roles.CreateRole("Administrators")` results in the `SqlRoleProvider` executing the `aspnet_Roles_CreateRole` stored procedure, which inserts a new record into the `aspnet_Roles` table named Administrators .</span></span>


<span data-ttu-id="7da07-207">本教學課程的其餘部分會查看使用`Roles`類別的`CreateRole`， `GetAllRoles`，和`DeleteRole`方法來管理系統中的角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-207">The remainder of this tutorial looks at using the `Roles` class's `CreateRole`, `GetAllRoles`, and `DeleteRole` methods to manage the roles in the system.</span></span>

## <a name="step-4-creating-new-roles"></a><span data-ttu-id="7da07-208">步驟 4： 建立新的角色</span><span class="sxs-lookup"><span data-stu-id="7da07-208">Step 4: Creating New Roles</span></span>

<span data-ttu-id="7da07-209">角色提供的方式，將任意使用者分組，以及此群組最常用於較方便的方式，將授權規則套用。</span><span class="sxs-lookup"><span data-stu-id="7da07-209">Roles offer a way to arbitrarily group users, and most commonly this grouping is used for a more convenient way to apply authorization rules.</span></span> <span data-ttu-id="7da07-210">但若要使用角色做為授權機制，我們需要先定義應用程式中有哪些角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-210">But in order to use roles as an authorization mechanism we first need to define what roles exist in the application.</span></span> <span data-ttu-id="7da07-211">不幸的是，ASP.NET 不包括 CreateRoleWizard 控制項。</span><span class="sxs-lookup"><span data-stu-id="7da07-211">Unfortunately, ASP.NET does not include a CreateRoleWizard control.</span></span> <span data-ttu-id="7da07-212">若要加入新的角色，我們需要建立適當的使用者介面，並叫用角色 API 自己。</span><span class="sxs-lookup"><span data-stu-id="7da07-212">In order to add new roles we need to create a suitable user interface and invoke the Roles API ourselves.</span></span> <span data-ttu-id="7da07-213">好消息是，這是很容易就能完成。</span><span class="sxs-lookup"><span data-stu-id="7da07-213">The good news is that this is very easy to accomplish.</span></span>

> [!NOTE]
> <span data-ttu-id="7da07-214">雖然沒有 CreateRoleWizard Web 控制項，還有[ASP.NET 網站管理工具](https://msdn.microsoft.com/library/ms228053.aspx)，這是本機的 ASP.NET 應用程式，設計來協助您檢視及管理 web 應用程式的組態。</span><span class="sxs-lookup"><span data-stu-id="7da07-214">While there is no CreateRoleWizard Web control, there is the [ASP.NET Web Site Administration Tool](https://msdn.microsoft.com/library/ms228053.aspx), which is a local ASP.NET application designed to assist with viewing and managing your web application's configuration.</span></span> <span data-ttu-id="7da07-215">不過，我不大風扇原因有兩個 ASP.NET 網站管理工具。</span><span class="sxs-lookup"><span data-stu-id="7da07-215">However, I am not a big fan of the ASP.NET Web Site Administration Tool for two reasons.</span></span> <span data-ttu-id="7da07-216">首先，它是一個位元錯誤和使用者經驗會讓人滿意。</span><span class="sxs-lookup"><span data-stu-id="7da07-216">First, it is a bit buggy and the user experience leaves a lot to be desired.</span></span> <span data-ttu-id="7da07-217">第二，ASP.NET 網站管理工具被專門用於只在本機，表示您將需要建置您自己的角色管理網頁，如果您要從遠端管理即時網站上的角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-217">Second, the ASP.NET Web Site Administration Tool is designed to only work locally, meaning that you will have to build your own role management web pages if you need to manage roles on a live site remotely.</span></span> <span data-ttu-id="7da07-218">這兩個原因，本教學課程和下一步將重點放在建置所需的角色管理工具，在網頁中的，而不是依賴 ASP.NET 網站管理工具。</span><span class="sxs-lookup"><span data-stu-id="7da07-218">For these two reasons, this tutorial and the next will focus on building the necessary role management tools in a web page rather than relying on the ASP.NET Web Site Administration Tool.</span></span>


<span data-ttu-id="7da07-219">開啟`ManageRoles.aspx`頁面`Roles`資料夾並將文字方塊和按鈕 Web 控制項加入至頁面。</span><span class="sxs-lookup"><span data-stu-id="7da07-219">Open the `ManageRoles.aspx` page in the `Roles` folder and add a TextBox and a Button Web control to the page.</span></span> <span data-ttu-id="7da07-220">將文字方塊控制項的`ID`屬性`RoleName`和按鈕的`ID`和`Text`屬性`CreateRoleButton`和建立角色，分別。</span><span class="sxs-lookup"><span data-stu-id="7da07-220">Set the TextBox control's `ID` property to `RoleName` and the Button's `ID` and `Text` properties to `CreateRoleButton` and Create Role, respectively.</span></span> <span data-ttu-id="7da07-221">此時，網頁的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="7da07-221">At this point, your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample6.aspx)]

<span data-ttu-id="7da07-222">接下來，按兩下`CreateRoleButton`按鈕控制項在設計工具來建立`Click`事件處理常式，然後加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="7da07-222">Next, double-click the `CreateRoleButton` Button control in the Designer to create a `Click` event handler and then add the following code:</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample7.cs)]

<span data-ttu-id="7da07-223">上述的程式碼會啟動藉由指派已修剪的角色名稱中輸入`RoleName`文字方塊`newRoleName`變數。</span><span class="sxs-lookup"><span data-stu-id="7da07-223">The above code starts by assigning the trimmed role name entered in the `RoleName` TextBox to the `newRoleName` variable.</span></span> <span data-ttu-id="7da07-224">下一步`Roles`類別的`RoleExists`方法呼叫以判斷角色`newRoleName`已經存在系統中。</span><span class="sxs-lookup"><span data-stu-id="7da07-224">Next, the `Roles` class's `RoleExists` method is called to determine if the role `newRoleName` already exists in the system.</span></span> <span data-ttu-id="7da07-225">如果角色不存在，就會建立透過呼叫`CreateRole`方法。</span><span class="sxs-lookup"><span data-stu-id="7da07-225">If the role does not exist, it is created via a call to the `CreateRole` method.</span></span> <span data-ttu-id="7da07-226">如果`CreateRole`角色名稱已存在於系統中，傳遞給方法`ProviderException`擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="7da07-226">If the `CreateRole` method is passed a role name that already exists in the system, a `ProviderException` exception is thrown.</span></span> <span data-ttu-id="7da07-227">這就是為什麼程式碼會先檢查以確保角色已不存在於之前呼叫系統`CreateRole`。</span><span class="sxs-lookup"><span data-stu-id="7da07-227">This is why the code first checks to ensure that the role does not already exist in the system before calling `CreateRole`.</span></span> <span data-ttu-id="7da07-228">`Click`事件處理常式結束時，會清除`RoleName`文字方塊的`Text`屬性。</span><span class="sxs-lookup"><span data-stu-id="7da07-228">The `Click` event handler concludes by clearing out the `RoleName` TextBox's `Text` property.</span></span>

> [!NOTE]
> <span data-ttu-id="7da07-229">您可能想知道會發生什麼事如果使用者未輸入任何值`RoleName`文字方塊。</span><span class="sxs-lookup"><span data-stu-id="7da07-229">You may be wondering what will happen if the user doesn't enter any value into the `RoleName` TextBox.</span></span> <span data-ttu-id="7da07-230">如果此值傳遞至`CreateRole`方法`null`或空字串，發生例外狀況，就會引發。</span><span class="sxs-lookup"><span data-stu-id="7da07-230">If the value passed into the `CreateRole` method is `null` or an empty string, an exception is raised.</span></span> <span data-ttu-id="7da07-231">同樣地，如果角色名稱包含逗號就會引發例外狀況。</span><span class="sxs-lookup"><span data-stu-id="7da07-231">Likewise, if the role name contains a comma an exception is raised.</span></span> <span data-ttu-id="7da07-232">因此，頁面應包含驗證控制項，以確定使用者輸入的角色，而且它不包含任何逗號。</span><span class="sxs-lookup"><span data-stu-id="7da07-232">Consequently, the page should contain validation controls to ensure that the user enters a role and that it does not contain any commas.</span></span> <span data-ttu-id="7da07-233">我將保留做為練習讀取器。</span><span class="sxs-lookup"><span data-stu-id="7da07-233">I leave as an exercise for the reader.</span></span>


<span data-ttu-id="7da07-234">讓我們來建立名為系統管理員的角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-234">Let's create a role named Administrators.</span></span> <span data-ttu-id="7da07-235">請瀏覽`ManageRoles.aspx`透過瀏覽器頁面上，在文字方塊中輸入系統管理員 （請參閱圖 3），然後按一下 [建立角色] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="7da07-235">Visit the `ManageRoles.aspx` page through a browser, type in Administrators into the textbox (see Figure 3), and then click the Create Role button.</span></span>


<span data-ttu-id="7da07-236">[![建立系統管理員角色](creating-and-managing-roles-cs/_static/image8.png)](creating-and-managing-roles-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7da07-236">[![Create an Administrators Role](creating-and-managing-roles-cs/_static/image8.png)](creating-and-managing-roles-cs/_static/image7.png)</span></span>

<span data-ttu-id="7da07-237">**圖 3**： 建立系統管理員角色 ([按一下以檢視完整大小的影像](creating-and-managing-roles-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="7da07-237">**Figure 3**: Create an Administrators Role  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image9.png))</span></span>


<span data-ttu-id="7da07-238">發生什麼事？</span><span class="sxs-lookup"><span data-stu-id="7da07-238">What happens?</span></span> <span data-ttu-id="7da07-239">發生回傳，但沒有視覺提示角色實際上已新增至系統。</span><span class="sxs-lookup"><span data-stu-id="7da07-239">A postback occurs, but there's no visual cue that the role has actually been added to the system.</span></span> <span data-ttu-id="7da07-240">我們將會更新以包含視覺化回饋的步驟 5 中的此頁面。</span><span class="sxs-lookup"><span data-stu-id="7da07-240">We will update this page in Step 5 to include visual feedback.</span></span> <span data-ttu-id="7da07-241">現在，不過，您可以確認角色已建立，請前往`SecurityTutorials.mdf`資料庫和顯示資料的`aspnet_Roles`資料表。</span><span class="sxs-lookup"><span data-stu-id="7da07-241">For now, however, you can verify that the role was created by going to the `SecurityTutorials.mdf` database and displaying the data from the `aspnet_Roles` table.</span></span> <span data-ttu-id="7da07-242">如圖 4 所示，`aspnet_Roles`資料表包含只加入系統管理員角色的記錄。</span><span class="sxs-lookup"><span data-stu-id="7da07-242">As Figure 4 shows, the `aspnet_Roles` table contains a record for the just-added Administrators roles.</span></span>


<span data-ttu-id="7da07-243">[![Aspnet_Roles 資料表有一個資料列的管理員](creating-and-managing-roles-cs/_static/image11.png)](creating-and-managing-roles-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="7da07-243">[![The aspnet_Roles Table has a Row for the Administrators](creating-and-managing-roles-cs/_static/image11.png)](creating-and-managing-roles-cs/_static/image10.png)</span></span>

<span data-ttu-id="7da07-244">**圖 4**:`aspnet_Roles`資料表有資料列，系統管理員 ([按一下以檢視完整大小的影像](creating-and-managing-roles-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="7da07-244">**Figure 4**: The `aspnet_Roles` Table has a Row for the Administrators  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image12.png))</span></span>


## <a name="step-5-displaying-the-roles-in-the-system"></a><span data-ttu-id="7da07-245">步驟 5： 顯示在系統中的角色</span><span class="sxs-lookup"><span data-stu-id="7da07-245">Step 5: Displaying the Roles in the System</span></span>

<span data-ttu-id="7da07-246">讓我們來加強`ManageRoles.aspx`頁面，即可包含系統中的目前角色的清單。</span><span class="sxs-lookup"><span data-stu-id="7da07-246">Let's augment the `ManageRoles.aspx` page to include a list of the current roles in the system.</span></span> <span data-ttu-id="7da07-247">若要達成此目的，將 GridView 控制項加入頁面並設定其`ID`屬性`RoleList`。</span><span class="sxs-lookup"><span data-stu-id="7da07-247">To accomplish this, add a GridView control to the page and set its `ID` property to `RoleList`.</span></span> <span data-ttu-id="7da07-248">接下來，將方法加入至名為頁面的程式碼後置類別`DisplayRolesInGrid`使用下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="7da07-248">Next, add a method to the page's code-behind class named `DisplayRolesInGrid` using the following code:</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample8.cs)]

<span data-ttu-id="7da07-249">`Roles`類別的`GetAllRoles`方法會傳回所有角色系統中的字串陣列。</span><span class="sxs-lookup"><span data-stu-id="7da07-249">The `Roles` class's `GetAllRoles` method returns all of the roles in the system as an array of strings.</span></span> <span data-ttu-id="7da07-250">這個字串陣列，然後繫結至 GridView。</span><span class="sxs-lookup"><span data-stu-id="7da07-250">This string array is then bound to the GridView.</span></span> <span data-ttu-id="7da07-251">若要將角色的清單繫結至 GridView，第一次載入頁面時，我們要呼叫`DisplayRolesInGrid`方法，從頁面`Page_Load`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="7da07-251">In order to bind the list of roles to the GridView when the page is first loaded, we need to call the `DisplayRolesInGrid` method from the page's `Page_Load` event handler.</span></span> <span data-ttu-id="7da07-252">當第一次瀏覽頁面時，但不是能在後續回傳時，下列程式碼會呼叫這個方法。</span><span class="sxs-lookup"><span data-stu-id="7da07-252">The following code calls this method when the page is first visited, but not on subsequent postbacks.</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample9.cs)]

<span data-ttu-id="7da07-253">此位置的程式碼，請瀏覽透過瀏覽器頁面。</span><span class="sxs-lookup"><span data-stu-id="7da07-253">With this code in place, visit the page through a browser.</span></span> <span data-ttu-id="7da07-254">如圖 5 所示，您應該會看到一個方格，具有單一資料行標示為項目。</span><span class="sxs-lookup"><span data-stu-id="7da07-254">As Figure 5 shows, you should see a grid with a single column labeled Item.</span></span> <span data-ttu-id="7da07-255">方格包含我們加入在步驟 4 中的系統管理員角色的資料列。</span><span class="sxs-lookup"><span data-stu-id="7da07-255">The grid includes a row for the Administrators role we added in Step 4.</span></span>


<span data-ttu-id="7da07-256">[![GridView 會顯示單一資料行中的角色](creating-and-managing-roles-cs/_static/image14.png)](creating-and-managing-roles-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7da07-256">[![The GridView Displays the Roles in a Single Column](creating-and-managing-roles-cs/_static/image14.png)](creating-and-managing-roles-cs/_static/image13.png)</span></span>

<span data-ttu-id="7da07-257">**圖 5**: GridView 會顯示單一資料行中的角色 ([按一下以檢視完整大小的影像](creating-and-managing-roles-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="7da07-257">**Figure 5**: The GridView Displays the Roles in a Single Column  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image15.png))</span></span>


<span data-ttu-id="7da07-258">GridView 會顯示標示為項目，因為唯一資料行的 GridView`AutoGenerateColumns`屬性設定為 True （預設值），這會導致自動建立資料行中每一個屬性 GridView 其`DataSource`。</span><span class="sxs-lookup"><span data-stu-id="7da07-258">The GridView displays a lone column labeled Item because the GridView's `AutoGenerateColumns` property is set to True (the default), which causes the GridView to automatically create a column for each property in its `DataSource`.</span></span> <span data-ttu-id="7da07-259">陣列具有單一屬性，表示項目陣列，因此在 GridView 中的單一資料行。</span><span class="sxs-lookup"><span data-stu-id="7da07-259">An array has a single property that represents the elements in the array, hence the single column in the GridView.</span></span>

<span data-ttu-id="7da07-260">顯示與 GridView 的資料時，我願意明確定義我的資料行而非讓它們隱含產生的 GridView。</span><span class="sxs-lookup"><span data-stu-id="7da07-260">When displaying data with a GridView, I prefer to explicitly define my columns rather than have them implicitly generated by the GridView.</span></span> <span data-ttu-id="7da07-261">藉由明確定義就能輕鬆將資料格式化的資料行，重新排列資料行，並執行其他一般工作。</span><span class="sxs-lookup"><span data-stu-id="7da07-261">By explicitly defining the columns it is much easier to format the data, rearrange the columns, and perform other common tasks.</span></span> <span data-ttu-id="7da07-262">因此，我們更新 GridView 的宣告式標記，以明確定義其資料行。</span><span class="sxs-lookup"><span data-stu-id="7da07-262">Therefore, let's update the GridView's declarative markup so that its columns are explicitly defined.</span></span>

<span data-ttu-id="7da07-263">開始，以設定 GridView`AutoGenerateColumns`屬性設定為 False。</span><span class="sxs-lookup"><span data-stu-id="7da07-263">Start by setting the GridView's `AutoGenerateColumns` property to False.</span></span> <span data-ttu-id="7da07-264">接下來，將為 TemplateField 加入至方格中，設定其`HeaderText`屬性至角色，並設定其`ItemTemplate`，使其顯示為陣列的內容。</span><span class="sxs-lookup"><span data-stu-id="7da07-264">Next, add a TemplateField to the grid, set its `HeaderText` property to Roles, and configure its `ItemTemplate` so that it displays the contents of the array.</span></span> <span data-ttu-id="7da07-265">若要達成此目的，將加入標籤 Web 控制項，名為`RoleNameLabel`至`ItemTemplate`並繫結其`Text`屬性`Container.DataItem`。</span><span class="sxs-lookup"><span data-stu-id="7da07-265">To accomplish this, add a Label Web control named `RoleNameLabel` to the `ItemTemplate` and bind its `Text` property to `Container.DataItem`.</span></span>

<span data-ttu-id="7da07-266">這些屬性和`ItemTemplate`的內容可以設定以宣告方式或透過 GridView 的 [欄位] 對話方塊和編輯樣板介面。</span><span class="sxs-lookup"><span data-stu-id="7da07-266">These properties and the `ItemTemplate`'s contents can be set declaratively or through the GridView's Fields dialog box and Edit Templates interface.</span></span> <span data-ttu-id="7da07-267">連線到 欄位 對話方塊，按一下 編輯資料行中的連結 GridView 的智慧標籤。</span><span class="sxs-lookup"><span data-stu-id="7da07-267">To reach the Fields dialog box, click the Edit Columns link in the GridView's Smart Tag.</span></span> <span data-ttu-id="7da07-268">接下來，取消核取自動產生欄位核取方塊以設定`AutoGenerateColumns`屬性設定為 False，並為 TemplateField 加入 GridView 中設定其`HeaderText`角色的屬性。</span><span class="sxs-lookup"><span data-stu-id="7da07-268">Next, uncheck the Auto-generate fields checkbox to set the `AutoGenerateColumns` property to False, and add a TemplateField to the GridView, setting its `HeaderText` property to Role.</span></span> <span data-ttu-id="7da07-269">若要定義`ItemTemplate`的內容，從 GridView 的智慧標籤中選擇 [編輯樣板] 選項。</span><span class="sxs-lookup"><span data-stu-id="7da07-269">To define the `ItemTemplate`'s contents, choose the Edit Templates option from the GridView's Smart Tag.</span></span> <span data-ttu-id="7da07-270">將標籤 Web 控制項拖曳至`ItemTemplate`，將其`ID`屬性`RoleNameLabel`，並設定其資料繫結設定，讓其`Text`屬性繫結至`Container.DataItem`。</span><span class="sxs-lookup"><span data-stu-id="7da07-270">Drag a Label Web control onto the `ItemTemplate`, set its `ID` property to `RoleNameLabel`, and configure its databinding settings so that its `Text` property is bound to `Container.DataItem`.</span></span>

<span data-ttu-id="7da07-271">不論您使用哪種方法，GridView 的產生的宣告式標記看起來應該類似下面的完畢時。</span><span class="sxs-lookup"><span data-stu-id="7da07-271">Regardless of what approach you use, the GridView's resulting declarative markup should look similar to the following when you are done.</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample10.aspx)]

> [!NOTE]
> <span data-ttu-id="7da07-272">陣列的內容會顯示使用資料繫結語法`<%# Container.DataItem %>`。</span><span class="sxs-lookup"><span data-stu-id="7da07-272">The array's contents are displayed using the databinding syntax `<%# Container.DataItem %>`.</span></span> <span data-ttu-id="7da07-273">時顯示之陣列的內容繫結至 GridView，為什麼使用此語法的完整描述，已超出本教學課程的範圍。</span><span class="sxs-lookup"><span data-stu-id="7da07-273">A thorough description of why this syntax is used when displaying the contents of an array bound to the GridView is beyond the scope of this tutorial.</span></span> <span data-ttu-id="7da07-274">如需這個問題的詳細資訊，請參閱[繫結至資料的 Web 控制項的純量陣列](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7da07-274">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>


<span data-ttu-id="7da07-275">目前， `RoleList` GridView 只能繫結至角色的清單時第一次造訪的網頁。</span><span class="sxs-lookup"><span data-stu-id="7da07-275">Currently, the `RoleList` GridView is only bound to the list of roles when the page is first visited.</span></span> <span data-ttu-id="7da07-276">我們需要加入新的角色時，請重新整理方格。</span><span class="sxs-lookup"><span data-stu-id="7da07-276">We need to refresh the grid whenever a new role is added.</span></span> <span data-ttu-id="7da07-277">若要完成這項作業，更新`CreateRoleButton`按鈕的`Click`事件處理常式，因此它會呼叫`DisplayRolesInGrid`方法，如果建立新的角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-277">To accomplish this, update the `CreateRoleButton` Button's `Click` event handler so that it calls the `DisplayRolesInGrid` method if a new role is created.</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample11.cs)]

<span data-ttu-id="7da07-278">現在當使用者將新角色`RoleList`GridView 會顯示只是加入角色在回傳時，提供角色已成功建立的視覺化回應。</span><span class="sxs-lookup"><span data-stu-id="7da07-278">Now when the user adds a new role the `RoleList` GridView shows the just-added role on postback, providing visual feedback that the role was successfully created.</span></span> <span data-ttu-id="7da07-279">為了說明這點，請瀏覽`ManageRoles.aspx`頁面上透過瀏覽器，並新增名為監督員的角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-279">To illustrate this, visit the `ManageRoles.aspx` page through a browser and add a role named Supervisors.</span></span> <span data-ttu-id="7da07-280">在 [建立角色] 按鈕時將發生回傳和方格會更新為包括系統管理員，以及新的角色，監督員。</span><span class="sxs-lookup"><span data-stu-id="7da07-280">Upon clicking the Create Role button, a postback will ensue and the grid will update to include Administrators as well as the new role, Supervisors.</span></span>


<span data-ttu-id="7da07-281">[![監督員角色都具有已加入](creating-and-managing-roles-cs/_static/image17.png)](creating-and-managing-roles-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="7da07-281">[![The Supervisors Role has Been Added](creating-and-managing-roles-cs/_static/image17.png)](creating-and-managing-roles-cs/_static/image16.png)</span></span>

<span data-ttu-id="7da07-282">**圖 6**： 監督員角色具有已加入 ([按一下以檢視完整大小的影像](creating-and-managing-roles-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="7da07-282">**Figure 6**: The Supervisors Role has Been Added  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image18.png))</span></span>


## <a name="step-6-deleting-roles"></a><span data-ttu-id="7da07-283">步驟 6： 刪除角色</span><span class="sxs-lookup"><span data-stu-id="7da07-283">Step 6: Deleting Roles</span></span>

<span data-ttu-id="7da07-284">使用者可以建立新的角色與檢視所有現有的角色從此時`ManageRoles.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="7da07-284">At this point a user can create a new role and view all existing roles from the `ManageRoles.aspx` page.</span></span> <span data-ttu-id="7da07-285">讓我們可讓使用者若要同時刪除角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-285">Let's allow users to also delete roles.</span></span> <span data-ttu-id="7da07-286">`Roles.DeleteRole`方法有兩個多載：</span><span class="sxs-lookup"><span data-stu-id="7da07-286">The `Roles.DeleteRole` method has two overloads:</span></span>

- <span data-ttu-id="7da07-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) -刪除的角色*roleName*。</span><span class="sxs-lookup"><span data-stu-id="7da07-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="7da07-288">如果角色包含一個或多個成員，則會擲回例外狀況。</span><span class="sxs-lookup"><span data-stu-id="7da07-288">An exception is thrown if the role contains one or more members.</span></span>
- <span data-ttu-id="7da07-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) -刪除的角色*roleName*。</span><span class="sxs-lookup"><span data-stu-id="7da07-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="7da07-290">如果*throwOnPopulateRole*是`true`，則會擲回例外狀況，如果角色包含一個或多個成員。</span><span class="sxs-lookup"><span data-stu-id="7da07-290">If *throwOnPopulateRole* is `true`, then an exception is thrown if the role contains one or more members.</span></span> <span data-ttu-id="7da07-291">如果*throwOnPopulateRole*是`false`，然後刪除角色後是否或不包含任何成員。</span><span class="sxs-lookup"><span data-stu-id="7da07-291">If *throwOnPopulateRole* is `false`, then the role is deleted whether it contains any members or not.</span></span> <span data-ttu-id="7da07-292">就內部而言，`DeleteRole(roleName)`方法呼叫`DeleteRole(roleName, true)`。</span><span class="sxs-lookup"><span data-stu-id="7da07-292">Internally, the `DeleteRole(roleName)` method calls `DeleteRole(roleName, true)`.</span></span>

<span data-ttu-id="7da07-293">`DeleteRole`方法也會擲回例外狀況如果*roleName*是`null`或空字串或*roleName*包含逗號。</span><span class="sxs-lookup"><span data-stu-id="7da07-293">The `DeleteRole` method will also throw an exception if *roleName* is `null` or an empty string or if *roleName* contains a comma.</span></span> <span data-ttu-id="7da07-294">如果*roleName*不存在於系統`DeleteRole`失敗時以無訊息模式，而不會引發例外狀況。</span><span class="sxs-lookup"><span data-stu-id="7da07-294">If *roleName* does not exist in the system, `DeleteRole` fails silently, without raising an exception.</span></span>

<span data-ttu-id="7da07-295">讓我們來加強在 GridView`ManageRoles.aspx`包含刪除按鈕，按一下時，會刪除選取的角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-295">Let's augment the GridView in `ManageRoles.aspx` to include a Delete button that, when clicked, deletes the selected role.</span></span> <span data-ttu-id="7da07-296">加入 GridView 中的 [刪除] 按鈕，移至 [欄位] 對話方塊，並加入 [刪除] 按鈕，位於 [CommandField] 選項啟動。</span><span class="sxs-lookup"><span data-stu-id="7da07-296">Start by adding a Delete button to the GridView by going to the Fields dialog box and adding a Delete button, which is located under the CommandField option.</span></span> <span data-ttu-id="7da07-297">請刪除按鈕最左側資料行，並設定其`DeleteText`屬性，以刪除角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-297">Make the Delete button the far left column and set its `DeleteText` property to Delete Role .</span></span>


<span data-ttu-id="7da07-298">[![將刪除 按鈕加入至 RoleList GridView](creating-and-managing-roles-cs/_static/image20.png)](creating-and-managing-roles-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="7da07-298">[![Add a Delete Button to the RoleList GridView](creating-and-managing-roles-cs/_static/image20.png)](creating-and-managing-roles-cs/_static/image19.png)</span></span>

<span data-ttu-id="7da07-299">**圖 7**： 新增至 [刪除] 按鈕`RoleList`GridView ([按一下以檢視完整大小的影像](creating-and-managing-roles-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="7da07-299">**Figure 7**: Add a Delete Button to the `RoleList` GridView  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image21.png))</span></span>


<span data-ttu-id="7da07-300">加入 [刪除] 按鈕之後, GridView 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="7da07-300">After adding the Delete button, your GridView's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample12.aspx)]

<span data-ttu-id="7da07-301">接下來，建立事件處理常式的 GridView`RowDeleting`事件。</span><span class="sxs-lookup"><span data-stu-id="7da07-301">Next, create an event handler for the GridView's `RowDeleting` event.</span></span> <span data-ttu-id="7da07-302">這是按一下刪除角色按鈕時，在回傳時引發的事件。</span><span class="sxs-lookup"><span data-stu-id="7da07-302">This is the event that is raised on postback when the Delete Role button is clicked.</span></span> <span data-ttu-id="7da07-303">將下列程式碼加入事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="7da07-303">Add the following code to the event handler.</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample13.cs)]

<span data-ttu-id="7da07-304">程式碼會啟動以程式設計方式參考`RoleNameLabel`Web 中的資料列的刪除角色 button 已按下的控制項。</span><span class="sxs-lookup"><span data-stu-id="7da07-304">The code starts by programmatically referencing the `RoleNameLabel` Web control in the row whose Delete Role button was clicked.</span></span> <span data-ttu-id="7da07-305">`Roles.DeleteRole`然後叫用方法，傳入`Text`的`RoleNameLabel`和`false`，藉此刪除該角色，而不論是否有任何與角色相關聯的使用者。</span><span class="sxs-lookup"><span data-stu-id="7da07-305">The `Roles.DeleteRole` method is then invoked, passing in the `Text` of the `RoleNameLabel` and `false`, thereby deleting the role regardless of whether there are any users associated with the role.</span></span> <span data-ttu-id="7da07-306">最後， `RoleList` GridView 會重新整理，以便只刪除的角色不會再出現在方格中。</span><span class="sxs-lookup"><span data-stu-id="7da07-306">Finally, the `RoleList` GridView is refreshed so that the just-deleted role no longer appears in the grid.</span></span>

> [!NOTE]
> <span data-ttu-id="7da07-307">刪除角色按鈕不需要任何類型的使用者的確認，再刪除該角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-307">The Delete Role button does not require any sort of confirmation from the user before deleting the role.</span></span> <span data-ttu-id="7da07-308">確認動作的最簡單方式是透過用戶端確認對話方塊。</span><span class="sxs-lookup"><span data-stu-id="7da07-308">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="7da07-309">如需有關這項技術的詳細資訊，請參閱[新增用戶端確認時刪除](https://asp.net/learn/data-access/tutorial-42-cs.aspx)。</span><span class="sxs-lookup"><span data-stu-id="7da07-309">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-cs.aspx).</span></span>


## <a name="summary"></a><span data-ttu-id="7da07-310">總結</span><span class="sxs-lookup"><span data-stu-id="7da07-310">Summary</span></span>

<span data-ttu-id="7da07-311">許多 web 應用程式具有特定授權規則或頁面層級功能，只使用特定類別的使用者。</span><span class="sxs-lookup"><span data-stu-id="7da07-311">Many web applications have certain authorization rules or page-level functionality that is only available to certain classes of users.</span></span> <span data-ttu-id="7da07-312">例如，可能只有系統管理員可以存取的 web 網頁的一組。</span><span class="sxs-lookup"><span data-stu-id="7da07-312">For example, there may be a set of web pages that only administrators can access.</span></span> <span data-ttu-id="7da07-313">而不是以使用者的使用者為基礎，定義這些授權規則，有時候很多有用來定義角色為基礎的規則。</span><span class="sxs-lookup"><span data-stu-id="7da07-313">Rather than defining these authorization rules on a user-by-user basis, oftentimes it is more useful to define the rules based on a role.</span></span> <span data-ttu-id="7da07-314">也就是說，而不是明確地讓使用者 Scott 和 Jisun 存取系統管理的網頁，更容易維護的方法是以允許系統管理員角色的成員存取這些頁面，然後代表屬於使用者 Scott 和 Jisun系統管理員角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-314">That is, rather than explicitly allowing users Scott and Jisun to access the administrative web pages, a more maintainable approach is to permit members of the Administrators role to access these pages, and then to denote Scott and Jisun as users belonging to the Administrators role.</span></span>

<span data-ttu-id="7da07-315">角色架構可讓您輕鬆地建立及管理角色。</span><span class="sxs-lookup"><span data-stu-id="7da07-315">The Roles framework makes it easy to create and manage roles.</span></span> <span data-ttu-id="7da07-316">在本教學課程中，我們檢查如何設定要使用的角色 framework `SqlRoleProvider`，使用 Microsoft SQL Server 資料庫為角色存放區。</span><span class="sxs-lookup"><span data-stu-id="7da07-316">In this tutorial we examined how to configure the Roles framework to use the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span> <span data-ttu-id="7da07-317">此外，我們也會建立網頁，列出系統中的現有角色，並允許建立新的角色，以刪除現有的。</span><span class="sxs-lookup"><span data-stu-id="7da07-317">We also created a web page that lists the existing roles in the system and allows for new roles to be created and existing ones to be deleted.</span></span> <span data-ttu-id="7da07-318">在後續的教學課程中，我們會看到如何將使用者指派給角色，以及如何套用以角色為基礎的授權。</span><span class="sxs-lookup"><span data-stu-id="7da07-318">In subsequent tutorials we will see how to assign users to roles and how to apply role-based authorization.</span></span>

<span data-ttu-id="7da07-319">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="7da07-319">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="7da07-320">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="7da07-320">Further Reading</span></span>

<span data-ttu-id="7da07-321">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="7da07-321">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="7da07-322">檢查 ASP.NET 2.0 的成員資格、 角色和設定檔</span><span class="sxs-lookup"><span data-stu-id="7da07-322">Examining ASP.NET 2.0's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="7da07-323">如何： 使用 ASP.NET 2.0 中的 角色管理員</span><span class="sxs-lookup"><span data-stu-id="7da07-323">How To: Use Role Manager in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998314.aspx)
- [<span data-ttu-id="7da07-324">角色提供者</span><span class="sxs-lookup"><span data-stu-id="7da07-324">Role Providers</span></span>](https://msdn.microsoft.com/library/aa478950.aspx)
- [<span data-ttu-id="7da07-325">復原您的網站管理工具</span><span class="sxs-lookup"><span data-stu-id="7da07-325">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="7da07-326">技術文件`<roleManager>`項目</span><span class="sxs-lookup"><span data-stu-id="7da07-326">Technical documentation for the `<roleManager>` Element</span></span>](https://msdn.microsoft.com/library/ms164660.aspx)
- [<span data-ttu-id="7da07-327">使用成員資格和角色管理員 Api</span><span class="sxs-lookup"><span data-stu-id="7da07-327">Using the Membership and Role Manager APIs</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/security/membership.aspx)

### <a name="about-the-author"></a><span data-ttu-id="7da07-328">關於作者</span><span class="sxs-lookup"><span data-stu-id="7da07-328">About the Author</span></span>

<span data-ttu-id="7da07-329">Scott Mitchell，多個 ASP/ASP.NET 書籍的作者和創辦的 4GuysFromRolla.com，具有已經使用 Microsoft Web 技術從 1998 年。</span><span class="sxs-lookup"><span data-stu-id="7da07-329">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7da07-330">Scott 可做為獨立顧問、 訓練和寫入器。</span><span class="sxs-lookup"><span data-stu-id="7da07-330">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7da07-331">他最新的活頁簿 *[Sam 教導您自己 ASP.NET 2.0 24 小時內](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*。</span><span class="sxs-lookup"><span data-stu-id="7da07-331">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="7da07-332">在可到達 Scott [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或透過在他的部落格[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="7da07-332">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="7da07-333">特別感謝</span><span class="sxs-lookup"><span data-stu-id="7da07-333">Special Thanks To</span></span>

<span data-ttu-id="7da07-334">許多有用的檢閱者已檢閱本教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="7da07-334">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7da07-335">前導檢閱者在此教學課程包含 Alicja Maziarz、 Suchi Banerjee 和本文菲。</span><span class="sxs-lookup"><span data-stu-id="7da07-335">Lead reviewers for this tutorial include Alicja Maziarz, Suchi Banerjee, and Teresa Murphy.</span></span> <span data-ttu-id="7da07-336">檢閱我即將推出的 MSDN 文件有興趣嗎？</span><span class="sxs-lookup"><span data-stu-id="7da07-336">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7da07-337">如果是這樣，卸除我一行 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7da07-337">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="7da07-338">下一步</span><span class="sxs-lookup"><span data-stu-id="7da07-338">Next</span></span>](assigning-roles-to-users-cs.md)
