---
uid: web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
title: 主要/詳細資料的主要記錄項目符號清單使用詳細資料 DataList (C#) |Microsoft Docs
author: rick-anderson
description: 在本教學課程會壓縮上一個教學課程的兩頁主要/詳細資料的報表到單一頁面上，t 上顯示的類別目錄名稱的項目符號清單...
ms.author: aspnetcontent
ms.date: 10/17/2006
ms.assetid: c727bb73-7b59-41a1-8dc3-623c6d69e7c2
msc.legacyurl: /web-forms/overview/data-access/filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs
msc.type: authoredcontent
ms.openlocfilehash: 0be6a03b2fbbf71a1f1d1e13bd4b9118981d0715
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/05/2018
ms.locfileid: "37841059"
---
<a name="masterdetail-using-a-bulleted-list-of-master-records-with-a-details-datalist-c"></a><span data-ttu-id="e1e8d-103">詳細資料 DataList (C#) 搭配使用的主要記錄項目符號清單的主要/詳細資料</span><span class="sxs-lookup"><span data-stu-id="e1e8d-103">Master/Detail Using a Bulleted List of Master Records with a Details DataList (C#)</span></span>
====================
<span data-ttu-id="e1e8d-104">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e1e8d-105">[下載範例應用程式](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe)或[下載 PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_35_CS.exe) or [Download PDF](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/datatutorial35cs1.pdf)</span></span>

> <span data-ttu-id="e1e8d-106">在本教學課程會壓縮上一個教學課程的兩頁主要/詳細資料的報表到單一頁面上，顯示畫面和螢幕的右邊的所選的分類的產品的左側的類別名稱的項目符號清單。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-106">In this tutorial we'll compress the two-page master/detail report of the previous tutorial into a single page, showing a bulleted list of category names on the left side of the screen and the selected category's products on the right of the screen.</span></span>


## <a name="introduction"></a><span data-ttu-id="e1e8d-107">簡介</span><span class="sxs-lookup"><span data-stu-id="e1e8d-107">Introduction</span></span>

<span data-ttu-id="e1e8d-108">在 [前述教學課程](master-detail-filtering-acess-two-pages-datalist-cs.md)我們探討了如何區隔跨兩個頁面的主版/詳細報告。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-108">In the [preceding tutorial](master-detail-filtering-acess-two-pages-datalist-cs.md) we looked at how to separate a master/detail report across two pages.</span></span> <span data-ttu-id="e1e8d-109">在主版頁面中，我們會使用重複項控制項呈現類別的項目符號清單。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-109">In the master page we used a Repeater control to render a bulleted list of categories.</span></span> <span data-ttu-id="e1e8d-110">每個類別目錄名稱是超連結，按一下時，會採用使用者的詳細資料頁面，其中兩個資料行 DataList 示範了這些產品屬於所選取的類別。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-110">Each category name was a hyperlink that, when clicked, would take the user to the details page, where a two-column DataList showed those products belonging to the selected category.</span></span>

<span data-ttu-id="e1e8d-111">在本教學課程會壓縮兩頁教學課程到單一頁面上，顯示在畫面左側的類別名稱的項目符號清單呈現 LinkButton 為每個類別目錄名稱。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-111">In this tutorial we'll compress the two-page tutorial into a single page, showing a bulleted list of category names on the left side of the screen with each category name rendered as a LinkButton.</span></span> <span data-ttu-id="e1e8d-112">按一下其中一個類別目錄名稱 Linkbutton 引發回傳，並將選取的類別目錄產品繫結至畫面的右側兩個資料行 DataList。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-112">Clicking one of the category name LinkButtons induces a postback and binds the selected category s products to a two-column DataList on the right of the screen.</span></span> <span data-ttu-id="e1e8d-113">除了顯示每個類別 s 的名稱，在左側的重複項顯示有多少總產品指定類別 （請參閱 圖 1）。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-113">In addition to displaying each category s name, the Repeater on the left shows how many total products there are for a given category (see Figure 1).</span></span>


<span data-ttu-id="e1e8d-114">[![使用的類別名稱和產品的總計數字會顯示在左邊](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-114">[![The Category s Name and Total Number of Products are Displayed on the Left](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image2.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image1.png)</span></span>

<span data-ttu-id="e1e8d-115">**圖 1**: 類別名稱和產品的總計數字會顯示在左側 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-115">**Figure 1**: The Category s Name and Total Number of Products are Displayed on the Left ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image3.png))</span></span>


## <a name="step-1-displaying-a-repeater-in-the-left-portion-of-the-screen"></a><span data-ttu-id="e1e8d-116">步驟 1： 在螢幕的左邊顯示的重複項</span><span class="sxs-lookup"><span data-stu-id="e1e8d-116">Step 1: Displaying a Repeater in the Left Portion of the Screen</span></span>

<span data-ttu-id="e1e8d-117">在本教學課程中，我們需要有類別目錄項目符號清單，選取類別目錄產品的左邊會出現。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-117">For this tutorial we need to have the bulleted list of categories appear to the left of the selected category s products.</span></span> <span data-ttu-id="e1e8d-118">可以使用標準的 HTML 項目段落標記，不分行空格放置內容的 web 網頁內的位置`<table>`s，並依此類推或透過階層式樣式表 (CSS) 技術。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-118">Content within a web page can be positioned using standard HTML elements paragraph tags, non-breaking spaces, `<table>` s, and so on or through cascading stylesheet (CSS) techniques.</span></span> <span data-ttu-id="e1e8d-119">我們的教學課程的所有目前為止已用來定位 CSS 技巧。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-119">All of our tutorials thus far have used CSS techniques for positioning.</span></span> <span data-ttu-id="e1e8d-120">當我們在我們的主版頁面中，會在建置巡覽使用者介面時[主版頁面與網站導覽](../introduction/master-pages-and-site-navigation-cs.md)教學課程中，我們使用*絕對定位*，指出瀏覽的精準的像素位移清單和主要內容。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-120">When we built the navigation user interface in our master page in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we used *absolute positioning*, indicating the precise pixel offset for the navigation list and the main content.</span></span> <span data-ttu-id="e1e8d-121">或者，使用 CSS，可以定位項目透過另一個左右*浮動*。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-121">Alternatively, CSS can be used to position one element to the right or left of another through *floating*.</span></span> <span data-ttu-id="e1e8d-122">我們可以有類別目錄項目符號清單，顯示左邊的 選取類別目錄產品浮動至 DataList 左邊 Repeater</span><span class="sxs-lookup"><span data-stu-id="e1e8d-122">We can have the bulleted list of categories appear to the left of the selected category s products by floating the Repeater to the left of the DataList</span></span>

<span data-ttu-id="e1e8d-123">開啟`CategoriesAndProducts.aspx`頁面上，從`DataListRepeaterFiltering`資料夾和 Repeater 和 DataList 新增至頁面。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-123">Open the `CategoriesAndProducts.aspx` page from the `DataListRepeaterFiltering` folder and add to the page a Repeater and a DataList.</span></span> <span data-ttu-id="e1e8d-124">設定中繼器 s`ID`要`Categories`和 DataList s 至`CategoryProducts`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-124">Set the Repeater s `ID` to `Categories` and the DataList s to `CategoryProducts`.</span></span> <span data-ttu-id="e1e8d-125">移至來源檢視，並將其本身內 Repeater 和 DataList 控制項放`<div>`項目。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-125">Go to the Source view and put the Repeater and DataList controls within their own `<div>` elements.</span></span> <span data-ttu-id="e1e8d-126">也就是括住在中繼器`<div>`項目第一次，然後在它自己 DataList`<div>`直接在中繼器之後的項目。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-126">That is, enclose the Repeater within a `<div>` element first and then the DataList in its own `<div>` element directly after the Repeater.</span></span> <span data-ttu-id="e1e8d-127">標記現在看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-127">Your markup at this point should look similar to the following:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample1.aspx)]

<span data-ttu-id="e1e8d-128">若要浮動至 DataList 左邊 Repeater，我們需要使用`float`CSS 樣式屬性，就像這樣：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-128">To float the Repeater to the left of the DataList, we need to use the `float` CSS style attribute, like so:</span></span>


[!code-html[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample2.html)]

<span data-ttu-id="e1e8d-129">`float: left;`浮點數的第一個`<div>`左邊的第二個項目。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-129">The `float: left;` floats the first `<div>` element to the left of the second one.</span></span> <span data-ttu-id="e1e8d-130">`width`並`padding-right`設定會指出第一個`<div>`s`width`之間加入多少填補和`<div>`元素的內容和其右邊界。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-130">The `width` and `padding-right` settings indicate the first `<div>` s `width` and how much padding is added between the `<div>` element s content and its right margin.</span></span> <span data-ttu-id="e1e8d-131">如需在 CSS 中浮動元素的詳細資訊請參閱[Floatutorial](http://css.maxdesign.com.au/floatutorial/)。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-131">For more information on floating elements in CSS check out the [Floatutorial](http://css.maxdesign.com.au/floatutorial/).</span></span>

<span data-ttu-id="e1e8d-132">而不是指定的樣式設定，直接透過第一個`<p>`項目 s`style`屬性中，將改為建立新的 CSS 類別中的 s`Styles.css`名為`FloatLeft`:</span><span class="sxs-lookup"><span data-stu-id="e1e8d-132">Rather than specify the style setting directly through the first `<p>` element s `style` attribute, let s instead create a new CSS class in `Styles.css` named `FloatLeft`:</span></span>


[!code-css[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample3.css)]

<span data-ttu-id="e1e8d-133">然後我們可以把`<div>`與`<div class="FloatLeft">`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-133">Then we can replace the `<div>` with `<div class="FloatLeft">`.</span></span>

<span data-ttu-id="e1e8d-134">加入 CSS 類別，並設定中的標記後`CategoriesAndProducts.aspx`頁面上，移至設計工具。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-134">After adding the CSS class and configuring the markup in the `CategoriesAndProducts.aspx` page, go to the Designer.</span></span> <span data-ttu-id="e1e8d-135">您應該會看到 Repeater （雖然權限現在都只會出現，因為我們尚未將其資料來源或範本的 ve 灰色方塊），浮點數到左邊的 DataList。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-135">You should see the Repeater floating to the left of the DataList (although right now both just appear as gray boxes since we ve yet to configure their data sources or templates).</span></span>


<span data-ttu-id="e1e8d-136">[![中繼器浮動至 DataList 左邊](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-136">[![The Repeater is Floated to the Left of the DataList](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image5.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image4.png)</span></span>

<span data-ttu-id="e1e8d-137">**圖 2**： 至 datalist 的左浮動的重複項 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-137">**Figure 2**: The Repeater is Floated to the Left of the DataList ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image6.png))</span></span>


## <a name="step-2-determining-the-number-of-products-for-each-category"></a><span data-ttu-id="e1e8d-138">步驟 2： 判斷每個類別目錄的產品數目</span><span class="sxs-lookup"><span data-stu-id="e1e8d-138">Step 2: Determining the Number of Products for Each Category</span></span>

<span data-ttu-id="e1e8d-139">與周圍的標記完成 Repeater 和 DataList s，我們準備好的類別目錄資料繫結至 Repeater 控制項。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-139">With the Repeater and DataList s surrounding markup complete, we re ready to bind the category data to the Repeater control.</span></span> <span data-ttu-id="e1e8d-140">不過，如 [圖 1] 中的類別目錄項目符號清單所示，除了每個類別目錄名稱，我們也需要顯示類別目錄相關聯的產品數目。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-140">However, as the bulleted list of categories in Figure 1 shows, in addition to each category s name we also need to display the number of products associated with the category.</span></span> <span data-ttu-id="e1e8d-141">若要存取此資訊，我們可以：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-141">To access this information we can either:</span></span>

- <span data-ttu-id="e1e8d-142">**判斷從 ASP.NET 頁面 s 程式碼後置類別的這項資訊。**</span><span class="sxs-lookup"><span data-stu-id="e1e8d-142">**Determine this information from the ASP.NET page s code-behind class.**</span></span> <span data-ttu-id="e1e8d-143">指定特定*`categoryID`* 我們可以呼叫來判斷相關聯的產品數目`ProductsBLL`類別的`GetProductsByCategoryID(categoryID)`方法。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-143">Given a particular *`categoryID`* we can determine the number of associated products by calling the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="e1e8d-144">這個方法會傳回`ProductsDataTable`物件，其`Count`屬性會指出多少`ProductsRow`s 已存在，但這是指定的產品數目*`categoryID`*。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-144">This method returns a `ProductsDataTable` object whose `Count` property indicates how many `ProductsRow` s exists, which is the number of products for the specified *`categoryID`*.</span></span> <span data-ttu-id="e1e8d-145">我們可以建立`ItemDataBound`Repeater 的繫結至 Repeater，每個類別會呼叫事件處理常式`ProductsBLL`類別的`GetProductsByCategoryID(categoryID)`方法，並在輸出中包含其計數。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-145">We can create an `ItemDataBound` event handler for the Repeater that, for each category bound to the Repeater, calls the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and includes its count in the output.</span></span>
- <span data-ttu-id="e1e8d-146">**更新`CategoriesDataTable`輸入資料集中要包含`NumberOfProducts`資料行。**</span><span class="sxs-lookup"><span data-stu-id="e1e8d-146">**Update the `CategoriesDataTable` in the Typed DataSet to include a `NumberOfProducts` column.**</span></span> <span data-ttu-id="e1e8d-147">我們可以接著更新`GetCategories()`方法中的`CategoriesDataTable`若要包含這項資訊或，或者，將`GetCategories()`做為-並建立新`CategoriesDataTable`方法呼叫`GetCategoriesAndNumberOfProducts()`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-147">We can then update the `GetCategories()` method in the `CategoriesDataTable` to include this information or, alternatively, leave `GetCategories()` as-is and create a new `CategoriesDataTable` method called `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="e1e8d-148">可讓 s 探索這兩種技巧。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-148">Let s explore both of these techniques.</span></span> <span data-ttu-id="e1e8d-149">第一種方法是比較容易實作方式，因為我們不 t 需要更新資料的存取層級;不過，它需要多個資料庫通訊。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-149">The first approach is simpler to implement since we don t need to update the Data Access Layer; however, it requires more communications with the database.</span></span> <span data-ttu-id="e1e8d-150">若要在呼叫`ProductsBLL`類別 s`GetProductsByCategoryID(categoryID)`方法中的`ItemDataBound`事件處理常式會將每個類別顯示中繼器中額外的資料庫呼叫。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-150">The call to the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method in the `ItemDataBound` event handler adds an extra database call for each category displayed in the Repeater.</span></span> <span data-ttu-id="e1e8d-151">使用這項技術有*N* + 1 個資料庫呼叫，其中*N*是中繼器中顯示的類別數目。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-151">With this technique there are *N* + 1 database calls, where *N* is the number of categories displayed in the Repeater.</span></span> <span data-ttu-id="e1e8d-152">會使用第二個方法時，從每個類別目錄的相關資訊傳回產品計數`CategoriesBLL`類別 s `GetCategories()` (或`GetCategoriesAndNumberOfProducts()`) 方法，進而導致只一次往返資料庫。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-152">With the second approach, the product count is returned with information about each category from the `CategoriesBLL` class s `GetCategories()` (or `GetCategoriesAndNumberOfProducts()`) method, thereby resulting in just one trip to the database.</span></span>

## <a name="determining-the-number-of-products-in-the-itemdatabound-event-handler"></a><span data-ttu-id="e1e8d-153">判斷 ItemDataBound 事件處理常式中的產品數目</span><span class="sxs-lookup"><span data-stu-id="e1e8d-153">Determining the Number of Products in the ItemDataBound Event Handler</span></span>

<span data-ttu-id="e1e8d-154">判斷中繼器 s 中的每個類別目錄的產品數目`ItemDataBound`事件處理常式不需要我們現有的資料存取層的任何修改。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-154">Determining the number of products for each category in the Repeater s `ItemDataBound` event handler does not require any modifications to our existing Data Access Layer.</span></span> <span data-ttu-id="e1e8d-155">可以直接在進行所有修改`CategoriesAndProducts.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-155">All modifications can be made directly within the `CategoriesAndProducts.aspx` page.</span></span> <span data-ttu-id="e1e8d-156">新增名為新 ObjectDataSource 開始`CategoriesDataSource`透過 Repeater s 智慧標籤。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-156">Start by adding a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="e1e8d-157">接下來，設定`CategoriesDataSource`ObjectDataSource，因此它會擷取資料的來源`CategoriesBLL`類別的`GetCategories()`方法。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-157">Next, configure the `CategoriesDataSource` ObjectDataSource so that it retrieves its data from the `CategoriesBLL` class s `GetCategories()` method.</span></span>


<span data-ttu-id="e1e8d-158">[![設定要使用 CategoriesBLL 類別的 GetCategories() 方法的 ObjectDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-158">[![Configure the ObjectDataSource to Use the CategoriesBLL class s GetCategories() Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image8.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image7.png)</span></span>

<span data-ttu-id="e1e8d-159">**圖 3**： 設定要使用 ObjectDataSource`CategoriesBLL`類別 s`GetCategories()`方法 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-159">**Figure 3**: Configure the ObjectDataSource to Use the `CategoriesBLL` class s `GetCategories()` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image9.png))</span></span>


<span data-ttu-id="e1e8d-160">在每個項目`Categories`Repeater 必須可以點選，並按一下時，會導致`CategoryProducts`顯示選取之類別目錄的這些產品的 DataList。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-160">Each item in the `Categories` Repeater needs to be clickable and, when clicked, cause the `CategoryProducts` DataList to display those products for the selected category.</span></span> <span data-ttu-id="e1e8d-161">這可藉由讓每個類別的超連結，連結回到這個相同的頁面 (`CategoriesAndProducts.aspx`)，但傳遞`CategoryID`透過查詢字串，如同我們在上一個教學課程中所見。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-161">This can be accomplished by making each category a hyperlink, linking back to this same page (`CategoriesAndProducts.aspx`), but passing the `CategoryID` through the querystring, much like we saw in the previous tutorial.</span></span> <span data-ttu-id="e1e8d-162">這種方法的優點是可以加上書籤頁面，顯示特定類別 s 的產品，並由搜尋引擎編製索引。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-162">The advantage of this approach is that a page displaying a particular category s products can be bookmarked and indexed by a search engine.</span></span>

<span data-ttu-id="e1e8d-163">或者，我們可以讓每個類別目錄的 LinkButton，這是本教學課程中，我們將使用的方法。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-163">Alternatively, we can make each category a LinkButton, which is the approach we'll use for this tutorial.</span></span> <span data-ttu-id="e1e8d-164">LinkButton 會呈現為超連結使用者 s 瀏覽器中，但按一下時，會引發回傳;在回傳時，DataList 的 ObjectDataSource 需要重新整理以顯示屬於所選分類的產品。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-164">The LinkButton renders in the user s browser as a hyperlink but, when clicked, induces a postback; on postback, the DataList s ObjectDataSource needs to be refreshed to display those products belonging to the selected category.</span></span> <span data-ttu-id="e1e8d-165">本教學課程中，使用超連結會比使用 LinkButton;不過，可能有其他的情況下使用 LinkButton 更有幫助。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-165">For this tutorial, using a hyperlink makes more sense than using a LinkButton; however, there may be other scenarios where using a LinkButton is more advantageous.</span></span> <span data-ttu-id="e1e8d-166">雖然超連結的方法是適用於此範例中，可讓 s 改為使用 LinkButton 進行探索。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-166">While the hyperlink approach would be ideal for this example, let s instead explore using the LinkButton.</span></span> <span data-ttu-id="e1e8d-167">如我們所見，使用了 LinkButton 導入了一些挑戰，否則不會發生的超連結。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-167">As we'll see, using a LinkButton introduces some challenges that would not otherwise arise with a hyperlink.</span></span> <span data-ttu-id="e1e8d-168">因此，在本教學課程使用 LinkButton 將反白顯示這些挑戰，並協助提供這些的情況下我們可能會想要使用 LinkButton 而不是超連結的解決方案。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-168">Therefore, using a LinkButton in this tutorial will highlight these challenges and help provide solutions for those scenarios where we may want to use a LinkButton instead of a hyperlink.</span></span>

> [!NOTE]
> <span data-ttu-id="e1e8d-169">建議您使用以重複執行本教學課程中使用超連結控制項或`<a>`代替 LinkButton 的項目。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-169">You are encouraged to repeat this tutorial using a HyperLink control or `<a>` element in lieu of the LinkButton.</span></span>


<span data-ttu-id="e1e8d-170">下列標記顯示 Repeater 和 ObjectDataSource 的宣告式語法。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-170">The following markup shows the declarative syntax for the Repeater and the ObjectDataSource.</span></span> <span data-ttu-id="e1e8d-171">請注意 Repeater 的範本呈現 LinkButton 為每個項目的項目符號清單：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-171">Note that the Repeater s templates render a bulleted list with each item as a LinkButton:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample4.aspx)]

> [!NOTE]
> <span data-ttu-id="e1e8d-172">本教學課程中的重複項必須啟用其檢視狀態 (請注意省略的`EnableViewState="False"`Repeater s 宣告式語法)。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-172">For this tutorial the Repeater must have its view state enabled (note the omission of the `EnableViewState="False"` from the Repeater s declarative syntax).</span></span> <span data-ttu-id="e1e8d-173">步驟 3 中我們將建立事件處理常式，如 Repeater s`ItemCommand`事件中我們將更新 DataList 的 ObjectDataSource 的`SelectParameters`集合。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-173">In step 3 we'll be creating an event handler for the Repeater s `ItemCommand` event in which we'll be updating the DataList s ObjectDataSource s `SelectParameters` collection.</span></span> <span data-ttu-id="e1e8d-174">Repeater 的`ItemCommand`，不過，如果已停用檢視狀態，贏得 t 引發。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-174">The Repeater s `ItemCommand`, however, won t fire if view state is disabled.</span></span> <span data-ttu-id="e1e8d-175">請參閱[ASP.NET 問題的疑惑](http://scottonwriting.net/sowblog/posts/1263.aspx)並[其解決方案](http://scottonwriting.net/sowBlog/posts/1268.aspx)詳細了解為何必須啟用檢視狀態的 Repeater 的`ItemCommand`引發的事件。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-175">See [A Stumper of an ASP.NET Question](http://scottonwriting.net/sowblog/posts/1263.aspx) and [its solution](http://scottonwriting.net/sowBlog/posts/1268.aspx) for more information on why view state must be enabled for a Repeater s `ItemCommand` event to fire.</span></span>


<span data-ttu-id="e1e8d-176">使用 LinkButton`ID`屬性值`ViewCategory`並沒有其`Text`屬性集。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-176">The LinkButton with the `ID` property value of `ViewCategory` does not have its `Text` property set.</span></span> <span data-ttu-id="e1e8d-177">如果我們只要有想要顯示類別名稱，我們會設定 Text 屬性以宣告方式，透過資料繫結語法，就像這樣：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-177">If we had just wanted to display the category name, we would have set the Text property declaratively, through databinding syntax, like so:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample5.aspx)]

<span data-ttu-id="e1e8d-178">不過，我們想要顯示這兩個類別目錄的名稱的地方*和*屬於該類別目錄的產品數目。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-178">However, we want to show both the category s name *and* the number of products belonging to that category.</span></span> <span data-ttu-id="e1e8d-179">這項資訊可以擷取從 Repeater s`ItemDataBound`藉由呼叫的事件處理常式`ProductBLL`類別 s`GetCategoriesByProductID(categoryID)`方法，並判斷在產生傳回多少筆記錄`ProductsDataTable`，如以下程式碼說明：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-179">This information can be retrieved from the Repeater s `ItemDataBound` event handler by making a call to the `ProductBLL` class s `GetCategoriesByProductID(categoryID)` method and determining how many records are returned in the resulting `ProductsDataTable`, as the following code illustrates:</span></span>


[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample6.cs)]

<span data-ttu-id="e1e8d-180">一開始我們先確定我們重新處理資料的項目 (一個其`ItemType`是`Item`或`AlternatingItem`)，然後參考`CategoriesRow`只是已繫結至目前的執行個體`RepeaterItem`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-180">We start out by ensuring that we re working with a data item (one whose `ItemType` is `Item` or `AlternatingItem`) and then reference the `CategoriesRow` instance that has just been bound to the current `RepeaterItem`.</span></span> <span data-ttu-id="e1e8d-181">接下來，我們判斷此分類的產品數目所建立的執行個體`ProductsBLL`類別，呼叫其`GetCategoriesByProductID(categoryID)`方法，並決定使用傳回的記錄數目`Count`屬性。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-181">Next, we determine the number of products for this category by creating an instance of the `ProductsBLL` class, calling its `GetCategoriesByProductID(categoryID)` method, and determining the number of records returned using the `Count` property.</span></span> <span data-ttu-id="e1e8d-182">最後， `ViewCategory` itemtemplate 的 LinkButton 是參考及其`Text`屬性設定為*CategoryName* (*NumberOfProductsInCategory*)，其中*NumberOfProductsInCategory*會格式化為零的小數位數的數字。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-182">Finally, the `ViewCategory` LinkButton in the ItemTemplate is references and its `Text` property is set to *CategoryName* (*NumberOfProductsInCategory*), where *NumberOfProductsInCategory* is formatted as a number with zero decimal places.</span></span>

> [!NOTE]
> <span data-ttu-id="e1e8d-183">或者，我們可以新增*格式化函式*接受類別 s 為 ASP.NET 網頁 s 程式碼後置類別`CategoryName`並`CategoryID`值並傳回`CategoryName`串連在一起的數目產品類別目錄中的 (由呼叫`GetCategoriesByProductID(categoryID)`方法)。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-183">Alternatively, we could have added a *formatting function* to the ASP.NET page s code-behind class that accepts a category s `CategoryName` and `CategoryID` values and returns the `CategoryName` concatenated with the number of products in the category (as determined by calling the `GetCategoriesByProductID(categoryID)` method).</span></span> <span data-ttu-id="e1e8d-184">這種格式的函式的結果無法以宣告方式指派給 LinkButton 的 Text 屬性取代需要`ItemDataBound`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-184">The results of such a formatting function could be declaratively assigned to the LinkButton s Text property replacing the need for the `ItemDataBound` event handler.</span></span> <span data-ttu-id="e1e8d-185">請參閱[使用 GridView 控制項中的 TemplateFields](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md)或是[格式化 DataList 和 Repeater 時資料](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md)如需有關使用格式化的函式的教學課程。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-185">Refer to the [Using TemplateFields in the GridView Control](../custom-formatting/using-templatefields-in-the-gridview-control-cs.md) or [Formatting the DataList and Repeater Based Upon Data](../displaying-data-with-the-datalist-and-repeater/formatting-the-datalist-and-repeater-based-upon-data-cs.md) tutorials for more information on using formatting functions.</span></span>


<span data-ttu-id="e1e8d-186">加入這個事件處理常式之後, 請花一點時間測試透過瀏覽器頁面。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-186">After adding this event handler, take a moment to test the page through a browser.</span></span> <span data-ttu-id="e1e8d-187">請注意每個類別目錄會列在項目符號清單中，顯示分類的名稱與類別相關聯的產品數目的方式 （請參閱 圖 4）。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-187">Note how each category is listed in a bulleted list, displaying the category s name and the number of products associated with the category (see Figure 4).</span></span>


<span data-ttu-id="e1e8d-188">[![會顯示每個類別目錄名稱和數字的產品](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-188">[![Each Category s Name and Number of Products are Displayed](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image11.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image10.png)</span></span>

<span data-ttu-id="e1e8d-189">**圖 4**： 顯示每個類別目錄名稱和數字的產品 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-189">**Figure 4**: Each Category s Name and Number of Products are Displayed ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image12.png))</span></span>


## <a name="updating-thecategoriesdatatableandcategoriestableadapterto-include-the-number-of-products-for-each-category"></a><span data-ttu-id="e1e8d-190">更新`CategoriesDataTable`和`CategoriesTableAdapter`来包含的產品數目，每個類別目錄</span><span class="sxs-lookup"><span data-stu-id="e1e8d-190">Updating the`CategoriesDataTable`and`CategoriesTableAdapter`to Include the Number of Products for Each Category</span></span>

<span data-ttu-id="e1e8d-191">而不是決定每個類別目錄做為它的產品數目 s 繫結至 Repeater，我們可以簡化這個程序，藉由調整`CategoriesDataTable`和`CategoriesTableAdapter`中將此資訊包含在原生資料存取層。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-191">Rather than determining the number of products for each category as it s bound to the Repeater, we can streamline this process by adjusting the `CategoriesDataTable` and `CategoriesTableAdapter` in the Data Access Layer to include this information natively.</span></span> <span data-ttu-id="e1e8d-192">若要達到此目的，我們必須加入至新的資料行`CategoriesDataTable`保留相關聯的產品數目。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-192">To achieve this, we must add a new column to `CategoriesDataTable` to hold the number of associated products.</span></span> <span data-ttu-id="e1e8d-193">若要加入新的資料行至 DataTable，開啟 輸入資料集 (`App_Code\DAL\Northwind.xsd`)，以滑鼠右鍵按一下要修改，DataTable，然後選擇 新增 / 資料行。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-193">To add a new column to a DataTable, open the Typed DataSet (`App_Code\DAL\Northwind.xsd`), right-click on the DataTable to modify, and choose Add / Column.</span></span> <span data-ttu-id="e1e8d-194">加入新的資料行，以`CategoriesDataTable`（請參閱 [圖 5]）。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-194">Add a new column to the `CategoriesDataTable` (see Figure 5).</span></span>


<span data-ttu-id="e1e8d-195">[![將新的資料行新增至 CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-195">[![Add a New Column to the CategoriesDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image14.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image13.png)</span></span>

<span data-ttu-id="e1e8d-196">**圖 5**： 加入新的資料行，以`CategoriesDataSource`([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-196">**Figure 5**: Add a New Column to the `CategoriesDataSource` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image15.png))</span></span>


<span data-ttu-id="e1e8d-197">這會新增新的資料行，名為`Column1`，您可以變更輸入其他名稱。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-197">This will add a new column named `Column1`, which you can change by simply typing in a different name.</span></span> <span data-ttu-id="e1e8d-198">重新命名此新資料行`NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-198">Rename this new column to `NumberOfProducts`.</span></span> <span data-ttu-id="e1e8d-199">接下來，我們需要設定此資料行的屬性。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-199">Next, we need to configure this column s properties.</span></span> <span data-ttu-id="e1e8d-200">按一下新的資料行，然後移至 [屬性] 視窗。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-200">Click on the new column and go to the Properties window.</span></span> <span data-ttu-id="e1e8d-201">變更資料行 s`DataType`屬性從`System.String`要`System.Int32`，並設定`ReadOnly`屬性設`True`，如 [圖 6] 所示。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-201">Change the column s `DataType` property from `System.String` to `System.Int32` and set the `ReadOnly` property to `True`, as shown in Figure 6.</span></span>


![設定資料類型和新的資料行的唯讀屬性](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image16.png)

<span data-ttu-id="e1e8d-203">**圖 6**： 設定`DataType`和`ReadOnly`新的資料行的屬性</span><span class="sxs-lookup"><span data-stu-id="e1e8d-203">**Figure 6**: Set the `DataType` and `ReadOnly` Properties of the New Column</span></span>


<span data-ttu-id="e1e8d-204">雖然`CategoriesDataTable`現在有`NumberOfProducts`資料行，其值不由設定的任何對應的 TableAdapter 的查詢。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-204">While the `CategoriesDataTable` now has a `NumberOfProducts` column, its value is not set by any of the corresponding TableAdapter s queries.</span></span> <span data-ttu-id="e1e8d-205">我們可以更新`GetCategories()`方法來傳回這項資訊，如果我們想要這類資訊傳回，每次擷取類別目錄資訊時。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-205">We can update the `GetCategories()` method to return this information if we want such information returned every time category information is retrieved.</span></span> <span data-ttu-id="e1e8d-206">如果，不過，我們只需要擷取相關聯的產品，在罕見情況下 （例如，只用於本教學課程），類別目錄數目，則我們可以把`GetCategories()`作為-並建立新的方法會傳回這項資訊。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-206">If, however, we only need to grab the number of associated products for the categories in rare instances (such as just for this tutorial), then we can leave `GetCategories()` as-is and create a new method that returns this information.</span></span> <span data-ttu-id="e1e8d-207">可讓 s 使用此第二種方法，建立名為的新方法`GetCategoriesAndNumberOfProducts()`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-207">Let s use this latter approach, creating a new method named `GetCategoriesAndNumberOfProducts()`.</span></span>

<span data-ttu-id="e1e8d-208">若要新增這`GetCategoriesAndNumberOfProducts()`方法，以滑鼠右鍵按一下`CategoriesTableAdapter`，然後選擇 新增查詢。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-208">To add this new `GetCategoriesAndNumberOfProducts()` method, right-click on the `CategoriesTableAdapter` and choose New Query.</span></span> <span data-ttu-id="e1e8d-209">這會的啟動 TableAdapter 查詢組態精靈 中，這點我們發生許多次上一個教學課程中使用。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-209">This brings up the TableAdapter Query Configuration Wizard, which we ve used numerous times in previous tutorials.</span></span> <span data-ttu-id="e1e8d-210">針對這個方法，請藉由指出此查詢使用特定 SQL 陳述式會傳回資料列來啟動精靈。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-210">For this method, start the wizard by indicating that the query uses an ad-hoc SQL statement that returns rows.</span></span>


<span data-ttu-id="e1e8d-211">[![建立使用特定 SQL 陳述式的方法](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-211">[![Create the Method Using an Ad-Hoc SQL Statement](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image18.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image17.png)</span></span>

<span data-ttu-id="e1e8d-212">**圖 7**： 建立方法使用特定 SQL 陳述式 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-212">**Figure 7**: Create the Method Using an Ad-Hoc SQL Statement ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image19.png))</span></span>


<span data-ttu-id="e1e8d-213">[![SQL 陳述式會傳回資料列](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-213">[![The SQL Statement Returns Rows](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image21.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image20.png)</span></span>

<span data-ttu-id="e1e8d-214">**圖 8**: SQL 陳述式傳回資料列 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-214">**Figure 8**: The SQL Statement Returns Rows ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image22.png))</span></span>


<span data-ttu-id="e1e8d-215">精靈的下一個畫面會提示我們輸入的查詢來使用。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-215">The next wizard screen prompts us for the query to use.</span></span> <span data-ttu-id="e1e8d-216">若要傳回每個類別 s `CategoryID`， `CategoryName`，並`Description`使用下列項目欄位，以及在類別中，相關聯的產品數目`SELECT`陳述式：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-216">To return each category s `CategoryID`, `CategoryName`, and `Description` fields, along with the number of products associated with the category, use the following `SELECT` statement:</span></span>


[!code-sql[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample7.sql)]


<span data-ttu-id="e1e8d-217">[![指定要使用的查詢](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-217">[![Specify the Query to Use](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image24.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image23.png)</span></span>

<span data-ttu-id="e1e8d-218">**圖 9**： 指定要使用的查詢 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-218">**Figure 9**: Specify the Query to Use ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image25.png))</span></span>


<span data-ttu-id="e1e8d-219">請注意 計算與分類相關聯的產品數目的子查詢的別名為`NumberOfProducts`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-219">Note that the subquery that computes the number of products associated with the category is aliased as `NumberOfProducts`.</span></span> <span data-ttu-id="e1e8d-220">此命名的相符項目會導致此相關聯的子查詢所傳回的值`CategoriesDataTable`s`NumberOfProducts`資料行。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-220">This naming match causes the value returned by this subquery to be associated with the `CategoriesDataTable` s `NumberOfProducts` column.</span></span>

<span data-ttu-id="e1e8d-221">輸入此查詢之後, 的最後一個步驟是選擇新方法的名稱。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-221">After entering this query, the last step is to choose the name for the new method.</span></span> <span data-ttu-id="e1e8d-222">使用`FillWithNumberOfProducts`和`GetCategoriesAndNumberOfProducts`填滿的 DataTable 和傳回 DataTable 模式，分別。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-222">Use `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span>


<span data-ttu-id="e1e8d-223">[![新的 TableAdapter 的方法 FillWithNumberOfProducts 名稱和 GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-223">[![Name the New TableAdapter s Methods FillWithNumberOfProducts and GetCategoriesAndNumberOfProducts](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image27.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image26.png)</span></span>

<span data-ttu-id="e1e8d-224">**圖 10**： 命名新的 tableadapter 方法`FillWithNumberOfProducts`並`GetCategoriesAndNumberOfProducts`([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-224">**Figure 10**: Name the New TableAdapter s Methods `FillWithNumberOfProducts` and `GetCategoriesAndNumberOfProducts` ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image28.png))</span></span>


<span data-ttu-id="e1e8d-225">此時資料存取層已經擴充成包含每個分類的產品數目。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-225">At this point the Data Access Layer has been extended to include the number of products per category.</span></span> <span data-ttu-id="e1e8d-226">因為我們所有的展示層所有將來電路由到不同的商務邏輯層透過 DAL 我們需要加入相對應`GetCategoriesAndNumberOfProducts`方法，以`CategoriesBLL`類別：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-226">Since all our presentation layer routes all calls to the DAL through a separate Business Logic Layer we need to add a corresponding `GetCategoriesAndNumberOfProducts` method to the `CategoriesBLL` class:</span></span>


[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample8.cs)]

<span data-ttu-id="e1e8d-227">我們重新就緒的 DAL 和完整的 BLL，此資料要繫結`Categories`中的重複項`CategoriesAndProducts.aspx`！</span><span class="sxs-lookup"><span data-stu-id="e1e8d-227">With the DAL and BLL complete, we re ready to bind this data to the `Categories` Repeater in `CategoriesAndProducts.aspx`!</span></span> <span data-ttu-id="e1e8d-228">如果您已建立 ObjectDataSource 從判斷重複項的數字的中的產品`ItemDataBound`事件處理常式 區段中，刪除這個 ObjectDataSource，並移除重複項的`DataSourceID`屬性也設定; unwireRepeater s`ItemDataBound`事件的事件處理常式，藉由移除`Handles Categories.OnItemDataBound`ASP.NET 程式碼後置類別中的語法。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-228">If you ve already created an ObjectDataSource for the Repeater from the Determining the Number of Products in the `ItemDataBound` Event Handler section, delete this ObjectDataSource and remove the Repeater s `DataSourceID` property setting; also unwire the Repeater s `ItemDataBound` event from the event handler by removing the `Handles Categories.OnItemDataBound` syntax in the ASP.NET code-behind class.</span></span>

<span data-ttu-id="e1e8d-229">傳回在其原始狀態中重複項，加上名為新 ObjectDataSource`CategoriesDataSource`透過 Repeater s 智慧標籤。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-229">With the Repeater back in its original state, add a new ObjectDataSource named `CategoriesDataSource` via the Repeater s smart tag.</span></span> <span data-ttu-id="e1e8d-230">設定要使用 ObjectDataSource`CategoriesBLL`類別，而不需要使用它，但`GetCategories()`方法中，有它使用`GetCategoriesAndNumberOfProducts()`改為 （請參閱 圖 11）。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-230">Configure the ObjectDataSource to use the `CategoriesBLL` class, but instead of having it use the `GetCategories()` method, have it use `GetCategoriesAndNumberOfProducts()` instead (see Figure 11).</span></span>


<span data-ttu-id="e1e8d-231">[![設定為使用 GetCategoriesAndNumberOfProducts 方法的 ObjectDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-231">[![Configure the ObjectDataSource to Use the GetCategoriesAndNumberOfProducts Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image30.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image29.png)</span></span>

<span data-ttu-id="e1e8d-232">**圖 11**： 設定要使用 ObjectDataSource`GetCategoriesAndNumberOfProducts`方法 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-232">**Figure 11**: Configure the ObjectDataSource to Use the `GetCategoriesAndNumberOfProducts` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image31.png))</span></span>


<span data-ttu-id="e1e8d-233">接下來，更新`ItemTemplate`以便 LinkButton s`Text`屬性以宣告方式使用資料繫結語法所指派，且同時包含`CategoryName`和`NumberOfProducts`資料欄位。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-233">Next, update the `ItemTemplate` so that the LinkButton s `Text` property is declaratively assigned using databinding syntax and includes both the `CategoryName` and `NumberOfProducts` data fields.</span></span> <span data-ttu-id="e1e8d-234">中繼器的完整宣告式標記和`CategoriesDataSource`ObjectDataSource 遵循：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-234">The complete declarative markup for the Repeater and the `CategoriesDataSource` ObjectDataSource follow:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample9.aspx)]

<span data-ttu-id="e1e8d-235">藉由更新以包含 DAL 轉譯的輸出`NumberOfProducts`資料行是使用相同`ItemDataBound`事件處理常式方法 (回頭查看畫面的 圖 4 顯示類別目錄名稱和產品數目中繼器的螢幕擷取)。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-235">The output rendered by updating the DAL to include a `NumberOfProducts` column is the same as using the `ItemDataBound` event handler approach (refer back to Figure 4 to see a screen shot of the Repeater showing the category names and number of products).</span></span>

## <a name="step-3-displaying-the-selected-category-s-products"></a><span data-ttu-id="e1e8d-236">步驟 3： 顯示所選類別目錄產品</span><span class="sxs-lookup"><span data-stu-id="e1e8d-236">Step 3: Displaying the Selected Category s Products</span></span>

<span data-ttu-id="e1e8d-237">現在我們有`Categories`顯示以及產品的數目的類別目錄的清單，每個類別中的重複項。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-237">At this point we have the `Categories` Repeater displaying the list of categories along with the number of products in each category.</span></span> <span data-ttu-id="e1e8d-238">中繼器每個類別目錄，按一下時，會導致回傳，在這點我們使用了 LinkButton 顯示選取之類別目錄中的這些產品需要`CategoryProducts`DataList。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-238">The Repeater uses a LinkButton for each category that, when clicked, causes a postback, at which point we need to display those products for the selected category in the `CategoryProducts` DataList.</span></span>

<span data-ttu-id="e1e8d-239">我們面臨的其中一項挑戰是如何顯示這些產品所選類別的 DataList。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-239">One challenge facing us is how to have the DataList display just those products for the selected category.</span></span> <span data-ttu-id="e1e8d-240">在 [主要/詳細說明使用具有詳細資料 DetailsView 可選取主要 GridView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md)無法選取我們了解如何建置 GridView 其資料列的教學課程、 所選取的資料列 s 的詳細資料顯示在相同的頁面上的 DetailsView。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-240">In the [Master/Detail Using a Selectable Master GridView with a Details DetailsView](../masterdetail/master-detail-using-a-selectable-master-gridview-with-a-details-detailview-cs.md) tutorial we saw how to build a GridView whose rows could be selected, with the selected row s details being displayed in a DetailsView on the same page.</span></span> <span data-ttu-id="e1e8d-241">GridView ObjectDataSource 傳回使用的所有產品的相關資訊`ProductsBLL`s`GetProducts()`方法並 DetailsView 的 ObjectDataSource 擷取所選的產品的使用資訊`GetProductsByProductID(productID)`方法。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-241">The GridView s ObjectDataSource returned information about all products using the `ProductsBLL` s `GetProducts()` method while the DetailsView s ObjectDataSource retrieved information about the selected product using the `GetProductsByProductID(productID)` method.</span></span> <span data-ttu-id="e1e8d-242">*`productID`* 參數值以宣告方式將它與 GridView s 的值關聯提供`SelectedValue`屬性。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-242">The *`productID`* parameter value was provided declaratively by associating it with the value of the GridView s `SelectedValue` property.</span></span> <span data-ttu-id="e1e8d-243">不幸的是，重複項並沒有`SelectedValue`屬性並不能做為參數的來源。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-243">Unfortunately, the Repeater does not have a `SelectedValue` property and cannot serve as a parameter source.</span></span>

> [!NOTE]
> <span data-ttu-id="e1e8d-244">這是其中一項中使用 LinkButton 時，會出現這些挑戰。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-244">This is one of those challenges that appear when using the LinkButton in a Repeater.</span></span> <span data-ttu-id="e1e8d-245">我們使用超連結來傳入`CategoryID`透過查詢字串相反的我們可以使用該查詢字串欄位做為來源參數 s 的值。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-245">Had we used a hyperlink to pass in the `CategoryID` through the querystring instead, we could use that QueryString field as the source for the parameter s value.</span></span>


<span data-ttu-id="e1e8d-246">我們會擔心缺乏之前`SelectedValue`的重複項的屬性，可讓 s 先繫結至 ObjectDataSource 的 DataList，並指定其`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-246">Before we worry about the lack of a `SelectedValue` property for the Repeater, though, let s first bind the DataList to an ObjectDataSource and specify its `ItemTemplate`.</span></span>

<span data-ttu-id="e1e8d-247">從 DataList s 智慧標籤，選擇 新增名為新 ObjectDataSource`CategoryProductsDataSource`並將它設定為使用`ProductsBLL`類別的`GetProductsByCategoryID(categoryID)`方法。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-247">From the DataList s smart tag, opt to add a new ObjectDataSource named `CategoryProductsDataSource` and configure it to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method.</span></span> <span data-ttu-id="e1e8d-248">因為在本教學課程 DataList 提供唯讀介面，放心地設定下拉式清單中的插入、 更新和刪除 （無） 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-248">Since the DataList in this tutorial offers a read-only interface, feel free to set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>


<span data-ttu-id="e1e8d-249">[![設定為使用 ProductsBLL 類別的 GetProductsByCategoryID(categoryID) 方法的 ObjectDataSource](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-249">[![Configure the ObjectDataSource to Use ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image33.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image32.png)</span></span>

<span data-ttu-id="e1e8d-250">**圖 12**： 設定要使用 ObjectDataSource`ProductsBLL`類別 s`GetProductsByCategoryID(categoryID)`方法 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-250">**Figure 12**: Configure the ObjectDataSource to Use `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image34.png))</span></span>


<span data-ttu-id="e1e8d-251">由於`GetProductsByCategoryID(categoryID)`方法所預期的輸入的參數 (*`categoryID`*)，設定資料來源精靈可讓我們指定的參數 s 的來源。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-251">Since the `GetProductsByCategoryID(categoryID)` method expects an input parameter (*`categoryID`*), the Configure Data Source wizard allows us to specify the parameter s source.</span></span> <span data-ttu-id="e1e8d-252">已分類已列在 GridView 或 DataList，d 我們設定參數來源下拉式清單控制項和到 ControlID `ID` Web 控制項的資料。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-252">Had the categories been listed in a GridView or a DataList, we d set the Parameter source drop-down list to Control and the ControlID to the `ID` of the data Web control.</span></span> <span data-ttu-id="e1e8d-253">不過，由於 Repeater 缺少`SelectedValue`屬性不能做為參數的來源。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-253">However, since the Repeater lacks a `SelectedValue` property it cannot be used as a parameter source.</span></span> <span data-ttu-id="e1e8d-254">如果您核取，您會發現 [ControlID] 下拉式清單只包含一個控制項`ID``CategoryProducts`，則`ID`的 DataList。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-254">If you check, you'll find that the ControlID drop-down list only contains one control `ID``CategoryProducts`, the `ID` of the DataList.</span></span>

<span data-ttu-id="e1e8d-255">現在，設定參數來源下拉式清單為 None。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-255">For now, set the Parameter source drop-down list to None.</span></span> <span data-ttu-id="e1e8d-256">就會出現以程式設計方式將指派此參數值，當按一下 LinkButton 中繼器中的類別。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-256">We'll end up programmatically assigning this parameter value when a category LinkButton is clicked in the Repeater.</span></span>


<span data-ttu-id="e1e8d-257">[![請勿指定 categoryID 參數參數來源](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-257">[![Do Not Specify a Parameter Source for the categoryID Parameter](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image36.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image35.png)</span></span>

<span data-ttu-id="e1e8d-258">**圖 13**： 未指定參數來源*`categoryID`* 參數 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-258">**Figure 13**: Do Not Specify a Parameter Source for the *`categoryID`* Parameter ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image37.png))</span></span>


<span data-ttu-id="e1e8d-259">完成設定資料來源精靈之後，Visual Studio 會自動產生 DataList 的`ItemTemplate`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-259">After completing the Configure Data Source wizard, Visual Studio auto-generates the DataList s `ItemTemplate`.</span></span> <span data-ttu-id="e1e8d-260">取代此預設值`ItemTemplate`範本與我們先前的教學課程中使用; 此外，設定 DataList 的`RepeatColumns`屬性設為 2。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-260">Replace this default `ItemTemplate` with the template we used in the preceding tutorial; also, set the DataList s `RepeatColumns` property to 2.</span></span> <span data-ttu-id="e1e8d-261">進行這些變更後您 DataList 和其相關聯的 ObjectDataSource 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-261">After making these changes the declarative markup for your DataList and its associated ObjectDataSource should look like the following:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample10.aspx)]

<span data-ttu-id="e1e8d-262">目前， `CategoryProductsDataSource` ObjectDataSource s *`categoryID`* 永遠不會設定參數，以便檢視頁面時，會不顯示任何產品。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-262">Currently, the `CategoryProductsDataSource` ObjectDataSource s *`categoryID`* parameter is never set, so no products are displayed when viewing the page.</span></span> <span data-ttu-id="e1e8d-263">我們要做為將此參數值，設定根據`CategoryID`中繼器中的已按下 類別目錄。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-263">What we need to do is have this parameter value set based on the `CategoryID` of the clicked category in the Repeater.</span></span> <span data-ttu-id="e1e8d-264">這引進了兩個挑戰： 首先，執行我們如何判斷當中繼器 s 中的 LinkButton`ItemTemplate`已按下; 和第二個，我們要如何判斷`CategoryID`其 LinkButton 已按下的對應類別目錄？</span><span class="sxs-lookup"><span data-stu-id="e1e8d-264">This introduces two challenges: first, how do we determine when a LinkButton in the Repeater s `ItemTemplate` has been clicked; and second, how can we determine the `CategoryID` of the corresponding category whose LinkButton was clicked?</span></span>

<span data-ttu-id="e1e8d-265">例如 「 按鈕 」 和 「 ImageButton 控制項 LinkButton 已`Click`事件和[`Command`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx)。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-265">The LinkButton like the Button and ImageButton controls has a `Click` event and a [`Command` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.command.aspx).</span></span> <span data-ttu-id="e1e8d-266">`Click`活動的設計僅僅 LinkButton 已按下。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-266">The `Click` event is designed to simply note that the LinkButton has been clicked.</span></span> <span data-ttu-id="e1e8d-267">有些時候，不過，除了 LinkButton 已按下您會看到我們也需要將一些額外的資訊傳遞至事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-267">At times, however, in addition to noting that the LinkButton has been clicked we also need to pass some extra information to the event handler.</span></span> <span data-ttu-id="e1e8d-268">如果此情況下，使用的 LinkButton 秒[ `CommandName` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx)並[ `CommandArgument` ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx)屬性可指定此額外資訊。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-268">If this is the case, the LinkButton s [`CommandName`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandname.aspx) and [`CommandArgument`](https://msdn.microsoft.com/library/system.web.ui.webcontrols.linkbutton.commandargument.aspx) properties can be assigned this extra information.</span></span> <span data-ttu-id="e1e8d-269">接下來，當按一下 LinkButton，其`Command`引發事件 (而不是其`Click`事件) 和事件處理常式傳遞的值`CommandName`和`CommandArgument`屬性。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-269">Then, when the LinkButton is clicked, its `Command` event fires (instead of its `Click` event) and the event handler is passed the values of the `CommandName` and `CommandArgument` properties.</span></span>

<span data-ttu-id="e1e8d-270">當`Command`事件從 Repeater，Repeater s 中的範本內引發[`ItemCommand`事件](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx)就會引發，並傳遞`CommandName`和`CommandArgument`按一下 LinkButton 的值 (或按鈕或ImageButton)。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-270">When a `Command` event is raised from within a template in the Repeater, the Repeater s [`ItemCommand` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.repeater.itemcommand.aspx) fires and is passed the `CommandName` and `CommandArgument` values of the clicked LinkButton (or Button or ImageButton).</span></span> <span data-ttu-id="e1e8d-271">因此，若要判斷 LinkButton 中繼器中的類別時已按下，我們需要執行下列作業：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-271">Therefore, to determine when a category LinkButton in the Repeater has been clicked, we need to do the following:</span></span>

1. <span data-ttu-id="e1e8d-272">設定`CommandName`屬性中 Repeater 的 LinkButton`ItemTemplate`為某個值 (我使用 ListProducts)。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-272">Set the `CommandName` property of the LinkButton in the Repeater s `ItemTemplate` to some value (I ve used ListProducts ).</span></span> <span data-ttu-id="e1e8d-273">藉由設定這`CommandName`的值，LinkButton 的`Command`LinkButton 已按下時，就會引發事件。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-273">By setting this `CommandName` value, the LinkButton s `Command` event fires when the LinkButton is clicked.</span></span>
2. <span data-ttu-id="e1e8d-274">設定使用的 LinkButton 秒`CommandArgument`屬性設為值的目前項目的`CategoryID`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-274">Set the LinkButton s `CommandArgument` property to the value of the current item s `CategoryID`.</span></span>
3. <span data-ttu-id="e1e8d-275">建立事件處理常式，如 Repeater 的`ItemCommand`事件。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-275">Create an event handler for the Repeater s `ItemCommand` event.</span></span> <span data-ttu-id="e1e8d-276">在事件處理常式中，設定`CategoryProductsDataSource`ObjectDataSource s`CategoryID`參數設為值的傳入`CommandArgument`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-276">In the event handler, set the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span>

<span data-ttu-id="e1e8d-277">下列`ItemTemplate`類別重複項的標記實作步驟 1 和 2。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-277">The following `ItemTemplate` markup for the Categories Repeater implements steps 1 and 2.</span></span> <span data-ttu-id="e1e8d-278">請注意如何`CommandArgument`值會指派資料項目的`CategoryID`使用資料繫結語法：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-278">Note how the `CommandArgument` value is assigned the data item s `CategoryID` using databinding syntax:</span></span>


[!code-aspx[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample11.aspx)]

<span data-ttu-id="e1e8d-279">每當建立`ItemCommand`最好一律先檢查傳入的事件處理常式`CommandName`值，因為*任何*`Command`引發事件*任何*按鈕、 LinkButton，或ImageButton Repeater 內會導致`ItemCommand`引發的事件。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-279">Whenever creating an `ItemCommand` event handler it is prudent to always first check the incoming `CommandName` value because *any* `Command` event raised by *any* Button, LinkButton, or ImageButton within the Repeater will cause the `ItemCommand` event to fire.</span></span> <span data-ttu-id="e1e8d-280">雖然我們目前只有一個這類 LinkButton 現在，未來我們 （或另一個開發人員在我們的團隊） 可能會額外的按鈕 Web 將控制項加入至 Repeater，按一下時，會引發相同`ItemCommand`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-280">While we currently only have one such LinkButton now, in the future we (or another developer on our team) might add additional button Web controls to the Repeater that, when clicked, raises the same `ItemCommand` event handler.</span></span> <span data-ttu-id="e1e8d-281">因此，它最好隨時確定您檢查`CommandName`屬性，然後如果個比對預期的值只繼續您的程式設計邏輯。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-281">Therefore, it s best to always make sure you check the `CommandName` property and only proceed with your programmatic logic if it matches up to the value expected.</span></span>

<span data-ttu-id="e1e8d-282">在確定傳入`CommandName`值等於 ListProducts，然後將指派的事件處理常式`CategoryProductsDataSource`ObjectDataSource s`CategoryID`參數設為值的傳入`CommandArgument`。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-282">After ensuring that the passed-in `CommandName` value equals ListProducts, the event handler then assigns the `CategoryProductsDataSource` ObjectDataSource s `CategoryID` parameter to the value of the passed-in `CommandArgument`.</span></span> <span data-ttu-id="e1e8d-283">這項修改為 ObjectDataSource 的`SelectParameters`會自動導致 DataList 重新本身繫結至資料來源，顯示新選取的分類的產品。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-283">This modification to the ObjectDataSource s `SelectParameters` automatically causes the DataList to rebind itself to the data source, showing the products for the newly selected category.</span></span>


[!code-csharp[Main](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/samples/sample12.cs)]

<span data-ttu-id="e1e8d-284">使用這些新增項目，在本教學課程已完成 ！</span><span class="sxs-lookup"><span data-stu-id="e1e8d-284">With these additions, our tutorial is complete!</span></span> <span data-ttu-id="e1e8d-285">請花一點時間瀏覽器中測試它。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-285">Take a moment to test it out in a browser.</span></span> <span data-ttu-id="e1e8d-286">第一次造訪網頁時，圖 14 顯示的畫面。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-286">Figure 14 shows the screen when first visiting the page.</span></span> <span data-ttu-id="e1e8d-287">因為類別目錄尚未選取，則會不顯示任何產品。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-287">Since a category has yet to be selected, no products are displayed.</span></span> <span data-ttu-id="e1e8d-288">按一下類別，產生，例如產品類別目錄，在兩個資料行] 檢視中顯示這些產品 （請參閱 [圖 15）。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-288">Clicking on a category, such as Produce, displays those products in the Product category in a two-column view (see Figure 15).</span></span>


<span data-ttu-id="e1e8d-289">[![沒有產品會顯示當第一次瀏覽頁面](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-289">[![No Products are Displayed When First Visiting the Page](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image39.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image38.png)</span></span>

<span data-ttu-id="e1e8d-290">**圖 14**： 否產品會顯示當第一次瀏覽頁面 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-290">**Figure 14**: No Products are Displayed When First Visiting the Page ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image40.png))</span></span>


<span data-ttu-id="e1e8d-291">[![按一下 產生類別目錄清單右邊的比對的產品](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-291">[![Clicking the Produce Category Lists the Matching Products to the Right](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image42.png)](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image41.png)</span></span>

<span data-ttu-id="e1e8d-292">**圖 15**： 按一下 [產生] 類別列出比對產品向右 ([按一下以檢視完整大小的影像](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png))</span><span class="sxs-lookup"><span data-stu-id="e1e8d-292">**Figure 15**: Clicking the Produce Category Lists the Matching Products to the Right ([Click to view full-size image](master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs/_static/image43.png))</span></span>


## <a name="summary"></a><span data-ttu-id="e1e8d-293">總結</span><span class="sxs-lookup"><span data-stu-id="e1e8d-293">Summary</span></span>

<span data-ttu-id="e1e8d-294">如我們所見本教學課程和上例中，主版/詳細報告可以分散到兩個頁面，或其中一個彙總。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-294">As we saw in this tutorial and the preceding one, master/detail reports can be spread out across two pages, or consolidated on one.</span></span> <span data-ttu-id="e1e8d-295">在單一頁面上顯示主版/詳細資料報表，不過，導入了一些有關的挑戰最主要的版面配置和分頁上的詳細資訊記錄。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-295">Displaying a master/details report on a single page, however, introduces some challenges on how best to layout the master and details records on the page.</span></span> <span data-ttu-id="e1e8d-296">在 *主要/詳細說明使用具有詳細資料 DetailsView 可選取主要 GridView*教學課程，我們必須顯示上述的主要記錄的詳細資訊記錄; 在本教學課程使用 CSS 技巧有要的主要記錄浮點數詳細資料的左方。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-296">In the *Master/Detail Using a Selectable Master GridView with a Details DetailsView* tutorial we had the details records appear above the master records; in this tutorial we used CSS techniques to have the master records float to the left of the details.</span></span>

<span data-ttu-id="e1e8d-297">以及顯示主版/詳細報告，我們也有機會將探討如何擷取的方式來執行伺服器端邏輯的 LinkButton （或按鈕或 ImageButton） 按一下從與每個類別目錄相關聯的產品數目重複項。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-297">Along with displaying master/details reports, we also had the opportunity to explore how to retrieve the number of products associated with each category as well as how to perform server-side logic when a LinkButton (or Button or ImageButton) is clicked from within a Repeater.</span></span>

<span data-ttu-id="e1e8d-298">本教學課程中完成主版/詳細報告我們的檢查使用 DataList 與重複項。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-298">This tutorial completes our examination of master/detail reports with the DataList and Repeater.</span></span> <span data-ttu-id="e1e8d-299">我們的下一個教學課程一組將說明如何加入編輯和刪除 DataList 控制項的功能。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-299">Our next set of tutorials will illustrate how to add editing and deleting capabilities to the DataList control.</span></span>

<span data-ttu-id="e1e8d-300">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="e1e8d-300">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="e1e8d-301">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="e1e8d-301">Further Reading</span></span>

<span data-ttu-id="e1e8d-302">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="e1e8d-302">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="e1e8d-303">[Floatutorial](http://css.maxdesign.com.au/floatutorial/)浮動 CSS 項目，使用 CSS 的教學課程</span><span class="sxs-lookup"><span data-stu-id="e1e8d-303">[Floatutorial](http://css.maxdesign.com.au/floatutorial/) a tutorial on floating CSS elements with CSS</span></span>
- <span data-ttu-id="e1e8d-304">[CSS 定位](http://www.brainjar.com/css/positioning/)上定位項目使用 CSS 的詳細資訊</span><span class="sxs-lookup"><span data-stu-id="e1e8d-304">[CSS Positioning](http://www.brainjar.com/css/positioning/) more information on positioning elements with CSS</span></span>
- <span data-ttu-id="e1e8d-305">[配置出內容與 HTML](http://www.w3schools.com/html/html_layout.asp)使用`<table>`s 和其他的 HTML 項目來定位</span><span class="sxs-lookup"><span data-stu-id="e1e8d-305">[Laying Out Content with HTML](http://www.w3schools.com/html/html_layout.asp) using `<table>` s and other HTML elements for positioning</span></span>

## <a name="about-the-author"></a><span data-ttu-id="e1e8d-306">關於作者</span><span class="sxs-lookup"><span data-stu-id="e1e8d-306">About the Author</span></span>

<span data-ttu-id="e1e8d-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-307">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e1e8d-308">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-308">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e1e8d-309">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-309">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="e1e8d-310">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-310">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="e1e8d-311">或透過他的部落格，這位於[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-311">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="e1e8d-312">特別感謝</span><span class="sxs-lookup"><span data-stu-id="e1e8d-312">Special Thanks To</span></span>

<span data-ttu-id="e1e8d-313">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-313">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e1e8d-314">本教學課程中的潛在客戶檢閱者已 Zack Jones。</span><span class="sxs-lookup"><span data-stu-id="e1e8d-314">Lead reviewer for this tutorial was Zack Jones.</span></span> <span data-ttu-id="e1e8d-315">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="e1e8d-315">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e1e8d-316">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-316">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e1e8d-317">[上一頁](master-detail-filtering-acess-two-pages-datalist-cs.md)
> [下一頁](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span><span class="sxs-lookup"><span data-stu-id="e1e8d-317">[Previous](master-detail-filtering-acess-two-pages-datalist-cs.md)
[Next](master-detail-filtering-with-a-dropdownlist-datalist-vb.md)</span></span>
