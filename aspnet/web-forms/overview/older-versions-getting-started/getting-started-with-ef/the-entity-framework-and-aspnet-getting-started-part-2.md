---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
title: 開始使用 Entity Framework 4.0 Database 中第一次與 ASP.NET 4 Web Form-第 2 部分 |Microsoft Docs
author: tdykstra
description: Contoso 大學範例 web 應用程式會示範如何建立使用 Entity Framework 的 ASP.NET Web Forms 應用程式。 範例應用程式是...
ms.author: aspnetcontent
manager: wpickett
ms.date: 12/03/2010
ms.topic: article
ms.assetid: fb63a326-a4ae-4b0c-a4f5-412327197216
ms.technology: dotnet-webforms
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2
msc.type: authoredcontent
ms.openlocfilehash: 476f3e45608bf79a6d2665424eba09cbfccd78fc
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/03/2018
ms.locfileid: "37371099"
---
<a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-2"></a><span data-ttu-id="80b1e-104">開始使用 Entity Framework 4.0 Database 中第一次和 ASP.NET 4 Web Form-第 2 部分</span><span class="sxs-lookup"><span data-stu-id="80b1e-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 2</span></span>
====================
<span data-ttu-id="80b1e-105">藉由[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="80b1e-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="80b1e-106">Contoso 大學範例 web 應用程式會示範如何建立使用 Entity Framework 4.0 和 Visual Studio 2010 的 ASP.NET Web Forms 應用程式。</span><span class="sxs-lookup"><span data-stu-id="80b1e-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="80b1e-107">教學課程系列的相關資訊，請參閱[系列的第一個教學課程](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="80b1e-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>


## <a name="the-entitydatasource-control"></a><span data-ttu-id="80b1e-108">EntityDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="80b1e-108">The EntityDataSource Control</span></span>

<span data-ttu-id="80b1e-109">在上一個教學課程中，您建立網站、 資料庫和資料模型。</span><span class="sxs-lookup"><span data-stu-id="80b1e-109">In the previous tutorial you created a web site, a database, and a data model.</span></span> <span data-ttu-id="80b1e-110">在本教學課程中您使用`EntityDataSource`ASP.NET 提供為了讓您輕鬆地使用 Entity Framework 資料模型的控制項。</span><span class="sxs-lookup"><span data-stu-id="80b1e-110">In this tutorial you work with the `EntityDataSource` control that ASP.NET provides in order to make it easy to work with an Entity Framework data model.</span></span> <span data-ttu-id="80b1e-111">您會建立`GridView`控制項的顯示和編輯學生資料`DetailsView`控制項加入新的學生，和`DropDownList`選取部門 （這稍後會用來顯示相關聯的課程） 控制項。</span><span class="sxs-lookup"><span data-stu-id="80b1e-111">You'll create a `GridView` control for displaying and editing student data, a `DetailsView` control for adding new students, and a `DropDownList` control for selecting a department (which you'll use later for displaying associated courses).</span></span>

<span data-ttu-id="80b1e-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-112">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image1.png)</span></span>

<span data-ttu-id="80b1e-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-113">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image3.png)</span></span>

<span data-ttu-id="80b1e-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-114">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image5.png)</span></span>

<span data-ttu-id="80b1e-115">請注意，此應用程式中您不是輸入將驗證新增至頁面，更新資料庫，一些錯誤處理不會如需要在實際執行的應用程式的強固。</span><span class="sxs-lookup"><span data-stu-id="80b1e-115">Note that in this application you won't be adding input validation to pages that update the database, and some of the error handling will not be as robust as would be required in a production application.</span></span> <span data-ttu-id="80b1e-116">會保留本教學課程著重於 Entity Framework 會防止其得太長。</span><span class="sxs-lookup"><span data-stu-id="80b1e-116">That keeps the tutorial focused on the Entity Framework and keeps it from getting too long.</span></span> <span data-ttu-id="80b1e-117">如需如何將這些功能新增至您的應用程式的詳細資訊，請參閱[驗證使用者輸入在 ASP.NET Web Pages](https://msdn.microsoft.com/library/7kh55542.aspx)並[處理 ASP.NET 網頁和應用程式中的錯誤](https://msdn.microsoft.com/library/w16865z6.aspx)。</span><span class="sxs-lookup"><span data-stu-id="80b1e-117">For details about how to add these features to your application, see [Validating User Input in ASP.NET Web Pages](https://msdn.microsoft.com/library/7kh55542.aspx) and [Error Handling in ASP.NET Pages and Applications](https://msdn.microsoft.com/library/w16865z6.aspx).</span></span>

## <a name="adding-and-configuring-the-entitydatasource-control"></a><span data-ttu-id="80b1e-118">加入和設定 EntityDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="80b1e-118">Adding and Configuring the EntityDataSource Control</span></span>

<span data-ttu-id="80b1e-119">一開始要先設定`EntityDataSource`讀取控制項`Person`實體`People`實體集。</span><span class="sxs-lookup"><span data-stu-id="80b1e-119">You'll begin by configuring an `EntityDataSource` control to read `Person` entities from the `People` entity set.</span></span>

<span data-ttu-id="80b1e-120">請確定您已開啟的 Visual Studio，以及您建立第 1 部分中，您正在使用的專案。</span><span class="sxs-lookup"><span data-stu-id="80b1e-120">Make sure you have Visual Studio open and that you're working with the project you created in part 1.</span></span> <span data-ttu-id="80b1e-121">如果您建立資料模型，或自上次變更您對它之後，尚未建置專案，現在就建置專案。</span><span class="sxs-lookup"><span data-stu-id="80b1e-121">If you haven't built the project since you created the data model or since the last change you made to it, build the project now.</span></span> <span data-ttu-id="80b1e-122">資料模型變更都不會提供給設計工具之前建置專案。</span><span class="sxs-lookup"><span data-stu-id="80b1e-122">Changes to the data model are not made available to the designer until the project is built.</span></span>

<span data-ttu-id="80b1e-123">建立新的網頁上使用**使用主版頁面的 Web Form**範本，並將它命名*Students.aspx*。</span><span class="sxs-lookup"><span data-stu-id="80b1e-123">Create a new web page using the **Web Form using Master Page** template, and name it *Students.aspx*.</span></span>

<span data-ttu-id="80b1e-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-124">[![Image23](the-entity-framework-and-aspnet-getting-started-part-2/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image7.png)</span></span>

<span data-ttu-id="80b1e-125">指定*Site.Master*作為主版頁面。</span><span class="sxs-lookup"><span data-stu-id="80b1e-125">Specify *Site.Master* as the master page.</span></span> <span data-ttu-id="80b1e-126">所有您建立這些教學課程中的頁面將會使用此主版頁面。</span><span class="sxs-lookup"><span data-stu-id="80b1e-126">All of the pages you create for these tutorials will use this master page.</span></span>

<span data-ttu-id="80b1e-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-127">[![Image24](the-entity-framework-and-aspnet-getting-started-part-2/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image9.png)</span></span>

<span data-ttu-id="80b1e-128">在 **來源**檢視、 新增`h2`標題來`Content`控制項，名為`Content2`，如下列範例所示：</span><span class="sxs-lookup"><span data-stu-id="80b1e-128">In **Source** view, add an `h2` heading to the `Content` control named `Content2`, as shown in the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample1.aspx)]

<span data-ttu-id="80b1e-129">從**資料**索引標籤**工具箱**，拖曳`EntityDataSource`控制項加入頁面，將其放在標題下方，並變更至識別碼`StudentsEntityDataSource`:</span><span class="sxs-lookup"><span data-stu-id="80b1e-129">From the **Data** tab of the **Toolbox**, drag an `EntityDataSource` control to the page, drop it below the heading, and change the ID to `StudentsEntityDataSource`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample2.aspx)]

<span data-ttu-id="80b1e-130">若要切換**設計**檢視，按一下 資料來源控制項的智慧標籤，然後按一下 **設定資料來源**來啟動**設定資料來源**精靈。</span><span class="sxs-lookup"><span data-stu-id="80b1e-130">Switch to **Design** view, click the data source control's smart tag, and then click **Configure Data Source** to launch the **Configure Data Source** wizard.</span></span>

<span data-ttu-id="80b1e-131">[![Image01](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-131">[![Image01](the-entity-framework-and-aspnet-getting-started-part-2/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image11.png)</span></span>

<span data-ttu-id="80b1e-132">在 **設定 ObjectContext**精靈步驟中，選取**SchoolEntities**做為值**具名的連接**，然後選取**SchoolEntities**作為**DefaultContainerName**值。</span><span class="sxs-lookup"><span data-stu-id="80b1e-132">In the **Configure ObjectContext** wizard step, select **SchoolEntities** as the value for **Named Connection**, and select **SchoolEntities** as the **DefaultContainerName** value.</span></span> <span data-ttu-id="80b1e-133">然後按 [下一步] 。</span><span class="sxs-lookup"><span data-stu-id="80b1e-133">Then click **Next**.</span></span>

<span data-ttu-id="80b1e-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-134">[![Image02](the-entity-framework-and-aspnet-getting-started-part-2/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image13.png)</span></span>

<span data-ttu-id="80b1e-135">注意： 如果您在此時收到下列對話方塊中，您必須建置專案後再繼續。</span><span class="sxs-lookup"><span data-stu-id="80b1e-135">Note: If you get the following dialog box at this point, you have to build the project before proceeding.</span></span>

<span data-ttu-id="80b1e-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-136">[![Image25](the-entity-framework-and-aspnet-getting-started-part-2/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image15.png)</span></span>

<span data-ttu-id="80b1e-137">在 **設定資料選取範圍**步驟中，選取**人**做為值**EntitySetName**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-137">In the **Configure Data Selection** step, select **People** as the value for **EntitySetName**.</span></span> <span data-ttu-id="80b1e-138">底下**選取**，請確定**選取 A** ll 核取方塊已選取。</span><span class="sxs-lookup"><span data-stu-id="80b1e-138">Under **Select**, make sure the **Select A** ll check box is selected.</span></span> <span data-ttu-id="80b1e-139">然後選取 啟用更新及刪除選項。</span><span class="sxs-lookup"><span data-stu-id="80b1e-139">Then select the options to enable update and delete.</span></span> <span data-ttu-id="80b1e-140">當您完成時，按一下**完成**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-140">When you're done, click **Finish**.</span></span>

<span data-ttu-id="80b1e-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-141">[![Image03](the-entity-framework-and-aspnet-getting-started-part-2/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image17.png)</span></span>

## <a name="configuring-database-rules-to-allow-deletion"></a><span data-ttu-id="80b1e-142">設定以允許刪除的資料庫規則</span><span class="sxs-lookup"><span data-stu-id="80b1e-142">Configuring Database Rules to Allow Deletion</span></span>

<span data-ttu-id="80b1e-143">您將會建立新的頁面，可讓使用者刪除的學生`Person`具有與其他資料表的三個關聯性的資料表 (`Course`， `StudentGrade`，和`OfficeAssignment`)。</span><span class="sxs-lookup"><span data-stu-id="80b1e-143">You'll be creating a page that lets users delete students from the `Person` table, which has three relationships with other tables (`Course`, `StudentGrade`, and `OfficeAssignment`).</span></span> <span data-ttu-id="80b1e-144">根據預設，資料庫會阻止您刪除資料列中的`Person`如果有其中一種其他資料表的相關資料列。</span><span class="sxs-lookup"><span data-stu-id="80b1e-144">By default, the database will prevent you from deleting a row in `Person` if there are related rows in one of the other tables.</span></span> <span data-ttu-id="80b1e-145">首先，您可以手動刪除相關的資料列，或者您可以設定要自動刪除它們，當您刪除的資料庫`Person`資料列。</span><span class="sxs-lookup"><span data-stu-id="80b1e-145">You can manually delete the related rows first, or you can configure the database to delete them automatically when you delete a `Person` row.</span></span> <span data-ttu-id="80b1e-146">在本教學課程的學生記錄，您將設定要自動刪除相關的資料的資料庫。</span><span class="sxs-lookup"><span data-stu-id="80b1e-146">For student records in this tutorial, you'll configure the database to delete the related data automatically.</span></span> <span data-ttu-id="80b1e-147">因為學生可以有相關的資料列只能在`StudentGrade`資料表中，您必須設定三個關聯性的其中之一。</span><span class="sxs-lookup"><span data-stu-id="80b1e-147">Because students can have related rows only in the `StudentGrade` table, you need to configure only one of the three relationships.</span></span>

<span data-ttu-id="80b1e-148">如果您使用*School.mdf*檔案下載會在本教學課程專案中，因為這些組態變更已完成，則可以略過本節。</span><span class="sxs-lookup"><span data-stu-id="80b1e-148">If you're using the *School.mdf* file that you downloaded from the project that goes with this tutorial, you can skip this section because these configuration changes have already been done.</span></span> <span data-ttu-id="80b1e-149">如果您執行指令碼建立資料庫，請執行下列程序來設定資料庫。</span><span class="sxs-lookup"><span data-stu-id="80b1e-149">If you created the database by running a script, configure the database by performing the following procedures.</span></span>

<span data-ttu-id="80b1e-150">在 **伺服器總管**，開啟您在第 1 部分中建立的資料庫圖表。</span><span class="sxs-lookup"><span data-stu-id="80b1e-150">In **Server Explorer**, open the database diagram that you created in part 1.</span></span> <span data-ttu-id="80b1e-151">以滑鼠右鍵按一下之間的關聯性`Person`並`StudentGrade`（資料表之間的行），然後選取**屬性**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-151">Right-click the relationship between `Person` and `StudentGrade` (the line between tables), and then select **Properties**.</span></span>

<span data-ttu-id="80b1e-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-152">[![Image04](the-entity-framework-and-aspnet-getting-started-part-2/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image19.png)</span></span>

<span data-ttu-id="80b1e-153">在**屬性** 視窗中，展開**INSERT 及 UPDATE 規格**並設定**DeleteRule**屬性設**Cascade**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-153">In the **Properties** window, expand **INSERT and UPDATE Specification** and set the **DeleteRule** property to **Cascade**.</span></span>

<span data-ttu-id="80b1e-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-154">[![Image05](the-entity-framework-and-aspnet-getting-started-part-2/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image21.png)</span></span>

<span data-ttu-id="80b1e-155">儲存並關閉圖表。</span><span class="sxs-lookup"><span data-stu-id="80b1e-155">Save and close the diagram.</span></span> <span data-ttu-id="80b1e-156">如果系統詢問您是否想要更新資料庫，按一下**是**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-156">If you're asked whether you want to update the database, click **Yes**.</span></span>

<span data-ttu-id="80b1e-157">若要確定此模型會保留在與資料庫正在進行同步的記憶體中的實體，您必須在資料模型中設定對應規則。</span><span class="sxs-lookup"><span data-stu-id="80b1e-157">To make sure that the model keeps entities that are in memory in sync with what the database is doing, you must set corresponding rules in the data model.</span></span> <span data-ttu-id="80b1e-158">開啟*SchoolModel.edmx*，以滑鼠右鍵按一下之間的關聯線`Person`並`StudentGrade`，然後選取**屬性**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-158">Open *SchoolModel.edmx*, right-click the association line between `Person` and `StudentGrade`, and then select **Properties**.</span></span>

<span data-ttu-id="80b1e-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-159">[![Image21](the-entity-framework-and-aspnet-getting-started-part-2/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image23.png)</span></span>

<span data-ttu-id="80b1e-160">在 **屬性**視窗中，將**End1 OnDelete**來**Cascade**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-160">In the **Properties** window, set **End1 OnDelete** to **Cascade**.</span></span>

<span data-ttu-id="80b1e-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-161">[![Image22](the-entity-framework-and-aspnet-getting-started-part-2/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image25.png)</span></span>

<span data-ttu-id="80b1e-162">儲存並關閉*SchoolModel.edmx*檔案，然後再重新建置專案。</span><span class="sxs-lookup"><span data-stu-id="80b1e-162">Save and close the *SchoolModel.edmx* file, and then rebuild the project.</span></span>

<span data-ttu-id="80b1e-163">一般情況下，當資料庫變更時，您會有如何同步處理模型的幾個選擇：</span><span class="sxs-lookup"><span data-stu-id="80b1e-163">In general, when the database changes, you have several choices for how to sync up the model:</span></span>

- <span data-ttu-id="80b1e-164">針對特定種類的變更 （例如新增或重新整理資料表、 檢視或預存程序），以滑鼠右鍵按一下設計工具，然後選取**從資料庫更新模型**才能自動讓設計工具進行變更。</span><span class="sxs-lookup"><span data-stu-id="80b1e-164">For certain kinds of changes (such as adding or refreshing tables, views, or stored procedures), right-click in the designer and select **Update Model from Database** to have the designer make the changes automatically.</span></span>
- <span data-ttu-id="80b1e-165">重新產生的資料模型。</span><span class="sxs-lookup"><span data-stu-id="80b1e-165">Regenerate the data model.</span></span>
- <span data-ttu-id="80b1e-166">進行手動更新，與下列類似。</span><span class="sxs-lookup"><span data-stu-id="80b1e-166">Make manual updates like this one.</span></span>

<span data-ttu-id="80b1e-167">在此情況下，您可能已重新產生模型，或重新整理資料表受到變更的關聯性，但是，您必須再次進行欄位名稱變更 (從`FirstName`至`FirstMidName`)。</span><span class="sxs-lookup"><span data-stu-id="80b1e-167">In this case, you could have regenerated the model or refreshed the tables affected by the relationship change, but then you'd have to make the field-name change again (from `FirstName` to `FirstMidName`).</span></span>

## <a name="using-a-gridview-control-to-read-and-update-entities"></a><span data-ttu-id="80b1e-168">使用 GridView 控制項來讀取和更新實體</span><span class="sxs-lookup"><span data-stu-id="80b1e-168">Using a GridView Control to Read and Update Entities</span></span>

<span data-ttu-id="80b1e-169">在本節中，您將使用`GridView`控制項來顯示、 更新或刪除的學生。</span><span class="sxs-lookup"><span data-stu-id="80b1e-169">In this section you'll use a `GridView` control to display, update, or delete students.</span></span>

<span data-ttu-id="80b1e-170">開啟或切換至*Students.aspx* ，並切換至**設計**檢視。</span><span class="sxs-lookup"><span data-stu-id="80b1e-170">Open or switch to *Students.aspx* and switch to **Design** view.</span></span> <span data-ttu-id="80b1e-171">從**資料**索引標籤**工具箱**，拖曳`GridView`右邊的控制項`EntityDataSource`控制，將其命名`StudentsGridView`，按一下 智慧標籤、，然後選取  **StudentsEntityDataSource**做為資料來源。</span><span class="sxs-lookup"><span data-stu-id="80b1e-171">From the **Data** tab of the **Toolbox**, drag a `GridView` control to the right of the `EntityDataSource` control, name it `StudentsGridView`, click the smart tag, and then select **StudentsEntityDataSource** as the data source.</span></span>

<span data-ttu-id="80b1e-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-172">[![Image06](the-entity-framework-and-aspnet-getting-started-part-2/_static/image28.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image27.png)</span></span>

<span data-ttu-id="80b1e-173">按一下 **重新整理結構描述**(按一下**Yes**如果系統提示您確認)，然後按一下**啟用分頁**，**啟用排序**， **啟用編輯**，並**啟用刪除**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-173">Click **Refresh Schema** (click **Yes** if you're prompted to confirm), then click **Enable Paging**, **Enable Sorting**, **Enable Editing**, and **Enable Deleting**.</span></span>

<span data-ttu-id="80b1e-174">按一下 **編輯資料行**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-174">Click **Edit Columns**.</span></span>

<span data-ttu-id="80b1e-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-175">[![Image10](the-entity-framework-and-aspnet-getting-started-part-2/_static/image30.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image29.png)</span></span>

<span data-ttu-id="80b1e-176">在 **選取的欄位**方塊中，刪除**PersonID**， **LastName**，以及**HireDate**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-176">In the **Selected fields** box, delete **PersonID**, **LastName**, and **HireDate**.</span></span> <span data-ttu-id="80b1e-177">您通常不記錄金鑰向使用者顯示、 雇用日期不是相關的學生，而且您會將這兩個部分的名稱放在一個欄位，因此您只需要一個 [名稱] 欄位。）</span><span class="sxs-lookup"><span data-stu-id="80b1e-177">You typically don't display a record key to users, hire date is not relevant to students, and you'll put both parts of the name in one field, so you only need one of the name fields.)</span></span>

<span data-ttu-id="80b1e-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-178">[![Image11](the-entity-framework-and-aspnet-getting-started-part-2/_static/image32.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image31.png)</span></span>

<span data-ttu-id="80b1e-179">選取  **FirstMidName**欄位，然後按一下**將此欄位轉換為 TemplateField**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-179">Select the **FirstMidName** field and then click **Convert this field into a TemplateField**.</span></span>

<span data-ttu-id="80b1e-180">執行相同的動作**EnrollmentDate**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-180">Do the same for **EnrollmentDate**.</span></span>

<span data-ttu-id="80b1e-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-181">[![Image13](the-entity-framework-and-aspnet-getting-started-part-2/_static/image34.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image33.png)</span></span>

<span data-ttu-id="80b1e-182">按一下  **確定** ，然後切換至**來源**檢視。</span><span class="sxs-lookup"><span data-stu-id="80b1e-182">Click **OK** and then switch to **Source** view.</span></span> <span data-ttu-id="80b1e-183">剩餘的變更會直接在標記中執行的工作變得更容易。</span><span class="sxs-lookup"><span data-stu-id="80b1e-183">The remaining changes will be easier to do directly in markup.</span></span> <span data-ttu-id="80b1e-184">`GridView`控制標記現在看起來如下列範例所示。</span><span class="sxs-lookup"><span data-stu-id="80b1e-184">The `GridView` control markup now looks like the following example.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample3.aspx)]

<span data-ttu-id="80b1e-185">第一個資料行之後 [命令] 欄位目前是範本欄位, 會顯示第一個名稱。</span><span class="sxs-lookup"><span data-stu-id="80b1e-185">The first column after the command field is a template field that currently displays the first name.</span></span> <span data-ttu-id="80b1e-186">變更此範本欄位，看起來像下列範例的標記：</span><span class="sxs-lookup"><span data-stu-id="80b1e-186">Change the markup for this template field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample4.aspx)]

<span data-ttu-id="80b1e-187">在顯示模式中，兩個`Label`控制項顯示的第一個和最後一個名稱。</span><span class="sxs-lookup"><span data-stu-id="80b1e-187">In display mode, two `Label` controls display the first and last name.</span></span> <span data-ttu-id="80b1e-188">處於編輯模式，因此您可以變更的第一個和最後一個名稱，會提供兩個文字方塊。</span><span class="sxs-lookup"><span data-stu-id="80b1e-188">In edit mode, two text boxes are provided so you can change the first and last name.</span></span> <span data-ttu-id="80b1e-189">如同`Label`控制項中的顯示模式，則使用`Bind`和`Eval`完全依照您的運算式會使用直接連接到資料庫的 ASP.NET 資料來源控制項。</span><span class="sxs-lookup"><span data-stu-id="80b1e-189">As with the `Label` controls in display mode, you use `Bind` and `Eval` expressions exactly as you would with ASP.NET data source controls that connect directly to databases.</span></span> <span data-ttu-id="80b1e-190">唯一的差別是您在指定的實體屬性，而不是資料庫資料行。</span><span class="sxs-lookup"><span data-stu-id="80b1e-190">The only difference is that you're specifying entity properties instead of database columns.</span></span>

<span data-ttu-id="80b1e-191">最後一個資料行是範本欄位顯示 註冊日期。</span><span class="sxs-lookup"><span data-stu-id="80b1e-191">The last column is a template field that displays the enrollment date.</span></span> <span data-ttu-id="80b1e-192">變更此欄位，看起來像下列範例的標記：</span><span class="sxs-lookup"><span data-stu-id="80b1e-192">Change the markup for this field to look like the following example:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample5.aspx)]

<span data-ttu-id="80b1e-193">在顯示和編輯模式中，格式字串"{0，d}"會導致顯示 「 簡短日期 」 格式的日期。</span><span class="sxs-lookup"><span data-stu-id="80b1e-193">In both display and edit mode, the format string "{0,d}" causes the date to be displayed in the "short date" format.</span></span> <span data-ttu-id="80b1e-194">（您的電腦可能設定為顯示此格式，不同於本教學課程中所示的畫面影像）。</span><span class="sxs-lookup"><span data-stu-id="80b1e-194">(Your computer might be configured to display this format differently from the screen images shown in this tutorial.)</span></span>

<span data-ttu-id="80b1e-195">請注意，在每個範本欄位，設計工具使用`Bind`運算式，預設值，但您已變更，以`Eval`中的運算式`ItemTemplate`項目。</span><span class="sxs-lookup"><span data-stu-id="80b1e-195">Notice that in each of these template fields, the designer used a `Bind` expression by default, but you've changed that to an `Eval` expression in the `ItemTemplate` elements.</span></span> <span data-ttu-id="80b1e-196">`Bind`運算式可讓資料在`GridView`控制屬性，如果您需要存取程式碼中的資料。</span><span class="sxs-lookup"><span data-stu-id="80b1e-196">The `Bind` expression makes the data available in `GridView` control properties in case you need to access the data in code.</span></span> <span data-ttu-id="80b1e-197">在此頁面中，您不需要存取程式碼中，此資料，因此您可以使用`Eval`，這是更有效率。</span><span class="sxs-lookup"><span data-stu-id="80b1e-197">In this page you don't need to access this data in code, so you can use `Eval`, which is more efficient.</span></span> <span data-ttu-id="80b1e-198">如需詳細資訊，請參閱 <<c0> [ 將資料從資料控制項](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx)。</span><span class="sxs-lookup"><span data-stu-id="80b1e-198">For more information, see [Getting your data out of the data controls](https://weblogs.asp.net/davidfowler/archive/2008/12/12/getting-your-data-out-of-the-data-controls.aspx).</span></span>

## <a name="revising-entitydatasource-control-markup-to-improve-performance"></a><span data-ttu-id="80b1e-199">修改 EntityDataSource 控制項的標記，以改善效能</span><span class="sxs-lookup"><span data-stu-id="80b1e-199">Revising EntityDataSource Control Markup to Improve Performance</span></span>

<span data-ttu-id="80b1e-200">中的標記`EntityDataSource`控制項，移除`ConnectionString`並`DefaultContainerName`屬性，並將其取代為`ContextTypeName="ContosoUniversity.DAL.SchoolEntities"`屬性。</span><span class="sxs-lookup"><span data-stu-id="80b1e-200">In the markup for the `EntityDataSource` control, remove the `ConnectionString` and `DefaultContainerName` attributes and replace them with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="80b1e-201">這是每次建立，您應該進行的變更`EntityDataSource`控制項，除非您需要使用不同的是硬式編碼在物件內容類別中的連接。</span><span class="sxs-lookup"><span data-stu-id="80b1e-201">This is a change you should make every time you create an `EntityDataSource` control, unless you need to use a connection that is different from the one that's hard-coded in the object context class.</span></span> <span data-ttu-id="80b1e-202">使用`ContextTypeName`屬性會提供下列優點：</span><span class="sxs-lookup"><span data-stu-id="80b1e-202">Using the `ContextTypeName` attribute provides the following benefits:</span></span>

- <span data-ttu-id="80b1e-203">效能較佳。</span><span class="sxs-lookup"><span data-stu-id="80b1e-203">Better performance.</span></span> <span data-ttu-id="80b1e-204">當`EntityDataSource`控制初始化的資料模型使用`ConnectionString`和`DefaultContainerName`屬性，它會執行其他工作，以載入每個要求的中繼資料。</span><span class="sxs-lookup"><span data-stu-id="80b1e-204">When the `EntityDataSource` control initializes the data model using the `ConnectionString` and `DefaultContainerName` attributes, it performs additional work to load metadata on every request.</span></span> <span data-ttu-id="80b1e-205">這並非必要，如果您指定`ContextTypeName`屬性。</span><span class="sxs-lookup"><span data-stu-id="80b1e-205">This isn't necessary if you specify the `ContextTypeName` attribute.</span></span>
- <span data-ttu-id="80b1e-206">消極式載入會開啟產生的物件內容類別中的預設值 (例如`SchoolEntities`在本教學課程) 中 Entity Framework 4.0。</span><span class="sxs-lookup"><span data-stu-id="80b1e-206">Lazy loading is turned on by default in generated object context classes (such as `SchoolEntities` in this tutorial) in Entity Framework 4.0.</span></span> <span data-ttu-id="80b1e-207">這表示，導覽屬性載入與相關資料會自動在需要時，權限。</span><span class="sxs-lookup"><span data-stu-id="80b1e-207">This means that navigation properties are loaded with related data automatically right when you need it.</span></span> <span data-ttu-id="80b1e-208">消極式載入會更詳細說明稍後在本教學課程。</span><span class="sxs-lookup"><span data-stu-id="80b1e-208">Lazy loading is explained in more detail later in this tutorial.</span></span>
- <span data-ttu-id="80b1e-209">您已套用至物件內容類別的任何自訂項目 (在此情況下，`SchoolEntities`類別) 可供使用的控制項`EntityDataSource`控制項。</span><span class="sxs-lookup"><span data-stu-id="80b1e-209">Any customizations that you've applied to the object context class (in this case, the `SchoolEntities` class) will be available to controls that use the `EntityDataSource` control.</span></span> <span data-ttu-id="80b1e-210">自訂物件內容類別是未涵蓋在本教學課程系列中的進階的主題。</span><span class="sxs-lookup"><span data-stu-id="80b1e-210">Customizing the object context class is an advanced topic that is not covered in this tutorial series.</span></span> <span data-ttu-id="80b1e-211">如需詳細資訊，請參閱 <<c0> [ 擴充 Entity Framework 產生的型別](https://msdn.microsoft.com/library/dd456844.aspx)。</span><span class="sxs-lookup"><span data-stu-id="80b1e-211">For more information, see [Extending Entity Framework Generated Types](https://msdn.microsoft.com/library/dd456844.aspx).</span></span>

<span data-ttu-id="80b1e-212">標記現在會類似下列範例 （的屬性順序可能會不同）：</span><span class="sxs-lookup"><span data-stu-id="80b1e-212">The markup will now resemble the following example (the order of the properties might be different):</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample6.aspx)]

<span data-ttu-id="80b1e-213">`EnableFlattening`屬性會參考到因為外部索引鍵資料行並不會公開為實體的屬性，在舊版的 Entity Framework 所需的功能。</span><span class="sxs-lookup"><span data-stu-id="80b1e-213">The `EnableFlattening` attribute refers to a feature that was needed in earlier versions of the Entity Framework because foreign key columns were not exposed as entity properties.</span></span> <span data-ttu-id="80b1e-214">目前的版本可讓您使用*外部索引鍵關聯*，這表示外部索引鍵屬性以外的所有多對多關聯的公開。</span><span class="sxs-lookup"><span data-stu-id="80b1e-214">The current version makes it possible to use *foreign key associations*, which means foreign key properties are exposed for all but many-to-many associations.</span></span> <span data-ttu-id="80b1e-215">如果您的實體有外部索引鍵屬性，但沒有[複雜型別](https://msdn.microsoft.com/library/bb738472.aspx)，您可以將此屬性設為`False`。</span><span class="sxs-lookup"><span data-stu-id="80b1e-215">If your entities have foreign key properties and no [complex types](https://msdn.microsoft.com/library/bb738472.aspx), you can leave this attribute set to `False`.</span></span> <span data-ttu-id="80b1e-216">未移除的屬性標記，因為預設值為`True`。</span><span class="sxs-lookup"><span data-stu-id="80b1e-216">Don't remove the attribute from the markup, because the default value is `True`.</span></span> <span data-ttu-id="80b1e-217">如需詳細資訊，請參閱 <<c0> [ 壓平合併的物件 (EntityDataSource)](https://msdn.microsoft.com/library/ee404746.aspx)。</span><span class="sxs-lookup"><span data-stu-id="80b1e-217">For more information, see [Flattening Objects (EntityDataSource)](https://msdn.microsoft.com/library/ee404746.aspx).</span></span>

<span data-ttu-id="80b1e-218">執行網頁，您會看到一份學生和員工 （您將篩選只要的學生在下一個教學課程中）。</span><span class="sxs-lookup"><span data-stu-id="80b1e-218">Run the page and you see a list of students and employees (you'll filter for just students in the next tutorial).</span></span> <span data-ttu-id="80b1e-219">名字和姓氏會一起顯示。</span><span class="sxs-lookup"><span data-stu-id="80b1e-219">The first name and last name are displayed together.</span></span>

<span data-ttu-id="80b1e-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-220">[![Image07](the-entity-framework-and-aspnet-getting-started-part-2/_static/image36.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image35.png)</span></span>

<span data-ttu-id="80b1e-221">若要排序顯示，請按一下資料行名稱。</span><span class="sxs-lookup"><span data-stu-id="80b1e-221">To sort the display, click a column name.</span></span>

<span data-ttu-id="80b1e-222">按一下 **編輯**中任何資料列。</span><span class="sxs-lookup"><span data-stu-id="80b1e-222">Click **Edit** in any row.</span></span> <span data-ttu-id="80b1e-223">文字方塊會顯示您可以在此變更的第一個和最後一個名稱。</span><span class="sxs-lookup"><span data-stu-id="80b1e-223">Text boxes are displayed where you can change the first and last name.</span></span>

<span data-ttu-id="80b1e-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-224">[![Image08](the-entity-framework-and-aspnet-getting-started-part-2/_static/image38.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image37.png)</span></span>

<span data-ttu-id="80b1e-225">**刪除**按鈕也可以運作。</span><span class="sxs-lookup"><span data-stu-id="80b1e-225">The **Delete** button also works.</span></span> <span data-ttu-id="80b1e-226">針對具有註冊日期的資料列和資料列就會消失，請按一下 [刪除]。</span><span class="sxs-lookup"><span data-stu-id="80b1e-226">Click delete for a row that has an enrollment date and the row disappears.</span></span> <span data-ttu-id="80b1e-227">（而不需要註冊日期的資料列代表講師，而且您可能會收到參考完整性錯誤。</span><span class="sxs-lookup"><span data-stu-id="80b1e-227">(Rows without an enrollment date represent instructors and you may get a referential integrity error.</span></span> <span data-ttu-id="80b1e-228">在下一個教學課程中您會篩選此清單包含只要的學生。）</span><span class="sxs-lookup"><span data-stu-id="80b1e-228">In the next tutorial you'll filter this list to include just students.)</span></span>

## <a name="displaying-data-from-a-navigation-property"></a><span data-ttu-id="80b1e-229">顯示從導覽屬性的資料</span><span class="sxs-lookup"><span data-stu-id="80b1e-229">Displaying Data from a Navigation Property</span></span>

<span data-ttu-id="80b1e-230">現在假設您想要知道多少課程每位學生在中註冊。</span><span class="sxs-lookup"><span data-stu-id="80b1e-230">Now suppose you want to know how many courses each student is enrolled in.</span></span> <span data-ttu-id="80b1e-231">Entity Framework 會提供該資訊`StudentGrades`導覽屬性`Person`實體。</span><span class="sxs-lookup"><span data-stu-id="80b1e-231">The Entity Framework provides that information in the `StudentGrades` navigation property of the `Person` entity.</span></span> <span data-ttu-id="80b1e-232">因為資料庫設計不允許註冊課程中，而不需要指派一個等級的學生，本教學課程中您可以假設在中，有一個資料列`StudentGrade`課程相關聯的資料表資料列等同於註冊過程中。</span><span class="sxs-lookup"><span data-stu-id="80b1e-232">Because the database design does not allow a student to be enrolled in a course without having a grade assigned, for this tutorial you can assume that having a row in the `StudentGrade` table row that is associated with a course is the same as being enrolled in the course.</span></span> <span data-ttu-id="80b1e-233">(`Courses`導覽屬性只能為講師。)</span><span class="sxs-lookup"><span data-stu-id="80b1e-233">(The `Courses` navigation property is only for instructors.)</span></span>

<span data-ttu-id="80b1e-234">當您使用`ContextTypeName`屬性的`EntityDataSource`控制項，Entity Framework 會自動擷取資訊的導覽屬性存取該屬性時。</span><span class="sxs-lookup"><span data-stu-id="80b1e-234">When you use the `ContextTypeName` attribute of the `EntityDataSource` control, the Entity Framework automatically retrieves information for a navigation property when you access that property.</span></span> <span data-ttu-id="80b1e-235">這就叫做*消極式載入*。</span><span class="sxs-lookup"><span data-stu-id="80b1e-235">This is called *lazy loading*.</span></span> <span data-ttu-id="80b1e-236">不過，這可能是效率不佳，因為它會導致個別呼叫需要每個階段的其他資訊的資料庫。</span><span class="sxs-lookup"><span data-stu-id="80b1e-236">However, this can be inefficient, because it results in a separate call to the database each time additional information is needed.</span></span> <span data-ttu-id="80b1e-237">如果您需要從導覽屬性的資料所傳回的每個實體之`EntityDataSource`控制項，它會擷取相關的資料，以及實體本身的資料庫的單一呼叫中更有效率。</span><span class="sxs-lookup"><span data-stu-id="80b1e-237">If you need data from the navigation property for every entity returned by the `EntityDataSource` control, it's more efficient to retrieve the related data along with the entity itself in a single call to the database.</span></span> <span data-ttu-id="80b1e-238">這就叫做*積極式載入*，而且您藉由設定指定導覽屬性的積極式載入`Include`屬性`EntityDataSource`控制項。</span><span class="sxs-lookup"><span data-stu-id="80b1e-238">This is called *eager loading*, and you specify eager loading for a navigation property by setting the `Include` property of the `EntityDataSource` control.</span></span>

<span data-ttu-id="80b1e-239">在  *Students.aspx*、 您想要顯示的每個學生的課程的數量，因此積極式載入是最佳選擇。</span><span class="sxs-lookup"><span data-stu-id="80b1e-239">In *Students.aspx*, you want to show the number of courses for every student, so eager loading is the best choice.</span></span> <span data-ttu-id="80b1e-240">如果您已顯示所有的學生，但顯示數量的課程只會針對幾個 （這需要撰寫一些程式碼，除了標記以外） 上的消極式載入可能是較好的選擇。</span><span class="sxs-lookup"><span data-stu-id="80b1e-240">If you were displaying all students but showing the number of courses only for a few of them (which would require writing some code in addition to the markup), lazy loading might be a better choice.</span></span>

<span data-ttu-id="80b1e-241">開啟或切換至*Students.aspx*，切換至**設計**檢視中，選取`StudentsEntityDataSource`，然後在**屬性** 視窗中設定**Include**屬性，以**StudentGrades**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-241">Open or switch to *Students.aspx*, switch to **Design** view, select `StudentsEntityDataSource`, and in the **Properties** window set the **Include** property to **StudentGrades**.</span></span> <span data-ttu-id="80b1e-242">(如果您想要取得多個導覽屬性，您可以指定其名稱以逗號分隔，例如**StudentGrades、 課程**。)</span><span class="sxs-lookup"><span data-stu-id="80b1e-242">(If you wanted to get multiple navigation properties, you could specify their names separated by commas — for example, **StudentGrades, Courses**.)</span></span>

<span data-ttu-id="80b1e-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-243">[![Image19](the-entity-framework-and-aspnet-getting-started-part-2/_static/image40.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image39.png)</span></span>

<span data-ttu-id="80b1e-244">若要切換**來源**檢視。</span><span class="sxs-lookup"><span data-stu-id="80b1e-244">Switch to **Source** view.</span></span> <span data-ttu-id="80b1e-245">在 `StudentsGridView`控制項，最後一個之後`asp:TemplateField`項目，新增下列新的 範本 欄位：</span><span class="sxs-lookup"><span data-stu-id="80b1e-245">In the `StudentsGridView` control, after the last `asp:TemplateField` element, add the following new template field:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample7.aspx)]

<span data-ttu-id="80b1e-246">在 `Eval`運算式中，您可以參考導覽屬性`StudentGrades`。</span><span class="sxs-lookup"><span data-stu-id="80b1e-246">In the `Eval` expression, you can reference the navigation property `StudentGrades`.</span></span> <span data-ttu-id="80b1e-247">此屬性包含集合，因為它有`Count`可用來顯示課程的學生是否已註冊的屬性。</span><span class="sxs-lookup"><span data-stu-id="80b1e-247">Because this property contains a collection, it has a `Count` property that you can use to display the number of courses in which the student is enrolled.</span></span> <span data-ttu-id="80b1e-248">在稍後的教學課程中，您會看到如何顯示從包含單一的實體，而不是集合的導覽屬性的資料。</span><span class="sxs-lookup"><span data-stu-id="80b1e-248">In a later tutorial you'll see how to display data from navigation properties that contain single entities instead of collections.</span></span> <span data-ttu-id="80b1e-249">(請注意，您無法使用`BoundField`來顯示資料的導覽屬性的項目。)</span><span class="sxs-lookup"><span data-stu-id="80b1e-249">(Note that you cannot use `BoundField` elements to display data from navigation properties.)</span></span>

<span data-ttu-id="80b1e-250">執行網頁，您現在會看到幾個課程中，已註冊學生。</span><span class="sxs-lookup"><span data-stu-id="80b1e-250">Run the page and you now see how many courses each student is enrolled in.</span></span>

<span data-ttu-id="80b1e-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-251">[![Image20](the-entity-framework-and-aspnet-getting-started-part-2/_static/image42.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image41.png)</span></span>

## <a name="using-a-detailsview-control-to-insert-entities"></a><span data-ttu-id="80b1e-252">若要插入實體使用 DetailsView 控制項</span><span class="sxs-lookup"><span data-stu-id="80b1e-252">Using a DetailsView Control to Insert Entities</span></span>

<span data-ttu-id="80b1e-253">下一個步驟是建立頁面，其中包含`DetailsView`控制項可讓您將新增新的學生。</span><span class="sxs-lookup"><span data-stu-id="80b1e-253">The next step is to create a page that has a `DetailsView` control that will let you add new students.</span></span> <span data-ttu-id="80b1e-254">關閉瀏覽器，然後再建立 新的網頁上使用*Site.Master*主版頁面。</span><span class="sxs-lookup"><span data-stu-id="80b1e-254">Close the browser and then create a new web page using the *Site.Master* master page.</span></span> <span data-ttu-id="80b1e-255">將頁面命名*StudentsAdd.aspx*，然後切換到**來源**檢視。</span><span class="sxs-lookup"><span data-stu-id="80b1e-255">Name the page *StudentsAdd.aspx*, and then switch to **Source** view.</span></span>

<span data-ttu-id="80b1e-256">加入下列標記取代的現有標記`Content`控制項，名為`Content2`:</span><span class="sxs-lookup"><span data-stu-id="80b1e-256">Add the following markup to replace the existing markup for the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample8.aspx)]

<span data-ttu-id="80b1e-257">此標記會建立`EntityDataSource`類似於您在所建立的控制項*Students.aspx*，但它可讓插入。</span><span class="sxs-lookup"><span data-stu-id="80b1e-257">This markup creates an `EntityDataSource` control that is similar to the one you created in *Students.aspx*, except it enables insertion.</span></span> <span data-ttu-id="80b1e-258">如同`GridView`控制項，繫結的欄位`DetailsView`完全依照其方式是根據資料控制項直接連接到資料庫，不同之處在於它們會參考實體屬性，會自動程式化控制項。</span><span class="sxs-lookup"><span data-stu-id="80b1e-258">As with the `GridView` control, the bound fields of the `DetailsView` control are coded exactly as they would be for a data control that connects directly to a database, except that they reference entity properties.</span></span> <span data-ttu-id="80b1e-259">在此情況下，`DetailsView`控制項只適用於插入資料列，所以已設定的預設模式為`Insert`。</span><span class="sxs-lookup"><span data-stu-id="80b1e-259">In this case, the `DetailsView` control is used only for inserting rows, so you have set the default mode to `Insert`.</span></span>

<span data-ttu-id="80b1e-260">執行網頁，並加入新的學生。</span><span class="sxs-lookup"><span data-stu-id="80b1e-260">Run the page and add a new student.</span></span>

<span data-ttu-id="80b1e-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-261">[![Image09](the-entity-framework-and-aspnet-getting-started-part-2/_static/image44.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image43.png)</span></span>

<span data-ttu-id="80b1e-262">插入新的學生之後，但現在執行會發生任何事*Students.aspx*，您會看到新的學生資訊。</span><span class="sxs-lookup"><span data-stu-id="80b1e-262">Nothing will happen after you insert a new student, but if you now run *Students.aspx*, you'll see the new student information.</span></span>

## <a name="displaying-data-in-a-drop-down-list"></a><span data-ttu-id="80b1e-263">在下拉式清單中顯示資料</span><span class="sxs-lookup"><span data-stu-id="80b1e-263">Displaying Data in a Drop-Down List</span></span>

<span data-ttu-id="80b1e-264">在下列步驟中，您將資料繫結`DropDownList`控制項的實體集使用`EntityDataSource`控制項。</span><span class="sxs-lookup"><span data-stu-id="80b1e-264">In the following steps you'll databind a `DropDownList` control to an entity set using an `EntityDataSource` control.</span></span> <span data-ttu-id="80b1e-265">在本教學課程的這個部分，您不會執行許多與這份清單。</span><span class="sxs-lookup"><span data-stu-id="80b1e-265">In this part of the tutorial, you won't do much with this list.</span></span> <span data-ttu-id="80b1e-266">在後續的部分，不過，您將使用清單，讓使用者選取部門，以顯示相關聯的部門的課程。</span><span class="sxs-lookup"><span data-stu-id="80b1e-266">In subsequent parts, though, you'll use the list to let users select a department to display courses associated with the department.</span></span>

<span data-ttu-id="80b1e-267">建立名為的新網頁*Courses.aspx*。</span><span class="sxs-lookup"><span data-stu-id="80b1e-267">Create a new web page named *Courses.aspx*.</span></span> <span data-ttu-id="80b1e-268">在 **來源**檢視中，新增標題，以`Content`控制項，名為`Content2`:</span><span class="sxs-lookup"><span data-stu-id="80b1e-268">In **Source** view, add a heading to the `Content` control that's named `Content2`:</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample9.aspx)]

<span data-ttu-id="80b1e-269">在 **設計**檢視、 新增`EntityDataSource`控制項加入網頁一樣，但這次它命名為`DepartmentsEntityDataSource`。</span><span class="sxs-lookup"><span data-stu-id="80b1e-269">In **Design** view, add an `EntityDataSource` control to the page as you did before, except this time name it `DepartmentsEntityDataSource`.</span></span> <span data-ttu-id="80b1e-270">選取 **部門**作為**EntitySetName**值，然後選取 僅**DepartmentID**並**名稱**屬性。</span><span class="sxs-lookup"><span data-stu-id="80b1e-270">Select **Departments** as the **EntitySetName** value, and select only the **DepartmentID** and **Name** properties.</span></span>

<span data-ttu-id="80b1e-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-271">[![Image15](the-entity-framework-and-aspnet-getting-started-part-2/_static/image46.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image45.png)</span></span>

<span data-ttu-id="80b1e-272">從**標準**索引標籤**工具箱**，拖曳`DropDownList`控制項加入頁面，將其命名`DepartmentsDropDownList`，按一下智慧標籤，然後選取**選擇資料來源**至開始**資料來源組態精靈**。</span><span class="sxs-lookup"><span data-stu-id="80b1e-272">From the **Standard** tab of the **Toolbox**, drag a `DropDownList` control to the page, name it `DepartmentsDropDownList`, click the smart tag, and select **Choose Data Source** to start the **DataSource Configuration Wizard**.</span></span>

<span data-ttu-id="80b1e-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-273">[![Image16](the-entity-framework-and-aspnet-getting-started-part-2/_static/image48.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image47.png)</span></span>

<span data-ttu-id="80b1e-274">在 **選擇資料來源**步驟中，選取**DepartmentsEntityDataSource**做為資料來源中，按一下 **重新整理結構描述**，然後選取 **名稱**為要顯示的資料欄位並**DepartmentID**做為值的資料欄位。</span><span class="sxs-lookup"><span data-stu-id="80b1e-274">In the **Choose a Data Source** step, select **DepartmentsEntityDataSource** as the data source, click **Refresh Schema**, and then select **Name** as the data field to display and **DepartmentID** as the value data field.</span></span> <span data-ttu-id="80b1e-275">按一下 [確定 **Deploying Office Solutions**]。</span><span class="sxs-lookup"><span data-stu-id="80b1e-275">Click **OK**.</span></span>

<span data-ttu-id="80b1e-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-276">[![Image17](the-entity-framework-and-aspnet-getting-started-part-2/_static/image50.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image49.png)</span></span>

<span data-ttu-id="80b1e-277">與其他 ASP.NET 資料來源控制項，除非您正在指定實體和實體屬性，您可以使用資料繫結控制項使用 Entity Framework 的方法都是一樣的。</span><span class="sxs-lookup"><span data-stu-id="80b1e-277">The method you use to databind the control using the Entity Framework is the same as with other ASP.NET data source controls except you're specifying entities and entity properties.</span></span>

<span data-ttu-id="80b1e-278">切換至**來源**檢視和加入 「 選取部門: 」 之前，立即`DropDownList`控制項。</span><span class="sxs-lookup"><span data-stu-id="80b1e-278">Switch to **Source** view and add "Select a department:" immediately before the `DropDownList` control.</span></span>

[!code-aspx[Main](the-entity-framework-and-aspnet-getting-started-part-2/samples/sample10.aspx)]

<span data-ttu-id="80b1e-279">提醒您，變更的標記`EntityDataSource`控制項在此時取代`ConnectionString`並`DefaultContainerName`屬性與`ContextTypeName="ContosoUniversity.DAL.SchoolEntities"`屬性。</span><span class="sxs-lookup"><span data-stu-id="80b1e-279">As a reminder, change the markup for the `EntityDataSource` control at this point by replacing the `ConnectionString` and `DefaultContainerName` attributes with a `ContextTypeName="ContosoUniversity.DAL.SchoolEntities"` attribute.</span></span> <span data-ttu-id="80b1e-280">通常最好是等到您已建立連結到資料來源控制項變更之前，先將資料繫結控制項`EntityDataSource`控制標記，因為您進行變更之後，設計工具不會提供您與**重新整理結構描述**資料繫結控制項中的選項。</span><span class="sxs-lookup"><span data-stu-id="80b1e-280">It's often best to wait until after you've created the data-bound control that is linked to the data source control before you change the `EntityDataSource` control markup, because after you make the change, the designer will not provide you with a **Refresh Schema** option in the data-bound control.</span></span>

<span data-ttu-id="80b1e-281">執行網頁，您可以從下拉式清單中選取部門。</span><span class="sxs-lookup"><span data-stu-id="80b1e-281">Run the page and you can select a department from the drop-down list.</span></span>

<span data-ttu-id="80b1e-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span><span class="sxs-lookup"><span data-stu-id="80b1e-282">[![Image18](the-entity-framework-and-aspnet-getting-started-part-2/_static/image52.png)](the-entity-framework-and-aspnet-getting-started-part-2/_static/image51.png)</span></span>

<span data-ttu-id="80b1e-283">如此即完成簡介使用`EntityDataSource`控制項。</span><span class="sxs-lookup"><span data-stu-id="80b1e-283">This completes the introduction to using the `EntityDataSource` control.</span></span> <span data-ttu-id="80b1e-284">與這個控制項的工作與使用其他 ASP.NET 資料來源控制項，通常不不同，不同之處在於您實體和屬性，而不是資料表和資料行的參考。</span><span class="sxs-lookup"><span data-stu-id="80b1e-284">Working with this control is generally no different from working with other ASP.NET data source controls, except that you reference entities and properties instead of tables and columns.</span></span> <span data-ttu-id="80b1e-285">唯一的例外狀況時，您想要存取導覽屬性。</span><span class="sxs-lookup"><span data-stu-id="80b1e-285">The only exception is when you want to access navigation properties.</span></span> <span data-ttu-id="80b1e-286">在下一個教學課程中您會看到，語法搭配`EntityDataSource`篩選、 分組和排序資料時控制項也可能會與其他資料來源控制項不同。</span><span class="sxs-lookup"><span data-stu-id="80b1e-286">In the next tutorial you'll see that the syntax you use with `EntityDataSource` control might also differ from other data source controls when you filter, group, and order data.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="80b1e-287">[上一頁](the-entity-framework-and-aspnet-getting-started-part-1.md)
> [下一頁](the-entity-framework-and-aspnet-getting-started-part-3.md)</span><span class="sxs-lookup"><span data-stu-id="80b1e-287">[Previous](the-entity-framework-and-aspnet-getting-started-part-1.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-3.md)</span></span>
