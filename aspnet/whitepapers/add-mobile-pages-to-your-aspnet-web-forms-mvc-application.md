---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: 如何： 將行動網頁新增至 ASP.NET Web Form / MVC 應用程式 |Microsoft Docs
author: rick-anderson
description: 本 How To 說明會提供適用於行動裝置，從您的 ASP.NET Web Form 網頁的各種方法 / MVC 應用程式，並建議架構和...
ms.author: riande
ms.date: 01/20/2011
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: 1693838a74f0564e38e11a2827cceb3d6474677b
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/16/2018
ms.locfileid: "41832611"
---
<a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="020ad-103">如何： 將行動網頁新增至 ASP.NET Web Form / MVC 應用程式</span><span class="sxs-lookup"><span data-stu-id="020ad-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>
====================
> <span data-ttu-id="020ad-104">**適用於**</span><span class="sxs-lookup"><span data-stu-id="020ad-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="020ad-105">ASP.NET Web Form 版本 4.0</span><span class="sxs-lookup"><span data-stu-id="020ad-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="020ad-106">ASP.NET MVC 3.0 版</span><span class="sxs-lookup"><span data-stu-id="020ad-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="020ad-107">**摘要**</span><span class="sxs-lookup"><span data-stu-id="020ad-107">**Summary**</span></span>
> 
> <span data-ttu-id="020ad-108">本 How To 說明會提供適用於行動裝置，從您的 ASP.NET Web Form 網頁的各種方法 / MVC 應用程式，並建議架構和設計以各種裝置為目標時應該考量的問題。</span><span class="sxs-lookup"><span data-stu-id="020ad-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="020ad-109">本文件也說明為何從 ASP.NET 2.0 ASP.NET 行動控制項，為 3.5 已經過時，並討論一些現代的替代方案。</span><span class="sxs-lookup"><span data-stu-id="020ad-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>


## <a name="contents"></a><span data-ttu-id="020ad-110">內容</span><span class="sxs-lookup"><span data-stu-id="020ad-110">Contents</span></span>

- <span data-ttu-id="020ad-111">總覽</span><span class="sxs-lookup"><span data-stu-id="020ad-111">Overview</span></span>
- <span data-ttu-id="020ad-112">架構選項</span><span class="sxs-lookup"><span data-stu-id="020ad-112">Architectural options</span></span>
- <span data-ttu-id="020ad-113">瀏覽器及裝置的偵測</span><span class="sxs-lookup"><span data-stu-id="020ad-113">Browser and device detection</span></span>
- <span data-ttu-id="020ad-114">ASP.NET Web Forms 應用程式會如何呈現行動裝置專屬頁面</span><span class="sxs-lookup"><span data-stu-id="020ad-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="020ad-115">ASP.NET MVC 應用程式會如何呈現行動裝置專屬頁面</span><span class="sxs-lookup"><span data-stu-id="020ad-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="020ad-116">其他資源</span><span class="sxs-lookup"><span data-stu-id="020ad-116">Additional resources</span></span>

<span data-ttu-id="020ad-117">如需可下載的程式碼範例示範針對 ASP.NET Web Form 和 MVC 的這份白皮書的技術，請參閱[行動應用程式和 ASP.NET 網站](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="020ad-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="020ad-118">總覽</span><span class="sxs-lookup"><span data-stu-id="020ad-118">Overview</span></span>

<span data-ttu-id="020ad-119">行動裝置 – 智慧型手機、 功能手機和平板電腦 – 繼續在受歡迎，做為存取 Web。</span><span class="sxs-lookup"><span data-stu-id="020ad-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="020ad-120">對於許多 web 開發人員和 web 導向的企業，這表示它是越來越重要，無法使用這些裝置的訪客提供絕佳的瀏覽經驗。</span><span class="sxs-lookup"><span data-stu-id="020ad-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="020ad-121">如何較早版本的 ASP.NET 支援行動瀏覽器</span><span class="sxs-lookup"><span data-stu-id="020ad-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="020ad-122">ASP.NET 版本 2.0 到 3.5，包含*ASP.NET 行動控制項*： 伺服器控制項中的行動裝置的一組*System.Web.Mobile.dll*組件和*System.Web.UI.MobileControls*命名空間。</span><span class="sxs-lookup"><span data-stu-id="020ad-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="020ad-123">組件仍會包含在 ASP.NET 4 中，但它已被取代。</span><span class="sxs-lookup"><span data-stu-id="020ad-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="020ad-124">開發人員建議移轉至更現代化的方法，例如這份文件中所述。</span><span class="sxs-lookup"><span data-stu-id="020ad-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="020ad-125">為什麼 ASP.NET 行動控制項已標示為過時的原因是它們的設計很常見周圍 2005年和更早版本的行動電話周圍導向。</span><span class="sxs-lookup"><span data-stu-id="020ad-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="020ad-126">WAP 瀏覽器，那個時代，控制項主要被設計來呈現 WML 或 cHTML 標記 （而不是一般的 HTML)。</span><span class="sxs-lookup"><span data-stu-id="020ad-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="020ad-127">但 WAP、 WML 和 cHTML 不再相關的大部分專案，因為 HTML 現在已成為行動和桌面瀏覽器，類似的通用標記語言。</span><span class="sxs-lookup"><span data-stu-id="020ad-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="020ad-128">目前支援的行動裝置上的挑戰</span><span class="sxs-lookup"><span data-stu-id="020ad-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="020ad-129">雖然行動瀏覽器時，現在幾乎都支援 HTML，您仍會在建立絕佳的行動瀏覽體驗為目標時面臨許多挑戰：</span><span class="sxs-lookup"><span data-stu-id="020ad-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="020ad-130">***螢幕大小***-行動裝置明顯不同格式，和他們的螢幕通常是許多小於桌上型監視器。</span><span class="sxs-lookup"><span data-stu-id="020ad-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="020ad-131">因此，您可能需要它們的設計完全不同的頁面配置。</span><span class="sxs-lookup"><span data-stu-id="020ad-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="020ad-132">***輸入方法***– 有些裝置有提功，某些 styluses，而其他人使用觸控功能。</span><span class="sxs-lookup"><span data-stu-id="020ad-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="020ad-133">您可能需要考慮多個導覽機制和資料的輸入的方法。</span><span class="sxs-lookup"><span data-stu-id="020ad-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="020ad-134">***標準相容性***– 許多行動瀏覽器不支援的最新的 HTML、 CSS 或 JavaScript 標準。</span><span class="sxs-lookup"><span data-stu-id="020ad-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="020ad-135">***頻寬***-行動數據網路效能的變化很大的差異，和某些使用者位於關稅的 mb 數來收取費用。</span><span class="sxs-lookup"><span data-stu-id="020ad-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="020ad-136">沒有一體適用的解決方案;您的應用程式會有的外觀和行為以不同的方式，根據裝置進行存取。</span><span class="sxs-lookup"><span data-stu-id="020ad-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="020ad-137">根據您要何種行動裝置層級，這可以是支援的挑戰更大的 web 開發人員比一直以來桌面 「 瀏覽器大戰 」。</span><span class="sxs-lookup"><span data-stu-id="020ad-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="020ad-138">一開始通常接近第一次行動瀏覽器支援的開發人員認為務必只支援最新且最精確的 smartphone （例如，Windows Phone 7、 iPhone 或 Android） 時，可能是因為開發人員通常是個人擁有這類裝置。</span><span class="sxs-lookup"><span data-stu-id="020ad-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="020ad-139">不過，成本較低的電話仍是很受歡迎，而且其擁有者使用它們來瀏覽網頁 – 特別是在行動電話所在位置，您更輕鬆地取得比寬頻連線的國家/地區。</span><span class="sxs-lookup"><span data-stu-id="020ad-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="020ad-140">您的業務需要決定哪些範圍要考慮其可能購買的客戶支援的裝置。</span><span class="sxs-lookup"><span data-stu-id="020ad-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="020ad-141">如果您正在建置為 luxury 健全狀況 spa 線上手冊，您可能會進行業務決策才能目標進階的智慧型手機，而如果您要建立杜比劇院效果的票證預約系統，您可能需要較不強大的功能與訪客帳戶電話。</span><span class="sxs-lookup"><span data-stu-id="020ad-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="020ad-142">架構選項</span><span class="sxs-lookup"><span data-stu-id="020ad-142">Architectural options</span></span>

<span data-ttu-id="020ad-143">我們的 ASP.NET Web Form 或 MVC 特定的技術細節之前，請注意，web 開發人員通常會有三個主要的可能選項，可支援行動瀏覽器：</span><span class="sxs-lookup"><span data-stu-id="020ad-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="020ad-144">***不執行任何動作 –*** 您只可以建立標準的桌面導向的 web 應用程式，並依賴來呈現它接受的行動瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="020ad-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="020ad-145">**利用**： 它是最便宜的選項，來實作和維護 – 不需要額外工作</span><span class="sxs-lookup"><span data-stu-id="020ad-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="020ad-146">**缺點**： 提供的最差的使用者體驗：</span><span class="sxs-lookup"><span data-stu-id="020ad-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="020ad-147">最新的智慧型手機可能會讓您的 HTML 與桌面瀏覽器，一樣，但縮放，以及水平捲動並以垂直方式取用您在小型螢幕上的內容，仍會強制使用者。</span><span class="sxs-lookup"><span data-stu-id="020ad-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="020ad-148">這是遠離最佳。</span><span class="sxs-lookup"><span data-stu-id="020ad-148">This is far from optimal.</span></span>
        - <span data-ttu-id="020ad-149">較舊的裝置和功能的電話可能無法令人滿意的方式呈現您的標記。</span><span class="sxs-lookup"><span data-stu-id="020ad-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="020ad-150">即使在最新的平板電腦裝置 （其畫面可以是膝上型電腦螢幕的大小），套用不同的互動規則。</span><span class="sxs-lookup"><span data-stu-id="020ad-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="020ad-151">觸控式的輸入最適合搭配較大的按鈕連結擴散的進一步，並沒有任何方法可以將滑鼠游標停留在飛出功能表。</span><span class="sxs-lookup"><span data-stu-id="020ad-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="020ad-152">\***解決此問題，在用戶端\*–** 小心使用 CSS 並[漸進式增強](http://en.wikipedia.org/wiki/Progressive_enhancement)標記、 樣式和適應它們執行的任何瀏覽器的指令碼，您可以建立。</span><span class="sxs-lookup"><span data-stu-id="020ad-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="020ad-153">例如，使用[CSS 3 的媒體查詢](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/)，您可以建立多重資料行版面配置，其畫面位於所選的臨界值較窄的裝置上會變成單一資料行版面配置。</span><span class="sxs-lookup"><span data-stu-id="020ad-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="020ad-154">**利用**： 最佳化呈現特定裝置使用，甚至是根據它們的任何畫面和輸入的特性有未知的未來裝置</span><span class="sxs-lookup"><span data-stu-id="020ad-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="020ad-155">**利用**： 輕鬆可讓您跨所有裝置類型 – 最小的程式碼或工作的重複共用伺服器端邏輯</span><span class="sxs-lookup"><span data-stu-id="020ad-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="020ad-156">**缺點**： 行動裝置並不讓桌面裝置，您可能希望是完全不同於您桌面的網頁，讓行動網頁顯示不同的資訊。</span><span class="sxs-lookup"><span data-stu-id="020ad-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="020ad-157">這類變化可能會沒有效率或不可能達成穩固透過 CSS，尤其考慮一致較舊的裝置解譯 CSS 規則。</span><span class="sxs-lookup"><span data-stu-id="020ad-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="020ad-158">這是特別的 CSS 3 屬性。</span><span class="sxs-lookup"><span data-stu-id="020ad-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="020ad-159">**缺點**： 不提供支援各種不同的伺服器端邏輯和適用於不同裝置的工作流程。</span><span class="sxs-lookup"><span data-stu-id="020ad-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="020ad-160">您比方說，不能透過 CSS 單獨實作簡單購物車簽出的工作流程為行動使用者。</span><span class="sxs-lookup"><span data-stu-id="020ad-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="020ad-161">**缺點**： 效率不佳的頻寬用量。</span><span class="sxs-lookup"><span data-stu-id="020ad-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="020ad-162">您的伺服器可能要傳輸的標記和樣式套用至所有可能的裝置，即使目標裝置只會使用該資訊的子集。</span><span class="sxs-lookup"><span data-stu-id="020ad-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="020ad-163">\***解決此問題，在伺服器上的\*–** 如果您的伺服器可讓您知道哪些裝置存取它-，或在該裝置，例如其螢幕大小和輸入的法，最低的特性，且無論是行動裝置，像是網域控制站可以執行不同的邏輯和輸出不同的 HTML 標記。</span><span class="sxs-lookup"><span data-stu-id="020ad-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="020ad-164">**優點：** 最大的彈性。</span><span class="sxs-lookup"><span data-stu-id="020ad-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="020ad-165">沒有多少，您便可以改變您的 asp.net 的伺服器端邏輯上，或最佳化您如有需要，裝置特定配置的標記來無限制。</span><span class="sxs-lookup"><span data-stu-id="020ad-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="020ad-166">**優點：** 有效率的頻寬用量。</span><span class="sxs-lookup"><span data-stu-id="020ad-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="020ad-167">您只需要傳輸的標記和目標裝置將使用的樣式資訊。</span><span class="sxs-lookup"><span data-stu-id="020ad-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="020ad-168">**缺點：** 有時候會強制執行的工作或程式碼的重複 （例如，讓您建立 Web Form 頁面或 MVC 檢視類似但稍微不同的複本）。</span><span class="sxs-lookup"><span data-stu-id="020ad-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="020ad-169">其中可能會排除一般邏輯為基礎的圖層或服務，但儘管如此，您的 UI 程式碼或標記的某些部分可能重複，並以平行方式加以維護。</span><span class="sxs-lookup"><span data-stu-id="020ad-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="020ad-170">**缺點：** 裝置偵測並非易事。</span><span class="sxs-lookup"><span data-stu-id="020ad-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="020ad-171">它需要的已知的裝置類型和它們的特性 （這不一定完全最新狀態） 的資料庫或資料清單，並不保證會精確地符合每個傳入要求。</span><span class="sxs-lookup"><span data-stu-id="020ad-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="020ad-172">本文件稍後所述部分選項和其所犯的錯誤。</span><span class="sxs-lookup"><span data-stu-id="020ad-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="020ad-173">若要取得最佳結果，大部分的開發人員會發現他們需要結合選項 (2) 和 (3)。</span><span class="sxs-lookup"><span data-stu-id="020ad-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="020ad-174">樣式的細微差異使用 CSS 或甚至是 JavaScript，在用戶端上最可調整，而在伺服器端程式碼中最有效地實作資料、 工作流程或標記中的主要差異。</span><span class="sxs-lookup"><span data-stu-id="020ad-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="020ad-175">此白皮書著重於伺服器端技術</span><span class="sxs-lookup"><span data-stu-id="020ad-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="020ad-176">由於 ASP.NET Web Form 和 MVC 是這兩種主要的伺服器端技術，這份白皮書著重於伺服器端技術，可讓您產生不同的標記和行動瀏覽器的邏輯。</span><span class="sxs-lookup"><span data-stu-id="020ad-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="020ad-177">當然，您也可以結合此使用任何用戶端技術 （例如，CSS 3 的媒體查詢，漸進式增強功能的 JavaScript），但，相當多的 web 設計比 ASP.NET 程式開發。</span><span class="sxs-lookup"><span data-stu-id="020ad-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="020ad-178">瀏覽器及裝置的偵測</span><span class="sxs-lookup"><span data-stu-id="020ad-178">Browser and device detection</span></span>

<span data-ttu-id="020ad-179">支援行動裝置的所有伺服器端技術的重要先決條件是知道您的訪客使用哪一種裝置。</span><span class="sxs-lookup"><span data-stu-id="020ad-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="020ad-180">事實上，比起了解該裝置的製造商和型號號碼了解更好*特性*的裝置。</span><span class="sxs-lookup"><span data-stu-id="020ad-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="020ad-181">特性可能包括：</span><span class="sxs-lookup"><span data-stu-id="020ad-181">Characteristics may include:</span></span>

- <span data-ttu-id="020ad-182">它是行動裝置嗎？</span><span class="sxs-lookup"><span data-stu-id="020ad-182">Is it a mobile device?</span></span>
- <span data-ttu-id="020ad-183">輸入的法 （滑鼠] / [鍵盤、 觸控、 數字鍵台、 搖桿，...）</span><span class="sxs-lookup"><span data-stu-id="020ad-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="020ad-184">螢幕大小，（實際和像素為單位）</span><span class="sxs-lookup"><span data-stu-id="020ad-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="020ad-185">支援的媒體和資料格式</span><span class="sxs-lookup"><span data-stu-id="020ad-185">Supported media and data formats</span></span>
- <span data-ttu-id="020ad-186">等。</span><span class="sxs-lookup"><span data-stu-id="020ad-186">Etc.</span></span>

<span data-ttu-id="020ad-187">最好是因為進行特性與模型數目為基礎的決策，然後您就更有能力來處理未來的裝置。</span><span class="sxs-lookup"><span data-stu-id="020ad-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="020ad-188">使用 ASP。NET 的內建的瀏覽器偵測支援</span><span class="sxs-lookup"><span data-stu-id="020ad-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="020ad-189">ASP.NET Web Form 和 MVC 的開發人員立即可以藉由檢查屬性探索正在瀏覽的瀏覽器的重要特性*Request.Browser*物件。</span><span class="sxs-lookup"><span data-stu-id="020ad-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="020ad-190">例如，請參閱</span><span class="sxs-lookup"><span data-stu-id="020ad-190">For example, see</span></span>

- <span data-ttu-id="020ad-191">Request.Browser.IsMobileDevice</span><span class="sxs-lookup"><span data-stu-id="020ad-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="020ad-192">Request.Browser.MobileDeviceManufacturer Request.Browser.MobileDeviceModel</span><span class="sxs-lookup"><span data-stu-id="020ad-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="020ad-193">Request.Browser.ScreenPixelsWidth</span><span class="sxs-lookup"><span data-stu-id="020ad-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="020ad-194">Request.Browser.SupportsXmlHttp</span><span class="sxs-lookup"><span data-stu-id="020ad-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="020ad-195">...還有許多其他項目</span><span class="sxs-lookup"><span data-stu-id="020ad-195">…and many others</span></span>

<span data-ttu-id="020ad-196">在幕後，ASP.NET 平台符合傳入*User-agent* (UA) 的 HTTP 標頭，針對一組瀏覽器定義 XML 檔案中的規則運算式。</span><span class="sxs-lookup"><span data-stu-id="020ad-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="020ad-197">根據預設，此平台包括定義許多常見的行動裝置，以及您可以為您想要辨識的其他項目中新增自訂的瀏覽器定義檔案。</span><span class="sxs-lookup"><span data-stu-id="020ad-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="020ad-198">如需詳細資訊，請參閱 MSDN 頁面[ASP.NET Web 伺服器控制項和瀏覽器能力](https://msdn.microsoft.com/library/x3k2ssx2.aspx)。</span><span class="sxs-lookup"><span data-stu-id="020ad-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="020ad-199">使用 WURFL 裝置資料庫透過 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="020ad-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="020ad-200">雖然 ASP。NET 的內建的瀏覽器偵測支援將足以說明許多應用程式時，有兩種主要的情況下它可能不太夠：</span><span class="sxs-lookup"><span data-stu-id="020ad-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="020ad-201">***您想要辨識最新的裝置***（而不需要手動建立它們的瀏覽器定義檔案）。</span><span class="sxs-lookup"><span data-stu-id="020ad-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="020ad-202">請注意，.NET 4 的瀏覽器定義檔案不是不夠新，無法辨識 Windows Phone 7、 Android 手機、 Opera Mobile 瀏覽器或 Apple Ipad。</span><span class="sxs-lookup"><span data-stu-id="020ad-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="020ad-203">***您需要裝置功能的詳細的資訊***。</span><span class="sxs-lookup"><span data-stu-id="020ad-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="020ad-204">您可能需要知道裝置的輸入法 （例如觸控與數字鍵台），或哪些音訊格式的瀏覽器支援。</span><span class="sxs-lookup"><span data-stu-id="020ad-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="020ad-205">標準的瀏覽器定義檔案中，無法使用這項資訊。</span><span class="sxs-lookup"><span data-stu-id="020ad-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="020ad-206">[*無線通用資源檔*(WURFL) 專案](http://wurfl.sourceforge.net/)維護更多最新狀態和詳細資訊中使用的行動裝置的相關今天。</span><span class="sxs-lookup"><span data-stu-id="020ad-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="020ad-207">適用於.NET 開發人員最棒的消息是該 ASP。NET 的瀏覽器偵測功能，所以就可以增強程式碼來克服這些問題。</span><span class="sxs-lookup"><span data-stu-id="020ad-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="020ad-208">例如，您可以在其中加入開放原始碼[ *51Degrees.mobi Foundation* ](https://github.com/51Degrees/dotNET-Device-Detection)至您的專案程式庫。</span><span class="sxs-lookup"><span data-stu-id="020ad-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="020ad-209">它是 ASP.NET IHttpModule 或瀏覽器功能提供者 （可使用 Web Form 和 MVC 應用程式），會直接讀取 WURFL 資料並將它連結到 ASP。NET 的內建瀏覽器偵測機制。</span><span class="sxs-lookup"><span data-stu-id="020ad-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="020ad-210">一旦您安裝該模組，請*Request.Browser*突然將包含許多更精確且更詳細的資訊： 它會正確地辨識許多先前所述的裝置，並列出其功能 （包括其他功能，例如輸入法）。</span><span class="sxs-lookup"><span data-stu-id="020ad-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="020ad-211">請參閱專案的文件，如需詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="020ad-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="020ad-212">Web Form 應用程式會如何呈現行動裝置專屬頁面</span><span class="sxs-lookup"><span data-stu-id="020ad-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="020ad-213">根據預設，以下是常見的行動裝置上的全新的 Web Form 應用程式的顯示方式：</span><span class="sxs-lookup"><span data-stu-id="020ad-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="020ad-214">很明顯地，未配置看起來非常適合行動 – 此頁面專為大型、 橫向的監視器，不適用於小型的直向導向螢幕。</span><span class="sxs-lookup"><span data-stu-id="020ad-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="020ad-215">因此可以您做什麼資訊？</span><span class="sxs-lookup"><span data-stu-id="020ad-215">So what can you do about it?</span></span>

<span data-ttu-id="020ad-216">如本文稍早所述，有很多種，量身訂做您的行動裝置的網頁。</span><span class="sxs-lookup"><span data-stu-id="020ad-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="020ad-217">有些技術則是伺服器架構，其他用戶端上執行。</span><span class="sxs-lookup"><span data-stu-id="020ad-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="020ad-218">建立行動專用的主版頁面</span><span class="sxs-lookup"><span data-stu-id="020ad-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="020ad-219">根據您的需求，您可以為所有訪客，使用相同的 Web Form，但有兩個不同的主版頁面： 一個用於桌面的訪客，另一個用於行動裝置的訪客。</span><span class="sxs-lookup"><span data-stu-id="020ad-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="020ad-220">這可讓您彈性地變更 CSS 樣式表或您最上層的 HTML 標記，以符合行動裝置，而不需要強迫您重複的任何網頁邏輯。</span><span class="sxs-lookup"><span data-stu-id="020ad-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="020ad-221">這很簡單。</span><span class="sxs-lookup"><span data-stu-id="020ad-221">This is easy to do.</span></span> <span data-ttu-id="020ad-222">例如，您可以將如下所示的 PreInit 處理常式加入 Web Form:</span><span class="sxs-lookup"><span data-stu-id="020ad-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="020ad-223">現在，建立您的應用程式的最上層資料夾中稱為 Mobile.Master 主版頁面，並將在偵測到行動裝置時使用。</span><span class="sxs-lookup"><span data-stu-id="020ad-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="020ad-224">如有必要，您行動裝置的主版頁面可以參考的行動裝置專屬的 CSS 樣式表。</span><span class="sxs-lookup"><span data-stu-id="020ad-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="020ad-225">桌面的訪客仍然會看到您預設主版頁面，不是行動裝置的一個。</span><span class="sxs-lookup"><span data-stu-id="020ad-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="020ad-226">建立獨立的行動裝置專屬 Web Form</span><span class="sxs-lookup"><span data-stu-id="020ad-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="020ad-227">最大的彈性，您即可更進一步比有個別的主版頁面，針對不同裝置類型。</span><span class="sxs-lookup"><span data-stu-id="020ad-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="020ad-228">您可以實作兩個*完全不同的 Web Form 頁面集*– 一個設定的桌面瀏覽器，另一組行動裝置的 asp.net。</span><span class="sxs-lookup"><span data-stu-id="020ad-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="020ad-229">這適用於最適合您想要呈現給行動裝置的訪客的非常不同的資訊或工作流程。</span><span class="sxs-lookup"><span data-stu-id="020ad-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="020ad-230">本節的其餘部分將說明這種方式詳細資料。</span><span class="sxs-lookup"><span data-stu-id="020ad-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="020ad-231">假設您已經有專為桌面瀏覽器的 Web Form 應用程式，繼續進行的最簡單方式是建立在您專案中，名為"Mobile"子資料夾，並建置行動頁面有。</span><span class="sxs-lookup"><span data-stu-id="020ad-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="020ad-232">您可以建構整個的子網站時，它自己的主版頁面、 樣式表和頁面，使用完全相同的技巧，您可以使用任何其他 Web Form 應用程式。</span><span class="sxs-lookup"><span data-stu-id="020ad-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="020ad-233">您不一定要產生行動裝置對等*每個*在桌面網站頁面上，您可以選擇哪些功能的子集有意義的行動裝置的訪客。</span><span class="sxs-lookup"><span data-stu-id="020ad-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="020ad-234">您的行動網頁可以共用通用的靜態資源 (例如影像、 JavaScript 或 CSS 檔案) 與您一般的頁面，如果您想要。</span><span class="sxs-lookup"><span data-stu-id="020ad-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="020ad-235">因為您的 「 行動 」 資料夾將會*不*標示為個別的應用程式裝載在 IIS 中 （它是只是 Web Form 網頁的簡單子資料夾），它也會分享相同的所有設定、 工作階段資料和其他基礎結構即程式桌面的頁面。</span><span class="sxs-lookup"><span data-stu-id="020ad-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="020ad-236">由於這種方法通常會涉及到的程式碼的一些重複項目 （行動網頁可能會將桌面的網頁中分享一些相似之處），請務必將任何一般商務邏輯或資料存取程式碼到共用的基礎層或服務。</span><span class="sxs-lookup"><span data-stu-id="020ad-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="020ad-237">否則，您將會兩倍的建立和維護您的應用程式的工作。</span><span class="sxs-lookup"><span data-stu-id="020ad-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>


#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="020ad-238">重新導向至您的行動頁面的行動訪客</span><span class="sxs-lookup"><span data-stu-id="020ad-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="020ad-239">通常很方便將行動裝置的訪客的行動裝置的頁面重新導向僅*第一個*要求在其瀏覽工作階段 （而不是在其工作階段中的每個要求上），因為：</span><span class="sxs-lookup"><span data-stu-id="020ad-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="020ad-240">您接著可以輕鬆地讓行動裝置的訪客存取您桌面的網頁，如果他們想要 – 只要將連結放在您移至 [桌面版本] 的主版頁面。</span><span class="sxs-lookup"><span data-stu-id="020ad-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="020ad-241">訪客不會重新導向回到行動裝置的頁面上，因為它不再第一個要求在其工作階段中。</span><span class="sxs-lookup"><span data-stu-id="020ad-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="020ad-242">它可避免干擾要求 （例如，如果您有一個常見的 Web 表單，桌上型電腦和行動裝置的組件，您的網站會顯示在 IFRAME 中或某些 Ajax 處理常式中），您的站台桌上型電腦和行動裝置的組件之間共用的所有動態資源的風險</span><span class="sxs-lookup"><span data-stu-id="020ad-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="020ad-243">若要這樣做，您可以將放在您重新導向邏輯**工作階段\_啟動**方法。</span><span class="sxs-lookup"><span data-stu-id="020ad-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="020ad-244">比方說，將下列方法新增至 Global.asax.cs 檔案中：</span><span class="sxs-lookup"><span data-stu-id="020ad-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="020ad-245">設定表單驗證，應遵守您的行動裝置頁面</span><span class="sxs-lookup"><span data-stu-id="020ad-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="020ad-246">請注意，表單驗證會使某些假設，它可以重新導向訪客期間和之後的驗證程序：</span><span class="sxs-lookup"><span data-stu-id="020ad-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="020ad-247">當使用者需要進行驗證時，表單驗證將會重新導向至您的桌面登入頁面，不論它們位桌面或行動裝置的使用者 (因為它只會有的概念*一個*登入 URL)。</span><span class="sxs-lookup"><span data-stu-id="020ad-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="020ad-248">假設您想要以不同的方式設定您的行動裝置的登入頁面的樣式，您需要增強您的桌面登入頁面，讓行動使用者重新導向至不同的行動裝置登入頁面。</span><span class="sxs-lookup"><span data-stu-id="020ad-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="020ad-249">例如，加入下列程式碼，您**桌面**登入頁面的程式碼後置：</span><span class="sxs-lookup"><span data-stu-id="020ad-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="020ad-250">使用者成功登入之後，表單驗證會根據預設重新導向至您的桌面首頁 (因為它只會有的概念*一個*預設網頁)。</span><span class="sxs-lookup"><span data-stu-id="020ad-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="020ad-251">您要增強您的行動裝置的登入頁面，讓它將重新導向至行動裝置首頁之後成功登入。</span><span class="sxs-lookup"><span data-stu-id="020ad-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="020ad-252">例如，加入下列程式碼，您**行動**登入頁面的程式碼後置：</span><span class="sxs-lookup"><span data-stu-id="020ad-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
  <span data-ttu-id="020ad-253">此程式碼假設您的網頁有呼叫 LoginUser，如所示的預設專案範本的 Login 伺服器控制項。</span><span class="sxs-lookup"><span data-stu-id="020ad-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="020ad-254">使用輸出快取</span><span class="sxs-lookup"><span data-stu-id="020ad-254">Working with Output Caching</span></span>

<span data-ttu-id="020ad-255">如果您使用輸出快取，請注意，根據預設，它是桌上型電腦的使用者，可以造訪特定 URL （導致快取其輸出），後面則會收到快取的桌面輸出的行動使用者。</span><span class="sxs-lookup"><span data-stu-id="020ad-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="020ad-256">無論您只是改變您的裝置類型的主版頁面，或實作完全不同的 Web Form，每種裝置類型，適用於這項警告。</span><span class="sxs-lookup"><span data-stu-id="020ad-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="020ad-257">若要避免此問題，您可以指示 ASP.NET 來變更快取項目，根據造訪者是否正在使用行動裝置。</span><span class="sxs-lookup"><span data-stu-id="020ad-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="020ad-258">Hodnota VaryByCustom 將參數新增至您的頁面 OutputCache 宣告，如下所示：</span><span class="sxs-lookup"><span data-stu-id="020ad-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="020ad-259">接下來，定義*isMobileDevice*做為自訂快取參數，將下列方法新增覆寫至 Global.asax.cs 檔案：</span><span class="sxs-lookup"><span data-stu-id="020ad-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="020ad-260">這可確保行動裝置的訪客頁面不會收到先前桌面的訪客，以放入快取的輸出。</span><span class="sxs-lookup"><span data-stu-id="020ad-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="020ad-261">實用的範例</span><span class="sxs-lookup"><span data-stu-id="020ad-261">A working example</span></span>

<span data-ttu-id="020ad-262">若要查看作用中的這些技巧，請下載[這份白皮書的程式碼範例](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="020ad-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="020ad-263">Web Form 範例應用程式會自動將行動裝置的使用者一組稱為 「 行動裝置的子資料夾中的行動裝置專屬頁面重新導向。</span><span class="sxs-lookup"><span data-stu-id="020ad-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="020ad-264">標記和樣式的那些頁面更適合行動瀏覽器，您可以看到與下列螢幕擷取畫面：</span><span class="sxs-lookup"><span data-stu-id="020ad-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="020ad-265">更多秘訣行動瀏覽器最佳化您的標記和 CSS 的詳細資訊，請參閱 「 樣式行動頁面的行動瀏覽器 」 在本文件稍後的一節。</span><span class="sxs-lookup"><span data-stu-id="020ad-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="020ad-266">ASP.NET MVC 應用程式會如何呈現行動裝置專屬頁面</span><span class="sxs-lookup"><span data-stu-id="020ad-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="020ad-267">因為 「 模型-檢視-控制器模式以減少從展示邏輯 （在檢視中） 的應用程式邏輯 （在控制站），您可以選擇任何下列其中一個方法來處理伺服器端程式碼中的行動支援：</span><span class="sxs-lookup"><span data-stu-id="020ad-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="020ad-268">\***桌上型電腦和行動瀏覽器中，使用相同的控制器和檢視，但會呈現不同的 Razor 版面配置，根據裝置類型 \* 檢視。**</span><span class="sxs-lookup"><span data-stu-id="020ad-268">\***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type\*.**</span></span> <span data-ttu-id="020ad-269">如果您在所有的裝置上顯示相同的資料，但只是想要提供不同的 CSS 樣式表，或是變更幾個最上層的 HTML 項目，行動裝置的 asp.net，這個選項最有用。</span><span class="sxs-lookup"><span data-stu-id="020ad-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="020ad-270">***桌上型電腦和行動瀏覽器中，使用相同的控制站，但會呈現每種裝置類型的不同檢視***。</span><span class="sxs-lookup"><span data-stu-id="020ad-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="020ad-271">如果您是顯示大致上相同的資料，而且對於使用者，提供相同的工作流程，這個選項最有用，但想要轉譯非常不同的 HTML 標記，以符合所使用的裝置。</span><span class="sxs-lookup"><span data-stu-id="020ad-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="020ad-272">\*\**建立桌面和行動瀏覽器，實作獨立的控制器和檢視每個不同的區域 *。**</span><span class="sxs-lookup"><span data-stu-id="020ad-272">\***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each\*.**</span></span> <span data-ttu-id="020ad-273">若您使用顯示非常不同的畫面，內含不同資訊而導致使用者透過不同的工作流程適用於其裝置類型，這個選項最有用。</span><span class="sxs-lookup"><span data-stu-id="020ad-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="020ad-274">這可能表示部分重複程式碼，但您可以最小化那個隔離一般邏輯為基礎的圖層或服務。</span><span class="sxs-lookup"><span data-stu-id="020ad-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="020ad-275">如果您想要採取**第一個**選項出入 Razor 版面配置每種裝置類型，它是非常簡單。</span><span class="sxs-lookup"><span data-stu-id="020ad-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="020ad-276">只要修改您\_ViewStart.cshtml 檔案，如下所示：</span><span class="sxs-lookup"><span data-stu-id="020ad-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="020ad-277">現在您可以建立行動專用的配置，稱為\_LayoutMobile.cshtml 頁面結構和 CSS 規則 適用於行動裝置。</span><span class="sxs-lookup"><span data-stu-id="020ad-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="020ad-278">如果您想要採取**第二個**選項根據訪客的裝置類型的轉譯完全不同檢視，請參閱[Scott Hanselman 的部落格文章](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx)。</span><span class="sxs-lookup"><span data-stu-id="020ad-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="020ad-279">這份文件的其餘部分著重於**第三個**選項 – 建立個別的控制器*和*行動裝置 – 讓您能夠控制其確實提供哪些功能的子集來進行行動裝置的訪客的檢視。</span><span class="sxs-lookup"><span data-stu-id="020ad-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="020ad-280">在 ASP.NET MVC 應用程式內的行動裝置區域設定</span><span class="sxs-lookup"><span data-stu-id="020ad-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="020ad-281">您可以新增以一般方式稱為 「 行動 」，在現有的 ASP.NET MVC 應用程式的區域： 您在 方案總管的專案名稱上按一下滑鼠右鍵，然後選擇 新增相對區域。</span><span class="sxs-lookup"><span data-stu-id="020ad-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="020ad-282">以您平常的 ASP.NET MVC 應用程式內的任何其他區域，您可以再新增控制器和檢視。</span><span class="sxs-lookup"><span data-stu-id="020ad-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="020ad-283">比方說，新增至您行動裝置的區域稱為 HomeController 作為行動裝置的訪客首頁的新控制器。</span><span class="sxs-lookup"><span data-stu-id="020ad-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="020ad-284">確保 URL /Mobile 達到行動裝置的首頁</span><span class="sxs-lookup"><span data-stu-id="020ad-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="020ad-285">如果您想要連線到您行動裝置的區域內 HomeController 的索引動作 URL /Mobile 時，您必須對路由組態的兩個的小型變更。</span><span class="sxs-lookup"><span data-stu-id="020ad-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="020ad-286">首先，更新 MobileAreaRegistration 類別使 HomeController 預設控制器在行動裝置的區域中，如下列程式碼所示：</span><span class="sxs-lookup"><span data-stu-id="020ad-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="020ad-287">這表示在行動裝置的首頁現在即將放置在 /Mobile，而不是行動/首頁，因為 「 首頁 」 現在是隱含預設控制器名稱行動頁面。</span><span class="sxs-lookup"><span data-stu-id="020ad-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="020ad-288">接下來，請注意，加入您的應用程式 （亦即，行動裝置一，除了現有的桌面一個） 中的第二個 HomeController，您將會中斷您的一般桌面首頁。</span><span class="sxs-lookup"><span data-stu-id="020ad-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="020ad-289">它將會失敗並出現錯誤 「*符合控制器名稱為 'Home' 找到多個類型*"。</span><span class="sxs-lookup"><span data-stu-id="020ad-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="020ad-290">若要解決此問題，請指定您的桌面 HomeController 在模稜兩可時，應該會優先更新最上層路由組態 （在 Global.asax.cs):</span><span class="sxs-lookup"><span data-stu-id="020ad-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="020ad-291">現在錯誤將會淘汰過，和 URL http://<em>yoursite</em>/ 會到達桌面的首頁和 http://<em>您的站台</em>/mobile/ 會連線到行動裝置的首頁。</span><span class="sxs-lookup"><span data-stu-id="020ad-291">Now the error will go away, and the URL http://<em>yoursite</em>/ will reach the desktop homepage, and http://<em>yoursite</em>/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="020ad-292">重新導向至您的行動裝置區域的行動訪客</span><span class="sxs-lookup"><span data-stu-id="020ad-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="020ad-293">因此有許多可能的方法，將重新導向邏輯在 ASP.NET MVC 中，有許多不同的擴充點。</span><span class="sxs-lookup"><span data-stu-id="020ad-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="020ad-294">其中一個不錯的選項是建立一個篩選屬性、 [RedirectMobileDevicesToMobileArea]，執行重新導向，如果符合下列條件：</span><span class="sxs-lookup"><span data-stu-id="020ad-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="020ad-295">它是使用者工作階段中的第一個要求 （亦即，Session.IsNewSession 等於 true）</span><span class="sxs-lookup"><span data-stu-id="020ad-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="020ad-296">要求來自行動瀏覽器 （亦即，Request.Browser.IsMobileDevice 等於 true）</span><span class="sxs-lookup"><span data-stu-id="020ad-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="020ad-297">使用者已不要求行動裝置的區域中的資源 (亦即*路徑*URL 部分的開頭不是 /Mobile)</span><span class="sxs-lookup"><span data-stu-id="020ad-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="020ad-298">本白皮書所隨附的可下載範例包含此邏輯的實作。</span><span class="sxs-lookup"><span data-stu-id="020ad-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="020ad-299">它會實作為衍生自 AuthorizeAttribute，這表示它在即使您使用輸出快取 （否則如果桌面的訪客第一次存取特定 URL，桌面的輸出可能會快取，並再提供給可以正確運作的授權篩選條件，後續行動訪客）。</span><span class="sxs-lookup"><span data-stu-id="020ad-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="020ad-300">因為它是篩選條件時，您可以選擇要套用至特定的控制器和動作例如</span><span class="sxs-lookup"><span data-stu-id="020ad-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="020ad-301">…</span><span class="sxs-lookup"><span data-stu-id="020ad-301">…</span></span> <span data-ttu-id="020ad-302">或您可以將它套用到所有控制器和動作的 MVC 3*全域篩選*Global.asax.cs 檔案中：</span><span class="sxs-lookup"><span data-stu-id="020ad-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="020ad-303">可下載的範例也會示範如何建立此屬性的重新導向至您行動裝置的區域內的特定位置的子類別。</span><span class="sxs-lookup"><span data-stu-id="020ad-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="020ad-304">這表示，例如，您可以：</span><span class="sxs-lookup"><span data-stu-id="020ad-304">This means, for example, you can:</span></span>

- <span data-ttu-id="020ad-305">註冊全域篩選器如下所示上述的預設傳送行動裝置的訪客在行動裝置的首頁。</span><span class="sxs-lookup"><span data-stu-id="020ad-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="020ad-306">以採取行動的訪客要求它們有任何產品頁面的行動裝置版本的 「 檢視產品 」 動作，也適用於特殊的 [RedirectMobileDevicesToMobileProductPage] 篩選器。</span><span class="sxs-lookup"><span data-stu-id="020ad-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="020ad-307">也適用於特定的動作，重新導向行動訪客的對等的行動頁面的 篩選器的其他特殊子類別</span><span class="sxs-lookup"><span data-stu-id="020ad-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="020ad-308">設定表單驗證，應遵守您的行動裝置頁面</span><span class="sxs-lookup"><span data-stu-id="020ad-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="020ad-309">如果您使用表單驗證，您應該注意，當使用者需要登入，它會自動將使用者重新導向至單一特定 「 登入 」 的 URL，其預設值是 **/帳戶/登入**。</span><span class="sxs-lookup"><span data-stu-id="020ad-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="020ad-310">這表示行動使用者，可能會重新導向至您的桌面登入 動作。</span><span class="sxs-lookup"><span data-stu-id="020ad-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="020ad-311">若要避免這個問題，使它會重新導向行動使用者一次在行動裝置的 「 登入 」 動作，在桌面的登入 動作加入邏輯。</span><span class="sxs-lookup"><span data-stu-id="020ad-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="020ad-312">如果您使用預設 ASP.NET MVC 應用程式範本，更新 AccountController 的登入動作，如下所示：</span><span class="sxs-lookup"><span data-stu-id="020ad-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="020ad-313">…</span><span class="sxs-lookup"><span data-stu-id="020ad-313">…</span></span> <span data-ttu-id="020ad-314">取代預設文字，然後再呼叫 AccountController 行動的區域中的控制站上實作適當的行動裝置專屬 「 登入 」 動作。</span><span class="sxs-lookup"><span data-stu-id="020ad-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="020ad-315">使用輸出快取</span><span class="sxs-lookup"><span data-stu-id="020ad-315">Working with Output Caching</span></span>

<span data-ttu-id="020ad-316">如果您使用 [OutputCache] 篩選器，您必須強制因裝置類型的快取項目。</span><span class="sxs-lookup"><span data-stu-id="020ad-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="020ad-317">比方說，撰寫程式碼：</span><span class="sxs-lookup"><span data-stu-id="020ad-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="020ad-318">然後，新增至 Global.asax.cs 檔案的下列方法：</span><span class="sxs-lookup"><span data-stu-id="020ad-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="020ad-319">這可確保行動裝置的訪客頁面不會收到先前桌面的訪客，以放入快取的輸出。</span><span class="sxs-lookup"><span data-stu-id="020ad-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="020ad-320">實用的範例</span><span class="sxs-lookup"><span data-stu-id="020ad-320">A working example</span></span>

<span data-ttu-id="020ad-321">若要查看作用中的這些技巧，請下載[這份白皮書的程式碼相關聯的範例](https://docs.microsoft.com/aspnet/mobile/overview)。</span><span class="sxs-lookup"><span data-stu-id="020ad-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="020ad-322">此範例包含 ASP.NET MVC 3 （發行候選版本） 應用程式增強為支援行動裝置使用上面所述的方法。</span><span class="sxs-lookup"><span data-stu-id="020ad-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="020ad-323">進一步的指引和建議</span><span class="sxs-lookup"><span data-stu-id="020ad-323">Further guidance and suggestions</span></span>

<span data-ttu-id="020ad-324">下列討論適用於 Web Form 和 MVC 的開發人員使用這份文件所述的技巧。</span><span class="sxs-lookup"><span data-stu-id="020ad-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="020ad-325">增強您的重新導向邏輯使用 51Degrees.mobi Foundation</span><span class="sxs-lookup"><span data-stu-id="020ad-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="020ad-326">這份文件中所示的重新導向邏輯可能是完全滿足您的應用程式，但如果您要停用工作階段，將無法運作或與拒絕的 cookie （這些不能有工作階段），因為它不會知道是否為指定的要求的行動瀏覽器第一個來自該訪客。</span><span class="sxs-lookup"><span data-stu-id="020ad-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="020ad-327">此外，您已了解開放原始碼 51Degrees.mobi Foundation 如何改善 ASP 的精確度。NET 的瀏覽器偵測。</span><span class="sxs-lookup"><span data-stu-id="020ad-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="020ad-328">它也有內建的能力，來重新導向至特定位置，在 Web.config 中設定的行動訪客。就能夠運作，而不根據 ASP.NET 工作階段 (並因此 cookie) 所儲存的訪客的 HTTP 標頭和 IP 位址的雜湊的暫存記錄檔，使它知道每一個要求是否從給定造訪的第一個。</span><span class="sxs-lookup"><span data-stu-id="020ad-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="020ad-329">下列項目加入至 web.config 檔案 fiftyOne 區段將會重新導向至頁面偵測到的行動裝置的第一個要求 ~ / Mobile/Default.aspx。</span><span class="sxs-lookup"><span data-stu-id="020ad-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="020ad-330">頁面 [行動] 資料夾下的任何要求都會*不*重新導向，無論何種裝置類型。</span><span class="sxs-lookup"><span data-stu-id="020ad-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="020ad-331">如果行動裝置已經過一段非作用中的 20 分鐘或更多裝置將會被遺忘，後續要求將會被視為新的目的，重新導向。</span><span class="sxs-lookup"><span data-stu-id="020ad-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="020ad-332">如需詳細資訊，請參閱 < [51degrees.mobi Foundation 文件](https://github.com/51Degrees/dotNET-Device-Detection)。</span><span class="sxs-lookup"><span data-stu-id="020ad-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="020ad-333">您*可以*使用 51Degrees.mobi Foundation 的重新導向功能，在 ASP.NET MVC 應用程式，但您必須定義您的重新導向設定，以純文字的 Url，不是由路由參數，或將 MVC 篩選條件上的動作。</span><span class="sxs-lookup"><span data-stu-id="020ad-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="020ad-334">這是因為 （在本文撰寫之際） 51Degrees.mobi Foundation 無法辨識或路由篩選器。</span><span class="sxs-lookup"><span data-stu-id="020ad-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>


### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="020ad-335">停用的轉碼器和 Proxy 伺服器</span><span class="sxs-lookup"><span data-stu-id="020ad-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="020ad-336">行動網路業者他們行動裝置的網際網路的方法有兩個廣泛的目標：</span><span class="sxs-lookup"><span data-stu-id="020ad-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="020ad-337">提供做為盡可能更相關內容</span><span class="sxs-lookup"><span data-stu-id="020ad-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="020ad-338">可以共用限制的廣播網路頻寬的客戶數目最大化</span><span class="sxs-lookup"><span data-stu-id="020ad-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="020ad-339">由於大部分的網頁設計大型桌面大小的螢幕和列快速修正寬頻連線時，許多運算子會使用*轉錄器*或是*proxy 伺服器*，動態變更網頁內容。</span><span class="sxs-lookup"><span data-stu-id="020ad-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="020ad-340">他們可能會修改您的 HTML 標記或 CSS 以符合較小的螢幕 （特別是針對 「 功能電話 」 缺少的處理能力來處理複雜的版面配置），和他們可能會重新映像 （大幅降低其品質） 壓縮以改善網頁傳送速度。</span><span class="sxs-lookup"><span data-stu-id="020ad-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="020ad-341">但是，如果您所採取的工作，以產生您的站台的行動裝置最佳化版本，您可能不想干擾它任何進一步的網路業者。</span><span class="sxs-lookup"><span data-stu-id="020ad-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="020ad-342">您可以將下行加入頁面\_任何 ASP.NET Web Form 中的 Load 事件：</span><span class="sxs-lookup"><span data-stu-id="020ad-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="020ad-343">或者，您也可以針對 ASP.NET MVC 控制站，您可以新增下列方法覆寫，讓它套用至該控制器上的所有動作：</span><span class="sxs-lookup"><span data-stu-id="020ad-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="020ad-344">產生的 HTTP 訊息會通知 W3C 相容轉錄器並不是用來改變內容的 proxy。</span><span class="sxs-lookup"><span data-stu-id="020ad-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="020ad-345">當然，則行動網路運算子會遵守此訊息無法保證。</span><span class="sxs-lookup"><span data-stu-id="020ad-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="020ad-346">行動瀏覽器的樣式設定行動裝置頁面</span><span class="sxs-lookup"><span data-stu-id="020ad-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="020ad-347">它超出範圍的這份文件中，有詳細描述哪些類型的 HTML 標記工作正確，或哪些 web 設計技術最大化在特定的裝置上的可用性。</span><span class="sxs-lookup"><span data-stu-id="020ad-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="020ad-348">它有增加，尋找夠簡單版面配置，讓您適合行動大小 畫面中，而不使用不可靠 HTML 或 CSS 技巧。</span><span class="sxs-lookup"><span data-stu-id="020ad-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="020ad-349">不過，是一個重要的技術，值得一提*檢視區的中繼標記*。</span><span class="sxs-lookup"><span data-stu-id="020ad-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="020ad-350">某些現代行動瀏覽器，在適用於桌面的監視器，投入時間顯示網頁中呈現的頁面上的虛擬的畫布，也稱為 「 檢視區 」 （例如，虛擬的檢視區為 980 像素寬在 iPhone 上和 850 個像素寬 Opera Mobile 上依預設），然後相應減少的結果，以符合螢幕的實體像素為單位。</span><span class="sxs-lookup"><span data-stu-id="020ad-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="020ad-351">使用者可以拉近然後該檢視區前後移動瀏覽。</span><span class="sxs-lookup"><span data-stu-id="020ad-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="020ad-352">這樣做的好處，它可讓瀏覽器顯示頁面在其預期的配置中，但也有缺點，它會強制縮放和取景功能不適用於使用者。</span><span class="sxs-lookup"><span data-stu-id="020ad-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="020ad-353">如果您要設計適用於行動裝置，最好設計窄的畫面，因此不需要的任何縮放或水平捲動。</span><span class="sxs-lookup"><span data-stu-id="020ad-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="020ad-354">告訴行動瀏覽器中檢視區應該是寬度的方式是透過使用非標準*viewport*中繼標籤。</span><span class="sxs-lookup"><span data-stu-id="020ad-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="020ad-355">例如，如果您將下列新增至您的頁面標頭 區段中，</span><span class="sxs-lookup"><span data-stu-id="020ad-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="020ad-356">…</span><span class="sxs-lookup"><span data-stu-id="020ad-356">…</span></span> <span data-ttu-id="020ad-357">然後支援 smartphone 瀏覽器會配置到 480 像素寬虛擬畫布上的頁面。</span><span class="sxs-lookup"><span data-stu-id="020ad-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="020ad-358">這表示，如果您的 HTML 項目會定義其寬度，以百分比表示，百分比會解譯這個 480 像素的寬度，不預設檢視區寬度方面。</span><span class="sxs-lookup"><span data-stu-id="020ad-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="020ad-359">如此一來，使用者是比較不可能需要縮放和取景位置調整 水平 – 大幅改善行動瀏覽體驗。</span><span class="sxs-lookup"><span data-stu-id="020ad-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="020ad-360">如果您想檢視區寬度，以符合裝置的實體像素為單位，您可以指定下列項目：</span><span class="sxs-lookup"><span data-stu-id="020ad-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="020ad-361">這麼做才能正常運作，您必須明確地強制超過該寬度的項目 (例如，使用*寬度*屬性或 CSS 屬性)，否則瀏覽器將會強制在使用較大的檢視區不論。</span><span class="sxs-lookup"><span data-stu-id="020ad-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="020ad-362">另請參閱：[非標準的檢視區標記的更多詳細](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html)。</span><span class="sxs-lookup"><span data-stu-id="020ad-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="020ad-363">現今大部分的智慧型手機支援*雙向*： 它們可以保留在直向或橫向模式。</span><span class="sxs-lookup"><span data-stu-id="020ad-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="020ad-364">因此，務必不要像素為單位的螢幕寬度的相關假設。</span><span class="sxs-lookup"><span data-stu-id="020ad-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="020ad-365">不要甚至是假設的螢幕寬度固定的因為使用者可以重新導向他們的裝置，都在頁面上。</span><span class="sxs-lookup"><span data-stu-id="020ad-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="020ad-366">下列 meta 標記中，通知他們內容的頁面已經過最佳化，適用於行動裝置，並因此不應該轉換，可能也會接受較舊的 Windows Mobile 和 Blackberry 裝置。</span><span class="sxs-lookup"><span data-stu-id="020ad-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="020ad-367">其他資源</span><span class="sxs-lookup"><span data-stu-id="020ad-367">Additional Resources</span></span>

<span data-ttu-id="020ad-368">如需行動裝置模擬器，模擬器可用來測試行動裝置的 ASP.NET web 應用程式的清單，請參閱網頁[模擬熱門的行動裝置，以測試](../mobile/device-simulators.md)。</span><span class="sxs-lookup"><span data-stu-id="020ad-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="020ad-369">參與名單</span><span class="sxs-lookup"><span data-stu-id="020ad-369">Credits</span></span>

- <span data-ttu-id="020ad-370">主要作者： Steven Sanderson</span><span class="sxs-lookup"><span data-stu-id="020ad-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="020ad-371">檢閱者 / 其他內容作者： James Rosewell、 Mikael Söderström、 Scott Hanselman、 Scott Hunter</span><span class="sxs-lookup"><span data-stu-id="020ad-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
