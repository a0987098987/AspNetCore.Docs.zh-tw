---
uid: web-forms/overview/older-versions-getting-started/master-pages/master-pages-and-asp-net-ajax-cs
title: 主版頁面和 ASP.NET AJAX (C#) |Microsoft Docs
author: rick-anderson
description: 討論使用 ASP.NET AJAX 和主版頁面的選項。 探討使用 ScriptManagerProxy 類別;討論各種 JS 檔案會列印文件的載入，請 dependi...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/11/2008
ms.topic: article
ms.assetid: 0c55eb66-ba44-4d49-98e8-5c87fd9b1111
ms.technology: dotnet-webforms
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/master-pages-and-asp-net-ajax-cs
msc.type: authoredcontent
ms.openlocfilehash: 6fceed046ead6c8129d55aa4e4272cfef0ebe184
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: HT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/03/2018
ms.locfileid: "37390904"
---
<a name="master-pages-and-aspnet-ajax-c"></a><span data-ttu-id="0d791-104">主版頁面和 ASP.NET AJAX (C#)</span><span class="sxs-lookup"><span data-stu-id="0d791-104">Master Pages and ASP.NET AJAX (C#)</span></span>
====================
<span data-ttu-id="0d791-105">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="0d791-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="0d791-106">[下載程式碼](http://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_08_CS.zip)或[下載 PDF](http://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_08_CS.pdf)</span><span class="sxs-lookup"><span data-stu-id="0d791-106">[Download Code](http://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_08_CS.zip) or [Download PDF](http://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_08_CS.pdf)</span></span>

> <span data-ttu-id="0d791-107">討論使用 ASP.NET AJAX 和主版頁面的選項。</span><span class="sxs-lookup"><span data-stu-id="0d791-107">Discusses options for using ASP.NET AJAX and master pages.</span></span> <span data-ttu-id="0d791-108">探討使用 ScriptManagerProxy 類別;討論各種 JS 檔案會載入方式取決於是否使用 ScriptManager 在主頁面或內容頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-108">Looks at using the ScriptManagerProxy class; discusses how the various JS files are loaded depending on whether the ScriptManager is used in the Master page or Content page.</span></span>


## <a name="introduction"></a><span data-ttu-id="0d791-109">簡介</span><span class="sxs-lookup"><span data-stu-id="0d791-109">Introduction</span></span>

<span data-ttu-id="0d791-110">過去幾年來，越來越多的開發人員一直在建立[AJAX](http://en.wikipedia.org/wiki/Ajax_(programming))-啟用 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="0d791-110">Over the past several years, more and more developers have been building [AJAX](http://en.wikipedia.org/wiki/Ajax_(programming))-enabled web applications.</span></span> <span data-ttu-id="0d791-111">啟用 AJAX 的網站使用多個相關的 web 技術，以提供回應速度更快的使用者體驗。</span><span class="sxs-lookup"><span data-stu-id="0d791-111">An AJAX-enabled website uses a number of related web technologies to offer a more responsive user experience.</span></span> <span data-ttu-id="0d791-112">建立啟用 AJAX 的 ASP.NET 應用程式是 Microsoft 的感謝出乎意料的簡單[ASP.NET AJAX 架構](../../../../ajax/index.md)。</span><span class="sxs-lookup"><span data-stu-id="0d791-112">Creating AJAX-enabled ASP.NET applications is amazingly easy thanks to Microsoft's [ASP.NET AJAX framework](../../../../ajax/index.md).</span></span> <span data-ttu-id="0d791-113">ASP.NET AJAX 是內建 ASP.NET 3.5 和 Visual Studio 2008;它也會提供個別下載 ASP.NET 2.0 應用程式的。</span><span class="sxs-lookup"><span data-stu-id="0d791-113">ASP.NET AJAX is built into ASP.NET 3.5 and Visual Studio 2008; it is also available as a separate download for ASP.NET 2.0 applications.</span></span>

<span data-ttu-id="0d791-114">建置時使用 ASP.NET AJAX 架構啟用 AJAX 的網頁，您必須加入精確地說是一個[ScriptManager 控制項](https://msdn.microsoft.com/library/bb398863.aspx)使用 framework 的每個頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-114">When building AJAX-enabled web pages with the ASP.NET AJAX framework, you must add precisely one [ScriptManager control](https://msdn.microsoft.com/library/bb398863.aspx) to each and every page that uses the framework.</span></span> <span data-ttu-id="0d791-115">正如其名，ScriptManager 會管理用戶端指令碼會在啟用 AJAX 的網頁。</span><span class="sxs-lookup"><span data-stu-id="0d791-115">As its name implies, the ScriptManager manages the client-side script used in AJAX-enabled web pages.</span></span> <span data-ttu-id="0d791-116">最小值，ScriptManager 會發出 HTML，它會指示瀏覽器以該結構為 ASP.NET AJAX 用戶端程式庫下載 JavaScript 檔案。</span><span class="sxs-lookup"><span data-stu-id="0d791-116">At a minimum, the ScriptManager emits HTML that instructs the browser to download the JavaScript files that makeup the ASP.NET AJAX Client Library.</span></span> <span data-ttu-id="0d791-117">它也可以用來註冊自訂的 JavaScript 檔案、 指令碼啟用網頁服務及自訂應用程式服務功能。</span><span class="sxs-lookup"><span data-stu-id="0d791-117">It can also be used to register custom JavaScript files, script-enabled web services, and custom application service functionality.</span></span>

<span data-ttu-id="0d791-118">如果您的網站會使用主版頁面 （正常），您不一定需要將 ScriptManager 控制項新增至每個單一的內容頁面;相反地，您可以將 ScriptManager 控制項加入主版頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-118">If your site uses master pages (as it should), you do not necessarily need to add a ScriptManager control to every single content page; rather, you can add a ScriptManager control to the master page.</span></span> <span data-ttu-id="0d791-119">本教學課程會示範如何將 ScriptManager 控制項新增至主版頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-119">This tutorial shows how to add the ScriptManager control to the master page.</span></span> <span data-ttu-id="0d791-120">它也會探討如何使用 ScriptManagerProxy 控制項特定的內容頁面中註冊自訂的指令碼和指令碼服務。</span><span class="sxs-lookup"><span data-stu-id="0d791-120">It also looks at how to use the ScriptManagerProxy control to register custom scripts and script services in a specific content page.</span></span>

> [!NOTE]
> <span data-ttu-id="0d791-121">設計或建置具有 ASP.NET AJAX 架構的啟用 AJAX 的 web 應用程式，就無法瀏覽本教學課程。</span><span class="sxs-lookup"><span data-stu-id="0d791-121">This tutorial does not explore designing or building AJAX-enabled web applications with the ASP.NET AJAX framework.</span></span> <span data-ttu-id="0d791-122">如需使用 AJAX 的詳細資訊，請參閱[ASP.NET AJAX 影片](../../../videos/aspnet-ajax/index.md)並[教學課程](../aspnet-ajax/understanding-partial-page-updates-with-asp-net-ajax.md)，以及為本教學課程結尾處進一步閱讀 > 一節中列出這些資源。</span><span class="sxs-lookup"><span data-stu-id="0d791-122">For more information on using AJAX consult the [ASP.NET AJAX videos](../../../videos/aspnet-ajax/index.md) and [tutorials](../aspnet-ajax/understanding-partial-page-updates-with-asp-net-ajax.md), as well as those resources listed in the Further Reading section at the end of this tutorial.</span></span>


## <a name="examining-the-markup-emitted-by-the-scriptmanager-control"></a><span data-ttu-id="0d791-123">檢查送出 ScriptManager 控制項的標記</span><span class="sxs-lookup"><span data-stu-id="0d791-123">Examining the Markup Emitted by the ScriptManager Control</span></span>

<span data-ttu-id="0d791-124">ScriptManager 控制項就會發出該結構為 ASP.NET AJAX 用戶端程式庫會指示瀏覽器來下載 JavaScript 檔案的標記。</span><span class="sxs-lookup"><span data-stu-id="0d791-124">The ScriptManager control emits markup that instructs the browser to download the JavaScript files that makeup the ASP.NET AJAX Client Library.</span></span> <span data-ttu-id="0d791-125">也會增加一堆內嵌 JavaScript 初始化此程式庫的頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-125">It also adds a bit of inline JavaScript to the page that initializes this library.</span></span> <span data-ttu-id="0d791-126">下列標記會顯示新增至包含 ScriptManager 控制項的頁面呈現的輸出內容：</span><span class="sxs-lookup"><span data-stu-id="0d791-126">The following markup shows the content that is added to the rendered output of a page that includes a ScriptManager control:</span></span>


[!code-html[Main](master-pages-and-asp-net-ajax-cs/samples/sample1.html)]

<span data-ttu-id="0d791-127">`<script src="url"></script>`標記會指示瀏覽器下載並執行的 JavaScript 檔案*url*。</span><span class="sxs-lookup"><span data-stu-id="0d791-127">The `<script src="url"></script>` tags instruct the browser to download and execute the JavaScript file at *url*.</span></span> <span data-ttu-id="0d791-128">ScriptManager 會發出三個這類標記;其中一個參考的檔案`WebResource.axd`，而其他兩個參考檔案`ScriptResource.axd`。</span><span class="sxs-lookup"><span data-stu-id="0d791-128">The ScriptManager emits three such tags; one references the file `WebResource.axd`, while the other two reference the file `ScriptResource.axd`.</span></span> <span data-ttu-id="0d791-129">這些檔案實際上不存在您的網站中的檔案。</span><span class="sxs-lookup"><span data-stu-id="0d791-129">These files do not actually exist as files in your website.</span></span> <span data-ttu-id="0d791-130">相反地，當這些檔案的其中一個要求抵達 web 伺服器時，ASP.NET 引擎會檢查查詢字串，並傳回適當的 JavaScript 內容。</span><span class="sxs-lookup"><span data-stu-id="0d791-130">Instead, when a request for either one of these files arrives at the web server, the ASP.NET engine examines the querystring and returns the appropriate JavaScript content.</span></span> <span data-ttu-id="0d791-131">這三個的外部 JavaScript 檔案所提供的指令碼會構成 ASP.NET AJAX 架構的用戶端程式庫。</span><span class="sxs-lookup"><span data-stu-id="0d791-131">The script provided by these three external JavaScript files constitute the ASP.NET AJAX framework's Client Library.</span></span> <span data-ttu-id="0d791-132">其他`<script>`ScriptManager 所發出的標記包括內嵌指令碼會初始化此程式庫。</span><span class="sxs-lookup"><span data-stu-id="0d791-132">The other `<script>` tags emitted by the ScriptManager include inline script that initializes this library.</span></span>

<span data-ttu-id="0d791-133">外部指令碼參考和 ScriptManager 所發出的內嵌指令碼是針對使用 ASP.NET AJAX 架構，但不是使用 framework 的頁面不需要的頁面，基本屬性。</span><span class="sxs-lookup"><span data-stu-id="0d791-133">The external script references and inline script emitted by the ScriptManager are essential for a page that uses the ASP.NET AJAX framework, but is not needed for pages that do not use the framework.</span></span> <span data-ttu-id="0d791-134">因此，您可能原因，最好只將 ScriptManager 加入至使用 ASP.NET AJAX 架構的頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-134">Therefore, you might reason that it is ideal to only add a ScriptManager to those pages that use the ASP.NET AJAX framework.</span></span> <span data-ttu-id="0d791-135">這已足夠，但如果您有許多網頁使用的架構，您就可以得到將 ScriptManager 控制項新增至所有頁面-重複性的工作中，這麼說。</span><span class="sxs-lookup"><span data-stu-id="0d791-135">And this is sufficient, but if you have many pages that use the framework you'll end up adding the ScriptManager control to all pages - a repetitive task, to say the least.</span></span> <span data-ttu-id="0d791-136">或者，您可以將 ScriptManager 加入主版頁面，然後插入所有的內容頁面中的這個必要的指令碼。</span><span class="sxs-lookup"><span data-stu-id="0d791-136">Alternatively, you can add a ScriptManager to the master page, which then injects this necessary script into all content pages.</span></span> <span data-ttu-id="0d791-137">使用此方法時，您不需要記得要使用 ASP.NET AJAX 架構，因為它已包含的主版頁面的新頁面加入 ScriptManager。</span><span class="sxs-lookup"><span data-stu-id="0d791-137">With this approach, you do not need to remember to add a ScriptManager to a new page that uses the ASP.NET AJAX framework because it is already included by the master page.</span></span> <span data-ttu-id="0d791-138">步驟 1 逐步 ScriptManager 加入主版頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-138">Step 1 walks through adding a ScriptManager to the master page.</span></span>

> [!NOTE]
> <span data-ttu-id="0d791-139">如果您計劃，包括您的主版頁面的使用者介面中的 AJAX 功能，然後在問題中沒有任何選擇-您必須包含 ScriptManager 主版頁面中。</span><span class="sxs-lookup"><span data-stu-id="0d791-139">If you plan on including AJAX functionality within the user interface of your master page, then you have no choice in the matter - you must include the ScriptManager in the master page.</span></span>


<span data-ttu-id="0d791-140">ScriptManager 加入主版頁面中的一項缺點是，上述指令碼中發出*每個*頁面上，無論其所需。</span><span class="sxs-lookup"><span data-stu-id="0d791-140">One downside of adding the ScriptManager to the master page is that the above script is emitted in *every* page, regardless of whether its needed.</span></span> <span data-ttu-id="0d791-141">這顯然會造成浪費頻寬有 ScriptManager 包含 （透過主版頁面中），但不使用任何功能的 ASP.NET AJAX 架構的頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-141">This clearly leads to wasted bandwidth for those pages that have the ScriptManager included (via the master page) yet don't use any features of the ASP.NET AJAX framework.</span></span> <span data-ttu-id="0d791-142">但浪費頻寬的多少？</span><span class="sxs-lookup"><span data-stu-id="0d791-142">But just how much bandwidth is wasted?</span></span>

- <span data-ttu-id="0d791-143">ScriptManager （如上所示） 所發出的實際內容總計過 1 KB。</span><span class="sxs-lookup"><span data-stu-id="0d791-143">The actual content emitted by the ScriptManager (shown above) totals a little over 1KB.</span></span>
- <span data-ttu-id="0d791-144">所參考的三個外部指令碼檔`<script>`項目，不過，包含大約 450 KB 的未壓縮的資料; 在使用 gzip 壓縮網站中，可以降低此總頻寬近乎 100 KB。</span><span class="sxs-lookup"><span data-stu-id="0d791-144">The three external script files referenced by the `<script>` element, however, comprise roughly 450KB of data uncompressed; in a website that uses gzip compression, this total bandwidth can be reduced near 100KB.</span></span> <span data-ttu-id="0d791-145">不過，這些指令碼檔案會由瀏覽器快取為一年，這表示它們只需要下載一次，則可以重複使用在網站上的其他頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-145">However, these script files are cached by the browser for one year, meaning that they only need to be downloaded once and then can be reused in other pages on the site.</span></span>

<span data-ttu-id="0d791-146">最好的情況下，然後，指令碼檔案會快取時，總成本是 1 KB 以下，這是微不足道。</span><span class="sxs-lookup"><span data-stu-id="0d791-146">In the best case, then, when the script files are cached, the total cost is 1KB, which is negligible.</span></span> <span data-ttu-id="0d791-147">在最糟的情況下，不過-這當指令碼檔案有尚未下載和 web 伺服器未使用任何形式的壓縮，-頻寬叫用為大約 450 KB，可以從第二個或兩個透過寬頻連線到最多一分鐘的任何位置加入 透過撥號數據機的使用者。</span><span class="sxs-lookup"><span data-stu-id="0d791-147">In the worst case, however - which is when the script files have not yet been downloaded and the web server is not using any form of compression - the bandwidth hit is around 450KB, which can add anywhere from a second or two over a broadband connection to up to a minute for users over dial-up modems.</span></span> <span data-ttu-id="0d791-148">好消息是，因為外部指令碼檔案會由瀏覽器快取，此最糟糕的情況不常發生。</span><span class="sxs-lookup"><span data-stu-id="0d791-148">The good news is that because the external script files are cached by the browser, this worst case scenario occurs infrequently.</span></span>

> [!NOTE]
> <span data-ttu-id="0d791-149">如果您仍然認為只要不將 ScriptManager 控制項放在主版頁面項目，請考慮 Web Form (`<form runat="server">`主版頁面中的標記)。</span><span class="sxs-lookup"><span data-stu-id="0d791-149">If you still feel uncomfortable placing the ScriptManager control in the master page, consider the Web Form (the `<form runat="server">` markup in the master page).</span></span> <span data-ttu-id="0d791-150">每個 ASP.NET 網頁會回傳模型必須包含一個 Web 表單。</span><span class="sxs-lookup"><span data-stu-id="0d791-150">Every ASP.NET page that uses the postback model must include precisely one Web Form.</span></span> <span data-ttu-id="0d791-151">加入 Web Form 加入其他內容： 一個隱藏的表單欄位的數字`<form>`標記本身，以及必要時，JavaScript 函式的初始化指令碼從回傳。</span><span class="sxs-lookup"><span data-stu-id="0d791-151">Adding a Web Form adds additional content: a number of hidden form fields, the `<form>` tag itself, and, if necessary, a JavaScript function for initiating a postback from script.</span></span> <span data-ttu-id="0d791-152">此標記是不必要的未回傳的網頁。</span><span class="sxs-lookup"><span data-stu-id="0d791-152">This markup is unnecessary for pages that don't postback.</span></span> <span data-ttu-id="0d791-153">移除主版頁面的 Web 表單，然後手動將它加入至其中一個需要每個內容頁面可以刪除此多餘的標記。</span><span class="sxs-lookup"><span data-stu-id="0d791-153">This extraneous markup could be eliminated by removing the Web Form from the master page and manually adding it to each content page that needs one.</span></span> <span data-ttu-id="0d791-154">不過，Web Form 主版頁面中的效益會多於缺點的不必要地加入特定內容的頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-154">However, the benefits of having the Web Form in the master page outweigh the disadvantages from having it added unnecessarily to certain content pages.</span></span>


## <a name="step-1-adding-a-scriptmanager-control-to-the-master-page"></a><span data-ttu-id="0d791-155">步驟 1： 將 ScriptManager 控制項新增至主版頁面</span><span class="sxs-lookup"><span data-stu-id="0d791-155">Step 1: Adding a ScriptManager Control to the Master Page</span></span>

<span data-ttu-id="0d791-156">使用 ASP.NET AJAX 架構的每個網頁必須包含一個 ScriptManager 控制項。</span><span class="sxs-lookup"><span data-stu-id="0d791-156">Every web page that uses the ASP.NET AJAX framework must contain precisely one ScriptManager control.</span></span> <span data-ttu-id="0d791-157">由於此需求，它通常可以合理地放置單一的 ScriptManager 控制項，在主版頁面，如此所有的內容頁面已自動包含 ScriptManager 控制項。</span><span class="sxs-lookup"><span data-stu-id="0d791-157">Because of this requirement, it usually makes sense to place a single ScriptManager control on the master page so that all content pages have the ScriptManager control automatically included.</span></span> <span data-ttu-id="0d791-158">此外，ScriptManager 必須出現在任何 ASP.NET AJAX 伺服器控制項，例如 UpdatePanel 和 UpdateProgress 控制項之前。</span><span class="sxs-lookup"><span data-stu-id="0d791-158">Furthermore, the ScriptManager must come before any of the ASP.NET AJAX server controls, such as the UpdatePanel and UpdateProgress controls.</span></span> <span data-ttu-id="0d791-159">因此，最好是將 ScriptManager 在 Web 表單內任何 ContentPlaceHolder 控制項之前。</span><span class="sxs-lookup"><span data-stu-id="0d791-159">Therefore, it's best to put the ScriptManager before any ContentPlaceHolder controls within the Web Form.</span></span>

<span data-ttu-id="0d791-160">開啟`Site.master`主版頁面，並將 ScriptManager 控制項新增至 Web 表單中的頁面之前`<div id="topContent">`項目 （請參閱 圖 1）。</span><span class="sxs-lookup"><span data-stu-id="0d791-160">Open the `Site.master` master page and add a ScriptManager control to the page within the Web Form, but before the `<div id="topContent">` element (see Figure 1).</span></span> <span data-ttu-id="0d791-161">如果您使用 Visual Web Developer 2008 或 Visual Studio 2008，ScriptManager 控制項位於工具箱的 [AJAX 延伸模組] 索引標籤。如果您使用 Visual Studio 2005，則您必須先安裝 ASP.NET AJAX 架構，並將控制項新增至工具箱。</span><span class="sxs-lookup"><span data-stu-id="0d791-161">If you are using Visual Web Developer 2008 or Visual Studio 2008, the ScriptManager control is located in the Toolbox in the AJAX Extensions tab. If you are using Visual Studio 2005, you will need to first install the ASP.NET AJAX framework and add the controls to the Toolbox.</span></span> <span data-ttu-id="0d791-162">請瀏覽[ASP.NET AJAX Wiki](https://github.com/DevExpress/AjaxControlToolkit/wiki) framework 取得 ASP.NET 2.0。</span><span class="sxs-lookup"><span data-stu-id="0d791-162">Visit the [ASP.NET AJAX Wiki](https://github.com/DevExpress/AjaxControlToolkit/wiki) to get the framework for ASP.NET 2.0.</span></span>

<span data-ttu-id="0d791-163">ScriptManager 加入網頁中之後, 變更其`ID`從`ScriptManager1`至`MyManager`。</span><span class="sxs-lookup"><span data-stu-id="0d791-163">After adding the ScriptManager to the page, change its `ID` from `ScriptManager1` to `MyManager`.</span></span>


<span data-ttu-id="0d791-164">[![ScriptManager 加入主版頁面](master-pages-and-asp-net-ajax-cs/_static/image2.png)](master-pages-and-asp-net-ajax-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-164">[![Add the ScriptManager to the Master Page](master-pages-and-asp-net-ajax-cs/_static/image2.png)](master-pages-and-asp-net-ajax-cs/_static/image1.png)</span></span>

<span data-ttu-id="0d791-165">**圖 01**： 將 ScriptManager 加入至主版頁面 ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-165">**Figure 01**: Add the ScriptManager to the Master Page  ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image3.png))</span></span>


## <a name="step-2-using-the-aspnet-ajax-framework-from-a-content-page"></a><span data-ttu-id="0d791-166">步驟 2： 使用 ASP.NET AJAX 架構，從內容頁面</span><span class="sxs-lookup"><span data-stu-id="0d791-166">Step 2: Using the ASP.NET AJAX Framework from a Content Page</span></span>

<span data-ttu-id="0d791-167">以 ScriptManager 控制項加入至主版頁面中，我們現在可以任何內容的頁面，以新增 ASP.NET AJAX 架構功能。</span><span class="sxs-lookup"><span data-stu-id="0d791-167">With the ScriptManager control added to the master page we can now add ASP.NET AJAX framework functionality to any content page.</span></span> <span data-ttu-id="0d791-168">讓我們建立新的 ASP.NET 頁面顯示的隨機選取的產品，從 Northwind 資料庫。</span><span class="sxs-lookup"><span data-stu-id="0d791-168">Let's create a new ASP.NET page that displays a randomly selected product from the Northwind database.</span></span> <span data-ttu-id="0d791-169">我們將使用 ASP.NET AJAX 架構的計時器控制項來更新此顯示每隔 15 秒，顯示新的產品。</span><span class="sxs-lookup"><span data-stu-id="0d791-169">We'll use the ASP.NET AJAX framework's Timer control to update this display every 15 seconds, showing a new product.</span></span>

<span data-ttu-id="0d791-170">藉由名為的根目錄中建立新的頁面開始`ShowRandomProduct.aspx`。</span><span class="sxs-lookup"><span data-stu-id="0d791-170">Start by creating a new page in the root directory named `ShowRandomProduct.aspx`.</span></span> <span data-ttu-id="0d791-171">別忘了要繫結至這個新頁面`Site.master`主版頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-171">Don't forget to bind this new page to the `Site.master` master page.</span></span>


<span data-ttu-id="0d791-172">[![將新的 ASP.NET 網頁新增至網站](master-pages-and-asp-net-ajax-cs/_static/image5.png)](master-pages-and-asp-net-ajax-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-172">[![Add a New ASP.NET Page to the Website](master-pages-and-asp-net-ajax-cs/_static/image5.png)](master-pages-and-asp-net-ajax-cs/_static/image4.png)</span></span>

<span data-ttu-id="0d791-173">**圖 02**： 將新的 ASP.NET 網頁新增至網站 ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-173">**Figure 02**: Add a New ASP.NET Page to the Website ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image6.png))</span></span>


<span data-ttu-id="0d791-174">請注意，在[*指定主版頁面的標題、 中繼標籤及其他 HTML 標頭*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md)教學課程中我們建立名為自訂的基底頁面類別`BasePage`如果它已產生頁面的標題未明確設定。</span><span class="sxs-lookup"><span data-stu-id="0d791-174">Recall that in the [*Specifying the Title, Meta Tags, and Other HTML Headers in the Master Page*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) tutorial we created a custom base page class named `BasePage` that generated the page's title if it was not explicitly set.</span></span> <span data-ttu-id="0d791-175">移至`ShowRandomProduct.aspx`頁面的程式碼後置類別，並讓它衍生自`BasePage`(而不是從`System.Web.UI.Page`)。</span><span class="sxs-lookup"><span data-stu-id="0d791-175">Go to the `ShowRandomProduct.aspx` page's code-behind class and have it derive from `BasePage` (instead of from `System.Web.UI.Page`).</span></span>

<span data-ttu-id="0d791-176">最後，更新`Web.sitemap`檔案，以包含這一課中的項目。</span><span class="sxs-lookup"><span data-stu-id="0d791-176">Finally, update the `Web.sitemap` file to include an entry for this lesson.</span></span> <span data-ttu-id="0d791-177">加入下列標記下方`<siteMapNode>`主要服務內容的頁面互動課程：</span><span class="sxs-lookup"><span data-stu-id="0d791-177">Add the following markup beneath the `<siteMapNode>` for the Master to Content Page Interaction lesson:</span></span>


[!code-xml[Main](master-pages-and-asp-net-ajax-cs/samples/sample2.xml)]

<span data-ttu-id="0d791-178">這個加法`<siteMapNode>`項目會反映在課程清單 （請參閱 [圖 5]）。</span><span class="sxs-lookup"><span data-stu-id="0d791-178">The addition of this `<siteMapNode>` element is reflected in the Lessons list (see Figure 5).</span></span>

### <a name="displaying-a-randomly-selected-product"></a><span data-ttu-id="0d791-179">顯示隨機選取的產品</span><span class="sxs-lookup"><span data-stu-id="0d791-179">Displaying a Randomly Selected Product</span></span>

<span data-ttu-id="0d791-180">返回`ShowRandomProduct.aspx`。</span><span class="sxs-lookup"><span data-stu-id="0d791-180">Return to `ShowRandomProduct.aspx`.</span></span> <span data-ttu-id="0d791-181">從設計工具中，拖曳 UpdatePanel 控制項從工具箱拖曳到`MainContent`內容控制項，並將其`ID`屬性設`ProductPanel`。</span><span class="sxs-lookup"><span data-stu-id="0d791-181">From the Designer, drag an UpdatePanel control from the Toolbox into the `MainContent` Content control and set its `ID` property to `ProductPanel`.</span></span> <span data-ttu-id="0d791-182">UpdatePanel 代表您可以透過部分頁面回傳以非同步方式更新畫面上的區域。</span><span class="sxs-lookup"><span data-stu-id="0d791-182">The UpdatePanel represents a region on the screen that can be asynchronously updated through a partial page postback.</span></span>

<span data-ttu-id="0d791-183">第一個工作是要顯示在 UpdatePanel 內的隨機選取產品的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="0d791-183">Our first task is to display information about a randomly selected product within the UpdatePanel.</span></span> <span data-ttu-id="0d791-184">開始將 DetailsView 控制項拖曳至 UpdatePanel。</span><span class="sxs-lookup"><span data-stu-id="0d791-184">Start by dragging a DetailsView control into the UpdatePanel.</span></span> <span data-ttu-id="0d791-185">將 DetailsView 控制項的`ID`屬性，以`ProductInfo`並清除其`Height`和`Width`屬性。</span><span class="sxs-lookup"><span data-stu-id="0d791-185">Set the DetailsView control's `ID` property to `ProductInfo` and clear out its `Height` and `Width` properties.</span></span> <span data-ttu-id="0d791-186">展開 DetailsView 的智慧標籤，然後從 選擇資料來源 下拉式清單中，選擇 繫結至新的 SqlDataSource 控制項，名為的 DetailsView `RandomProductDataSource`。</span><span class="sxs-lookup"><span data-stu-id="0d791-186">Expand the DetailsView's smart tag and, from the Choose Data Source drop-down list, choose to bind the DetailsView to a new SqlDataSource control named `RandomProductDataSource`.</span></span>


<span data-ttu-id="0d791-187">[![將 DetailsView 繫結至新的 SqlDataSource 控制項](master-pages-and-asp-net-ajax-cs/_static/image8.png)](master-pages-and-asp-net-ajax-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-187">[![Bind the DetailsView to a New SqlDataSource Control](master-pages-and-asp-net-ajax-cs/_static/image8.png)](master-pages-and-asp-net-ajax-cs/_static/image7.png)</span></span>

<span data-ttu-id="0d791-188">**圖 03**： 將 DetailsView 繫結至新的 SqlDataSource 控制項 ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-188">**Figure 03**: Bind the DetailsView to a New SqlDataSource Control  ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image9.png))</span></span>


<span data-ttu-id="0d791-189">設定 SqlDataSource 控制項連接至 Northwind 資料庫，透過`NorthwindConnectionString`(我們在中建立[*與主版頁面，從內容頁互動*](interacting-with-the-content-page-from-the-master-page-cs.md)教學課程)。</span><span class="sxs-lookup"><span data-stu-id="0d791-189">Configure the SqlDataSource control to connect to the Northwind database via the `NorthwindConnectionString` (which we created in the [*Interacting with the Master Page from the Content Page*](interacting-with-the-content-page-from-the-master-page-cs.md) tutorial).</span></span> <span data-ttu-id="0d791-190">當設定 select 陳述式選擇指定自訂的 SQL 陳述式，然後再輸入下列查詢：</span><span class="sxs-lookup"><span data-stu-id="0d791-190">When configuring the select statement choose to specify a custom SQL statement and then enter the following query:</span></span>


[!code-sql[Main](master-pages-and-asp-net-ajax-cs/samples/sample3.sql)]

<span data-ttu-id="0d791-191">`TOP 1`中的關鍵字`SELECT`子句會傳回只查詢所傳回的第一筆記錄。</span><span class="sxs-lookup"><span data-stu-id="0d791-191">The `TOP 1` keyword in the `SELECT` clause returns only the first record returned by the query.</span></span> <span data-ttu-id="0d791-192">[ `NEWID()`函式](https://msdn.microsoft.com/library/ms190348.aspx)產生新[全域唯一識別碼 (GUID) 的值](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)而且可以用於`ORDER BY`子句，以隨機順序傳回資料表的記錄。</span><span class="sxs-lookup"><span data-stu-id="0d791-192">The [`NEWID()` function](https://msdn.microsoft.com/library/ms190348.aspx) generates a new [globally unique identifier value (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) and can be used in an `ORDER BY` clause to return the table's records in a random order.</span></span>


<span data-ttu-id="0d791-193">[![設定 SqlDataSource 傳回單一的隨機選取的記錄](master-pages-and-asp-net-ajax-cs/_static/image11.png)](master-pages-and-asp-net-ajax-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-193">[![Configure the SqlDataSource to Return a Single, Randomly Selected Record](master-pages-and-asp-net-ajax-cs/_static/image11.png)](master-pages-and-asp-net-ajax-cs/_static/image10.png)</span></span>

<span data-ttu-id="0d791-194">**圖 04**： 設定要傳回一個隨機選取的記錄 SqlDataSource ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-194">**Figure 04**: Configure the SqlDataSource to Return a Single, Randomly Selected Record  ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image12.png))</span></span>


<span data-ttu-id="0d791-195">完成精靈之後，Visual Studio 會建立兩個以上的查詢所傳回的資料行的 BoundField。</span><span class="sxs-lookup"><span data-stu-id="0d791-195">After completing the wizard, Visual Studio creates a BoundField for the two columns returned by the above query.</span></span> <span data-ttu-id="0d791-196">此時您頁面的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="0d791-196">At this point your page's declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](master-pages-and-asp-net-ajax-cs/samples/sample4.aspx)]

<span data-ttu-id="0d791-197">[圖 5] 顯示`ShowRandomProduct.aspx`頁面上透過瀏覽器檢視時。</span><span class="sxs-lookup"><span data-stu-id="0d791-197">Figure 5 shows the `ShowRandomProduct.aspx` page when viewed through a browser.</span></span> <span data-ttu-id="0d791-198">按一下 瀏覽器的 重新整理 按鈕重新載入頁面;您應該會看到`ProductName`和`UnitPrice`新的隨機選取資料錄的值。</span><span class="sxs-lookup"><span data-stu-id="0d791-198">Click your browser's Refresh button to reload the page; you should see the `ProductName` and `UnitPrice` values for a new randomly selected record.</span></span>


<span data-ttu-id="0d791-199">[![顯示隨機產品的名稱和價格](master-pages-and-asp-net-ajax-cs/_static/image14.png)](master-pages-and-asp-net-ajax-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-199">[![A Random Product's Name and Price is Displayed](master-pages-and-asp-net-ajax-cs/_static/image14.png)](master-pages-and-asp-net-ajax-cs/_static/image13.png)</span></span>

<span data-ttu-id="0d791-200">**圖 05**: 隨機產品的名稱和價格顯示 ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-200">**Figure 05**: A Random Product's Name and Price is Displayed  ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image15.png))</span></span>


### <a name="automatically-displaying-a-new-product-every-15-seconds"></a><span data-ttu-id="0d791-201">會自動顯示新的產品每隔 15 秒</span><span class="sxs-lookup"><span data-stu-id="0d791-201">Automatically Displaying a New Product Every 15 Seconds</span></span>

<span data-ttu-id="0d791-202">ASP.NET AJAX 架構包含在指定的時間; 會執行回傳的計時器控制項在回傳計時器的`Tick`就會引發事件。</span><span class="sxs-lookup"><span data-stu-id="0d791-202">The ASP.NET AJAX framework includes a Timer control that performs a postback at a specified time; on postback the Timer's `Tick` event is raised.</span></span> <span data-ttu-id="0d791-203">如果是在 UpdatePanel 放 Timer 控制項就會觸發部分頁面回傳，此時我們可以重新繫結至 DetailsView 來顯示新的隨機選取的產品的資料。</span><span class="sxs-lookup"><span data-stu-id="0d791-203">If the Timer control is placed within an UpdatePanel it triggers a partial page postback, during which we can rebind the data to the DetailsView to display a new randomly selected product.</span></span>

<span data-ttu-id="0d791-204">若要這麼做，計時器從 [工具箱] 拖放到 UpdatePanel。</span><span class="sxs-lookup"><span data-stu-id="0d791-204">To accomplish this, drag a Timer from the Toolbox and drop it into the UpdatePanel.</span></span> <span data-ttu-id="0d791-205">變更的計時器`ID`從`Timer1`要`ProductTimer`並將其`Interval`60000 15000 的屬性。</span><span class="sxs-lookup"><span data-stu-id="0d791-205">Change the Timer's `ID` from `Timer1` to `ProductTimer` and its `Interval` property from 60000 to 15000.</span></span> <span data-ttu-id="0d791-206">`Interval`屬性會指出回傳之間的毫秒數; 將它設定為 15000，會導致計時器觸發程序的部分頁面回傳每隔 15 秒。</span><span class="sxs-lookup"><span data-stu-id="0d791-206">The `Interval` property indicates the number of milliseconds between postbacks; setting it to 15000 causes the Timer to trigger a partial page postback every 15 seconds.</span></span> <span data-ttu-id="0d791-207">此時計時器的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="0d791-207">At this point your Timer's declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](master-pages-and-asp-net-ajax-cs/samples/sample5.aspx)]

<span data-ttu-id="0d791-208">建立事件處理常式，讓計時器的`Tick`事件。</span><span class="sxs-lookup"><span data-stu-id="0d791-208">Create an event handler for the Timer's `Tick` event.</span></span> <span data-ttu-id="0d791-209">這個事件處理常式中，我們需要重新繫結至 DetailsView 藉由呼叫 DetailsView`DataBind`方法。</span><span class="sxs-lookup"><span data-stu-id="0d791-209">In this event handler we need to rebind the data to the DetailsView by calling the DetailsView's `DataBind` method.</span></span> <span data-ttu-id="0d791-210">這樣會指示重新擷取的資料，從其資料來源控制項 DetailsView 以選取並顯示新的隨機選取 （正如時重新載入頁面，按一下 瀏覽器的 重新整理 按鈕） 的記錄。</span><span class="sxs-lookup"><span data-stu-id="0d791-210">Doing so instructs the DetailsView to re-retrieve the data from its data source control, which will select and display a new randomly selected record (just like when reloading the page by clicking the browser's Refresh button).</span></span>


[!code-csharp[Main](master-pages-and-asp-net-ajax-cs/samples/sample6.cs)]

<span data-ttu-id="0d791-211">這樣就完成了 ！</span><span class="sxs-lookup"><span data-stu-id="0d791-211">That's all there is to it!</span></span> <span data-ttu-id="0d791-212">再次瀏覽透過瀏覽器頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-212">Revisit the page through a browser.</span></span> <span data-ttu-id="0d791-213">一開始，會顯示隨機產品的資訊。</span><span class="sxs-lookup"><span data-stu-id="0d791-213">Initially, a random product's information is displayed.</span></span> <span data-ttu-id="0d791-214">如果您耐心監看畫面，您會發現，15 秒之後，新產品的相關資訊神奇地取代現有的顯示。</span><span class="sxs-lookup"><span data-stu-id="0d791-214">If you patiently watch the screen you'll notice that, after 15 seconds, information about a new product magically replaces the existing display.</span></span>

<span data-ttu-id="0d791-215">若要進一步了解了解，讓我們加入一個 Label 控制項顯示的時間，顯示上次更新的 UpdatePanel。</span><span class="sxs-lookup"><span data-stu-id="0d791-215">To better see what's happening here, let's add a Label control to the UpdatePanel that displays the time the display was last updated.</span></span> <span data-ttu-id="0d791-216">新增在 UpdatePanel Label Web 控制項、 設定其`ID`要`LastUpdateTime`，並清除其`Text`屬性。</span><span class="sxs-lookup"><span data-stu-id="0d791-216">Add a Label Web control within the UpdatePanel, set its `ID` to `LastUpdateTime`, and clear its `Text` property.</span></span> <span data-ttu-id="0d791-217">接下來，建立事件處理常式的 UpdatePanel`Load`事件與顯示在標籤中的目前時間。</span><span class="sxs-lookup"><span data-stu-id="0d791-217">Next, create an event handler for the UpdatePanel's `Load` event and display the current time in the Label.</span></span> <span data-ttu-id="0d791-218">(在 UpdatePanel`Load`在每個完整或部分頁面回傳時引發事件。)</span><span class="sxs-lookup"><span data-stu-id="0d791-218">(The UpdatePanel's `Load` event is fired on every full or partial page postback.)</span></span>


[!code-csharp[Main](master-pages-and-asp-net-ajax-cs/samples/sample7.cs)]

<span data-ttu-id="0d791-219">有了這個完成的變更，此頁面包含目前所顯示的產品已載入的時間。</span><span class="sxs-lookup"><span data-stu-id="0d791-219">With this change complete, the page includes the time the currently displayed product was loaded.</span></span> <span data-ttu-id="0d791-220">[圖 6] 顯示頁面上，當第一次瀏覽。</span><span class="sxs-lookup"><span data-stu-id="0d791-220">Figure 6 shows the page when first visited.</span></span> <span data-ttu-id="0d791-221">圖 7 顯示頁面 15 秒之後 Timer 控制項的動作有 「 勾選 」 後 UpdatePanel 重新整理以顯示新的產品相關資訊。</span><span class="sxs-lookup"><span data-stu-id="0d791-221">Figure 7 shows the page 15 seconds later after the Timer control has "ticked" and the UpdatePanel has been refreshed to display information about a new product.</span></span>


<span data-ttu-id="0d791-222">[![隨機選取產品會顯示在頁面載入](master-pages-and-asp-net-ajax-cs/_static/image17.png)](master-pages-and-asp-net-ajax-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-222">[![A Randomly Selected Product is Displayed on Page Load](master-pages-and-asp-net-ajax-cs/_static/image17.png)](master-pages-and-asp-net-ajax-cs/_static/image16.png)</span></span>

<span data-ttu-id="0d791-223">**圖 06**: 隨機選取產品會顯示在頁面載入 ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-223">**Figure 06**: A Randomly Selected Product is Displayed on Page Load  ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image18.png))</span></span>


<span data-ttu-id="0d791-224">[![會顯示新隨機選取的產品，每隔 15 秒](master-pages-and-asp-net-ajax-cs/_static/image20.png)](master-pages-and-asp-net-ajax-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-224">[![Every 15 Seconds a New Randomly Selected Product is Displayed](master-pages-and-asp-net-ajax-cs/_static/image20.png)](master-pages-and-asp-net-ajax-cs/_static/image19.png)</span></span>

<span data-ttu-id="0d791-225">**圖 07**： 每 15 秒會顯示新隨機選取的產品 ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-225">**Figure 07**: Every 15 Seconds a New Randomly Selected Product is Displayed  ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image21.png))</span></span>


## <a name="step-3-using-the-scriptmanagerproxy-control"></a><span data-ttu-id="0d791-226">步驟 3： 使用 ScriptManagerProxy 控制項</span><span class="sxs-lookup"><span data-stu-id="0d791-226">Step 3: Using the ScriptManagerProxy Control</span></span>

<span data-ttu-id="0d791-227">以及包括 ASP.NET AJAX 架構用戶端程式庫的必要指令碼，ScriptManager 也可以註冊自訂的 JavaScript 檔案，啟用指令碼的 Web 服務，以及自訂驗證、 授權和設定檔服務的參考。</span><span class="sxs-lookup"><span data-stu-id="0d791-227">Along with including the necessary script for the ASP.NET AJAX framework Client Library, the ScriptManager can also register custom JavaScript files, references to script-enabled Web Services, and custom authentication, authorization, and profile services.</span></span> <span data-ttu-id="0d791-228">通常這類自訂專屬於特定頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-228">Usually such customizations are specific to a certain page.</span></span> <span data-ttu-id="0d791-229">不過，如果自訂指令碼檔案、 Web 服務參考或驗證、 授權或服務設定檔會參考在 ScriptManager 中的主版頁面中，則它們會包含在*所有*網站中的頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-229">However, if the custom script files, Web Service references, or authentication, authorization, or profile services are referenced in the ScriptManager in the master page then they are included in *all* pages in the website.</span></span>

<span data-ttu-id="0d791-230">若要加入 ScriptManager 相關頁面的頁面為基礎的自訂內容，請使用 ScriptManagerProxy 控制項。</span><span class="sxs-lookup"><span data-stu-id="0d791-230">To add ScriptManager-related customizations on a page-by-page basis use the ScriptManagerProxy control.</span></span> <span data-ttu-id="0d791-231">您可以將 ScriptManagerProxy 新增至內容的頁面並再註冊自訂的 JavaScript 檔案、 Web 服務參考，或驗證、 授權或從 ScriptManagerProxy; 的設定檔服務這有註冊這些服務特定的內容頁面的效果。</span><span class="sxs-lookup"><span data-stu-id="0d791-231">You can add a ScriptManagerProxy to a content page and then register the custom JavaScript file, Web Service reference, or authentication, authorization, or profile service from the ScriptManagerProxy; this has the effect of registering these services for the particular content page.</span></span>

> [!NOTE]
> <span data-ttu-id="0d791-232">ASP.NET 網頁中只能存在一個以上的 ScriptManager 控制項。</span><span class="sxs-lookup"><span data-stu-id="0d791-232">An ASP.NET page can only have no more than one ScriptManager control present.</span></span> <span data-ttu-id="0d791-233">因此，您無法將 ScriptManager 控制項新增至內容頁面，如果 ScriptManager 控制項已定義主版頁面中。</span><span class="sxs-lookup"><span data-stu-id="0d791-233">Therefore, you cannot add a ScriptManager control to a content page if the ScriptManager control is already defined in the master page.</span></span> <span data-ttu-id="0d791-234">ScriptManagerProxy 的唯一目的是提供開發人員可以在主版頁面中，定義 ScriptManager，但仍舊能夠加入 ScriptManager 的自訂內容頁的頁面為基礎的方式。</span><span class="sxs-lookup"><span data-stu-id="0d791-234">The sole purpose of the ScriptManagerProxy is to provide a way for developers to define the ScriptManager in the master page, but still have the ability to add ScriptManager customizations on a page-by-page basis.</span></span>


<span data-ttu-id="0d791-235">若要查看作用中的 ScriptManagerProxy 控制項，讓我們擴大在 UpdatePanel`ShowRandomProduct.aspx`包含暫停或繼續 Timer 控制項使用用戶端指令碼的按鈕。</span><span class="sxs-lookup"><span data-stu-id="0d791-235">To see the ScriptManagerProxy control in action, let's augment the UpdatePanel in `ShowRandomProduct.aspx` to include a button that uses client-side script to pause or resume the Timer control.</span></span> <span data-ttu-id="0d791-236">Timer 控制項有三種可用來達成這項功能所需的用戶端方法：</span><span class="sxs-lookup"><span data-stu-id="0d791-236">The Timer control has three client-side methods that we can use to achieve this desired functionality:</span></span>

- <span data-ttu-id="0d791-237">`_startTimer()` -啟動計時器控制項</span><span class="sxs-lookup"><span data-stu-id="0d791-237">`_startTimer()` - starts the Timer control</span></span>
- <span data-ttu-id="0d791-238">`_raiseTick()` -藉此使 「 刻度 」 計時器控制項回傳並引發其`Tick`伺服器上的事件</span><span class="sxs-lookup"><span data-stu-id="0d791-238">`_raiseTick()` - causes the Timer control to "tick," thereby posting back and raising its `Tick` event on the server</span></span>
- <span data-ttu-id="0d791-239">`_stopTimer()` -停止計時器控制項</span><span class="sxs-lookup"><span data-stu-id="0d791-239">`_stopTimer()` - stops the Timer control</span></span>

<span data-ttu-id="0d791-240">我們使用名為的變數來建立的 JavaScript 檔案`timerEnabled`和名為函式`ToggleTimer`。</span><span class="sxs-lookup"><span data-stu-id="0d791-240">Let's create a JavaScript file with a variable named `timerEnabled` and a function named `ToggleTimer`.</span></span> <span data-ttu-id="0d791-241">`timerEnabled`變數會指出是否目前已啟用或停用計時器控制項; 它會預設為 true。</span><span class="sxs-lookup"><span data-stu-id="0d791-241">The `timerEnabled` variable indicates whether the Timer control is currently enabled or disabled; it defaults to true.</span></span> <span data-ttu-id="0d791-242">`ToggleTimer`函式會接受兩個輸入參數： 暫停/繼續按鈕和用戶端的參考`id`計時器控制項的值。</span><span class="sxs-lookup"><span data-stu-id="0d791-242">The `ToggleTimer` function accepts two input parameters: a reference to the Pause/Resume button and the client-side `id` value of the Timer control.</span></span> <span data-ttu-id="0d791-243">此函式會切換的值`timerEnabled`，則取得計時器控制項的參考、 啟動或停止計時器 (根據的值`timerEnabled`)，並更新 「 暫停 」 或 「 繼續 」 按鈕的顯示文字。</span><span class="sxs-lookup"><span data-stu-id="0d791-243">This function toggles the value of `timerEnabled`, gets a reference to the Timer control, starts or stops the Timer (depending on the value of `timerEnabled`), and updates the button's display text to "Pause" or "Resume".</span></span> <span data-ttu-id="0d791-244">按一下 [暫停/繼續] 按鈕時，就會呼叫此函式。</span><span class="sxs-lookup"><span data-stu-id="0d791-244">This function will be called whenever the Pause/Resume button is clicked.</span></span>

<span data-ttu-id="0d791-245">開始建立新的資料夾中名為網站`Scripts`。</span><span class="sxs-lookup"><span data-stu-id="0d791-245">Start by creating a new folder in the website named `Scripts`.</span></span> <span data-ttu-id="0d791-246">接下來，將新檔案新增至名為 [指令碼] 資料夾`TimerScript.js`是 JScript File 類型。</span><span class="sxs-lookup"><span data-stu-id="0d791-246">Next, add a new file to the Scripts folder named `TimerScript.js` of type JScript File.</span></span>


<span data-ttu-id="0d791-247">[![將新的 JavaScript 檔案加入至指令碼 資料夾](master-pages-and-asp-net-ajax-cs/_static/image23.png)](master-pages-and-asp-net-ajax-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-247">[![Add a New JavaScript File to the Scripts Folder](master-pages-and-asp-net-ajax-cs/_static/image23.png)](master-pages-and-asp-net-ajax-cs/_static/image22.png)</span></span>

<span data-ttu-id="0d791-248">**圖 08**： 加入新的 JavaScript 檔案，以便`Scripts`資料夾 ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-248">**Figure 08**: Add a New JavaScript File to the `Scripts` Folder  ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image24.png))</span></span>


<span data-ttu-id="0d791-249">[![新的 JavaScript 檔案新增網站](master-pages-and-asp-net-ajax-cs/_static/image26.png)](master-pages-and-asp-net-ajax-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-249">[![A New JavaScript File has been Added to the Website](master-pages-and-asp-net-ajax-cs/_static/image26.png)](master-pages-and-asp-net-ajax-cs/_static/image25.png)</span></span>

<span data-ttu-id="0d791-250">**圖 09**: 新的 JavaScript 檔案已新增至網站 ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-250">**Figure 09**: A New JavaScript File has been Added to the Website ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image27.png))</span></span>


<span data-ttu-id="0d791-251">接下來，新增下列指令碼至 TimerScript.js 檔案：</span><span class="sxs-lookup"><span data-stu-id="0d791-251">Next, add the following scrip to the TimerScript.js file:</span></span>


[!code-csharp[Main](master-pages-and-asp-net-ajax-cs/samples/sample8.cs)]

<span data-ttu-id="0d791-252">我們現在要註冊此自訂的 JavaScript 檔案中`ShowRandomProduct.aspx`。</span><span class="sxs-lookup"><span data-stu-id="0d791-252">We now need to register this custom JavaScript file in `ShowRandomProduct.aspx`.</span></span> <span data-ttu-id="0d791-253">返回`ShowRandomProduct.aspx`和 ScriptManagerProxy 控制項加入頁面，設定其`ID`至`MyManagerProxy`。</span><span class="sxs-lookup"><span data-stu-id="0d791-253">Return to `ShowRandomProduct.aspx` and add a ScriptManagerProxy control to the page; set its `ID` to `MyManagerProxy`.</span></span> <span data-ttu-id="0d791-254">若要註冊自訂的 JavaScript 檔案會選取 ScriptManagerProxy 控制項設計工具中，然後移至 [屬性] 視窗。</span><span class="sxs-lookup"><span data-stu-id="0d791-254">To register a custom JavaScript file select the ScriptManagerProxy control in the Designer and then go to the Properties window.</span></span> <span data-ttu-id="0d791-255">其中一個屬性的標題為指令碼。</span><span class="sxs-lookup"><span data-stu-id="0d791-255">One of the properties is titled Scripts.</span></span> <span data-ttu-id="0d791-256">選取此屬性會顯示 [圖 10] 所示的指令碼參考集合編輯器。</span><span class="sxs-lookup"><span data-stu-id="0d791-256">Selecting this property displays the ScriptReference Collection Editor shown in Figure 10.</span></span> <span data-ttu-id="0d791-257">按一下 [新增] 按鈕，以包含新的指令碼參考，然後再輸入 [路徑] 屬性中的指令碼檔案的路徑： `~/Scripts/TimerScript.js`。</span><span class="sxs-lookup"><span data-stu-id="0d791-257">Click the Add button to include a new script reference and then enter the path to the script file in the Path property: `~/Scripts/TimerScript.js`.</span></span>


<span data-ttu-id="0d791-258">[![新增 ScriptManagerProxy 控制項的指令碼參考](master-pages-and-asp-net-ajax-cs/_static/image29.png)](master-pages-and-asp-net-ajax-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-258">[![Add a Script Reference to the ScriptManagerProxy Control](master-pages-and-asp-net-ajax-cs/_static/image29.png)](master-pages-and-asp-net-ajax-cs/_static/image28.png)</span></span>

<span data-ttu-id="0d791-259">**圖 10**： 新增 ScriptManagerProxy 控制項的指令碼參考 ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-259">**Figure 10**: Add a Script Reference to the ScriptManagerProxy Control ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image30.png))</span></span>


<span data-ttu-id="0d791-260">新增指令碼參考 ScriptManagerProxy 控制項的宣告式後的標記會更新以包含`<Scripts>`具有單一集合`ScriptReference`項目，做為標記中的下列程式碼片段說明：</span><span class="sxs-lookup"><span data-stu-id="0d791-260">After adding the script reference the ScriptManagerProxy control's declarative markup is updated to include a `<Scripts>` collection with a single `ScriptReference` entry, as the following snippet of markup illustrates:</span></span>


[!code-aspx[Main](master-pages-and-asp-net-ajax-cs/samples/sample9.aspx)]

<span data-ttu-id="0d791-261">`ScriptReference`項目會指示 ScriptManagerProxy 納入其呈現的標記中的 JavaScript 檔案的參考。</span><span class="sxs-lookup"><span data-stu-id="0d791-261">The `ScriptReference` entry instructs the ScriptManagerProxy to include a reference to the JavaScript file in its rendered markup.</span></span> <span data-ttu-id="0d791-262">也就是註冊的自訂指令碼中 ScriptManagerProxy`ShowRandomProduct.aspx`頁面的轉譯的輸出現在包含另一個`<script src="url"></script>`標記： `<script src="Scripts/TimerScript.js" type="text/javascript"></script>`。</span><span class="sxs-lookup"><span data-stu-id="0d791-262">That is, by registering the custom script in the ScriptManagerProxy the `ShowRandomProduct.aspx` page's rendered output now includes another `<script src="url"></script>` tag: `<script src="Scripts/TimerScript.js" type="text/javascript"></script>`.</span></span>

<span data-ttu-id="0d791-263">我們現在可以呼叫`ToggleTimer`中所定義的函式`TimerScript.js`中的用戶端指令碼從`ShowRandomProduct.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-263">We can now call the `ToggleTimer` function defined in `TimerScript.js` from the client script in the `ShowRandomProduct.aspx` page.</span></span> <span data-ttu-id="0d791-264">新增在 UpdatePanel 下列 HTML:</span><span class="sxs-lookup"><span data-stu-id="0d791-264">Add the following HTML within the UpdatePanel:</span></span>


[!code-aspx[Main](master-pages-and-asp-net-ajax-cs/samples/sample10.aspx)]

<span data-ttu-id="0d791-265">這會顯示具有 「 暫停 」 的文字的按鈕。</span><span class="sxs-lookup"><span data-stu-id="0d791-265">This displays a button with the text "Pause".</span></span> <span data-ttu-id="0d791-266">只要按一下，JavaScript 函式`ToggleTimer`呼叫時，傳入的按鈕和 Timer 控制項的識別碼值的參考 (`ProductTimer`)。</span><span class="sxs-lookup"><span data-stu-id="0d791-266">Whenever it is clicked, the JavaScript function `ToggleTimer` is called, passing in a reference to the button and the id value of the Timer control (`ProductTimer`).</span></span> <span data-ttu-id="0d791-267">請注意語法以取得`id`計時器控制項的值。</span><span class="sxs-lookup"><span data-stu-id="0d791-267">Note the syntax for obtaining the `id` value of the Timer control.</span></span> <span data-ttu-id="0d791-268">`<%=ProductTimer.ClientID%>` 值就會發出`ProductTimer`Timer 控制項`ClientID`屬性。</span><span class="sxs-lookup"><span data-stu-id="0d791-268">`<%=ProductTimer.ClientID%>` emits the value of the `ProductTimer` Timer control's `ClientID` property.</span></span> <span data-ttu-id="0d791-269">在  [*內容頁中的控制項識別碼命名*](control-id-naming-in-content-pages-cs.md)教學課程中我們所討論的伺服器端之間的差異`ID`值和產生的用戶端`id`值，以及如何`ClientID`會傳回用戶端`id`。</span><span class="sxs-lookup"><span data-stu-id="0d791-269">In the [*Control ID Naming in Content Pages*](control-id-naming-in-content-pages-cs.md) tutorial we discussed the differences between the server-side `ID` value and the resulting client-side `id` value, and how `ClientID` returns the client-side `id`.</span></span>

<span data-ttu-id="0d791-270">[圖 11] 顯示當第一次透過瀏覽器中瀏覽此頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-270">Figure 11 shows this page when first visited through a browser.</span></span> <span data-ttu-id="0d791-271">計時器目前正在執行，並更新顯示的產品資訊每隔 15 秒。</span><span class="sxs-lookup"><span data-stu-id="0d791-271">The Timer is currently running and updates the displayed product information every 15 seconds.</span></span> <span data-ttu-id="0d791-272">已按下 暫停 按鈕之後，圖 12 顯示的畫面。</span><span class="sxs-lookup"><span data-stu-id="0d791-272">Figure 12 shows the screen after the Pause button has been clicked.</span></span> <span data-ttu-id="0d791-273">按一下 [暫停] 按鈕時，會停止計時器，並更新 「 繼續 」 按鈕的文字。</span><span class="sxs-lookup"><span data-stu-id="0d791-273">Clicking the Pause button stops the Timer and updates the button's text to "Resume".</span></span> <span data-ttu-id="0d791-274">產品資訊將會重新整理 （並繼續重新整理每隔 15 秒） 後使用者按下繼續。</span><span class="sxs-lookup"><span data-stu-id="0d791-274">The product information will refresh (and continue to refresh every 15 seconds) once the user clicks Resume.</span></span>


<span data-ttu-id="0d791-275">[![按一下 [暫停] 按鈕來停止計時器控制項](master-pages-and-asp-net-ajax-cs/_static/image32.png)](master-pages-and-asp-net-ajax-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-275">[![Click the Pause Button to Stop the Timer Control](master-pages-and-asp-net-ajax-cs/_static/image32.png)](master-pages-and-asp-net-ajax-cs/_static/image31.png)</span></span>

<span data-ttu-id="0d791-276">**圖 11**： 按一下 [停止計時器控制項的 [暫停] 按鈕 ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-276">**Figure 11**: Click the Pause Button to Stop the Timer Control  ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image33.png))</span></span>


<span data-ttu-id="0d791-277">[![按一下 [繼續] 按鈕，以重新啟動計時器](master-pages-and-asp-net-ajax-cs/_static/image35.png)](master-pages-and-asp-net-ajax-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="0d791-277">[![Click the Resume Button to Restart the Timer](master-pages-and-asp-net-ajax-cs/_static/image35.png)](master-pages-and-asp-net-ajax-cs/_static/image34.png)</span></span>

<span data-ttu-id="0d791-278">**圖 12**： 按一下 [重新啟動計時器的 [繼續] 按鈕 ([按一下以檢視完整大小的影像](master-pages-and-asp-net-ajax-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="0d791-278">**Figure 12**: Click the Resume Button to Restart the Timer  ([Click to view full-size image](master-pages-and-asp-net-ajax-cs/_static/image36.png))</span></span>


## <a name="summary"></a><span data-ttu-id="0d791-279">總結</span><span class="sxs-lookup"><span data-stu-id="0d791-279">Summary</span></span>

<span data-ttu-id="0d791-280">建置使用 ASP.NET AJAX 架構的啟用 AJAX 的 web 應用程式時務必每個啟用 AJAX 的網頁上包含 ScriptManager 控制項。</span><span class="sxs-lookup"><span data-stu-id="0d791-280">When building AJAX-enabled web applications using the ASP.NET AJAX framework it is imperative that every AJAX-enabled web page include a ScriptManager control.</span></span> <span data-ttu-id="0d791-281">若要加速此程序，我們可以加入 ScriptManager 主版頁面，而不需要記得去 ScriptManager 加入每個內容頁面。</span><span class="sxs-lookup"><span data-stu-id="0d791-281">To facilitate this process, we can add a ScriptManager to the master page rather than having to remember to add a ScriptManager to each and every content page.</span></span> <span data-ttu-id="0d791-282">示範如何將 ScriptManager 加入主版頁面時查看在內容頁面中實作 AJAX 功能的步驟 2 的步驟 1。</span><span class="sxs-lookup"><span data-stu-id="0d791-282">Step 1 showed how to add the ScriptManager to the master page while Step 2 looked at implementing AJAX functionality in a content page.</span></span>

<span data-ttu-id="0d791-283">如果您要新增自訂指令碼，指令碼啟用 Web 服務的參考，或自訂的驗證、 授權或特定的內容頁面上，設定檔服務 ScriptManagerProxy 控制項加入 [內容] 頁面並再設定那里自訂。</span><span class="sxs-lookup"><span data-stu-id="0d791-283">If you need to add custom scripts, references to script-enabled Web Services, or customized authentication, authorization, or profile services to a particular content page, add a ScriptManagerProxy control to the content page and then configure the customizations there.</span></span> <span data-ttu-id="0d791-284">步驟 3 檢查如何使用 ScriptManagerProxy 特定的內容頁面中註冊自訂的 JavaScript 檔案。</span><span class="sxs-lookup"><span data-stu-id="0d791-284">Step 3 examined how to use the ScriptManagerProxy to register a custom JavaScript file in a specific content page.</span></span>

<span data-ttu-id="0d791-285">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="0d791-285">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="0d791-286">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="0d791-286">Further Reading</span></span>

<span data-ttu-id="0d791-287">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="0d791-287">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="0d791-288">ASP.NET AJAX 架構</span><span class="sxs-lookup"><span data-stu-id="0d791-288">ASP.NET AJAX Framework</span></span>](../../../../ajax/index.md)
- [<span data-ttu-id="0d791-289">ASP.NET AJAX 教學課程</span><span class="sxs-lookup"><span data-stu-id="0d791-289">ASP.NET AJAX Tutorials</span></span>](../aspnet-ajax/understanding-partial-page-updates-with-asp-net-ajax.md)
- [<span data-ttu-id="0d791-290">ASP.NET AJAX 影片</span><span class="sxs-lookup"><span data-stu-id="0d791-290">ASP.NET AJAX Videos</span></span>](../../../videos/aspnet-ajax/index.md)
- [<span data-ttu-id="0d791-291">使用 Microsoft ASP.NET AJAX 建置互動式使用者介面</span><span class="sxs-lookup"><span data-stu-id="0d791-291">Building Interactive User Interface with Microsoft ASP.NET AJAX</span></span>](http://aspnet.4guysfromrolla.com/articles/101007-1.aspx)
- [<span data-ttu-id="0d791-292">使用 NEWID 隨機排序記錄</span><span class="sxs-lookup"><span data-stu-id="0d791-292">Using NEWID to Randomly Sort Records</span></span>](http://www.sqlteam.com/article/using-newid-to-randomly-sort-records)
- [<span data-ttu-id="0d791-293">使用 Timer 控制項</span><span class="sxs-lookup"><span data-stu-id="0d791-293">Using the Timer Control</span></span>](http://aspnet.4guysfromrolla.com/articles/061808-1.aspx)

### <a name="about-the-author"></a><span data-ttu-id="0d791-294">關於作者</span><span class="sxs-lookup"><span data-stu-id="0d791-294">About the Author</span></span>

<span data-ttu-id="0d791-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的多個 ASP 本書籍，他是 4GuysFromRolla.com 的創辦人，一直從事 Microsoft Web 技術自 1998 年。</span><span class="sxs-lookup"><span data-stu-id="0d791-295">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="0d791-296">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="0d791-296">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="0d791-297">他最新的著作是[ *Sams 教導您自己 ASP.NET 3.5 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="0d791-297">His latest book is [*Sams Teach Yourself ASP.NET 3.5 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco).</span></span> <span data-ttu-id="0d791-298">Scott 要聯絡[ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com)或透過他的部落格[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="0d791-298">Scott can be reached at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="0d791-299">特別感謝</span><span class="sxs-lookup"><span data-stu-id="0d791-299">Special Thanks To</span></span>

<span data-ttu-id="0d791-300">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="0d791-300">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="0d791-301">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="0d791-301">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="0d791-302">如果是這樣，psychic 在 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="0d791-302">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="0d791-303">[上一頁](interacting-with-the-content-page-from-the-master-page-cs.md)
> [下一頁](specifying-the-master-page-programmatically-cs.md)</span><span class="sxs-lookup"><span data-stu-id="0d791-303">[Previous](interacting-with-the-content-page-from-the-master-page-cs.md)
[Next](specifying-the-master-page-programmatically-cs.md)</span></span>
