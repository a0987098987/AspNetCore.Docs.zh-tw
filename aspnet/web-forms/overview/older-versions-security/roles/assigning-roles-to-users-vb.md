---
uid: web-forms/overview/older-versions-security/roles/assigning-roles-to-users-vb
title: 將角色指派給使用者 (VB) |Microsoft Docs
author: rick-anderson
description: 在本教學課程中，我們將建置兩個 ASP.NET 網頁，以協助管理哪些使用者屬於哪些角色。 第一頁會包含看有哪些功能...
ms.author: aspnetcontent
ms.date: 03/24/2008
ms.assetid: fd208ee9-69cc-4467-9783-b4e039bdd1d3
msc.legacyurl: /web-forms/overview/older-versions-security/roles/assigning-roles-to-users-vb
msc.type: authoredcontent
ms.openlocfilehash: 41b73ec54ec2f174bca1d0ee2965ff8e0438ccba
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/05/2018
ms.locfileid: "37839774"
---
<a name="assigning-roles-to-users-vb"></a><span data-ttu-id="03bc2-104">將角色指派給使用者 (VB)</span><span class="sxs-lookup"><span data-stu-id="03bc2-104">Assigning Roles to Users (VB)</span></span>
====================
<span data-ttu-id="03bc2-105">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="03bc2-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="03bc2-106">[下載程式碼](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.10.zip)或[下載 PDF](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial10_AssigningRoles_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="03bc2-106">[Download Code](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/VB.10.zip) or [Download PDF](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial10_AssigningRoles_vb.pdf)</span></span>

> <span data-ttu-id="03bc2-107">在本教學課程中，我們將建置兩個 ASP.NET 網頁，以協助管理哪些使用者屬於哪些角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-107">In this tutorial we will build two ASP.NET pages to assist with managing what users belong to what roles.</span></span> <span data-ttu-id="03bc2-108">第一頁會包含功能若要查看哪些使用者屬於指定的角色，具備特定的使用者所屬的角色和指派或移除特定角色中的特定使用者的能力。</span><span class="sxs-lookup"><span data-stu-id="03bc2-108">The first page will include facilities to see what users belong to a given role, what roles a particular user belongs to, and the ability to assign or remove a particular user from a particular role.</span></span> <span data-ttu-id="03bc2-109">在第二個頁面中，我們會擴大 CreateUserWizard 控制項使其包含的步驟，以指定新建立的使用者屬於哪些角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-109">In the second page we will augment the CreateUserWizard control so that it includes a step to specify what roles the newly created user belongs to.</span></span> <span data-ttu-id="03bc2-110">這是系統管理員能夠建立新的使用者帳戶的案例中很有用。</span><span class="sxs-lookup"><span data-stu-id="03bc2-110">This is useful in scenarios where an administrator is able to create new user accounts.</span></span>


## <a name="introduction"></a><span data-ttu-id="03bc2-111">簡介</span><span class="sxs-lookup"><span data-stu-id="03bc2-111">Introduction</span></span>

<span data-ttu-id="03bc2-112"><a id="_msoanchor_1"> </a>[先前的教學課程](creating-and-managing-roles-vb.md)檢查角色架構並`SqlRoleProvider`; 我們了解如何使用`Roles`類別來建立、 擷取及刪除角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-112">The <a id="_msoanchor_1"></a>[previous tutorial](creating-and-managing-roles-vb.md) examined the Roles framework and the `SqlRoleProvider`; we saw how to use the `Roles` class to create, retrieve, and delete roles.</span></span> <span data-ttu-id="03bc2-113">除了建立及刪除角色，我們必須要能夠指派或移除角色中的使用者。</span><span class="sxs-lookup"><span data-stu-id="03bc2-113">In addition to creating and deleting roles, we need to be able to assign or remove users from a role.</span></span> <span data-ttu-id="03bc2-114">不幸的是，ASP.NET 並未隨附任何 Web 控制項，來管理哪些使用者屬於哪些角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-114">Unfortunately, ASP.NET does not ship with any Web controls for managing what users belong to what roles.</span></span> <span data-ttu-id="03bc2-115">相反地，我們必須建立自己的 ASP.NET 網頁，來管理這些關聯。</span><span class="sxs-lookup"><span data-stu-id="03bc2-115">Instead, we must create our own ASP.NET pages to manage these associations.</span></span> <span data-ttu-id="03bc2-116">好消息是新增和移除使用者角色是相當簡單。</span><span class="sxs-lookup"><span data-stu-id="03bc2-116">The good news is that adding and removing users to roles is quite easy.</span></span> <span data-ttu-id="03bc2-117">`Roles`類別包含數個方法來將一或多個使用者新增至一個或多個角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-117">The `Roles` class contains a number of methods for adding one or more users to one or more roles.</span></span>

<span data-ttu-id="03bc2-118">在本教學課程中，我們將建置兩個 ASP.NET 網頁，以協助管理哪些使用者屬於哪些角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-118">In this tutorial we will build two ASP.NET pages to assist with managing what users belong to what roles.</span></span> <span data-ttu-id="03bc2-119">第一頁會包含功能若要查看哪些使用者屬於指定的角色，具備特定的使用者所屬的角色和指派或移除特定角色中的特定使用者的能力。</span><span class="sxs-lookup"><span data-stu-id="03bc2-119">The first page will include facilities to see what users belong to a given role, what roles a particular user belongs to, and the ability to assign or remove a particular user from a particular role.</span></span> <span data-ttu-id="03bc2-120">在第二個頁面中，我們會擴大 CreateUserWizard 控制項使其包含的步驟，以指定新建立的使用者屬於哪些角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-120">In the second page we will augment the CreateUserWizard control so that it includes a step to specify what roles the newly created user belongs to.</span></span> <span data-ttu-id="03bc2-121">這是系統管理員能夠建立新的使用者帳戶的案例中很有用。</span><span class="sxs-lookup"><span data-stu-id="03bc2-121">This is useful in scenarios where an administrator is able to create new user accounts.</span></span>

<span data-ttu-id="03bc2-122">讓我們開始吧 ！</span><span class="sxs-lookup"><span data-stu-id="03bc2-122">Let's get started!</span></span>

## <a name="listing-what-users-belong-to-what-roles"></a><span data-ttu-id="03bc2-123">列出哪些使用者屬於哪些角色</span><span class="sxs-lookup"><span data-stu-id="03bc2-123">Listing What Users Belong To What Roles</span></span>

<span data-ttu-id="03bc2-124">第一要務本教學課程是建立網頁的使用者可以指派給角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-124">The first order of business for this tutorial is to create a web page from which users can be assigned to roles.</span></span> <span data-ttu-id="03bc2-125">我們考慮自行如何將使用者指派給角色之前，讓我們先把焦點放在如何判斷哪些使用者屬於哪些角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-125">Before we concern ourselves with how to assign users to roles, let's first concentrate on how to determine what users belong to what roles.</span></span> <span data-ttu-id="03bc2-126">有兩種方式來顯示這項資訊: 「 角色 」 或 「 使用者 」。</span><span class="sxs-lookup"><span data-stu-id="03bc2-126">There are two ways to display this information: "by role" or "by user."</span></span> <span data-ttu-id="03bc2-127">我們可能會允許訪客能夠選取角色，然後顯示它們的所有使用者屬於角色 （「 依角色 」 顯示），或我們無法提示來選取使用者，然後顯示它們的角色指派給該使用者 （「 依使用者 「 顯示器） 的訪客。</span><span class="sxs-lookup"><span data-stu-id="03bc2-127">We could allow the visitor to select a role and then show them all of the users that belong to the role (the "by role" display), or we could prompt the visitor to select a user and then show them the roles assigned to that user (the "by user" display).</span></span>

<span data-ttu-id="03bc2-128">「 依角色 」 檢視適合用在情況下，造訪者想要知道使用者隸屬於特定的角色中，集合造訪者必須知道特定使用者的角色時，理想的 「 依使用者 」 檢視。</span><span class="sxs-lookup"><span data-stu-id="03bc2-128">The "by role" view is useful in circumstances where the visitor wants to know the set of users that belong to a particular role; the "by user" view is ideal when the visitor needs to know a particular user's role(s).</span></span> <span data-ttu-id="03bc2-129">讓我們有我們同時包含 「 依角色 」 和 「 依使用者 」 的網頁介面。</span><span class="sxs-lookup"><span data-stu-id="03bc2-129">Let's have our page include both "by role" and "by user" interfaces.</span></span>

<span data-ttu-id="03bc2-130">我們將開始建立 「 依使用者 」 的介面。</span><span class="sxs-lookup"><span data-stu-id="03bc2-130">We will start with creating the "by user" interface.</span></span> <span data-ttu-id="03bc2-131">此介面將包含下拉式清單和核取方塊的清單。</span><span class="sxs-lookup"><span data-stu-id="03bc2-131">This interface will consist of a drop-down list and a list of checkboxes.</span></span> <span data-ttu-id="03bc2-132">下拉式清單會填入一組使用者在系統中;核取方塊會列舉的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-132">The drop-down list will be populated with the set of users in the system; the checkboxes will enumerate the roles.</span></span> <span data-ttu-id="03bc2-133">從下拉式清單中選取使用者將會檢查這些使用者所屬的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-133">Selecting a user from the drop-down list will check those roles the user belongs to.</span></span> <span data-ttu-id="03bc2-134">再檢查或取消選取核取方塊，以新增或移除對應的角色中的所選的使用者瀏覽頁面的人員。</span><span class="sxs-lookup"><span data-stu-id="03bc2-134">The person visiting the page can then check or uncheck the checkboxes to add or remove the selected user from the corresponding roles.</span></span>

> [!NOTE]
> <span data-ttu-id="03bc2-135">使用下拉式清單加入至清單的使用者帳戶不是網站的理想選擇，可能有數百個使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="03bc2-135">Using a drop-down list to list the user accounts is not an ideal choice for websites where there may be hundreds of user accounts.</span></span> <span data-ttu-id="03bc2-136">下拉式清單可讓使用者選擇的選項在相對較短的清單中的一個項目。</span><span class="sxs-lookup"><span data-stu-id="03bc2-136">A drop-down list is designed to allow a user to pick one item from a relatively short list of options.</span></span> <span data-ttu-id="03bc2-137">快速地變得難以隨著清單項目數目。</span><span class="sxs-lookup"><span data-stu-id="03bc2-137">It quickly becomes unwieldy as the number of list items grows.</span></span> <span data-ttu-id="03bc2-138">如果您要建置的網站，將會有可能很大的數字的使用者帳戶，您可能要考慮使用替代的使用者介面，例如可分頁的 GridView 或列出的可篩選介面會提示選擇字母的訪客，然後只顯示使用者名稱開頭為所選的字母這些使用者。</span><span class="sxs-lookup"><span data-stu-id="03bc2-138">If you are building a website that will have potentially large numbers of user accounts, you may want to consider using an alternative user interface, such as a pageable GridView or a filterable interface that lists prompts the visitor to choose a letter and then only shows those users whose username starts with the selected letter.</span></span>


## <a name="step-1-building-the-by-user-user-interface"></a><span data-ttu-id="03bc2-139">步驟 1： 建立 「 依使用者 」 使用者介面</span><span class="sxs-lookup"><span data-stu-id="03bc2-139">Step 1: Building the "By User" User Interface</span></span>

<span data-ttu-id="03bc2-140">開啟`UsersAndRoles.aspx`頁面。</span><span class="sxs-lookup"><span data-stu-id="03bc2-140">Open the `UsersAndRoles.aspx` page.</span></span> <span data-ttu-id="03bc2-141">在頁面頂端，新增名為的 Label Web 控制項`ActionStatus`並清除其`Text`屬性。</span><span class="sxs-lookup"><span data-stu-id="03bc2-141">At the top of the page, add a Label Web control named `ActionStatus` and clear out its `Text` property.</span></span> <span data-ttu-id="03bc2-142">我們將使用此標籤來顯示這類訊息上執行的動作提供意見反應，「 使用者 Tito 已加入到系統管理員角色，「 或者 」 使用者 Jisun 都已獲得 「 主管 」 角色。 」</span><span class="sxs-lookup"><span data-stu-id="03bc2-142">We will use this Label to provide feedback on the actions performed, displaying messages like, "User Tito has been added to the Administrators role," or "User Jisun has been removed from the Supervisors role."</span></span> <span data-ttu-id="03bc2-143">若要讓這些訊息脫穎而出，將標籤的`CssClass`"Important"的屬性。</span><span class="sxs-lookup"><span data-stu-id="03bc2-143">In order to make these messages stand out, set the Label's `CssClass` property to "Important".</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample1.aspx)]

<span data-ttu-id="03bc2-144">接下來，新增下列 CSS 類別定義，以`Styles.css`樣式表：</span><span class="sxs-lookup"><span data-stu-id="03bc2-144">Next, add the following CSS class definition to the `Styles.css` stylesheet:</span></span>

[!code-css[Main](assigning-roles-to-users-vb/samples/sample2.css)]

<span data-ttu-id="03bc2-145">這個 CSS 定義會指示瀏覽器顯示使用大型、 紅色字型的標籤。</span><span class="sxs-lookup"><span data-stu-id="03bc2-145">This CSS definition instructs the browser to display the Label using a large, red font.</span></span> <span data-ttu-id="03bc2-146">[圖 1] 顯示此效果，透過 Visual Studio 設計工具。</span><span class="sxs-lookup"><span data-stu-id="03bc2-146">Figure 1 shows this effect through the Visual Studio Designer.</span></span>


<span data-ttu-id="03bc2-147">[![標籤的 CssClass 屬性會導致大型的紅色字型](assigning-roles-to-users-vb/_static/image2.png)](assigning-roles-to-users-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-147">[![The Label's CssClass Property Results in a Large, Red Font](assigning-roles-to-users-vb/_static/image2.png)](assigning-roles-to-users-vb/_static/image1.png)</span></span>

<span data-ttu-id="03bc2-148">**圖 1**: 標籤`CssClass`導致大 」，紅色字型的屬性 ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-148">**Figure 1**: The Label's `CssClass` Property Results in a Large, Red Font  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image3.png))</span></span>


<span data-ttu-id="03bc2-149">接下來，將 DropDownList 新增至頁面上，設定其`ID`屬性，以`UserList`，並設定其`AutoPostBack`屬性設為 True。</span><span class="sxs-lookup"><span data-stu-id="03bc2-149">Next, add a DropDownList to the page, set its `ID` property to `UserList`, and set its `AutoPostBack` property to True.</span></span> <span data-ttu-id="03bc2-150">若要列出的所有使用者在系統中，我們將使用此 DropDownList。</span><span class="sxs-lookup"><span data-stu-id="03bc2-150">We will use this DropDownList to list all of the users in the system.</span></span> <span data-ttu-id="03bc2-151">將繫結此 DropDownList MembershipUser 物件的集合。</span><span class="sxs-lookup"><span data-stu-id="03bc2-151">This DropDownList will be bound to a collection of MembershipUser objects.</span></span> <span data-ttu-id="03bc2-152">因為我們希望 DropDownList 以顯示 MembershipUser 物件的使用者名稱屬性 （並使用它做為清單項目的值），設定 DropDownList`DataTextField`和`DataValueField`屬性為"UserName"。</span><span class="sxs-lookup"><span data-stu-id="03bc2-152">Because we want the DropDownList to display the UserName property of the MembershipUser object (and use it as the value of the list items), set the DropDownList's `DataTextField` and `DataValueField` properties to "UserName".</span></span>

<span data-ttu-id="03bc2-153">下方的下拉式清單中，新增名為 Repeater `UsersRoleList`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-153">Underneath the DropDownList, add a Repeater named `UsersRoleList`.</span></span> <span data-ttu-id="03bc2-154">這個 Repeater 會列出所有角色的系統中以一系列的核取方塊。</span><span class="sxs-lookup"><span data-stu-id="03bc2-154">This Repeater will list all of the roles in the system as a series of checkboxes.</span></span> <span data-ttu-id="03bc2-155">定義 Repeater`ItemTemplate`使用下列的宣告式標記：</span><span class="sxs-lookup"><span data-stu-id="03bc2-155">Define the Repeater's `ItemTemplate` using the following declarative markup:</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample3.aspx)]

<span data-ttu-id="03bc2-156">`ItemTemplate`標記包含單一的核取方塊 Web 控制項，名為`RoleCheckBox`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-156">The `ItemTemplate` markup includes a single CheckBox Web control named `RoleCheckBox`.</span></span> <span data-ttu-id="03bc2-157">此核取方塊`AutoPostBack`屬性設定為 True，`Text`屬性的繫結至`Container.DataItem`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-157">The CheckBox's `AutoPostBack` property is set to True and the `Text` property is bound to `Container.DataItem`.</span></span> <span data-ttu-id="03bc2-158">資料繫結語法做只是`Container.DataItem`是因為角色架構會傳回角色名稱的清單，以字串陣列，而且我們將會繫結至 Repeater 這個字串陣列。</span><span class="sxs-lookup"><span data-stu-id="03bc2-158">The reason the databinding syntax is simply `Container.DataItem` is because the Roles framework returns the list of role names as a string array, and it is this string array that we will be binding to the Repeater.</span></span> <span data-ttu-id="03bc2-159">為什麼要顯示繫結至資料 Web 控制項陣列的內容使用此語法的完整描述已超出本教學課程的範圍。</span><span class="sxs-lookup"><span data-stu-id="03bc2-159">A thorough description of why this syntax is used to display the contents of an array bound to a data Web control is beyond the scope of this tutorial.</span></span> <span data-ttu-id="03bc2-160">如需有關此問題的詳細資訊，請參閱[繫結至資料 Web 控制項的純量陣列](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx)。</span><span class="sxs-lookup"><span data-stu-id="03bc2-160">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>

<span data-ttu-id="03bc2-161">此時您 「 依使用者 」 的介面的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="03bc2-161">At this point your "by user" interface's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample4.aspx)]

<span data-ttu-id="03bc2-162">我們現在已準備好撰寫程式碼，以將一組使用者帳戶至 DropDownList 和 Repeater 的規則集合繫結。</span><span class="sxs-lookup"><span data-stu-id="03bc2-162">We are now ready to write the code to bind the set of user accounts to the DropDownList and the set of roles to the Repeater.</span></span> <span data-ttu-id="03bc2-163">在頁面的程式碼後置類別中，新增名為`BindUsersToUserList`而另一個名為`BindRolesList`，使用下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="03bc2-163">In the page's code-behind class, add a method named `BindUsersToUserList` and another named `BindRolesList`, using the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample5.vb)]

<span data-ttu-id="03bc2-164">`BindUsersToUserList`方法則會透過在系統中擷取所有使用者帳戶[`Membership.GetAllUsers`方法](https://msdn.microsoft.com/library/dy8swhya.aspx)。</span><span class="sxs-lookup"><span data-stu-id="03bc2-164">The `BindUsersToUserList` method retrieves all of the user accounts in the system via the [`Membership.GetAllUsers` method](https://msdn.microsoft.com/library/dy8swhya.aspx).</span></span> <span data-ttu-id="03bc2-165">這會傳回[`MembershipUserCollection`物件](https://msdn.microsoft.com/library/system.web.security.membershipusercollection.aspx)，這是集合的[`MembershipUser`執行個體](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx)。</span><span class="sxs-lookup"><span data-stu-id="03bc2-165">This returns a [`MembershipUserCollection` object](https://msdn.microsoft.com/library/system.web.security.membershipusercollection.aspx), which is a collection of [`MembershipUser` instances](https://msdn.microsoft.com/library/system.web.security.membershipuser.aspx).</span></span> <span data-ttu-id="03bc2-166">這個集合則繫結到`UserList`DropDownList。</span><span class="sxs-lookup"><span data-stu-id="03bc2-166">This collection is then bound to the `UserList` DropDownList.</span></span> <span data-ttu-id="03bc2-167">`MembershipUser`執行個體的集合包含各種不同的屬性，例如該結構`UserName`， `Email`， `CreationDate`，和`IsOnline`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-167">The `MembershipUser` instances that makeup the collection contain a variety of properties, like `UserName`, `Email`, `CreationDate`, and `IsOnline`.</span></span> <span data-ttu-id="03bc2-168">若要指示 DropDownList 以顯示的值`UserName`屬性，確定`UserList`DropDownList 的`DataTextField`和`DataValueField`屬性都已設定為"UserName"。</span><span class="sxs-lookup"><span data-stu-id="03bc2-168">In order to instruct the DropDownList to display the value of the `UserName` property, ensure that the `UserList` DropDownList's `DataTextField` and `DataValueField` properties have been set to "UserName".</span></span>

> [!NOTE]
> <span data-ttu-id="03bc2-169">`Membership.GetAllUsers`方法有兩個多載︰ 一個可接受任何輸入的參數且傳回的所有使用者，以及其中的頁面索引和頁面大小的整數值會採用並傳回使用者的指定的子集。</span><span class="sxs-lookup"><span data-stu-id="03bc2-169">The `Membership.GetAllUsers` method has two overloads: one that accepts no input parameters and returns all of the users, and one that takes in integer values for the page index and page size, and returns only the specified subset of the users.</span></span> <span data-ttu-id="03bc2-170">大量的可分頁的使用者介面項目中所顯示的使用者帳戶時，第二個多載可用來更有效率地逐頁查看使用者因為它會傳回只是使用者帳戶而非所有人都精確子集。</span><span class="sxs-lookup"><span data-stu-id="03bc2-170">When there are large amounts of user accounts being displayed in a pageable user interface element, the second overload can be used to more efficiently page through the users since it returns just the precise subset of user accounts rather than all of them.</span></span>


<span data-ttu-id="03bc2-171">`BindRolesToList`方法會呼叫`Roles`類別的[`GetAllRoles`方法](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx)，它會傳回字串陣列，包含系統中的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-171">The `BindRolesToList` method starts by calling the `Roles` class's [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx), which returns a string array containing the roles in the system.</span></span> <span data-ttu-id="03bc2-172">此字串陣列，然後繫結至 Repeater。</span><span class="sxs-lookup"><span data-stu-id="03bc2-172">This string array is then bound to the Repeater.</span></span>

<span data-ttu-id="03bc2-173">最後，我們需要呼叫這兩種方法，當第一次載入此頁面。</span><span class="sxs-lookup"><span data-stu-id="03bc2-173">Finally, we need to call these two methods when the page is first loaded.</span></span> <span data-ttu-id="03bc2-174">將下列程式碼加入至 `Page_Load` 事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="03bc2-174">Add the following code to the `Page_Load` event handler:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample6.vb)]

<span data-ttu-id="03bc2-175">使用此程式碼就緒之後，請花一點時間瀏覽的頁面，透過瀏覽器;您的畫面看起來應該類似於圖 2。</span><span class="sxs-lookup"><span data-stu-id="03bc2-175">With this code in place, take a moment to visit the page through a browser; your screen should look similar to Figure 2.</span></span> <span data-ttu-id="03bc2-176">所有使用者帳戶會填入下拉式清單中，和下方，每個角色會顯示為核取方塊。</span><span class="sxs-lookup"><span data-stu-id="03bc2-176">All of the user accounts are populated in the drop-down list and, underneath that, each role appears as a checkbox.</span></span> <span data-ttu-id="03bc2-177">因為我們設定`AutoPostBack`DropDownList 和屬性的核取方塊設為 True，變更選取的使用者，或是檢查或取消勾選角色造成回傳。</span><span class="sxs-lookup"><span data-stu-id="03bc2-177">Because we set the `AutoPostBack` properties of the DropDownList and CheckBoxes to True, changing the selected user or checking or unchecking a role causes a postback.</span></span> <span data-ttu-id="03bc2-178">不執行任何動作，不過，因為我們尚未撰寫程式碼來處理這些動作時。</span><span class="sxs-lookup"><span data-stu-id="03bc2-178">No action is performed, however, because we have yet to write code to handle these actions.</span></span> <span data-ttu-id="03bc2-179">我們將會處理這些工作，接下來兩節中。</span><span class="sxs-lookup"><span data-stu-id="03bc2-179">We'll tackle these tasks in the next two sections.</span></span>


<span data-ttu-id="03bc2-180">[![此頁面會顯示使用者和角色](assigning-roles-to-users-vb/_static/image5.png)](assigning-roles-to-users-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-180">[![The Page Displays the Users and Roles](assigning-roles-to-users-vb/_static/image5.png)](assigning-roles-to-users-vb/_static/image4.png)</span></span>

<span data-ttu-id="03bc2-181">**圖 2**： 此頁面會顯示使用者和角色 ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-181">**Figure 2**: The Page Displays the Users and Roles  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image6.png))</span></span>


### <a name="checking-the-roles-the-selected-user-belongs-to"></a><span data-ttu-id="03bc2-182">檢查角色選取的使用者屬於</span><span class="sxs-lookup"><span data-stu-id="03bc2-182">Checking the Roles the Selected User Belongs To</span></span>

<span data-ttu-id="03bc2-183">當第一次載入頁面時，或造訪者從下拉式清單中選取新的使用者，我們需要更新`UsersRoleList`的核取方塊，以便只有當選取的使用者屬於該角色，選取指定的角色核取方塊。</span><span class="sxs-lookup"><span data-stu-id="03bc2-183">When the page is first loaded, or whenever the visitor selects a new user from the drop-down list, we need to update the `UsersRoleList`'s checkboxes so that a given role checkbox is checked only if the selected user belongs to that role.</span></span> <span data-ttu-id="03bc2-184">若要達成此目的，建立名為方法`CheckRolesForSelectedUser`為下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="03bc2-184">To accomplish this, create a method named `CheckRolesForSelectedUser` with the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample7.vb)]

<span data-ttu-id="03bc2-185">上述程式碼一開始會判斷選取的使用者。</span><span class="sxs-lookup"><span data-stu-id="03bc2-185">The above code starts by determining who the selected user is.</span></span> <span data-ttu-id="03bc2-186">然後它會使用角色類別的[`GetRolesForUser(userName)`方法](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx)傳回指定的使用者組的字串陣列形式的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-186">It then uses the Roles class's [`GetRolesForUser(userName)` method](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx) to return the specified user's set of roles as a string array.</span></span> <span data-ttu-id="03bc2-187">接下來，列舉 Repeater 的項目和每個項目`RoleCheckBox`核取方塊以程式設計方式所參考。</span><span class="sxs-lookup"><span data-stu-id="03bc2-187">Next, the Repeater's items are enumerated and each item's `RoleCheckBox` CheckBox is programmatically referenced.</span></span> <span data-ttu-id="03bc2-188">只有當它對應至該角色包含在已核取此核取方塊`selectedUsersRoles`字串陣列。</span><span class="sxs-lookup"><span data-stu-id="03bc2-188">The CheckBox is checked only if the role it corresponds to is contained within the `selectedUsersRoles` string array.</span></span>

> [!NOTE]
> <span data-ttu-id="03bc2-189">`Linq.Enumerable.Contains(Of String)(...)`語法不會編譯，如果您使用 ASP.NET 2.0 版。</span><span class="sxs-lookup"><span data-stu-id="03bc2-189">The `Linq.Enumerable.Contains(Of String)(...)` syntax will not compile if you are using ASP.NET version 2.0.</span></span> <span data-ttu-id="03bc2-190">`Contains(Of String)`方法屬於[LINQ 文件庫](http://en.wikipedia.org/wiki/Language_Integrated_Query)，這是新 ASP.NET 3.5。</span><span class="sxs-lookup"><span data-stu-id="03bc2-190">The `Contains(Of String)` method is part of the [LINQ library](http://en.wikipedia.org/wiki/Language_Integrated_Query), which is new to ASP.NET 3.5.</span></span> <span data-ttu-id="03bc2-191">如果您仍在使用 ASP.NET 2.0 版中，使用[`Array.IndexOf(Of String)`方法](https://msdn.microsoft.com/library/eha9t187.aspx)改。</span><span class="sxs-lookup"><span data-stu-id="03bc2-191">If you are still using ASP.NET version 2.0, use the [`Array.IndexOf(Of String)` method](https://msdn.microsoft.com/library/eha9t187.aspx) instead.</span></span>


<span data-ttu-id="03bc2-192">`CheckRolesForSelectedUser`需要在兩個情況下呼叫方法： 第一次載入頁面時，只要使用`UserList`DropDownList 的選取的索引變更。</span><span class="sxs-lookup"><span data-stu-id="03bc2-192">The `CheckRolesForSelectedUser` method needs to be called in two cases: when the page is first loaded and whenever the `UserList` DropDownList's selected index is changed.</span></span> <span data-ttu-id="03bc2-193">因此，呼叫這個方法從`Page_Load`事件處理常式 (呼叫之後`BindUsersToUserList`和`BindRolesToList`)。</span><span class="sxs-lookup"><span data-stu-id="03bc2-193">Therefore, call this method from the `Page_Load` event handler (after the calls to `BindUsersToUserList` and `BindRolesToList`).</span></span> <span data-ttu-id="03bc2-194">此外，建立事件處理常式的 DropDownList`SelectedIndexChanged`事件，並從該處呼叫這個方法。</span><span class="sxs-lookup"><span data-stu-id="03bc2-194">Also, create an event handler for the DropDownList's `SelectedIndexChanged` event and call this method from there.</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample8.vb)]

<span data-ttu-id="03bc2-195">使用此程式碼就緒之後，您可以測試透過瀏覽器頁面。</span><span class="sxs-lookup"><span data-stu-id="03bc2-195">With this code in place, you can test the page through the browser.</span></span> <span data-ttu-id="03bc2-196">不過，由於`UsersAndRoles.aspx`頁面目前缺少能夠將使用者指派給角色，沒有任何使用者角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-196">However, since the `UsersAndRoles.aspx` page currently lacks the ability to assign users to roles, no users have roles.</span></span> <span data-ttu-id="03bc2-197">我們將建立的介面，將使用者指派給角色很快，因此您可以採取我這段程式碼的運作方式的文字，並確認，它會更新版本中，或您可以手動將使用者加入角色插入記錄成`aspnet_UsersInRoles`資料表中，以測試此 functi現在 onality。</span><span class="sxs-lookup"><span data-stu-id="03bc2-197">We will create the interface for assigning users to roles in a moment, so you can either take my word that this code works and verify that it does so later, or you can manually add users to roles by inserting records into the `aspnet_UsersInRoles` table in order to test this functionality now.</span></span>

### <a name="assigning-and-removing-users-from-roles"></a><span data-ttu-id="03bc2-198">指派和從角色移除使用者</span><span class="sxs-lookup"><span data-stu-id="03bc2-198">Assigning and Removing Users from Roles</span></span>

<span data-ttu-id="03bc2-199">造訪者檢查，或取消核取方塊`UsersRoleList`我們需要新增或移除對應的角色中的所選的使用者的重複項。</span><span class="sxs-lookup"><span data-stu-id="03bc2-199">When the visitor checks or unchecks a CheckBox in the `UsersRoleList` Repeater we need to add or remove the selected user from the corresponding role.</span></span> <span data-ttu-id="03bc2-200">核取方塊的`AutoPostBack`設定為 True，這會導致回傳，每當中繼器中的核取方塊已核取或取消核取。</span><span class="sxs-lookup"><span data-stu-id="03bc2-200">The CheckBox's `AutoPostBack` property is currently set to True, which causes a postback anytime a CheckBox in the Repeater is checked or unchecked.</span></span> <span data-ttu-id="03bc2-201">簡單地說，我們需要建立事件處理常式 核取方塊的`CheckChanged`事件。</span><span class="sxs-lookup"><span data-stu-id="03bc2-201">In short, we need to create an event handler for the CheckBox's `CheckChanged` event.</span></span> <span data-ttu-id="03bc2-202">因為核取方塊是在中繼器控制項中，我們需要以手動方式加入事件處理常式配管。</span><span class="sxs-lookup"><span data-stu-id="03bc2-202">Since the CheckBox is in a Repeater control, we need to manually add the event handler plumbing.</span></span> <span data-ttu-id="03bc2-203">將事件處理常式新增至程式碼後置類別，做為啟動`Protected`方法，就像這樣：</span><span class="sxs-lookup"><span data-stu-id="03bc2-203">Start by adding the event handler to the code-behind class as a `Protected` method, like so:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample9.vb)]

<span data-ttu-id="03bc2-204">我們將會傳回這個事件處理常式撰寫程式碼，稍後。</span><span class="sxs-lookup"><span data-stu-id="03bc2-204">We will return to write the code for this event handler in a moment.</span></span> <span data-ttu-id="03bc2-205">但首先讓我們完成之事件處理常式配管。</span><span class="sxs-lookup"><span data-stu-id="03bc2-205">But first let's complete the event handling plumbing.</span></span> <span data-ttu-id="03bc2-206">從 Repeater 內的核取方塊`ItemTemplate`，新增`OnCheckedChanged="RoleCheckBox_CheckChanged"`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-206">From the CheckBox within the Repeater's `ItemTemplate`, add `OnCheckedChanged="RoleCheckBox_CheckChanged"`.</span></span> <span data-ttu-id="03bc2-207">此語法將`RoleCheckBox_CheckChanged`事件處理常式`RoleCheckBox`的`CheckedChanged`事件。</span><span class="sxs-lookup"><span data-stu-id="03bc2-207">This syntax wires the `RoleCheckBox_CheckChanged` event handler to the `RoleCheckBox`'s `CheckedChanged` event.</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample10.aspx)]

<span data-ttu-id="03bc2-208">最後一項工作是完成`RoleCheckBox_CheckChanged`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="03bc2-208">Our final task is to complete the `RoleCheckBox_CheckChanged` event handler.</span></span> <span data-ttu-id="03bc2-209">我們必須開始藉由參考引發事件，因為這個核取方塊執行個體告訴我們哪些角色已 checked 或 unchecked 透過 [checkbox] 控制項及其`Text`和`Checked`屬性。</span><span class="sxs-lookup"><span data-stu-id="03bc2-209">We need to start by referencing the CheckBox control that raised the event because this CheckBox instance tells us what role was checked or unchecked via its `Text` and `Checked` properties.</span></span> <span data-ttu-id="03bc2-210">使用此資訊連同使用者名稱的 選取的使用者，我們新增或移除使用者透過 azure 角色`Roles`類別的[ `AddUserToRole` ](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx)或是[`RemoveUserFromRole`方法](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx)。</span><span class="sxs-lookup"><span data-stu-id="03bc2-210">Using this information along with the UserName of the selected user, we add or remove the user from the role via the `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx) or [`RemoveUserFromRole` method](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx).</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample11.vb)]

<span data-ttu-id="03bc2-211">上述程式碼一開始會以程式設計方式參考引發事件，其可透過核取方塊`sender`輸入的參數。</span><span class="sxs-lookup"><span data-stu-id="03bc2-211">The above code starts by programmatically referencing the CheckBox that raised the event, which is available via the `sender` input parameter.</span></span> <span data-ttu-id="03bc2-212">如果勾選此核取方塊，選取的使用者會加入指定的角色，否則為從角色中移除。</span><span class="sxs-lookup"><span data-stu-id="03bc2-212">If the CheckBox is checked, the selected user is added to the specified role, otherwise they are removed from the role.</span></span> <span data-ttu-id="03bc2-213">在任一情況下，`ActionStatus`標籤會顯示一則訊息摘述剛才執行的動作。</span><span class="sxs-lookup"><span data-stu-id="03bc2-213">In either case, the `ActionStatus` Label displays a message summarizing the action just performed.</span></span>

<span data-ttu-id="03bc2-214">請花一點時間來測試此頁面，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="03bc2-214">Take a moment to test out this page through a browser.</span></span> <span data-ttu-id="03bc2-215">選取使用者 Tito，然後將 Tito 加入系統管理員 」 和 「 監督員 」 角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-215">Select user Tito and then add Tito to both the Administrators and Supervisors roles.</span></span>


<span data-ttu-id="03bc2-216">[![Tito 已新增至系統管理員和監督員的角色](assigning-roles-to-users-vb/_static/image8.png)](assigning-roles-to-users-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-216">[![Tito Has Been Added to the Administrators and Supervisors Roles](assigning-roles-to-users-vb/_static/image8.png)](assigning-roles-to-users-vb/_static/image7.png)</span></span>

<span data-ttu-id="03bc2-217">**圖 3**： 系統管理員和監督員角色已新增 Tito ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-217">**Figure 3**: Tito Has Been Added to the Administrators and Supervisors Roles  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image9.png))</span></span>


<span data-ttu-id="03bc2-218">接下來，從下拉式清單中選取使用者 Bruce。</span><span class="sxs-lookup"><span data-stu-id="03bc2-218">Next, select user Bruce from the drop-down list.</span></span> <span data-ttu-id="03bc2-219">沒有回傳和 Repeater 的核取方塊會透過更新`CheckRolesForSelectedUser`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-219">There is a postback and the Repeater's CheckBoxes are updated via the `CheckRolesForSelectedUser`.</span></span> <span data-ttu-id="03bc2-220">Bruce 不尚未屬於任何角色，因為兩個核取方塊未勾選。</span><span class="sxs-lookup"><span data-stu-id="03bc2-220">Since Bruce does not yet belong to any roles, the two checkboxes are unchecked.</span></span> <span data-ttu-id="03bc2-221">接下來，Bruce 加入 「 主管 」 角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-221">Next, add Bruce to the Supervisors role.</span></span>


<span data-ttu-id="03bc2-222">[![Bruce 已新增至 「 主管 」 角色](assigning-roles-to-users-vb/_static/image11.png)](assigning-roles-to-users-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-222">[![Bruce Has Been Added to the Supervisors Role](assigning-roles-to-users-vb/_static/image11.png)](assigning-roles-to-users-vb/_static/image10.png)</span></span>

<span data-ttu-id="03bc2-223">**圖 4**: Bruce 已新增至 「 主管 」 角色 ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-223">**Figure 4**: Bruce Has Been Added to the Supervisors Role  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image12.png))</span></span>


<span data-ttu-id="03bc2-224">若要進一步驗證功能`CheckRolesForSelectedUser`方法中，選取一個 Tito 或 Bruce 以外的使用者。</span><span class="sxs-lookup"><span data-stu-id="03bc2-224">To further verify the functionality of the `CheckRolesForSelectedUser` method, select a user other than Tito or Bruce.</span></span> <span data-ttu-id="03bc2-225">請注意情況下，核取方塊會自動取消核取的方式，用來表示，它們不屬於任何角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-225">Note how the checkboxes are automatically unchecked, denoting that they do not belong to any roles.</span></span> <span data-ttu-id="03bc2-226">返回 Tito。</span><span class="sxs-lookup"><span data-stu-id="03bc2-226">Return to Tito.</span></span> <span data-ttu-id="03bc2-227">應檢查的系統管理員 」 和 「 監督員內的核取方塊。</span><span class="sxs-lookup"><span data-stu-id="03bc2-227">Both the Administrators and Supervisors checkboxes should be checked.</span></span>

## <a name="step-2-building-the-by-roles-user-interface"></a><span data-ttu-id="03bc2-228">步驟 2： 建立 「 依角色 」 的使用者介面</span><span class="sxs-lookup"><span data-stu-id="03bc2-228">Step 2: Building the "By Roles" User Interface</span></span>

<span data-ttu-id="03bc2-229">現在我們已完成 」 的使用者 」 介面，並已準備好開始處理 「 依角色 」 的介面。</span><span class="sxs-lookup"><span data-stu-id="03bc2-229">At this point we have completed the "by users" interface and are ready to start tackling the "by roles" interface.</span></span> <span data-ttu-id="03bc2-230">「 依角色 」 介面會提示使用者從下拉式清單中選取角色，並顯示一組屬於 GridView 中該角色的使用者。</span><span class="sxs-lookup"><span data-stu-id="03bc2-230">The "by roles" interface prompts the user to select a role from a drop-down list and then displays the set of users that belong to that role in a GridView.</span></span>

<span data-ttu-id="03bc2-231">新增另一個 DropDownList 控制項來`UsersAndRoles.aspx page`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-231">Add another DropDownList control to the `UsersAndRoles.aspx page`.</span></span> <span data-ttu-id="03bc2-232">放置這一個重複項控制項下方，將其命名`RoleList`，並設定其`AutoPostBack`屬性設為 True。</span><span class="sxs-lookup"><span data-stu-id="03bc2-232">Place this one beneath the Repeater control, name it `RoleList`, and set its `AutoPostBack` property to True.</span></span> <span data-ttu-id="03bc2-233">下方，新增 GridView 並將它命名`RolesUserList`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-233">Underneath that, add a GridView and name it `RolesUserList`.</span></span> <span data-ttu-id="03bc2-234">此 GridView 會列出屬於所選角色的使用者。</span><span class="sxs-lookup"><span data-stu-id="03bc2-234">This GridView will list the users that belong to the selected role.</span></span> <span data-ttu-id="03bc2-235">設定 GridView`AutoGenerateColumns`屬性設定為 False，會加入方格中的 TemplateField`Columns`集合和集其`HeaderText`"Users"的屬性。</span><span class="sxs-lookup"><span data-stu-id="03bc2-235">Set the GridView's `AutoGenerateColumns` property to False, add a TemplateField to the grid's `Columns` collection, and set its `HeaderText` property to "Users".</span></span> <span data-ttu-id="03bc2-236">定義 TemplateField `ItemTemplate` ，以顯示資料繫結運算式的值`Container.DataItem`中`Text`屬性的名稱為標籤`UserNameLabel`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-236">Define the TemplateField's `ItemTemplate` so that it displays the value of the databinding expression `Container.DataItem` in the `Text` property of a Label named `UserNameLabel`.</span></span>

<span data-ttu-id="03bc2-237">加入及設定 GridView 之後, 您 「 依角色 」 的介面的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="03bc2-237">After adding and configuring the GridView, your "by role" interface's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample12.aspx)]

<span data-ttu-id="03bc2-238">我們要填入`RoleList`DropDownList 與一組系統中的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-238">We need to populate the `RoleList` DropDownList with the set of roles in the system.</span></span> <span data-ttu-id="03bc2-239">若要這麼做，更新`BindRolesToList`這是繫結的方法所傳回的字串陣列`Roles.GetAllRoles`方法來`RolesList`DropDownList (以及`UsersRoleList`重複項)。</span><span class="sxs-lookup"><span data-stu-id="03bc2-239">To accomplish this, update the `BindRolesToList` method so that is binds the string array returned by the `Roles.GetAllRoles` method to the `RolesList` DropDownList (as well as the `UsersRoleList` Repeater).</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample13.vb)]

<span data-ttu-id="03bc2-240">中的最後兩行`BindRolesToList`方法已加入至繫結之一組角色`RoleList`DropDownList 控制項。</span><span class="sxs-lookup"><span data-stu-id="03bc2-240">The last two lines in the `BindRolesToList` method have been added to bind the set of roles to the `RoleList` DropDownList control.</span></span> <span data-ttu-id="03bc2-241">圖 5 顯示檢視透過瀏覽器 – 下拉式清單，填入 系統角色時的最終結果。</span><span class="sxs-lookup"><span data-stu-id="03bc2-241">Figure 5 shows the end result when viewed through a browser – a drop-down list populated with the system's roles.</span></span>


<span data-ttu-id="03bc2-242">[![角色會顯示在 RoleList DropDownList](assigning-roles-to-users-vb/_static/image14.png)](assigning-roles-to-users-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-242">[![The Roles are Displayed in the RoleList DropDownList](assigning-roles-to-users-vb/_static/image14.png)](assigning-roles-to-users-vb/_static/image13.png)</span></span>

<span data-ttu-id="03bc2-243">**圖 5**： 會顯示角色`RoleList`DropDownList ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-243">**Figure 5**: The Roles are Displayed in the `RoleList` DropDownList  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image15.png))</span></span>


### <a name="displaying-the-users-that-belong-to-the-selected-role"></a><span data-ttu-id="03bc2-244">顯示屬於所選角色的使用者</span><span class="sxs-lookup"><span data-stu-id="03bc2-244">Displaying the Users That Belong To the Selected Role</span></span>

<span data-ttu-id="03bc2-245">當第一次載入頁面，或從選取的新角色時`RoleList`下拉式清單中，我們需要顯示屬於該角色，在 gridview 裡的使用者清單。</span><span class="sxs-lookup"><span data-stu-id="03bc2-245">When the page is first loaded, or when a new role is selected from the `RoleList` DropDownList, we need to display the list of users that belong to that role in the GridView.</span></span> <span data-ttu-id="03bc2-246">建立一個名為方法`DisplayUsersBelongingToRole`使用下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="03bc2-246">Create a method named `DisplayUsersBelongingToRole` using the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample14.vb)]

<span data-ttu-id="03bc2-247">此方法會藉由取得從選取的角色啟動`RoleList`DropDownList。</span><span class="sxs-lookup"><span data-stu-id="03bc2-247">This method starts by getting the selected role from the `RoleList` DropDownList.</span></span> <span data-ttu-id="03bc2-248">然後它會使用[`Roles.GetUsersInRole(roleName)`方法](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx)擷取屬於該角色之使用者的使用者名稱的字串陣列。</span><span class="sxs-lookup"><span data-stu-id="03bc2-248">It then uses the [`Roles.GetUsersInRole(roleName)` method](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx) to retrieve a string array of the UserNames of the users that belong to that role.</span></span> <span data-ttu-id="03bc2-249">這個陣列會接著繫結到`RolesUserList`GridView。</span><span class="sxs-lookup"><span data-stu-id="03bc2-249">This array is then bound to the `RolesUserList` GridView.</span></span>

<span data-ttu-id="03bc2-250">這個方法需要在兩個情況下呼叫： 一開始載入頁面時，以及當在選取的角色`RoleList`dropdownlist 進行變更。</span><span class="sxs-lookup"><span data-stu-id="03bc2-250">This method needs to be called in two circumstances: when the page is initially loaded and when the selected role in the `RoleList` DropDownList changes.</span></span> <span data-ttu-id="03bc2-251">因此，更新`Page_Load`事件處理常式，讓這個方法會叫用呼叫後面`CheckRolesForSelectedUser`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-251">Therefore, update the `Page_Load` event handler so that this method is invoked after the call to `CheckRolesForSelectedUser`.</span></span> <span data-ttu-id="03bc2-252">接下來，建立的事件處理常式`RoleList`的`SelectedIndexChanged`事件，並從該處，呼叫這個方法時，也將太。</span><span class="sxs-lookup"><span data-stu-id="03bc2-252">Next, create an event handler for the `RoleList`'s `SelectedIndexChanged` event, and call this method from there, too.</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample15.vb)]

<span data-ttu-id="03bc2-253">此程式碼的位置， `RolesUserList` GridView 應該會顯示屬於所選角色的使用者。</span><span class="sxs-lookup"><span data-stu-id="03bc2-253">With this code in place, the `RolesUserList` GridView should display those users that belong to the selected role.</span></span> <span data-ttu-id="03bc2-254">如 [圖 6] 所示，監督員角色組成兩個成員： Bruce 和 Tito。</span><span class="sxs-lookup"><span data-stu-id="03bc2-254">As Figure 6 shows, the Supervisors role consists of two members: Bruce and Tito.</span></span>


<span data-ttu-id="03bc2-255">[![GridView 會列出這些屬於所選角色的使用者](assigning-roles-to-users-vb/_static/image17.png)](assigning-roles-to-users-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-255">[![The GridView Lists Those Users That Belong to the Selected Role](assigning-roles-to-users-vb/_static/image17.png)](assigning-roles-to-users-vb/_static/image16.png)</span></span>

<span data-ttu-id="03bc2-256">**圖 6**: GridView 會列出這些使用者屬於選取的角色 ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-256">**Figure 6**: The GridView Lists Those Users That Belong to the Selected Role  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image18.png))</span></span>


### <a name="removing-users-from-the-selected-role"></a><span data-ttu-id="03bc2-257">從選取的角色移除使用者</span><span class="sxs-lookup"><span data-stu-id="03bc2-257">Removing Users from the Selected Role</span></span>

<span data-ttu-id="03bc2-258">讓我們擴大`RolesUserList`GridView 使其包含的資料行的 [移除] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="03bc2-258">Let's augment the `RolesUserList` GridView so that it includes a column of "Remove" buttons.</span></span> <span data-ttu-id="03bc2-259">按一下特定使用者的 [移除] 按鈕將它們從該角色中移除。</span><span class="sxs-lookup"><span data-stu-id="03bc2-259">Clicking the "Remove" button for a particular user will remove them from that role.</span></span>

<span data-ttu-id="03bc2-260">開始刪除按鈕欄位加入至 GridView。</span><span class="sxs-lookup"><span data-stu-id="03bc2-260">Start by adding a Delete button field to the GridView.</span></span> <span data-ttu-id="03bc2-261">讓這個欄位會顯示為已歸檔最左邊，並變更其`DeleteText`屬性從 [刪除] （預設值） 為 「 移除 」。</span><span class="sxs-lookup"><span data-stu-id="03bc2-261">Make this field appear as the left most filed and change its `DeleteText` property from "Delete" (the default) to "Remove".</span></span>


<span data-ttu-id="03bc2-262">[![新增](assigning-roles-to-users-vb/_static/image20.png)](assigning-roles-to-users-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-262">[![Add the](assigning-roles-to-users-vb/_static/image20.png)](assigning-roles-to-users-vb/_static/image19.png)</span></span>

<span data-ttu-id="03bc2-263">**圖 7**： 加入 GridView 中的 [移除] 按鈕 ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-263">**Figure 7**: Add the "Remove" Button to the GridView  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image21.png))</span></span>


<span data-ttu-id="03bc2-264">按一下 [移除] 按鈕時回傳接踵而來和 GridView`RowDeleting`就會引發事件。</span><span class="sxs-lookup"><span data-stu-id="03bc2-264">When the "Remove" button is clicked a postback ensues and the GridView's `RowDeleting` event is raised.</span></span> <span data-ttu-id="03bc2-265">我們需要建立此事件的事件處理常式撰寫程式碼，從選取的角色移除使用者。</span><span class="sxs-lookup"><span data-stu-id="03bc2-265">We need to create an event handler for this event and write code that removes the user from the selected role.</span></span> <span data-ttu-id="03bc2-266">建立事件處理常式，然後加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="03bc2-266">Create the event handler and then add the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample16.vb)]

<span data-ttu-id="03bc2-267">程式碼一開始會判斷選取的角色名稱。</span><span class="sxs-lookup"><span data-stu-id="03bc2-267">The code starts by determining the selected role name.</span></span> <span data-ttu-id="03bc2-268">然後以程式設計方式參考`UserNameLabel`從的 [移除] 按鈕已按下以判斷使用者的使用者名稱，若要移除的資料列的控制。</span><span class="sxs-lookup"><span data-stu-id="03bc2-268">It then programmatically references the `UserNameLabel` control from the row whose "Remove" button was clicked in order to determine the UserName of the user to remove.</span></span> <span data-ttu-id="03bc2-269">使用者從透過呼叫角色中移除`Roles.RemoveUserFromRole`方法。</span><span class="sxs-lookup"><span data-stu-id="03bc2-269">The user is then removed from the role via a call to the `Roles.RemoveUserFromRole` method.</span></span> <span data-ttu-id="03bc2-270">`RolesUserList` GridView 然後重新整理，並透過顯示一則訊息`ActionStatus`標籤控制項。</span><span class="sxs-lookup"><span data-stu-id="03bc2-270">The `RolesUserList` GridView is then refreshed and a message is displayed via the `ActionStatus` Label control.</span></span>

> [!NOTE]
> <span data-ttu-id="03bc2-271">[移除] 按鈕不需要任何類型的使用者從角色移除使用者之前，先確認。</span><span class="sxs-lookup"><span data-stu-id="03bc2-271">The "Remove" button does not require any sort of confirmation from the user before removing the user from the role.</span></span> <span data-ttu-id="03bc2-272">歡迎您加入某種程度的使用者確認。</span><span class="sxs-lookup"><span data-stu-id="03bc2-272">I invite you to add some level of user confirmation.</span></span> <span data-ttu-id="03bc2-273">其中一個最簡單的方式，可確認動作是透過用戶端確認對話方塊。</span><span class="sxs-lookup"><span data-stu-id="03bc2-273">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="03bc2-274">如需有關這項技術的詳細資訊，請參閱 <<c0> [ 正在刪除時新增用戶端確認](https://asp.net/learn/data-access/tutorial-42-vb.aspx)。</span><span class="sxs-lookup"><span data-stu-id="03bc2-274">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-vb.aspx).</span></span>


<span data-ttu-id="03bc2-275">從 主管 群組中移除使用者 Tito 後，圖 8 顯示頁面。</span><span class="sxs-lookup"><span data-stu-id="03bc2-275">Figure 8 shows the page after user Tito has been removed from the Supervisors group.</span></span>


<span data-ttu-id="03bc2-276">[![可惜的是，Tito 不再監督員](assigning-roles-to-users-vb/_static/image23.png)](assigning-roles-to-users-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-276">[![Alas, Tito is No Longer a Supervisor](assigning-roles-to-users-vb/_static/image23.png)](assigning-roles-to-users-vb/_static/image22.png)</span></span>

<span data-ttu-id="03bc2-277">**圖 8**： 是很優 Tito 不再監督員 ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-277">**Figure 8**: Alas, Tito is No Longer a Supervisor  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image24.png))</span></span>


### <a name="adding-new-users-to-the-selected-role"></a><span data-ttu-id="03bc2-278">將新的使用者新增至選取的角色</span><span class="sxs-lookup"><span data-stu-id="03bc2-278">Adding New Users to the Selected Role</span></span>

<span data-ttu-id="03bc2-279">從選取的角色移除使用者，以及此頁面的訪客也應該能夠將使用者新增至選取的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-279">Along with removing users from the selected role, the visitor to this page should also be able to add a user to the selected role.</span></span> <span data-ttu-id="03bc2-280">將使用者新增至所選角色的最佳介面取決於您預期的使用者帳戶數目。</span><span class="sxs-lookup"><span data-stu-id="03bc2-280">The best interface for adding a user to the selected role depends on the number of user accounts you expect to have.</span></span> <span data-ttu-id="03bc2-281">如果您的網站會存放在短短的數十個使用者帳戶或更小，您可以在這裡使用 dropdownlist 進行。</span><span class="sxs-lookup"><span data-stu-id="03bc2-281">If your website will house just a few dozen user accounts or less, you could use a DropDownList here.</span></span> <span data-ttu-id="03bc2-282">如果可能有數千個使用者帳戶，您會想要包括允許訪客能夠逐頁瀏覽的帳戶，搜尋特定的帳戶，或篩選中透過其他方式的使用者帳戶的使用者介面。</span><span class="sxs-lookup"><span data-stu-id="03bc2-282">If there might be thousands of user accounts, you would want to include a user interface that permits the visitor to page through the accounts, search for a particular account, or filter the user accounts in some other fashion.</span></span>

<span data-ttu-id="03bc2-283">此頁面讓我們使用一個非常簡單的介面，不論在系統中的使用者帳戶數目。</span><span class="sxs-lookup"><span data-stu-id="03bc2-283">For this page let's use a very simple interface that works regardless of the number of user accounts in the system.</span></span> <span data-ttu-id="03bc2-284">也就是，我們將使用文字方塊中，提示輸入使用者的她想要新增至選取的角色名稱的訪客。</span><span class="sxs-lookup"><span data-stu-id="03bc2-284">Namely, we will use a TextBox, prompting the visitor to type in the username of the user she wants to add to the selected role.</span></span> <span data-ttu-id="03bc2-285">如果沒有具有該名稱的使用者存在，或如果使用者已經是角色的成員，我們會顯示在訊息`ActionStatus`標籤。</span><span class="sxs-lookup"><span data-stu-id="03bc2-285">If no user with that name exists, or if the user is already a member of the role, we'll display a message in `ActionStatus` Label.</span></span> <span data-ttu-id="03bc2-286">但是，如果使用者存在，且不是角色的成員，則我們會將它們新增至角色，並重新整理方格。</span><span class="sxs-lookup"><span data-stu-id="03bc2-286">But if the user exists and is not a member of the role, we'll add them to the role and refresh the grid.</span></span>

<span data-ttu-id="03bc2-287">加入 TextBox 和 GridView 下方的按鈕。</span><span class="sxs-lookup"><span data-stu-id="03bc2-287">Add a TextBox and Button beneath the GridView.</span></span> <span data-ttu-id="03bc2-288">設定文字方塊的`ID`要`UserNameToAddToRole`並將按鈕的`ID`並`Text`屬性，以`AddUserToRoleButton`和 「 新增使用者至角色 」，分別。</span><span class="sxs-lookup"><span data-stu-id="03bc2-288">Set the TextBox's `ID` to `UserNameToAddToRole` and set the Button's `ID` and `Text` properties to `AddUserToRoleButton` and "Add User to Role", respectively.</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample17.aspx)]

<span data-ttu-id="03bc2-289">接下來，建立`Click`事件處理常式`AddUserToRoleButton`並加入下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="03bc2-289">Next, create a `Click` event handler for the `AddUserToRoleButton` and add the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample18.vb)]

<span data-ttu-id="03bc2-290">中的程式碼大多`Click`事件處理常式會執行各種不同的驗證檢查。</span><span class="sxs-lookup"><span data-stu-id="03bc2-290">The majority of the code in the `Click` event handler performs various validation checks.</span></span> <span data-ttu-id="03bc2-291">它可確保訪客提供中的使用者名稱`UserNameToAddToRole`文字方塊中，使用者存在於系統中，而且已不屬於所選的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-291">It ensures that the visitor supplied a username in the `UserNameToAddToRole` TextBox, that the user exists in the system, and that they don't already belong to the selected role.</span></span> <span data-ttu-id="03bc2-292">如果上述任何檢查失敗時，適當的訊息會顯示在`ActionStatus`和結束事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="03bc2-292">If any of these checks fails, an appropriate message is displayed in `ActionStatus` and the event handler is exited.</span></span> <span data-ttu-id="03bc2-293">如果所有檢查都通過，要將使用者新增至透過角色`Roles.AddUserToRole`方法。</span><span class="sxs-lookup"><span data-stu-id="03bc2-293">If all of the checks pass, the user is added to the role via the `Roles.AddUserToRole` method.</span></span> <span data-ttu-id="03bc2-294">接下來，文字方塊中的`Text`屬性會被清除、 重新整理 GridView，而`ActionStatus`標籤會顯示訊息，指出指定的使用者已成功加入至選取的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-294">Following that, the TextBox's `Text` property is cleared out, the GridView is refreshed, and the `ActionStatus` Label displays a message indicating that the specified user was successfully added to the selected role.</span></span>

> [!NOTE]
> <span data-ttu-id="03bc2-295">若要確保指定的使用者已經不隸屬於所選的角色，我們使用[`Roles.IsUserInRole(userName, roleName)`方法](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx)，它會傳回布林值，指出是否*userName* 隸屬*roleName*。</span><span class="sxs-lookup"><span data-stu-id="03bc2-295">To ensure that the specified user does not already belong to the selected role, we use the [`Roles.IsUserInRole(userName, roleName)` method](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx), which returns a Boolean value indicating whether *userName* is a member of *roleName*.</span></span> <span data-ttu-id="03bc2-296">我們將使用中的，這個方法一次<a id="_msoanchor_2"> </a>[下一個教學課程](role-based-authorization-vb.md)當我們查看以角色為基礎的授權。</span><span class="sxs-lookup"><span data-stu-id="03bc2-296">We will use this method again in the <a id="_msoanchor_2"></a>[next tutorial](role-based-authorization-vb.md) when we look at role-based authorization.</span></span>


<span data-ttu-id="03bc2-297">瀏覽透過瀏覽器頁面，然後選取從 「 監督員角色`RoleList`DropDownList。</span><span class="sxs-lookup"><span data-stu-id="03bc2-297">Visit the page through a browser and select the Supervisors role from the `RoleList` DropDownList.</span></span> <span data-ttu-id="03bc2-298">請嘗試輸入無效的使用者名稱，您應該會看到訊息，說明使用者不存在於系統。</span><span class="sxs-lookup"><span data-stu-id="03bc2-298">Try entering an invalid username – you should see a message explaining that the user does not exist in the system.</span></span>


<span data-ttu-id="03bc2-299">[![您無法將不存在的使用者加入角色](assigning-roles-to-users-vb/_static/image26.png)](assigning-roles-to-users-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-299">[![You Cannot Add a Non-Existent User to a Role](assigning-roles-to-users-vb/_static/image26.png)](assigning-roles-to-users-vb/_static/image25.png)</span></span>

<span data-ttu-id="03bc2-300">**圖 9**： 您無法加入角色中的非存在的使用者 ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-300">**Figure 9**: You Cannot Add a Non-Existent User to a Role  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image27.png))</span></span>


<span data-ttu-id="03bc2-301">現在，嘗試新增有效的使用者。</span><span class="sxs-lookup"><span data-stu-id="03bc2-301">Now try adding a valid user.</span></span> <span data-ttu-id="03bc2-302">請繼續並重新加入 Tito 監督員的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-302">Go ahead and re-add Tito to the Supervisors role.</span></span>


<span data-ttu-id="03bc2-303">[![Tito 同樣是監督員 ！](assigning-roles-to-users-vb/_static/image29.png)](assigning-roles-to-users-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-303">[![Tito Is Once Again a Supervisor!](assigning-roles-to-users-vb/_static/image29.png)](assigning-roles-to-users-vb/_static/image28.png)</span></span>

<span data-ttu-id="03bc2-304">**圖 10**: Tito 同樣是監督員 ！</span><span class="sxs-lookup"><span data-stu-id="03bc2-304">**Figure 10**: Tito Is Once Again a Supervisor!</span></span>  <span data-ttu-id="03bc2-305">([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-305">([Click to view full-size image](assigning-roles-to-users-vb/_static/image30.png))</span></span>


## <a name="step-3-cross-updating-the-by-user-and-by-role-interfaces"></a><span data-ttu-id="03bc2-306">步驟 3： 跨更新 「 使用者 」 和 「 角色 」 介面</span><span class="sxs-lookup"><span data-stu-id="03bc2-306">Step 3: Cross-Updating the "By User" and "By Role" Interfaces</span></span>

<span data-ttu-id="03bc2-307">`UsersAndRoles.aspx`頁面提供兩個不同的介面來管理使用者和角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-307">The `UsersAndRoles.aspx` page offers two distinct interfaces for managing users and roles.</span></span> <span data-ttu-id="03bc2-308">目前，這兩個介面的作用彼此所以有可能，在一個介面中所做的變更將不會立即反映在其他。</span><span class="sxs-lookup"><span data-stu-id="03bc2-308">Currently, these two interfaces act independently of one another so it is possible that a change made in one interface will not be reflected immediately in the other.</span></span> <span data-ttu-id="03bc2-309">例如，想像一下頁面的造訪者選取 「 主管 」 角色從`RoleList`下拉式清單中，它會列出 Bruce 和 Tito 做為其成員。</span><span class="sxs-lookup"><span data-stu-id="03bc2-309">For example, imagine that the visitor to the page selects the Supervisors role from the `RoleList` DropDownList, which lists Bruce and Tito as its members.</span></span> <span data-ttu-id="03bc2-310">下一步，造訪者選取從 Tito`UserList`下拉式清單中，用來在檢查的系統管理員 」 和 「 監督員核取方塊`UsersRoleList`Repeater。</span><span class="sxs-lookup"><span data-stu-id="03bc2-310">Next, the visitor selects Tito from the `UserList` DropDownList, which checks the Administrators and Supervisors checkboxes in the `UsersRoleList` Repeater.</span></span> <span data-ttu-id="03bc2-311">如果造訪者然後取消核取 Repeater 從 「 主管 」 角色，Tito 從角色中移除監督員內，但這項修改不會反映在 「 依角色 」 介面中。</span><span class="sxs-lookup"><span data-stu-id="03bc2-311">If the visitor then unchecks the Supervisor role from the Repeater, Tito is removed from the Supervisors role, but this modification is not reflected in the "by role" interface.</span></span> <span data-ttu-id="03bc2-312">GridView 仍會顯示 Tito 視為 「 主管 」 角色的成員。</span><span class="sxs-lookup"><span data-stu-id="03bc2-312">The GridView will still show Tito as being a member of the Supervisors role.</span></span>

<span data-ttu-id="03bc2-313">若要修正此我們要重新整理 GridView，每當角色是 checked 或 unchecked 從`UsersRoleList`Repeater。</span><span class="sxs-lookup"><span data-stu-id="03bc2-313">To fix this we need to refresh the GridView whenever a role is checked or unchecked from the `UsersRoleList` Repeater.</span></span> <span data-ttu-id="03bc2-314">同樣地，我們需要重新整理 Repeater，每當使用者移除或新增至角色，從 「 依角色 」 的介面。</span><span class="sxs-lookup"><span data-stu-id="03bc2-314">Likewise, we need to refresh the Repeater whenever a user is removed or added to a role from the "by role" interface.</span></span>

<span data-ttu-id="03bc2-315">在 「 依使用者 」 介面 Repeater 會藉由呼叫重新整理`CheckRolesForSelectedUser`方法。</span><span class="sxs-lookup"><span data-stu-id="03bc2-315">The Repeater in the "by user" interface is refreshed by calling the `CheckRolesForSelectedUser` method.</span></span> <span data-ttu-id="03bc2-316">可修改的 「 依角色 」 介面`RolesUserList`GridView 的`RowDeleting`事件處理常式並`AddUserToRoleButton` 按鈕的`Click`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="03bc2-316">The "by role" interface can be modified in the `RolesUserList` GridView's `RowDeleting` event handler and the `AddUserToRoleButton` Button's `Click` event handler.</span></span> <span data-ttu-id="03bc2-317">因此，我們需要呼叫`CheckRolesForSelectedUser`從每一種方法的方法。</span><span class="sxs-lookup"><span data-stu-id="03bc2-317">Therefore, we need to call the `CheckRolesForSelectedUser` method from each of these methods.</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample19.vb)]

<span data-ttu-id="03bc2-318">同樣地，在 「 依角色 」 介面 GridView 會重新整理藉由呼叫`DisplayUsersBelongingToRole`方法，並在 「 依使用者 」 介面透過修改`RoleCheckBox_CheckChanged`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="03bc2-318">Similarly, the GridView in the "by role" interface is refreshed by calling the `DisplayUsersBelongingToRole` method and the "by user" interface is modified through the `RoleCheckBox_CheckChanged` event handler.</span></span> <span data-ttu-id="03bc2-319">因此，我們需要呼叫`DisplayUsersBelongingToRole`從這個事件處理常式的方法。</span><span class="sxs-lookup"><span data-stu-id="03bc2-319">Therefore, we need to call the `DisplayUsersBelongingToRole` method from this event handler.</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample20.vb)]

<span data-ttu-id="03bc2-320">這些次要的程式碼變更，「 使用者 」 和 「 角色 」 介面現在正確跨更新。</span><span class="sxs-lookup"><span data-stu-id="03bc2-320">With these minor code changes, the "by user" and "by role" interfaces now correctly cross-update.</span></span> <span data-ttu-id="03bc2-321">若要確認這點，請瀏覽透過瀏覽器頁面並選取 Tito 和監督員內，從`UserList`和`RoleList`dropdownlist 進行，分別。</span><span class="sxs-lookup"><span data-stu-id="03bc2-321">To verify this, visit the page through a browser and select Tito and Supervisors from the `UserList` and `RoleList` DropDownLists, respectively.</span></span> <span data-ttu-id="03bc2-322">請注意，當您針對從在 「 依使用者 」 介面 Repeater Tito 取消 「 主管 」 角色，Tito 會自動移除 「 依角色 」 介面中 GridView。</span><span class="sxs-lookup"><span data-stu-id="03bc2-322">Note that as you uncheck the Supervisors role for Tito from the Repeater in the "by user" interface, Tito is automatically removed from the GridView in the "by role" interface.</span></span> <span data-ttu-id="03bc2-323">回到 「 主管 」 角色中將 Tito 加入從 「 依角色 」 的介面時，會自動重新檢查 「 依使用者 」 介面中的各有核取方塊。</span><span class="sxs-lookup"><span data-stu-id="03bc2-323">Adding Tito back to the Supervisors role from the "by role" interface automatically re-checks the Supervisors checkbox in the "by user" interface.</span></span>

## <a name="step-4-customizing-the-createuserwizard-to-include-a-specify-roles-step"></a><span data-ttu-id="03bc2-324">步驟 4： 自訂以包含 「 指定的角色 」 的步驟 CreateUserWizard</span><span class="sxs-lookup"><span data-stu-id="03bc2-324">Step 4: Customizing the CreateUserWizard to Include a "Specify Roles" Step</span></span>

<span data-ttu-id="03bc2-325">在  <a id="_msoanchor_3"> </a> [*建立使用者帳戶*](../membership/creating-user-accounts-vb.md)教學課程中我們了解如何使用 CreateUserWizard Web 控制項來提供介面來建立新的使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="03bc2-325">In the <a id="_msoanchor_3"></a>[*Creating User Accounts*](../membership/creating-user-accounts-vb.md) tutorial we saw how to use the CreateUserWizard Web control to provide an interface for creating a new user account.</span></span> <span data-ttu-id="03bc2-326">CreateUserWizard 控制項可以用於兩種方式之一：</span><span class="sxs-lookup"><span data-stu-id="03bc2-326">The CreateUserWizard control can be used in one of two ways:</span></span>

- <span data-ttu-id="03bc2-327">做為的訪客在網站上，建立他們自己的使用者帳戶和</span><span class="sxs-lookup"><span data-stu-id="03bc2-327">As a means for visitors to create their own user account on the site, and</span></span>
- <span data-ttu-id="03bc2-328">做為建立新帳戶的系統管理員</span><span class="sxs-lookup"><span data-stu-id="03bc2-328">As a means for administrators to create new accounts</span></span>

<span data-ttu-id="03bc2-329">在第一個使用案例中，訪客會來到 站台，並填寫 CreateUserWizard，才能註冊網站上輸入他們的資訊。</span><span class="sxs-lookup"><span data-stu-id="03bc2-329">In the first use case, a visitor comes to the site and fills out the CreateUserWizard, entering their information in order to register on the site.</span></span> <span data-ttu-id="03bc2-330">在第二個案例中，系統管理員會建立新的帳戶，另一位人員。</span><span class="sxs-lookup"><span data-stu-id="03bc2-330">In the second case, an administrator creates a new account for another person.</span></span>

<span data-ttu-id="03bc2-331">當正在建立帳戶的一些其他人的系統管理員時，可能很有幫助以允許系統管理員指定哪些新的使用者帳戶所屬的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-331">When an account is being created by an administrator for some other person, it might be helpful to allow the administrator to specify what roles the new user account belongs to.</span></span> <span data-ttu-id="03bc2-332">在  <a id="_msoanchor_4"> </a> [*儲存**額外的使用者資訊*](../membership/storing-additional-user-information-vb.md)我們了解如何新增其他自訂 CreateUserWizard 的教學課程`WizardSteps`.</span><span class="sxs-lookup"><span data-stu-id="03bc2-332">In the <a id="_msoanchor_4"></a>[*Storing* *Additional User Information*](../membership/storing-additional-user-information-vb.md) tutorial we saw how to customize the CreateUserWizard by adding additional `WizardSteps`.</span></span> <span data-ttu-id="03bc2-333">讓我們看看如何將額外的步驟新增至 CreateUserWizard，若要指定新的使用者角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-333">Let's look at how to add an additional step to the CreateUserWizard in order to specify the new user's roles.</span></span>

<span data-ttu-id="03bc2-334">開啟`CreateUserWizardWithRoles.aspx`頁面上，並新增名為的 CreateUserWizard 控制項`RegisterUserWithRoles`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-334">Open the `CreateUserWizardWithRoles.aspx` page and add a CreateUserWizard control named `RegisterUserWithRoles`.</span></span> <span data-ttu-id="03bc2-335">將控制項的`ContinueDestinationPageUrl`屬性，以"~ / Default.aspx"。</span><span class="sxs-lookup"><span data-stu-id="03bc2-335">Set the control's `ContinueDestinationPageUrl` property to "~/Default.aspx".</span></span> <span data-ttu-id="03bc2-336">因為這意思是，系統管理員將會使用這個 CreateUserWizard 控制項來建立新的使用者帳戶，將控制項的`LoginCreatedUser`屬性設定為 False。</span><span class="sxs-lookup"><span data-stu-id="03bc2-336">Because the idea here is that an administrator will be using this CreateUserWizard control to create new user accounts, set the control's `LoginCreatedUser` property to False.</span></span> <span data-ttu-id="03bc2-337">這`LoginCreatedUser`屬性指定是否訪客自動剛建立以使用者身分，登入，而且它預設為 True。</span><span class="sxs-lookup"><span data-stu-id="03bc2-337">This `LoginCreatedUser` property specifies whether the visitor is automatically logged on as the just-created user, and it defaults to True.</span></span> <span data-ttu-id="03bc2-338">我們將它設定為 False 因為系統管理員建立新的帳戶時，我們希望能讓他自己的身分登入。</span><span class="sxs-lookup"><span data-stu-id="03bc2-338">We set it to False because when an administrator creates a new account we want to keep him signed in as himself.</span></span>

<span data-ttu-id="03bc2-339">接下來，選取 「 新增/移除`WizardSteps`...」 選項從 CreateUserWizard 的智慧標籤，然後新增新`WizardStep`，將其`ID`至`SpecifyRolesStep`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-339">Next, select the "Add/Remove `WizardSteps`…" option from the CreateUserWizard's Smart Tag and add a new `WizardStep`, setting its `ID` to `SpecifyRolesStep`.</span></span> <span data-ttu-id="03bc2-340">移動`SpecifyRolesStep WizardStep`以便說 「 登註冊您新帳戶 」 的步驟之後，但 「 完成 」 步驟之前。</span><span class="sxs-lookup"><span data-stu-id="03bc2-340">Move the `SpecifyRolesStep WizardStep` so that it comes after the "Sign Up for Your New Account" step, but before the "Complete" step.</span></span> <span data-ttu-id="03bc2-341">設定`WizardStep`的`Title`屬性，以 「 指定角色 」，其`StepType`屬性設`Step`，並將其`AllowReturn`屬性設定為 False。</span><span class="sxs-lookup"><span data-stu-id="03bc2-341">Set the `WizardStep`'s `Title` property to "Specify Roles", its `StepType` property to `Step`, and its `AllowReturn` property to False.</span></span>


<span data-ttu-id="03bc2-342">[![新增](assigning-roles-to-users-vb/_static/image32.png)](assigning-roles-to-users-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-342">[![Add the](assigning-roles-to-users-vb/_static/image32.png)](assigning-roles-to-users-vb/_static/image31.png)</span></span>

<span data-ttu-id="03bc2-343">**圖 11**： 新增 「 指定角色 」`WizardStep`以 CreateUserWizard ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-343">**Figure 11**: Add the "Specify Roles" `WizardStep` to the CreateUserWizard  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image33.png))</span></span>


<span data-ttu-id="03bc2-344">這項變更之後 CreateUserWizard 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="03bc2-344">After this change your CreateUserWizard's declarative markup should look like the following:</span></span>

[!code-aspx[Main](assigning-roles-to-users-vb/samples/sample21.aspx)]

<span data-ttu-id="03bc2-345">在 [指定角色] `WizardStep`，新增名為 CheckBoxList`RoleList.`此 CheckBoxList 會列出可用的角色，新建立的使用者啟用瀏覽頁面的人員，若要檢查哪些角色所屬。</span><span class="sxs-lookup"><span data-stu-id="03bc2-345">In the "Specify Roles" `WizardStep`, add a CheckBoxList named `RoleList.` This CheckBoxList will list the available roles, enabling the person visiting the page to check what roles the newly created user belongs to.</span></span>

<span data-ttu-id="03bc2-346">但還是有兩個程式碼撰寫工作： 首先我們必須填入`RoleList`CheckBoxList 系統; 中的角色與第二，我們需要將所建立的使用者新增至選取的角色，當使用者從 「 指定的角色 」 步驟移至 「 完成 」 步驟。</span><span class="sxs-lookup"><span data-stu-id="03bc2-346">We are left with two coding tasks: first we must populate the `RoleList` CheckBoxList with the roles in the system; second, we need to add the created user to the selected roles when the user moves from the "Specify Roles" step to the "Complete" step.</span></span> <span data-ttu-id="03bc2-347">我們可以完成的第一個工作`Page_Load`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="03bc2-347">We can accomplish the first task in the `Page_Load` event handler.</span></span> <span data-ttu-id="03bc2-348">下列的程式碼以程式設計方式參考`RoleList`核取方塊，在第一個瀏覽至頁面，並將系統中的角色繫結至它。</span><span class="sxs-lookup"><span data-stu-id="03bc2-348">The following code programmatically references the `RoleList` CheckBox on the first visit to the page and binds the roles in the system to it.</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample22.vb)]

<span data-ttu-id="03bc2-349">上述程式碼看起來應該很熟悉。</span><span class="sxs-lookup"><span data-stu-id="03bc2-349">The above code should look familiar.</span></span> <span data-ttu-id="03bc2-350">在  <a id="_msoanchor_5"> </a> [*儲存**額外的使用者資訊*](../membership/storing-additional-user-information-vb.md)教學課程中我們使用兩個`FindControl`陳述式來參考 Web 控制項從自訂內`WizardStep`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-350">In the <a id="_msoanchor_5"></a>[*Storing* *Additional User Information*](../membership/storing-additional-user-information-vb.md) tutorial we used two `FindControl` statements to reference a Web control from within a custom `WizardStep`.</span></span> <span data-ttu-id="03bc2-351">並將角色繫結至 CheckBoxList 的程式碼取自稍早在本教學課程。</span><span class="sxs-lookup"><span data-stu-id="03bc2-351">And the code that binds the roles to the CheckBoxList was taken from earlier in this tutorial.</span></span>

<span data-ttu-id="03bc2-352">若要執行的第二個的程式設計工作，我們需要知道何時會完成的 「 指定的角色 」 步驟。</span><span class="sxs-lookup"><span data-stu-id="03bc2-352">In order to perform the second programming task we need to know when the "Specify Roles" step has been completed.</span></span> <span data-ttu-id="03bc2-353">回想一下，CreateUserWizard 具有`ActiveStepChanged`引發的事件，每次造訪者一個步驟中瀏覽至另一個。</span><span class="sxs-lookup"><span data-stu-id="03bc2-353">Recall that the CreateUserWizard has an `ActiveStepChanged` event, which fires each time the visitor navigates from one step to another.</span></span> <span data-ttu-id="03bc2-354">這裡我們可以判斷使用者是否已達到 「 完成 」 的步驟如果是這樣，我們需要將使用者新增至選取的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-354">Here we can determine if the user has reached the "Complete" step; if so, we need to add the user to the selected roles.</span></span>

<span data-ttu-id="03bc2-355">建立事件處理常式`ActiveStepChanged`事件，並新增下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="03bc2-355">Create an event handler for the `ActiveStepChanged` event and add the following code:</span></span>

[!code-vb[Main](assigning-roles-to-users-vb/samples/sample23.vb)]

<span data-ttu-id="03bc2-356">如果使用者剛到達 「 已完成 」 步驟，事件處理常式會列舉的項目`RoleList`CheckBoxList 和剛建立的使用者指派給選取的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-356">If the user has just reached the "Completed" step, the event handler enumerates the items of the `RoleList` CheckBoxList and the just-created user is assigned to the selected roles.</span></span>

<span data-ttu-id="03bc2-357">請瀏覽此頁面，透過瀏覽器。</span><span class="sxs-lookup"><span data-stu-id="03bc2-357">Visit this page through a browser.</span></span> <span data-ttu-id="03bc2-358">CreateUserWizard 的第一個步驟是標準的 [登註冊您新增帳戶] 步驟，也會提示您輸入新使用者的使用者名稱、 密碼、 電子郵件和其他重要資訊。</span><span class="sxs-lookup"><span data-stu-id="03bc2-358">The first step in the CreateUserWizard is the standard "Sign Up for Your New Account" step, which prompts for the new user's username, password, email, and other key information.</span></span> <span data-ttu-id="03bc2-359">輸入要建立名為 Wanda 的新使用者的資訊。</span><span class="sxs-lookup"><span data-stu-id="03bc2-359">Enter the information to create a new user named Wanda.</span></span>


<span data-ttu-id="03bc2-360">[![建立名為 Wanda 新使用者](assigning-roles-to-users-vb/_static/image35.png)](assigning-roles-to-users-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-360">[![Create a New User Named Wanda](assigning-roles-to-users-vb/_static/image35.png)](assigning-roles-to-users-vb/_static/image34.png)</span></span>

<span data-ttu-id="03bc2-361">**圖 12**： 建立新的使用者名稱為 Wanda ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-361">**Figure 12**: Create a New User Named Wanda  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image36.png))</span></span>


<span data-ttu-id="03bc2-362">按一下 [建立使用者] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="03bc2-362">Click the "Create User" button.</span></span> <span data-ttu-id="03bc2-363">在內部呼叫 CreateUserWizard`Membership.CreateUser`方法，建立新的使用者帳戶，並接著會前進到下一個步驟中，「 指定的角色。 」</span><span class="sxs-lookup"><span data-stu-id="03bc2-363">The CreateUserWizard internally calls the `Membership.CreateUser` method, creating the new user account, and then progresses to the next step, "Specify Roles."</span></span> <span data-ttu-id="03bc2-364">這裡會列出系統角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-364">Here the system roles are listed.</span></span> <span data-ttu-id="03bc2-365">檢查各有核取方塊，然後按一下 [下一步]。</span><span class="sxs-lookup"><span data-stu-id="03bc2-365">Check the Supervisors checkbox and click Next.</span></span>


<span data-ttu-id="03bc2-366">[![請 Wanda 監督員角色的成員](assigning-roles-to-users-vb/_static/image38.png)](assigning-roles-to-users-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-366">[![Make Wanda a Member of the Supervisors Role](assigning-roles-to-users-vb/_static/image38.png)](assigning-roles-to-users-vb/_static/image37.png)</span></span>

<span data-ttu-id="03bc2-367">**圖 13**： 請 Wanda 監督員角色的成員 ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-367">**Figure 13**: Make Wanda a Member of the Supervisors Role  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image39.png))</span></span>


<span data-ttu-id="03bc2-368">按一下 下一步，回傳和更新會導致`ActiveStep`「 完成 」 步驟。</span><span class="sxs-lookup"><span data-stu-id="03bc2-368">Clicking Next causes a postback and updates the `ActiveStep` to the "Complete" step.</span></span> <span data-ttu-id="03bc2-369">在 `ActiveStepChanged`事件處理常式，最近建立的使用者帳戶指派給 「 監督員 」 角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-369">In the `ActiveStepChanged` event handler, the recently-created user account is assigned to the Supervisors role.</span></span> <span data-ttu-id="03bc2-370">若要確認這點，傳回到`UsersAndRoles.aspx`頁面上，選取監督員內，從`RoleList`DropDownList。</span><span class="sxs-lookup"><span data-stu-id="03bc2-370">To verify this, return to the `UsersAndRoles.aspx` page and select Supervisors from the `RoleList` DropDownList.</span></span> <span data-ttu-id="03bc2-371">如 [圖 14] 所示，監督員內現在組成三個使用者： Bruce、 Tito 和 Wanda。</span><span class="sxs-lookup"><span data-stu-id="03bc2-371">As Figure 14 shows, the Supervisors are now made up of three users: Bruce, Tito, and Wanda.</span></span>


<span data-ttu-id="03bc2-372">[![Bruce、 Tito 和 Wanda 是所有的監督員](assigning-roles-to-users-vb/_static/image41.png)](assigning-roles-to-users-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="03bc2-372">[![Bruce, Tito, and Wanda are All Supervisors](assigning-roles-to-users-vb/_static/image41.png)](assigning-roles-to-users-vb/_static/image40.png)</span></span>

<span data-ttu-id="03bc2-373">**圖 14**: Bruce、 Tito 和 Wanda 是所有的監督員 ([按一下以檢視完整大小的影像](assigning-roles-to-users-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="03bc2-373">**Figure 14**: Bruce, Tito, and Wanda are All Supervisors  ([Click to view full-size image](assigning-roles-to-users-vb/_static/image42.png))</span></span>


## <a name="summary"></a><span data-ttu-id="03bc2-374">總結</span><span class="sxs-lookup"><span data-stu-id="03bc2-374">Summary</span></span>

<span data-ttu-id="03bc2-375">角色架構會提供方法來擷取特定使用者的角色和方法來判斷哪些使用者屬於指定角色的相關資訊。</span><span class="sxs-lookup"><span data-stu-id="03bc2-375">The Roles framework offers methods for retrieving information about a particular user's roles and methods for determining what users belong to a specified role.</span></span> <span data-ttu-id="03bc2-376">此外，有多種方法來新增和移除一或多個使用者新增至一或多個角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-376">Furthermore, there are a number of methods for adding and removing one or more users to one or more roles.</span></span> <span data-ttu-id="03bc2-377">在本教學課程中我們著重於兩個只是一種方法：`AddUserToRole`和`RemoveUserFromRole`。</span><span class="sxs-lookup"><span data-stu-id="03bc2-377">In this tutorial we focused on just two of these methods: `AddUserToRole` and `RemoveUserFromRole`.</span></span> <span data-ttu-id="03bc2-378">有設計用來將多個使用者新增至單一角色，並將多個角色指派給單一使用者的其他變化。</span><span class="sxs-lookup"><span data-stu-id="03bc2-378">There are additional variants designed to add multiple users to a single role and to assign multiple roles to a single user.</span></span>

<span data-ttu-id="03bc2-379">本教學課程也包含了解擴充 CreateUserWizard 控制項，以包含`WizardStep`來指定新建立之使用者的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-379">This tutorial also included a look at extending the CreateUserWizard control to include a `WizardStep` to specify the newly-created user's roles.</span></span> <span data-ttu-id="03bc2-380">這個步驟有助於簡化程序建立新使用者的使用者帳戶的系統管理員。</span><span class="sxs-lookup"><span data-stu-id="03bc2-380">Such a step could help an administrator streamline the process of creating user accounts for new users.</span></span>

<span data-ttu-id="03bc2-381">此時，我們看到如何建立及刪除角色，以及如何新增和移除角色的使用者。</span><span class="sxs-lookup"><span data-stu-id="03bc2-381">At this point we have seen how to create and delete roles and how to add and remove users from roles.</span></span> <span data-ttu-id="03bc2-382">但是，我們還沒有看看套用以角色為基礎的授權。</span><span class="sxs-lookup"><span data-stu-id="03bc2-382">But we have yet to look at applying role-based authorization.</span></span> <span data-ttu-id="03bc2-383">在  <a id="_msoanchor_6"> </a>[下一個教學課程](role-based-authorization-vb.md)我們稍後會定義角色的角色為基礎的 URL 授權規則以及如何將頁面層級功能限制根據目前登入使用者的角色。</span><span class="sxs-lookup"><span data-stu-id="03bc2-383">In the <a id="_msoanchor_6"></a>[following tutorial](role-based-authorization-vb.md) we will look at defining URL authorization rules on a role-by-role basis, as well as how to limit page-level functionality based on the currently logged in user's roles.</span></span>

<span data-ttu-id="03bc2-384">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="03bc2-384">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="03bc2-385">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="03bc2-385">Further Reading</span></span>

<span data-ttu-id="03bc2-386">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="03bc2-386">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="03bc2-387">ASP.NET 網站管理工具概觀</span><span class="sxs-lookup"><span data-stu-id="03bc2-387">ASP.NET Web Site Administration Tool Overview</span></span>](https://msdn.microsoft.com/library/ms228053.aspx)
- [<span data-ttu-id="03bc2-388">正在檢查 ASP。NET 的成員資格、 角色和設定檔</span><span class="sxs-lookup"><span data-stu-id="03bc2-388">Examining ASP.NET's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="03bc2-389">復原您自己的網站管理工具</span><span class="sxs-lookup"><span data-stu-id="03bc2-389">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)

### <a name="about-the-author"></a><span data-ttu-id="03bc2-390">關於作者</span><span class="sxs-lookup"><span data-stu-id="03bc2-390">About the Author</span></span>

<span data-ttu-id="03bc2-391">Scott Mitchell，多個 ASP 書籍的作者，他是 4GuysFromRolla.com 的創辦人，從事 Microsoft Web 技術工作自 1998 年。</span><span class="sxs-lookup"><span data-stu-id="03bc2-391">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="03bc2-392">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="03bc2-392">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="03bc2-393">他最新的著作是 *[Sams 教導您自己 ASP.NET 2.0 在 24 小時內](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*。</span><span class="sxs-lookup"><span data-stu-id="03bc2-393">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="03bc2-394">Scott 要聯絡[ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)或透過他的部落格[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="03bc2-394">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="03bc2-395">特別感謝...</span><span class="sxs-lookup"><span data-stu-id="03bc2-395">Special Thanks To…</span></span>

<span data-ttu-id="03bc2-396">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="03bc2-396">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="03bc2-397">本教學課程中的潛在客戶檢閱者已 Teresa murphy 徹底檢驗了。</span><span class="sxs-lookup"><span data-stu-id="03bc2-397">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="03bc2-398">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="03bc2-398">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="03bc2-399">如果是這樣，psychic 在 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="03bc2-399">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="03bc2-400">[上一頁](creating-and-managing-roles-vb.md)
> [下一頁](role-based-authorization-vb.md)</span><span class="sxs-lookup"><span data-stu-id="03bc2-400">[Previous](creating-and-managing-roles-vb.md)
[Next](role-based-authorization-vb.md)</span></span>
