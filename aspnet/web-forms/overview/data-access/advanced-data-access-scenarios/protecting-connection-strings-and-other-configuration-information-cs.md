---
uid: web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
title: 保護連接字串和其他組態資訊 (C#) |Microsoft Docs
author: rick-anderson
description: ASP.NET 應用程式通常會儲存在 Web.config 檔案中的組態資訊。 其中有些資訊是機密，保證保護。 由 def...
ms.author: riande
ms.date: 08/03/2007
ms.assetid: ad8dd396-30f7-4abe-ac02-a0b84422e5be
msc.legacyurl: /web-forms/overview/data-access/advanced-data-access-scenarios/protecting-connection-strings-and-other-configuration-information-cs
msc.type: authoredcontent
ms.openlocfilehash: 61ac52ffe28762ce0cf8892621343f71e73a9ca7
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/16/2018
ms.locfileid: "41826209"
---
<a name="protecting-connection-strings-and-other-configuration-information-c"></a><span data-ttu-id="8b6d2-105">保護連接字串和其他組態資訊 (C#)</span><span class="sxs-lookup"><span data-stu-id="8b6d2-105">Protecting Connection Strings and Other Configuration Information (C#)</span></span>
====================
<span data-ttu-id="8b6d2-106">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8b6d2-106">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8b6d2-107">[下載程式碼](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip)或[下載 PDF](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8b6d2-107">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_73_CS.zip) or [Download PDF](protecting-connection-strings-and-other-configuration-information-cs/_static/datatutorial73cs1.pdf)</span></span>

> <span data-ttu-id="8b6d2-108">ASP.NET 應用程式通常會儲存在 Web.config 檔案中的組態資訊。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-108">An ASP.NET application typically stores configuration information in a Web.config file.</span></span> <span data-ttu-id="8b6d2-109">其中有些資訊是機密，保證保護。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-109">Some of this information is sensitive and warrants protection.</span></span> <span data-ttu-id="8b6d2-110">依預設這個檔案將不會處理網站訪客，但系統管理員或駭客可能會存取 Web 伺服器的檔案系統，並檢視檔案的內容。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-110">By default this file will not be served to a Web site visitor, but an administrator or a hacker may gain access to the Web server's file system and view the contents of the file.</span></span> <span data-ttu-id="8b6d2-111">在本教學課程中我們了解 ASP.NET 2.0 可讓我們來保護機密資訊加密 Web.config 檔案的區段。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-111">In this tutorial we learn that ASP.NET 2.0 allows us to protect sensitive information by encrypting sections of the Web.config file.</span></span>


## <a name="introduction"></a><span data-ttu-id="8b6d2-112">簡介</span><span class="sxs-lookup"><span data-stu-id="8b6d2-112">Introduction</span></span>

<span data-ttu-id="8b6d2-113">ASP.NET 應用程式的組態資訊通常儲存在名為 XML 檔案`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-113">Configuration information for ASP.NET applications is commonly stored in an XML file named `Web.config`.</span></span> <span data-ttu-id="8b6d2-114">這些教學課程期間，我們已更新`Web.config`少數的次數。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-114">Over the course of these tutorials we have updated the `Web.config` a handful of times.</span></span> <span data-ttu-id="8b6d2-115">建立時`Northwind`型別中的資料集[第一個教學課程](../introduction/creating-a-data-access-layer-cs.md)，連接字串資訊，例如自動加入至`Web.config`在`<connectionStrings>`一節。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-115">When creating the `Northwind` Typed DataSet in the [first tutorial](../introduction/creating-a-data-access-layer-cs.md), for example, connection string information was automatically added to `Web.config` in the `<connectionStrings>` section.</span></span> <span data-ttu-id="8b6d2-116">稍後，在[主版頁面與網站導覽](../introduction/master-pages-and-site-navigation-cs.md)教學課程中，我們以手動方式更新`Web.config`，來加入`<pages>`項目會指出應該使用我們的專案中的 ASP.NET 網頁的所有`DataWebControls`佈景主題。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-116">Later, in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial, we manually updated `Web.config`, adding a `<pages>` element indicating that all of the ASP.NET pages in our project should use the `DataWebControls` Theme.</span></span>

<span data-ttu-id="8b6d2-117">由於`Web.config`可能包含機密資料，例如連接字串，很重要的內容`Web.config`保持安全且隱藏未經授權的檢視器。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-117">Since `Web.config` may contain sensitive data such as connection strings, it is important that the contents of `Web.config` be kept safe and hidden from unauthorized viewers.</span></span> <span data-ttu-id="8b6d2-118">根據預設，任何 HTTP 要求與檔案`.config`延伸模組由 ASP.NET 引擎，它會傳回*不提供這種類型的頁面*[圖 1] 所示的訊息。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-118">By default, any HTTP request to a file with the `.config` extension is handled by the ASP.NET engine, which returns the *This type of page is not served* message shown in Figure 1.</span></span> <span data-ttu-id="8b6d2-119">這表示訪客不能檢視您`Web.config`只要輸入檔案 s 內容 http://www.YourServer.com/Web.config 其 s 的瀏覽器網址列。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-119">This means that visitors cannot view your `Web.config` file s contents by simply entering http://www.YourServer.com/Web.config into their browser s Address bar.</span></span>


<span data-ttu-id="8b6d2-120">[![瀏覽 Web.config 透過瀏覽器傳回這類頁面是不會處理訊息](protecting-connection-strings-and-other-configuration-information-cs/_static/image2.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8b6d2-120">[![Visiting Web.config Through a Browser Returns a This type of page is not served Message](protecting-connection-strings-and-other-configuration-information-cs/_static/image2.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image1.png)</span></span>

<span data-ttu-id="8b6d2-121">**圖 1**： 瀏覽`Web.config`透過瀏覽器傳回這類頁面不會處理訊息 ([按一下以檢視完整大小的影像](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="8b6d2-121">**Figure 1**: Visiting `Web.config` Through a Browser Returns a This type of page is not served Message ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image3.png))</span></span>


<span data-ttu-id="8b6d2-122">但如果攻擊者能夠找到一些其他攻擊，讓她檢視您`Web.config`檔案 s 內容嗎？</span><span class="sxs-lookup"><span data-stu-id="8b6d2-122">But what if an attacker is able to find some other exploit that allows her to view your `Web.config` file s contents?</span></span> <span data-ttu-id="8b6d2-123">可能的攻擊者用來做什麼這項資訊，以及可以採取哪些步驟來進一步保護中的機密資訊`Web.config`嗎？</span><span class="sxs-lookup"><span data-stu-id="8b6d2-123">What could an attacker do with this information, and what steps can be taken to further protect the sensitive information within `Web.config`?</span></span> <span data-ttu-id="8b6d2-124">幸運的是，大部分的各節`Web.config`未包含機密資訊。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-124">Fortunately, most sections in `Web.config` do not contain sensitive information.</span></span> <span data-ttu-id="8b6d2-125">什麼傷害可以攻擊者 perpetrate 若他們知道使用 ASP.NET 網頁的佈景主題的預設名稱？</span><span class="sxs-lookup"><span data-stu-id="8b6d2-125">What harm can an attacker perpetrate if they know the name of the default Theme used by your ASP.NET pages?</span></span>

<span data-ttu-id="8b6d2-126">某些`Web.config`章節中，不過，包含機密資訊可能包含連接字串、 使用者名稱、 密碼、 伺服器名稱、 加密金鑰和其他等等。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-126">Certain `Web.config` sections, however, contain sensitive information that may include connection strings, user names, passwords, server names, encryption keys, and so forth.</span></span> <span data-ttu-id="8b6d2-127">這項資訊通常位於下列`Web.config`各節：</span><span class="sxs-lookup"><span data-stu-id="8b6d2-127">This information is typically found in the following `Web.config` sections:</span></span>

- `<appSettings>`
- `<connectionStrings>`
- `<identity>`
- `<sessionState>`

<span data-ttu-id="8b6d2-128">在本教學課程中我們將探討技術可保護這類的機密組態資訊。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-128">In this tutorial we will look at techniques for protecting such sensitive configuration information.</span></span> <span data-ttu-id="8b6d2-129">如我們所見，.NET Framework 2.0 版包含了能以程式設計方式加密及解密選取的組態區段，即可輕易地的受保護的組態系統。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-129">As we will see, the .NET Framework version 2.0 includes a protected configurations system that makes programmatically encrypting and decrypting selected configuration sections a breeze.</span></span>

> [!NOTE]
> <span data-ttu-id="8b6d2-130">本教學課程中隨附了解 Microsoft 建議從 ASP.NET 應用程式連接到資料庫。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-130">This tutorial concludes with a look at Microsoft s recommendations for connecting to a database from an ASP.NET application.</span></span> <span data-ttu-id="8b6d2-131">除了加密您的連接字串，您可以協助強化系統藉由確保您要連線到安全的方式中的資料庫。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-131">In addition to encrypting your connection strings, you can help harden your system by ensuring that you are connecting to the database in a secure fashion.</span></span>


## <a name="step-1-exploring-aspnet-20-s-protected-configuration-options"></a><span data-ttu-id="8b6d2-132">步驟 1： 探索 ASP.NET 2.0 s 受保護的組態選項</span><span class="sxs-lookup"><span data-stu-id="8b6d2-132">Step 1: Exploring ASP.NET 2.0 s Protected Configuration Options</span></span>

<span data-ttu-id="8b6d2-133">ASP.NET 2.0 包含加密和解密組態資訊的受保護的組態系統。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-133">ASP.NET 2.0 includes a protected configuration system for encrypting and decrypting configuration information.</span></span> <span data-ttu-id="8b6d2-134">這包括在.NET Framework 中可用來以程式設計方式加密或解密組態資訊的方法。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-134">This includes methods in the .NET Framework that can be used to programmatically encrypt or decrypt configuration information.</span></span> <span data-ttu-id="8b6d2-135">受保護的組態系統會使用[提供者模型](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)，可讓開發人員選擇使用何種密碼編譯的實作。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-135">The protected configuration system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), which allows developers to choose what cryptographic implementation is used.</span></span>

<span data-ttu-id="8b6d2-136">.NET Framework 隨附兩個受保護的組態提供者：</span><span class="sxs-lookup"><span data-stu-id="8b6d2-136">The .NET Framework ships with two protected configuration providers:</span></span>

- <span data-ttu-id="8b6d2-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) -使用非對稱[RSA 演算法](http://en.wikipedia.org/wiki/Rsa)加密和解密。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-137">[`RSAProtectedConfigurationProvider`](https://msdn.microsoft.com/library/system.configuration.rsaprotectedconfigurationprovider.aspx) - uses the asymmetric [RSA algorithm](http://en.wikipedia.org/wiki/Rsa) for encryption and decryption.</span></span>
- <span data-ttu-id="8b6d2-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) -使用 Windows[的資料保護 API (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx)加密和解密。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-138">[`DPAPIProtectedConfigurationProvider`](https://msdn.microsoft.com/system.configuration.dpapiprotectedconfigurationprovider.aspx) - uses the Windows [Data Protection API (DPAPI)](https://msdn.microsoft.com/library/ms995355.aspx) for encryption and decryption.</span></span>

<span data-ttu-id="8b6d2-139">由於受保護的組態系統會實作提供者設計模式，就可以建立自己的受保護的組態提供者，並插入您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-139">Since the protected configuration system implements the provider design pattern, it is possible to create your own protected configuration provider and plug it into your application.</span></span> <span data-ttu-id="8b6d2-140">請參閱[實作受保護組態提供者](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx)如需此程序的詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-140">See [Implementing a Protected Configuration Provider](https://msdn.microsoft.com/library/wfc2t3az(VS.80).aspx) for more information on this process.</span></span>

<span data-ttu-id="8b6d2-141">RSA 和 DPAPI 的提供者會將金鑰用於其加密和解密的常式，以及這些金鑰可以儲存在電腦或使用者層級。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-141">The RSA and DPAPI providers use keys for their encryption and decryption routines, and these keys can be stored at the machine- or user-level.</span></span> <span data-ttu-id="8b6d2-142">電腦層級索引鍵是適用於其自己專用的伺服器的 web 應用程式執行所在的案例，或者如果有多個應用程式需要共用的伺服器上加密的資訊。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-142">Machine-level keys are ideal for scenarios where the web application runs on its own dedicated server or if there are multiple applications on a server that need to share encrypted information.</span></span> <span data-ttu-id="8b6d2-143">使用者層級索引鍵是在相同的伺服器上的其他應用程式不應該儲存能夠解密您的應用程式的受保護的 s 組態區段的共用裝載環境中更安全的選項。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-143">User-level keys are a more secure option in shared hosting environments where other applications on the same server should not be able to decrypt your application s protected configuration sections.</span></span>

<span data-ttu-id="8b6d2-144">在本教學課程中的 DPAPI 提供者和電腦層級索引鍵，將使用我們的範例。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-144">In this tutorial our examples will use the DPAPI provider and machine-level keys.</span></span> <span data-ttu-id="8b6d2-145">具體來說，我們將探討加密`<connectionStrings>`一節`Web.config`，不過，受保護的組態系統可用來加密任何大部分`Web.config`一節。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-145">Specifically, we will look at encrypting the `<connectionStrings>` section in `Web.config`, although the protected configuration system can be used to encrypt most any `Web.config` section.</span></span> <span data-ttu-id="8b6d2-146">如需使用使用者層級索引鍵，或使用 RSA 提供者的資訊，請參閱在本教學課程結尾處的其他讀數一節中的資源。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-146">For information on using user-level keys or using the RSA provider, consult the resources in the Further Readings section at the end of this tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="8b6d2-147">`RSAProtectedConfigurationProvider`並`DPAPIProtectedConfigurationProvider`中註冊提供者`machine.config`提供者名稱的副檔名`RsaProtectedConfigurationProvider`和`DataProtectionConfigurationProvider`分別。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-147">The `RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider` providers are registered in the `machine.config` file with the provider names `RsaProtectedConfigurationProvider` and `DataProtectionConfigurationProvider`, respectively.</span></span> <span data-ttu-id="8b6d2-148">加密或解密我們必須提供適當的提供者名稱的組態資訊時 (`RsaProtectedConfigurationProvider`或是`DataProtectionConfigurationProvider`) 而非實際的型別名稱 (`RSAProtectedConfigurationProvider`和`DPAPIProtectedConfigurationProvider`)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-148">When encrypting or decrypting configuration information we will need to supply the appropriate provider name (`RsaProtectedConfigurationProvider` or `DataProtectionConfigurationProvider`) rather than the actual type name (`RSAProtectedConfigurationProvider` and `DPAPIProtectedConfigurationProvider`).</span></span> <span data-ttu-id="8b6d2-149">您可以找到`machine.config`檔案中`$WINDOWS$\Microsoft.NET\Framework\version\CONFIG`資料夾。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-149">You can find the `machine.config` file in the `$WINDOWS$\Microsoft.NET\Framework\version\CONFIG` folder.</span></span>


## <a name="step-2-programmatically-encrypting-and-decrypting-configuration-sections"></a><span data-ttu-id="8b6d2-150">步驟 2： 以程式設計方式加密和解密組態區段</span><span class="sxs-lookup"><span data-stu-id="8b6d2-150">Step 2: Programmatically Encrypting and Decrypting Configuration Sections</span></span>

<span data-ttu-id="8b6d2-151">只要幾行程式碼中，我們可以加密或解密使用指定的提供者的特定組態區段。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-151">With a few lines of code we can encrypt or decrypt a particular configuration section using a specified provider.</span></span> <span data-ttu-id="8b6d2-152">程式碼中，我們會在短時間內，看到只需要以程式設計方式參考適當的組態 區段中，呼叫其`ProtectSection`或是`UnprotectSection`方法，然後再呼叫`Save`方法，將所做的變更。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-152">The code, as we will see shortly, simply needs to programmatically reference the appropriate configuration section, call its `ProtectSection` or `UnprotectSection` method, and then call the `Save` method to persist the changes.</span></span> <span data-ttu-id="8b6d2-153">此外，.NET Framework 包含有用的命令列公用程式可加密和解密組態資訊。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-153">Moreover, the .NET Framework includes a helpful command line utility that can encrypt and decrypt configuration information.</span></span> <span data-ttu-id="8b6d2-154">我們將探討在步驟 3 中的這個命令列公用程式。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-154">We will explore this command line utility in Step 3.</span></span>

<span data-ttu-id="8b6d2-155">為了說明以程式設計方式保護的組態資訊，可讓 s 建立 ASP.NET 網頁，其中包含用於加密和解密的按鈕`<connectionStrings>`一節中`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-155">To illustrate programmatically protecting configuration information, let s create an ASP.NET page that includes buttons for encrypting and decrypting the `<connectionStrings>` section in `Web.config`.</span></span>

<span data-ttu-id="8b6d2-156">首先開啟`EncryptingConfigSections.aspx`頁面中`AdvancedDAL`資料夾。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-156">Start by opening the `EncryptingConfigSections.aspx` page in the `AdvancedDAL` folder.</span></span> <span data-ttu-id="8b6d2-157">將文字方塊控制項從工具箱拖曳至設計工具中，設定其`ID`屬性，以`WebConfigContents`、 其`TextMode`屬性設`MultiLine`，並將其`Width`和`Rows`屬性給 95%和 15，會分別。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-157">Drag a TextBox control from the Toolbox onto the Designer, setting its `ID` property to `WebConfigContents`, its `TextMode` property to `MultiLine`, and its `Width` and `Rows` properties to 95% and 15, respectively.</span></span> <span data-ttu-id="8b6d2-158">此文字方塊控制項會顯示的內容`Web.config`讓我們快速查看是否，是否加密內容。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-158">This TextBox control will display the contents of `Web.config` allowing us to quickly see if the contents are encrypted or not.</span></span> <span data-ttu-id="8b6d2-159">當然，在實際的應用程式會永遠不會想要顯示的內容`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-159">Of course, in a real application you would never want to display the contents of `Web.config`.</span></span>

<span data-ttu-id="8b6d2-160">下方的文字方塊中，新增名為兩個按鈕控制項`EncryptConnStrings`和`DecryptConnStrings`。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-160">Beneath the TextBox, add two Button controls named `EncryptConnStrings` and `DecryptConnStrings`.</span></span> <span data-ttu-id="8b6d2-161">若要加密連接字串及解密連接字串設定其 Text 屬性。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-161">Set their Text properties to Encrypt Connection Strings and Decrypt Connection Strings .</span></span>

<span data-ttu-id="8b6d2-162">此時您的畫面應該看起來類似 圖 2。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-162">At this point your screen should look similar to Figure 2.</span></span>


<span data-ttu-id="8b6d2-163">[![將文字方塊和兩個按鈕 Web 控制項加入頁面](protecting-connection-strings-and-other-configuration-information-cs/_static/image5.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="8b6d2-163">[![Add a TextBox and Two Button Web Controls to the Page](protecting-connection-strings-and-other-configuration-information-cs/_static/image5.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image4.png)</span></span>

<span data-ttu-id="8b6d2-164">**圖 2**： 新增至頁面的文字方塊和兩個按鈕 Web 控制項 ([按一下以檢視完整大小的影像](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="8b6d2-164">**Figure 2**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image6.png))</span></span>


<span data-ttu-id="8b6d2-165">接下來，我們必須撰寫程式碼來載入及顯示的內容`Web.config`在`WebConfigContents`文字方塊中，第一個頁面時載入。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-165">Next, we need to write code that loads and displays the contents of `Web.config` in the `WebConfigContents` TextBox when the page is first loaded.</span></span> <span data-ttu-id="8b6d2-166">頁面 s 程式碼後置類別中加入下列程式碼。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-166">Add the following code to the page s code-behind class.</span></span> <span data-ttu-id="8b6d2-167">此程式碼會新增一個名為方法`DisplayWebConfig`，並呼叫從`Page_Load`事件處理常式時`Page.IsPostBack`是`false`:</span><span class="sxs-lookup"><span data-stu-id="8b6d2-167">This code adds a method named `DisplayWebConfig` and calls it from the `Page_Load` event handler when `Page.IsPostBack` is `false`:</span></span>


[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample1.cs)]

<span data-ttu-id="8b6d2-168">`DisplayWebConfig`方法會使用[`File`類別](https://msdn.microsoft.com/library/system.io.file.aspx)以開啟應用程式 s`Web.config`檔案[`StreamReader`類別](https://msdn.microsoft.com/library/system.io.streamreader.aspx)其內容讀入字串，而[`Path`類別](https://msdn.microsoft.com/library/system.io.path.aspx)產生的實體路徑`Web.config`檔案。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-168">The `DisplayWebConfig` method uses the [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) to open the application s `Web.config` file, the [`StreamReader` class](https://msdn.microsoft.com/library/system.io.streamreader.aspx) to read its contents into a string, and the [`Path` class](https://msdn.microsoft.com/library/system.io.path.aspx) to generate the physical path to the `Web.config` file.</span></span> <span data-ttu-id="8b6d2-169">這三個類別會在找到的所有[`System.IO`命名空間](https://msdn.microsoft.com/library/system.io.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-169">These three classes are all found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="8b6d2-170">因此，您必須新增`using``System.IO`陳述式的程式碼後置類別，或者這些類別具有名稱的前置詞`System.IO.`。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-170">Consequently, you will need to add a `using` `System.IO` statement to the top of the code-behind class or, alternatively, prefix these class names with `System.IO.` .</span></span>

<span data-ttu-id="8b6d2-171">接下來，我們需要加入兩個按鈕控制項的事件處理常式`Click`事件，並新增必要的程式碼，來加密和解密`<connectionStrings>`區段使用 DPAPI 的提供者的電腦層級金鑰。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-171">Next, we need to add event handlers for the two Button controls `Click` events and add the necessary code to encrypt and decrypt the `<connectionStrings>` section using a machine-level key with the DPAPI provider.</span></span> <span data-ttu-id="8b6d2-172">從設計工具中，按兩下每個按鈕來新增`Click`中程式碼後置的事件處理常式類別，然後再將下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="8b6d2-172">From the Designer, double-click each of the Buttons to add a `Click` event handler in the code-behind class and then add the following code:</span></span>


[!code-csharp[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample2.cs)]

<span data-ttu-id="8b6d2-173">使用中的兩個事件處理常式的程式碼是幾乎完全相同。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-173">The code used in the two event handlers is nearly identical.</span></span> <span data-ttu-id="8b6d2-174">它們都會啟動藉由取得目前的應用程式 s 的相關資訊`Web.config`透過檔案[`WebConfigurationManager`類別](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx)s [ `OpenWebConfiguration`方法](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-174">They both start by getting information about the current application s `Web.config` file via the [`WebConfigurationManager` class](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.aspx) s [`OpenWebConfiguration` method](https://msdn.microsoft.com/library/system.web.configuration.webconfigurationmanager.openwebconfiguration.aspx).</span></span> <span data-ttu-id="8b6d2-175">這個方法會傳回指定的虛擬路徑的 web 組態檔。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-175">This method returns the web configuration file for the specified virtual path.</span></span> <span data-ttu-id="8b6d2-176">下一步`Web.config`檔案 s`<connectionStrings>`一節透過存取[`Configuration`類別](https://msdn.microsoft.com/library/system.configuration.configuration.aspx)s [ `GetSection(sectionName)`方法](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx)，以傳回[ `ConfigurationSection` ](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx)物件。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-176">Next, the `Web.config` file s `<connectionStrings>` section is accessed via the [`Configuration` class](https://msdn.microsoft.com/library/system.configuration.configuration.aspx) s [`GetSection(sectionName)` method](https://msdn.microsoft.com/library/system.configuration.configuration.getsection.aspx), which returns a [`ConfigurationSection`](https://msdn.microsoft.com/library/system.configuration.configurationsection.aspx) object.</span></span>

<span data-ttu-id="8b6d2-177">`ConfigurationSection`物件包含[`SectionInformation`屬性](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx)，提供其他資訊和相關的組態區段的功能。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-177">The `ConfigurationSection` object includes a [`SectionInformation` property](https://msdn.microsoft.com/library/system.configuration.configurationsection.sectioninformation.aspx) that provides additional information and functionality regarding the configuration section.</span></span> <span data-ttu-id="8b6d2-178">上面顯示的程式碼，我們可以判斷是否藉由檢查加密的組態區段`SectionInformation`屬性的`IsProtected`屬性。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-178">As the code above shows, we can determine whether the configuration section is encrypted by checking the `SectionInformation` property s `IsProtected` property.</span></span> <span data-ttu-id="8b6d2-179">此外，區段可以要加密或解密透過`SectionInformation`屬性 s`ProtectSection(provider)`和`UnprotectSection`方法。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-179">Moreover, the section can be encrypted or decrypted via the `SectionInformation` property s `ProtectSection(provider)` and `UnprotectSection` methods.</span></span>

<span data-ttu-id="8b6d2-180">`ProtectSection(provider)`方法接受做為輸入字串，指定要加密時所使用的受保護的組態提供者的名稱。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-180">The `ProtectSection(provider)` method accepts as input a string specifying the name of the protected configuration provider to use when encrypting.</span></span> <span data-ttu-id="8b6d2-181">在  `EncryptConnString` s 按鈕事件處理常式，我們將傳遞到 DataProtectionConfigurationProvider`ProtectSection(provider)`方法，以便使用 DPAPI 的提供者。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-181">In the `EncryptConnString` Button s event handler we pass DataProtectionConfigurationProvider into the `ProtectSection(provider)` method so that the DPAPI provider is used.</span></span> <span data-ttu-id="8b6d2-182">`UnprotectSection`方法可以判斷用來加密組態區段，因此不需要任何輸入參數的提供者。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-182">The `UnprotectSection` method can determine the provider that was used to encrypt the configuration section and therefore does not require any input parameters.</span></span>

<span data-ttu-id="8b6d2-183">之後呼叫`ProtectSection(provider)`或是`UnprotectSection`方法，您必須呼叫`Configuration`物件 s [ `Save`方法](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx)來保存變更。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-183">After calling the `ProtectSection(provider)` or `UnprotectSection` method, you must call the `Configuration` object s [`Save` method](https://msdn.microsoft.com/library/system.configuration.configuration.save.aspx) to persist the changes.</span></span> <span data-ttu-id="8b6d2-184">一旦已加密或解密的組態資訊並儲存變更，我們呼叫`DisplayWebConfig`載入更新`Web.config`到 TextBox 控制項的內容。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-184">Once the configuration information has been encrypted or decrypted and the changes saved, we call `DisplayWebConfig` to load the updated `Web.config` contents into the TextBox control.</span></span>

<span data-ttu-id="8b6d2-185">一旦您輸入上述的程式碼，測試它，請造訪`EncryptingConfigSections.aspx`透過瀏覽器的頁面。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-185">Once you have entered the above code, test it by visiting the `EncryptingConfigSections.aspx` page through a browser.</span></span> <span data-ttu-id="8b6d2-186">您應該一開始會看到列出的內容頁面`Web.config`與`<connectionStrings>`以純文字顯示的區段 （請參閱 [圖 3]）。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-186">You should initially see a page that lists the contents of `Web.config` with the `<connectionStrings>` section displayed in plain-text (see Figure 3).</span></span>


<span data-ttu-id="8b6d2-187">[![將文字方塊和兩個按鈕 Web 控制項加入頁面](protecting-connection-strings-and-other-configuration-information-cs/_static/image8.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="8b6d2-187">[![Add a TextBox and Two Button Web Controls to the Page](protecting-connection-strings-and-other-configuration-information-cs/_static/image8.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image7.png)</span></span>

<span data-ttu-id="8b6d2-188">**圖 3**： 新增至頁面的文字方塊和兩個按鈕 Web 控制項 ([按一下以檢視完整大小的影像](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="8b6d2-188">**Figure 3**: Add a TextBox and Two Button Web Controls to the Page ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image9.png))</span></span>


<span data-ttu-id="8b6d2-189">現在按一下 [加密連接字串] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-189">Now click the Encrypt Connection Strings button.</span></span> <span data-ttu-id="8b6d2-190">標記已啟用要求驗證，如果從回傳`WebConfigContents`文字方塊中會產生`HttpRequestValidationException`，其中顯示訊息，有潛在危險`Request.Form`從用戶端偵測到值。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-190">If request validation is enabled, the markup posted back from the `WebConfigContents` TextBox will produce an `HttpRequestValidationException`, which displays the message, A potentially dangerous `Request.Form` value was detected from the client.</span></span> <span data-ttu-id="8b6d2-191">要求驗證，ASP.NET 2.0 中的預設會啟用，禁止包含未編碼 HTML 的回傳，並可協助防止指令碼資料隱碼攻擊。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-191">Request validation, which is enabled by default in ASP.NET 2.0, prohibits postbacks that include un-encoded HTML and is designed to help prevent script-injection attacks.</span></span> <span data-ttu-id="8b6d2-192">這項檢查可以停用在頁面或應用程式層級。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-192">This check can be disabled at the page- or application-level.</span></span> <span data-ttu-id="8b6d2-193">若要將它關閉此頁面，設定`ValidateRequest`設為`false`在`@Page`指示詞。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-193">To turn it off for this page, set the `ValidateRequest` setting to `false` in the `@Page` directive.</span></span> <span data-ttu-id="8b6d2-194">`@Page`指示詞位於頂端的 [s] 頁面的宣告式標記。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-194">The `@Page` directive is found at the top of the page s declarative markup.</span></span>


[!code-aspx[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample3.aspx)]

<span data-ttu-id="8b6d2-195">如需有關要求驗證，它的目的，在網頁和應用程式層級，以及如何為 HTML 編碼標記為停用，請參閱[要求驗證-防止指令碼攻擊](../../../../whitepapers/request-validation.md)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-195">For more information on request validation, its purpose, how to disable it at the page- and application-level, as well as how to HTML encode markup, see [Request Validation - Preventing Script Attacks](../../../../whitepapers/request-validation.md).</span></span>

<span data-ttu-id="8b6d2-196">停用頁面的要求驗證之後, 再試一次按一下 [加密連接字串] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-196">After disabling request validation for the page, try clicking the Encrypt Connection Strings button again.</span></span> <span data-ttu-id="8b6d2-197">在回傳時，將存取設定檔並將其`<connectionStrings>`加密使用 DPAPI 的提供者的一節。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-197">On postback, the configuration file will be accessed and its `<connectionStrings>` section encrypted using the DPAPI provider.</span></span> <span data-ttu-id="8b6d2-198">文字方塊則會更新以顯示新`Web.config`內容。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-198">The TextBox is then updated to display the new `Web.config` content.</span></span> <span data-ttu-id="8b6d2-199">如 [圖 4] 所示，`<connectionStrings>`現在都已加密資訊。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-199">As Figure 4 shows, the `<connectionStrings>` information is now encrypted.</span></span>


<span data-ttu-id="8b6d2-200">[![按一下 加密連接字串按鈕會加密&lt;connectionString&gt;區段](protecting-connection-strings-and-other-configuration-information-cs/_static/image11.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="8b6d2-200">[![Clicking the Encrypt Connection Strings Button Encrypts the &lt;connectionString&gt; Section](protecting-connection-strings-and-other-configuration-information-cs/_static/image11.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image10.png)</span></span>

<span data-ttu-id="8b6d2-201">**圖 4**： 按一下 加密連接字串按鈕加密`<connectionString>`一節 ([按一下以檢視完整大小的影像](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="8b6d2-201">**Figure 4**: Clicking the Encrypt Connection Strings Button Encrypts the `<connectionString>` Section ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image12.png))</span></span>


<span data-ttu-id="8b6d2-202">加密`<connectionStrings>`我的電腦上產生的區段之後，雖然部分中的內容`<CipherData>`為了簡潔起見已移除項目：</span><span class="sxs-lookup"><span data-stu-id="8b6d2-202">The encrypted `<connectionStrings>` section generated on my computer follows, although some of the content in the `<CipherData>` element has been removed for brevity:</span></span>


[!code-xml[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample4.xml)]

> [!NOTE]
> <span data-ttu-id="8b6d2-203">`<connectionStrings>`項目會指定用來執行加密提供者 (`DataProtectionConfigurationProvider`)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-203">The `<connectionStrings>` element specifies the provider used to perform the encryption (`DataProtectionConfigurationProvider`).</span></span> <span data-ttu-id="8b6d2-204">這項資訊由`UnprotectSection`方法時按一下 [解密連接字串] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-204">This information is used by the `UnprotectSection` method when the Decrypt Connection Strings button is clicked.</span></span>


<span data-ttu-id="8b6d2-205">當連接字串資訊從存取`Web.config`-可能是由我們所撰寫程式碼，從 SqlDataSource 控制項或在我們的輸入資料集 Tableadapter 的自動產生程式碼-就會自動解密。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-205">When the connection string information is accessed from `Web.config` - either by code we write, from a SqlDataSource control, or the auto-generated code from the TableAdapters in our Typed DataSets - it is automatically decrypted.</span></span> <span data-ttu-id="8b6d2-206">簡單地說，我們不需要新增任何額外的程式碼或邏輯來解密加密`<connectionString>`一節。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-206">In short, we do not need to add any extra code or logic to decrypt the encrypted `<connectionString>` section.</span></span> <span data-ttu-id="8b6d2-207">若要進行示範，請瀏覽先前的教學課程的其中一個在這個階段，例如簡單顯示教學課程中，從基本報告 區段 (`~/BasicReporting/SimpleDisplay.aspx`)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-207">To demonstrate this, visit one of the earlier tutorials at this time, such as the Simple Display tutorial from the Basic Reporting section (`~/BasicReporting/SimpleDisplay.aspx`).</span></span> <span data-ttu-id="8b6d2-208">如 [圖 5] 所示，本教學課程的運作方式完全如我們所預期，表示加密的連接字串資訊時所自動解密由 ASP.NET 網頁。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-208">As Figure 5 shows, the tutorial works exactly as we would expect it, indicating that the encrypted connection string information is being automatically decrypted by the ASP.NET page.</span></span>


<span data-ttu-id="8b6d2-209">[![資料存取層會自動解密連接字串資訊](protecting-connection-strings-and-other-configuration-information-cs/_static/image14.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="8b6d2-209">[![The Data Access Layer Automatically Decrypts the Connection String Information](protecting-connection-strings-and-other-configuration-information-cs/_static/image14.png)](protecting-connection-strings-and-other-configuration-information-cs/_static/image13.png)</span></span>

<span data-ttu-id="8b6d2-210">**圖 5**： 資料存取層會自動解密連接字串資訊 ([按一下以檢視完整大小的影像](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="8b6d2-210">**Figure 5**: The Data Access Layer Automatically Decrypts the Connection String Information ([Click to view full-size image](protecting-connection-strings-and-other-configuration-information-cs/_static/image15.png))</span></span>


<span data-ttu-id="8b6d2-211">若要還原`<connectionStrings>`回到其純文字來表示區段中，按一下 [解密連接字串] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-211">To revert the `<connectionStrings>` section back to its plain-text representation, click the Decrypt Connection Strings button.</span></span> <span data-ttu-id="8b6d2-212">在回傳中，您應該看到中的連接字串`Web.config`以純文字。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-212">On postback you should see the connection strings in `Web.config` in plain-text.</span></span> <span data-ttu-id="8b6d2-213">此時您的畫面看起來應該像第一次瀏覽此頁面 （請參閱 圖 3） 時。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-213">At this point your screen should look like it did when first visiting this page (see in Figure 3).</span></span>

## <a name="step-3-encrypting-configuration-sections-usingaspnetregiisexe"></a><span data-ttu-id="8b6d2-214">步驟 3： 加密使用的組態區段`aspnet_regiis.exe`</span><span class="sxs-lookup"><span data-stu-id="8b6d2-214">Step 3: Encrypting Configuration Sections Using`aspnet_regiis.exe`</span></span>

<span data-ttu-id="8b6d2-215">.NET Framework 包含各種不同的命令列工具，在`$WINDOWS$\Microsoft.NET\Framework\version\`資料夾。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-215">The .NET Framework includes a variety of command line tools in the `$WINDOWS$\Microsoft.NET\Framework\version\` folder.</span></span> <span data-ttu-id="8b6d2-216">在 [使用 SQL 快取相依性](../caching-data/using-sql-cache-dependencies-cs.md)教學課程中，比方說，我們探討使用`aspnet_regsql.exe`命令列工具來新增必要的 SQL 快取相依性的基礎結構。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-216">In the [Using SQL Cache Dependencies](../caching-data/using-sql-cache-dependencies-cs.md) tutorial, for instance, we looked at using the `aspnet_regsql.exe` command line tool to add the infrastructure necessary for SQL cache dependencies.</span></span> <span data-ttu-id="8b6d2-217">在此資料夾中的另一個有用的命令列工具是[ASP.NET IIS 註冊工具 (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-217">Another useful command line tool in this folder is the [ASP.NET IIS Registration tool (`aspnet_regiis.exe`)](https://msdn.microsoft.com/library/k6h9cz8h(VS.80).aspx).</span></span> <span data-ttu-id="8b6d2-218">正如其名，則 ASP.NET IIS 註冊工具是主要用來與 Microsoft 的專業級 Web 伺服器，IIS 註冊 ASP.NET 2.0 應用程式中。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-218">As its name implies, the ASP.NET IIS Registration tool is primarily used to register an ASP.NET 2.0 application with Microsoft s professional-grade Web server, IIS.</span></span> <span data-ttu-id="8b6d2-219">它與 IIS 相關的功能，除了 ASP.NET IIS 註冊工具也可用來加密或解密指定的組態區段中`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-219">In addition to its IIS-related features, the ASP.NET IIS Registration tool can also be used to encrypt or decrypt specified configuration sections in `Web.config`.</span></span>

<span data-ttu-id="8b6d2-220">下列陳述式會顯示用來加密組態區段的一般語法`aspnet_regiis.exe`命令列工具：</span><span class="sxs-lookup"><span data-stu-id="8b6d2-220">The following statement shows the general syntax used to encrypt a configuration section with the `aspnet_regiis.exe` command line tool:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample5.cmd)]

<span data-ttu-id="8b6d2-221">*一節*是要加密 （例如 connectionStrings) 的組態區段*實體\_目錄*是 web 應用程式的根目錄的完整的實體路徑和*提供者*用 （例如 DataProtectionConfigurationProvider) 的受保護的組態提供者的名稱。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-221">*section* is the configuration section to encrypt (like connectionStrings ), the *physical\_directory* is the full, physical path to the web application s root directory, and *provider* is the name of the protected configuration provider to use (such as DataProtectionConfigurationProvider ).</span></span> <span data-ttu-id="8b6d2-222">或者，如果在 IIS 中註冊 web 應用程式，您可以輸入而不是使用下列語法的實體路徑的虛擬路徑：</span><span class="sxs-lookup"><span data-stu-id="8b6d2-222">Alternatively, if the web application is registered in IIS you can enter the virtual path instead of the physical path using the following syntax:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample6.cmd)]

<span data-ttu-id="8b6d2-223">下列`aspnet_regiis.exe`範例會加密`<connectionStrings>`區段具有電腦層級索引鍵使用 DPAPI 的提供者：</span><span class="sxs-lookup"><span data-stu-id="8b6d2-223">The following `aspnet_regiis.exe` example encrypts the `<connectionStrings>` section using the DPAPI provider with a machine-level key:</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample7.cmd)]

<span data-ttu-id="8b6d2-224">同樣地，`aspnet_regiis.exe`命令列工具可用來解密組態區段。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-224">Similarly, the `aspnet_regiis.exe` command line tool can be used to decrypt configuration sections.</span></span> <span data-ttu-id="8b6d2-225">而不是使用`-pef`切換，請使用`-pdf`(或 instead of `-pe`，使用`-pd`)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-225">Instead of using the `-pef` switch, use `-pdf` (or instead of `-pe`, use `-pd`).</span></span> <span data-ttu-id="8b6d2-226">此外，請注意解密時不需要提供者名稱。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-226">Also, note that the provider name is not necessary when decrypting.</span></span>


[!code-console[Main](protecting-connection-strings-and-other-configuration-information-cs/samples/sample8.cmd)]

> [!NOTE]
> <span data-ttu-id="8b6d2-227">因為我們使用 DPAPI 的提供者，它會使用金鑰的電腦，您必須執行`aspnet_regiis.exe`來自相同的機器會在提供網頁。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-227">Since we are using the DPAPI provider, which uses keys specific to the computer, you must run `aspnet_regiis.exe` from the same machine from which the web pages are being served.</span></span> <span data-ttu-id="8b6d2-228">比方說，如果您從本機開發電腦上執行此命令列程式，然後將加密的 Web.config 檔案上傳到生產環境伺服器時，實際執行伺服器將無法再解密連接字串資訊，因為它已加密使用您的開發電腦的特定索引鍵。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-228">For example, if you run this command line program from your local development machine and then upload the encrypted Web.config file to the production server, the production server will not be able to decrypt the connection string information since it was encrypted using keys specific to your development machine.</span></span> <span data-ttu-id="8b6d2-229">RSA 提供者並沒有這項限制，即能將 RSA 金鑰匯出到另一部電腦。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-229">The RSA provider does not have this limitation as it is possible to export the RSA keys to another machine.</span></span>


## <a name="understanding-database-authentication-options"></a><span data-ttu-id="8b6d2-230">了解資料庫驗證選項</span><span class="sxs-lookup"><span data-stu-id="8b6d2-230">Understanding Database Authentication Options</span></span>

<span data-ttu-id="8b6d2-231">任何應用程式可以發出之前`SELECT`， `INSERT`， `UPDATE`，或`DELETE`查詢到 Microsoft SQL Server 資料庫，資料庫必須先識別要求者。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-231">Before any application can issue `SELECT`, `INSERT`, `UPDATE`, or `DELETE` queries to a Microsoft SQL Server database, the database first must identify the requestor.</span></span> <span data-ttu-id="8b6d2-232">此程序稱為*驗證*和 SQL Server 提供兩種驗證方法：</span><span class="sxs-lookup"><span data-stu-id="8b6d2-232">This process is known as *authentication* and SQL Server provides two methods of authentication:</span></span>

- <span data-ttu-id="8b6d2-233">**Windows 驗證**-應用程式執行所在的程序用來與資料庫通訊。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-233">**Windows Authentication** - the process under which the application is running is used to communicate with the database.</span></span> <span data-ttu-id="8b6d2-234">當執行 ASP.NET 應用程式透過 Visual Studio 2005 的 ASP.NET 程式開發伺服器時，ASP.NET 應用程式會假設目前登入使用者的身分識別。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-234">When running an ASP.NET application through Visual Studio 2005 s ASP.NET Development Server, the ASP.NET application assumes the identity of the currently logged on user.</span></span> <span data-ttu-id="8b6d2-235">ASP.NET 應用程式上 Microsoft Internet Information Server (IIS)，ASP.NET 應用程式通常是假設的身分識別`domainName``\MachineName`或`domainName``\NETWORK SERVICE`，不過您可以自訂這個。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-235">For ASP.NET applications on Microsoft Internet Information Server (IIS), ASP.NET applications usually assume the identity of `domainName``\MachineName` or `domainName``\NETWORK SERVICE`, although this can be customized.</span></span>
- <span data-ttu-id="8b6d2-236">**SQL 驗證**-使用者 ID 和密碼值會提供做為認證進行驗證。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-236">**SQL Authentication** - a user ID and password values are supplied as credentials for authentication.</span></span> <span data-ttu-id="8b6d2-237">使用 SQL 驗證的使用者識別碼和密碼提供連接字串中。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-237">With SQL authentication, the user ID and password are provided in the connection string.</span></span>

<span data-ttu-id="8b6d2-238">Windows 驗證是慣用透過 SQL 驗證更安全。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-238">Windows authentication is preferred over SQL authentication because it is more secure.</span></span> <span data-ttu-id="8b6d2-239">使用 Windows 驗證連接字串是免費的使用者名稱和密碼，並在 web 伺服器和資料庫伺服器位於兩個不同的電腦上，如果認證不會傳送透過網路以純文字。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-239">With Windows authentication the connection string is free from a username and password and if the web server and database server reside on two different machines, the credentials are not sent over the network in plain-text.</span></span> <span data-ttu-id="8b6d2-240">使用 SQL 驗證，不過，驗證認證是硬式編碼的連接字串中，從 web 伺服器傳輸至資料庫伺服器，以純文字。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-240">With SQL authentication, however, the authentication credentials are hard-coded in the connection string and are transmitted from the web server to the database server in plain-text.</span></span>

<span data-ttu-id="8b6d2-241">這些教學課程都使用 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-241">These tutorials have used Windows authentication.</span></span> <span data-ttu-id="8b6d2-242">您可以分辨哪一種驗證模式所檢查的連接字串。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-242">You can tell what authentication mode is being used by inspecting the connection string.</span></span> <span data-ttu-id="8b6d2-243">中的連接字串`Web.config`針對我們的教學課程已：</span><span class="sxs-lookup"><span data-stu-id="8b6d2-243">The connection string in `Web.config` for our tutorials has been:</span></span>

`Data Source=.\SQLEXPRESS; AttachDbFilename=|DataDirectory|\NORTHWND.MDF; Integrated Security=True; User Instance=True`

<span data-ttu-id="8b6d2-244">Integrated Security = True 且缺乏使用者名稱和密碼會指出，正在使用 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-244">The Integrated Security=True and lack of a username and password indicate that Windows authentication is being used.</span></span> <span data-ttu-id="8b6d2-245">在某些連接字串 受信任連線一詞 = Yes 或整合式的安全性 = 而非整合式安全性使用 SSPI = True，但這三個指示使用 Windows 驗證。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-245">In some connection strings the term Trusted Connection=Yes or Integrated Security=SSPI is used instead of Integrated Security=True, but all three indicate the use of Windows authentication.</span></span>

<span data-ttu-id="8b6d2-246">下列範例會示範使用 SQL 驗證的連接字串。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-246">The following example shows a connection string that uses SQL authentication.</span></span> <span data-ttu-id="8b6d2-247">請注意連接字串中內嵌的認證：</span><span class="sxs-lookup"><span data-stu-id="8b6d2-247">Note the credentials embedded within the connection string:</span></span>

`Server=serverName; Database=Northwind; uid=userID; pwd=password`

<span data-ttu-id="8b6d2-248">假設有攻擊者可檢視您的應用程式 s`Web.config`檔案。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-248">Imagine that an attacker is able to view your application s `Web.config` file.</span></span> <span data-ttu-id="8b6d2-249">如果您使用 SQL 驗證來連接到可透過網際網路存取的資料庫時，攻擊者可以使用此連接字串來連接到您的資料庫，透過 SQL Management Studio 或從自己的網站上的 ASP.NET 網頁。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-249">If you use SQL authentication to connect to a database that is accessible over the Internet, the attacker can use this connection string to connect to your database through SQL Management Studio or from ASP.NET pages on their own website.</span></span> <span data-ttu-id="8b6d2-250">若要降低此威脅，來加密中的連接字串資訊`Web.config`使用受保護的組態系統。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-250">To help mitigate this threat, encrypt the connection string information in `Web.config` using the protected configuration system.</span></span>

> [!NOTE]
> <span data-ttu-id="8b6d2-251">如需有關不同 SQL Server 中可用的驗證類型的詳細資訊，請參閱[建置安全的 ASP.NET 應用程式： 驗證、 授權和安全通訊](https://msdn.microsoft.com/library/aa302392.aspx)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-251">For more information on the different types of authentication available in SQL Server, see [Building Secure ASP.NET Applications: Authentication, Authorization, and Secure Communication](https://msdn.microsoft.com/library/aa302392.aspx).</span></span> <span data-ttu-id="8b6d2-252">如進一步連接字串範例，說明 Windows 和 SQL 驗證 」 語法之間的差異，請參閱[ConnectionStrings.com](http://www.connectionstrings.com/)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-252">For further connection string examples illustrating the differences between Windows and SQL authentication syntax, refer to [ConnectionStrings.com](http://www.connectionstrings.com/).</span></span>


## <a name="summary"></a><span data-ttu-id="8b6d2-253">總結</span><span class="sxs-lookup"><span data-stu-id="8b6d2-253">Summary</span></span>

<span data-ttu-id="8b6d2-254">根據預設，檔案與`.config`無法透過瀏覽器存取 ASP.NET 應用程式中的延伸模組。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-254">By default, files with a `.config` extension in an ASP.NET application cannot be accessed through a browser.</span></span> <span data-ttu-id="8b6d2-255">因為它們可能包含機密資訊，例如資料庫連接字串、 使用者名稱和密碼，然後依此類推，不會傳回這些類型的檔案。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-255">These types of files are not returned because they may contain sensitive information, such as database connection strings, usernames and passwords, and so on.</span></span> <span data-ttu-id="8b6d2-256">.NET 2.0 中的受保護的組態系統可協助您進一步藉由使用指定的組態區段，以加密保護機密資訊。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-256">The protected configuration system in .NET 2.0 helps further protect sensitive information by allowing specified configuration sections to be encrypted.</span></span> <span data-ttu-id="8b6d2-257">有兩個內建的受保護的組態提供者： 使用 RSA 演算法，另一個使用 Windows 資料保護 API (DPAPI) 的其中一個。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-257">There are two built-in protected configuration providers: one that uses the RSA algorithm and one that uses the Windows Data Protection API (DPAPI).</span></span>

<span data-ttu-id="8b6d2-258">在本教學課程中，我們討論過如何加密和解密使用 DPAPI 的提供者的組態設定。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-258">In this tutorial we looked at how to encrypt and decrypt configuration settings using the DPAPI provider.</span></span> <span data-ttu-id="8b6d2-259">這可以完成以程式設計的方式，如我們在步驟 2 中所見，以及透過`aspnet_regiis.exe`涵蓋在步驟 3 中的命令列工具。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-259">This can be accomplished both programmatically, as we saw in Step 2, as well as through the `aspnet_regiis.exe` command line tool, which was covered in Step 3.</span></span> <span data-ttu-id="8b6d2-260">如需有關使用使用者層級索引鍵，或改為使用 RSA 提供者的詳細資訊，請參閱 < 進一步閱讀 > 一節中的資源。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-260">For more information on using user-level keys or using the RSA provider instead, see the resources in the Further Reading section.</span></span>

<span data-ttu-id="8b6d2-261">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="8b6d2-261">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="8b6d2-262">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="8b6d2-262">Further Reading</span></span>

<span data-ttu-id="8b6d2-263">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="8b6d2-263">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="8b6d2-264">建置安全的 ASP.NET 應用程式： 驗證、 授權和安全通訊</span><span class="sxs-lookup"><span data-stu-id="8b6d2-264">Building Secure ASP.NET Application: Authentication, Authorization, and Secure Communication</span></span>](https://msdn.microsoft.com/library/aa302392.aspx)
- [<span data-ttu-id="8b6d2-265">ASP.NET 2.0 中的組態資訊加密應用程式</span><span class="sxs-lookup"><span data-stu-id="8b6d2-265">Encrypting Configuration Information in ASP.NET 2.0 Applications</span></span>](http://aspnet.4guysfromrolla.com/articles/021506-1.aspx)
- [<span data-ttu-id="8b6d2-266">加密`Web.config`ASP.NET 2.0 中的值</span><span class="sxs-lookup"><span data-stu-id="8b6d2-266">Encrypting `Web.config` Values in ASP.NET 2.0</span></span>](https://weblogs.asp.net/scottgu/archive/2006/01/09/434893.aspx)
- [<span data-ttu-id="8b6d2-267">如何： Encrypt Configuration Sections in ASP.NET 2.0 使用 DPAPI</span><span class="sxs-lookup"><span data-stu-id="8b6d2-267">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using DPAPI</span></span>](https://msdn.microsoft.com/library/ms998280.aspx)
- [<span data-ttu-id="8b6d2-268">如何： Encrypt Configuration Sections in ASP.NET 2.0 使用 RSA</span><span class="sxs-lookup"><span data-stu-id="8b6d2-268">How To: Encrypt Configuration Sections in ASP.NET 2.0 Using RSA</span></span>](https://msdn.microsoft.com/library/ms998283.aspx)
- [<span data-ttu-id="8b6d2-269">.NET 2.0 中的組態 API</span><span class="sxs-lookup"><span data-stu-id="8b6d2-269">The Configuration API in .NET 2.0</span></span>](http://www.odetocode.com/Articles/418.aspx)
- [<span data-ttu-id="8b6d2-270">Windows 資料保護</span><span class="sxs-lookup"><span data-stu-id="8b6d2-270">Windows Data Protection</span></span>](https://msdn.microsoft.com/library/ms995355.aspx)

## <a name="about-the-author"></a><span data-ttu-id="8b6d2-271">關於作者</span><span class="sxs-lookup"><span data-stu-id="8b6d2-271">About the Author</span></span>

<span data-ttu-id="8b6d2-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-272">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8b6d2-273">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-273">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8b6d2-274">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-274">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8b6d2-275">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8b6d2-275">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="8b6d2-276">或透過他的部落格，這位於 [http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-276">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="8b6d2-277">特別感謝</span><span class="sxs-lookup"><span data-stu-id="8b6d2-277">Special Thanks To</span></span>

<span data-ttu-id="8b6d2-278">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-278">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="8b6d2-279">本教學課程中的潛在客戶檢閱者已 Teresa Murphy 和 Randy Schmidt。</span><span class="sxs-lookup"><span data-stu-id="8b6d2-279">Lead reviewers for this tutorial were Teresa Murphy and Randy Schmidt.</span></span> <span data-ttu-id="8b6d2-280">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="8b6d2-280">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="8b6d2-281">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8b6d2-281">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8b6d2-282">[上一頁](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
> [下一頁](debugging-stored-procedures-cs.md)</span><span class="sxs-lookup"><span data-stu-id="8b6d2-282">[Previous](configuring-the-data-access-layer-s-connection-and-command-level-settings-cs.md)
[Next](debugging-stored-procedures-cs.md)</span></span>
