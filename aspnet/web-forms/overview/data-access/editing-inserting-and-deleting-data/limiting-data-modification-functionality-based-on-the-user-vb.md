---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-vb
title: 限制資料修改功能會根據使用者 (VB) |Microsoft 文件
author: rick-anderson
description: 允許使用者編輯資料的 web 應用程式，在不同的使用者帳戶可能有不同的資料編輯權限。 在本教學課程中我們將檢驗如何 t...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/17/2006
ms.topic: article
ms.assetid: 9dc264a6-feb8-474b-8b91-008c50708065
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-vb
msc.type: authoredcontent
ms.openlocfilehash: eccb8e114e0ecf772680a2e5b36a761736cf8025
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 04/06/2018
---
<a name="limiting-data-modification-functionality-based-on-the-user-vb"></a><span data-ttu-id="f0d76-104">限制使用者 (VB) 為基礎的資料修改功能</span><span class="sxs-lookup"><span data-stu-id="f0d76-104">Limiting Data Modification Functionality Based on the User (VB)</span></span>
====================
<span data-ttu-id="f0d76-105">由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f0d76-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f0d76-106">[下載範例應用程式](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_23_VB.exe)或[下載 PDF](limiting-data-modification-functionality-based-on-the-user-vb/_static/datatutorial23vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="f0d76-106">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_23_VB.exe) or [Download PDF](limiting-data-modification-functionality-based-on-the-user-vb/_static/datatutorial23vb1.pdf)</span></span>

> <span data-ttu-id="f0d76-107">允許使用者編輯資料的 web 應用程式，在不同的使用者帳戶可能有不同的資料編輯權限。</span><span class="sxs-lookup"><span data-stu-id="f0d76-107">In a web application that allows users to edit data, different user accounts may have different data-editing privileges.</span></span> <span data-ttu-id="f0d76-108">在本教學課程中，我們將檢驗如何動態調整正在瀏覽的使用者為基礎的資料修改功能。</span><span class="sxs-lookup"><span data-stu-id="f0d76-108">In this tutorial we'll examine how to dynamically adjust the data modification capabilities based on the visiting user.</span></span>


## <a name="introduction"></a><span data-ttu-id="f0d76-109">簡介</span><span class="sxs-lookup"><span data-stu-id="f0d76-109">Introduction</span></span>

<span data-ttu-id="f0d76-110">許多 web 應用程式支援的使用者帳戶，並提供不同的選項、 報表和已登入使用者為基礎的功能。</span><span class="sxs-lookup"><span data-stu-id="f0d76-110">A number of web applications support user accounts and provide different options, reports, and functionality based on the logged in user.</span></span> <span data-ttu-id="f0d76-111">比方說，與教學課程我們可能會想要允許使用者登入站台和更新的一般資訊其產品，其名稱和單位，數量可能是-以及供應商資訊、 他們的公司名稱，例如供應商公司地址、 連絡人的資訊等等。</span><span class="sxs-lookup"><span data-stu-id="f0d76-111">For example, with our tutorials we might want to allow users from the supplier companies to log on to the site and update general information about their products - their name and quantity per unit, perhaps - along with supplier information, such as their company name, address, the contact person s information, and so on.</span></span> <span data-ttu-id="f0d76-112">此外，我們可能需要以包含部分使用者帳戶，以便我們公司的人員，使他們可以登入和更新產品資訊，像是單位股票圖、 重新排序層級，等等。</span><span class="sxs-lookup"><span data-stu-id="f0d76-112">Furthermore, we might want to include some user accounts for people from our company so that they can log on and update product information like units on stock, reorder level, and so forth.</span></span> <span data-ttu-id="f0d76-113">我們的 web 應用程式也可能會允許匿名使用者瀏覽 （人不登入），但會限制他們只能檢視資料。</span><span class="sxs-lookup"><span data-stu-id="f0d76-113">Our web application might also allow anonymous users to visit (people who have not logged on), but would limit them to just viewing data.</span></span> <span data-ttu-id="f0d76-114">此使用者帳戶系統位置中，我們可能會想在我們 ASP.NET 網頁中插入、 編輯和刪除功能適用於目前登入的使用者提供的 Web 控制項的資料。</span><span class="sxs-lookup"><span data-stu-id="f0d76-114">With such a user account system in place, we would want the data Web controls in our ASP.NET pages to offer the inserting, editing, and deleting capabilities appropriate for the currently logged on user.</span></span>

<span data-ttu-id="f0d76-115">在本教學課程中，我們將檢驗如何動態調整正在瀏覽的使用者為基礎的資料修改功能。</span><span class="sxs-lookup"><span data-stu-id="f0d76-115">In this tutorial we'll examine how to dynamically adjust the data modification capabilities based on the visiting user.</span></span> <span data-ttu-id="f0d76-116">特別是，我們將建立顯示供應商資訊中會列出供應商所提供的產品的 GridView 以及編輯 DetailsView 的頁面。</span><span class="sxs-lookup"><span data-stu-id="f0d76-116">In particular, we'll create a page that displays the suppliers information in an editable DetailsView along with a GridView that lists the products provided by the supplier.</span></span> <span data-ttu-id="f0d76-117">如果是從本公司的瀏覽頁面的使用者，他們可以： 可以檢視任何供應商的資訊;編輯其位址。並編輯任何產品供應商所提供的資訊。</span><span class="sxs-lookup"><span data-stu-id="f0d76-117">If the user visiting the page is from our company, they can: view any supplier s information; edit their address; and edit the information for any product provided by the supplier.</span></span> <span data-ttu-id="f0d76-118">如果，不過，是從某家公司的使用者，他們可以只檢視和編輯自己的位址資訊和只能編輯其未標示為已中止的產品。</span><span class="sxs-lookup"><span data-stu-id="f0d76-118">If, however, the user is from a particular company, they can only view and edit their own address information and can only edit their products that have not been marked as discontinued.</span></span>


<span data-ttu-id="f0d76-119">[![我們公司的使用者可以編輯任何供應商的資訊](limiting-data-modification-functionality-based-on-the-user-vb/_static/image2.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-119">[![A User from Our Company Can Edit Any Supplier s Information](limiting-data-modification-functionality-based-on-the-user-vb/_static/image2.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image1.png)</span></span>

<span data-ttu-id="f0d76-120">**圖 1**： 使用者從我們公司可以編輯任何供應商的資訊 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-120">**Figure 1**: A User from Our Company Can Edit Any Supplier s Information ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image3.png))</span></span>


<span data-ttu-id="f0d76-121">[![從特定供應商只能檢視和編輯其資訊的使用者](limiting-data-modification-functionality-based-on-the-user-vb/_static/image5.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-121">[![A User from a Particular Supplier Can Only View and Edit their Information](limiting-data-modification-functionality-based-on-the-user-vb/_static/image5.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image4.png)</span></span>

<span data-ttu-id="f0d76-122">**圖 2**： 使用者從特定供應商可以只檢視和編輯其資訊 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-122">**Figure 2**: A User from a Particular Supplier Can Only View and Edit their Information ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image6.png))</span></span>


<span data-ttu-id="f0d76-123">Let s 開始 ！</span><span class="sxs-lookup"><span data-stu-id="f0d76-123">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="f0d76-124">ASP.NET 2.0 s 成員資格系統提供標準化、 可延伸的平台，用於建立、 管理及驗證使用者帳戶。</span><span class="sxs-lookup"><span data-stu-id="f0d76-124">ASP.NET 2.0 s membership system provides a standardized, extensible platform for creating, managing, and validating user accounts.</span></span> <span data-ttu-id="f0d76-125">因為成員資格系統檢查超出這些教學課程的範圍，本教學課程改為"fakes"成員資格允許匿名的使用者選擇他們是否從特定供應商或本公司。</span><span class="sxs-lookup"><span data-stu-id="f0d76-125">Since an examination of the membership system is beyond the scope of these tutorials, this tutorial instead "fakes" membership by allowing anonymous visitors to choose whether they are from a particular supplier or from our company.</span></span> <span data-ttu-id="f0d76-126">如需成員資格的詳細資訊，請參閱我[檢查 ASP.NET 2.0 s 成員資格、 角色和設定檔](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)文章系列。</span><span class="sxs-lookup"><span data-stu-id="f0d76-126">For more on membership, refer to my [Examining ASP.NET 2.0 s Membership, Roles, and Profile](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx) article series.</span></span>


## <a name="step-1-allowing-the-user-to-specify-their-access-rights"></a><span data-ttu-id="f0d76-127">步驟 1： 可讓使用者指定其存取權限</span><span class="sxs-lookup"><span data-stu-id="f0d76-127">Step 1: Allowing the User to Specify their Access Rights</span></span>

<span data-ttu-id="f0d76-128">在真實世界的 web 應用程式中，使用者的帳戶資訊會包括是否我們公司或特定供應商，他們的工作，因此這項資訊會以程式設計方式存取從我們的 ASP.NET 網頁，一旦使用者已登入站台。</span><span class="sxs-lookup"><span data-stu-id="f0d76-128">In a real-world web application, a user s account information would include whether they worked for our company or for a particular supplier, and this information would be programmatically accessible from our ASP.NET pages once the user has logged on to the site.</span></span> <span data-ttu-id="f0d76-129">這項資訊可以透過 ASP.NET 2.0 的角色的系統，被擷取成使用者層級帳戶資訊，透過設定檔的系統，或透過一些自訂的方式。</span><span class="sxs-lookup"><span data-stu-id="f0d76-129">This information could be captured through ASP.NET 2.0 s roles system, as user-level account information through the profile system, or through some custom means.</span></span>

<span data-ttu-id="f0d76-130">由於本教學課程的目的在於示範調整登入的使用者為基礎的資料修改功能，而且並非用於展示 ASP.NET 2.0 s 成員資格、 角色和設定檔的系統，我們會使用非常簡單的機制來判斷使用者瀏覽頁面-從中使用者可以指出是否它們應該能夠檢視和編輯任何供應商資訊或，或者，目標的 DropDownList 功能也可以檢視和編輯的特定供應商的資訊。</span><span class="sxs-lookup"><span data-stu-id="f0d76-130">Since the aim of this tutorial is to demonstrate adjusting the data modification capabilities based on the logged on user, and is not meant to showcase ASP.NET 2.0 s membership, roles, and profile systems, we'll use a very simply mechanism to determine the capabilities for the user visiting the page - a DropDownList from which the user can indicate if they should be able to view and edit any of the suppliers information or, alternatively, what particular supplier s information they can view and edit.</span></span> <span data-ttu-id="f0d76-131">如果使用者表示她可以檢視和編輯所有供應商資訊 （預設值），她可以逐頁查看所有供應商、 編輯任何供應商的位址資訊和編輯的名稱和任何所選取的供應商提供的產品單位數量。</span><span class="sxs-lookup"><span data-stu-id="f0d76-131">If the user indicates that she can view and edit all supplier information (the default), she can page through all suppliers, edit any supplier s address information, and edit the name and quantity per unit for any product provided by the selected supplier.</span></span> <span data-ttu-id="f0d76-132">如果使用者表示，她只能檢視和編輯特定供應商，不過，然後她可以只有一個供應商檢視詳細資料和產品，且只可更新的名稱和每個單位為這些產品的資訊數量*不*已停止。</span><span class="sxs-lookup"><span data-stu-id="f0d76-132">If the user indicates that she can only view and edit a particular supplier, however, then she can only view the details and products for that one supplier and can only update the name and quantity per unit information for those products that are *not* discontinued.</span></span>

<span data-ttu-id="f0d76-133">在本教學課程中，我們第一個步驟，是建立此 DropDownList 並填入供應商中系統中。</span><span class="sxs-lookup"><span data-stu-id="f0d76-133">Our first step in this tutorial, then, is to create this DropDownList and populate it with the suppliers in the system.</span></span> <span data-ttu-id="f0d76-134">開啟`UserLevelAccess.aspx`頁面`EditInsertDelete`資料夾中，加入 DropDownList 其`ID`屬性設定為`Suppliers`，並將此 DropDownList 繫結至名為新 ObjectDataSource `AllSuppliersDataSource`。</span><span class="sxs-lookup"><span data-stu-id="f0d76-134">Open the `UserLevelAccess.aspx` page in the `EditInsertDelete` folder, add a DropDownList whose `ID` property is set to `Suppliers`, and bind this DropDownList to a new ObjectDataSource named `AllSuppliersDataSource`.</span></span>


<span data-ttu-id="f0d76-135">[![建立名為 AllSuppliersDataSource 新 ObjectDataSource](limiting-data-modification-functionality-based-on-the-user-vb/_static/image8.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-135">[![Create a New ObjectDataSource Named AllSuppliersDataSource](limiting-data-modification-functionality-based-on-the-user-vb/_static/image8.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image7.png)</span></span>

<span data-ttu-id="f0d76-136">**圖 3**： 建立新的 ObjectDataSource 具名`AllSuppliersDataSource`([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-136">**Figure 3**: Create a New ObjectDataSource Named `AllSuppliersDataSource` ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image9.png))</span></span>


<span data-ttu-id="f0d76-137">因為我們想要這個 DropDownList 以包含所有供應商，設定要叫用 ObjectDataSource`SuppliersBLL`類別的`GetSuppliers()`方法。</span><span class="sxs-lookup"><span data-stu-id="f0d76-137">Since we want this DropDownList to include all suppliers, configure the ObjectDataSource to invoke the `SuppliersBLL` class s `GetSuppliers()` method.</span></span> <span data-ttu-id="f0d76-138">也請確認 ObjectDataSource s`Update()`方法對應到`SuppliersBLL`類別的`UpdateSupplierAddress`方法，為這個 ObjectDataSource 也會使用由 DetailsView 我們將加入在步驟 2 中。</span><span class="sxs-lookup"><span data-stu-id="f0d76-138">Also ensure that the ObjectDataSource s `Update()` method is mapped to the `SuppliersBLL` class s `UpdateSupplierAddress` method, as this ObjectDataSource will also be used by the DetailsView we'll be adding in Step 2.</span></span>

<span data-ttu-id="f0d76-139">完成 ObjectDataSource 精靈之後，完成設定步驟`Suppliers`DropDownList，它會顯示`CompanyName`資料欄位，並使用`SupplierID`資料欄位的值都為`ListItem`。</span><span class="sxs-lookup"><span data-stu-id="f0d76-139">After completing the ObjectDataSource wizard, complete the steps by configuring the `Suppliers` DropDownList such that it shows the `CompanyName` data field and uses the `SupplierID` data field as the value for each `ListItem`.</span></span>


<span data-ttu-id="f0d76-140">[![設定供應商 DropDownList 以使用 CompanyName 和 SupplierID 資料欄位](limiting-data-modification-functionality-based-on-the-user-vb/_static/image11.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-140">[![Configure the Suppliers DropDownList to Use the CompanyName and SupplierID Data Fields](limiting-data-modification-functionality-based-on-the-user-vb/_static/image11.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image10.png)</span></span>

<span data-ttu-id="f0d76-141">**圖 4**： 設定`Suppliers`使用 DropDownList`CompanyName`和`SupplierID`資料欄位 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-141">**Figure 4**: Configure the `Suppliers` DropDownList to Use the `CompanyName` and `SupplierID` Data Fields ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image12.png))</span></span>


<span data-ttu-id="f0d76-142">此時，DropDownList 會列出供應商在資料庫中的公司名稱。</span><span class="sxs-lookup"><span data-stu-id="f0d76-142">At this point, the DropDownList lists the company names of the suppliers in the database.</span></span> <span data-ttu-id="f0d76-143">不過，我們也必須包括 「 顯示或編輯所有供應商 」 選項，以 DropDownList。</span><span class="sxs-lookup"><span data-stu-id="f0d76-143">However, we also need to include a "Show/Edit ALL Suppliers" option to the DropDownList.</span></span> <span data-ttu-id="f0d76-144">若要達成此目的，設定`Suppliers`DropDownList s`AppendDataBoundItems`屬性`true`然後再加入`ListItem`其`Text`屬性是 「 顯示或編輯所有供應商 」，而其值為`-1`。</span><span class="sxs-lookup"><span data-stu-id="f0d76-144">To accomplish this, set the `Suppliers` DropDownList s `AppendDataBoundItems` property to `true` and then add a `ListItem` whose `Text` property is "Show/Edit ALL Suppliers" and whose value is `-1`.</span></span> <span data-ttu-id="f0d76-145">這可以加入透過宣告式標記或直接在設計工具移至 [屬性] 視窗，然後按一下省略符號，DropDownList 的`Items`屬性。</span><span class="sxs-lookup"><span data-stu-id="f0d76-145">This can be added directly through the declarative markup or through the Designer by going to the Properties window and clicking on the ellipses in the DropDownList s `Items` property.</span></span>

> [!NOTE]
> <span data-ttu-id="f0d76-146">回頭參考[*主要/詳細資料篩選與 DropDownList* ](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md)教學課程，如需將所有選取的項目加入至資料繫結 DropDownList 的更詳細討論。</span><span class="sxs-lookup"><span data-stu-id="f0d76-146">Refer back to the [*Master/Detail Filtering With a DropDownList*](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) tutorial for a more detailed discussion on adding a Select All item to a databound DropDownList.</span></span>


<span data-ttu-id="f0d76-147">之後`AppendDataBoundItems`屬性已設定和`ListItem`加入，DropDownList s 宣告式標記看起來應該像：</span><span class="sxs-lookup"><span data-stu-id="f0d76-147">After the `AppendDataBoundItems` property has been set and the `ListItem` added, the DropDownList s declarative markup should look like:</span></span>


[!code-aspx[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample1.aspx)]

<span data-ttu-id="f0d76-148">圖 5 顯示目前進度的螢幕擷取畫面，透過瀏覽器檢視時。</span><span class="sxs-lookup"><span data-stu-id="f0d76-148">Figure 5 shows a screen shot of our current progress, when viewed through a browser.</span></span>


<span data-ttu-id="f0d76-149">[![供應商 DropDownList 包含顯示，所有的清單項目，再加上另一個用於每個供應商](limiting-data-modification-functionality-based-on-the-user-vb/_static/image14.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-149">[![The Suppliers DropDownList Contains a Show ALL ListItem, Plus One for Each Supplier](limiting-data-modification-functionality-based-on-the-user-vb/_static/image14.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image13.png)</span></span>

<span data-ttu-id="f0d76-150">**圖 5**: `Suppliers` DropDownList 包含全部顯示`ListItem`，加上一個每個供應商 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-150">**Figure 5**: The `Suppliers` DropDownList Contains a Show ALL `ListItem`, Plus One for Each Supplier ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image15.png))</span></span>


<span data-ttu-id="f0d76-151">由於我們想要使用者已變更選取範圍之後，立即更新的使用者介面，將設定`Suppliers`DropDownList s`AutoPostBack`屬性`true`。</span><span class="sxs-lookup"><span data-stu-id="f0d76-151">Since we want to update the user interface immediately after the user has changed their selection, set the `Suppliers` DropDownList s `AutoPostBack` property to `true`.</span></span> <span data-ttu-id="f0d76-152">在步驟 2 中，我們將建立會顯示的資訊為根據的 DropDownList 選擇 supplier(s) DetailsView 控制項。</span><span class="sxs-lookup"><span data-stu-id="f0d76-152">In Step 2 we'll create a DetailsView control that will show the information for the supplier(s) based on the DropDownList selection.</span></span> <span data-ttu-id="f0d76-153">然後，在步驟 3 中，我們將建立此 DropDownList s 的事件處理常式`SelectedIndexChanged`事件，在其中我們會加入程式碼，將適當的供應商資訊繫結至 DetailsView 根據選取的供應商。</span><span class="sxs-lookup"><span data-stu-id="f0d76-153">Then, in Step 3, we'll create an event handler for this DropDownList s `SelectedIndexChanged` event, in which we'll add code that binds the appropriate supplier information to the DetailsView based upon the selected supplier.</span></span>

## <a name="step-2-adding-a-detailsview-control"></a><span data-ttu-id="f0d76-154">步驟 2： 加入 DetailsView 控制項</span><span class="sxs-lookup"><span data-stu-id="f0d76-154">Step 2: Adding a DetailsView Control</span></span>

<span data-ttu-id="f0d76-155">可讓 s 使用 DetailsView 顯示供應商的資訊。</span><span class="sxs-lookup"><span data-stu-id="f0d76-155">Let s use a DetailsView to show supplier information.</span></span> <span data-ttu-id="f0d76-156">可以檢視及編輯所有供應商的使用者，DetailsView 會支援分頁，讓使用者逐步執行供應商資訊一筆記錄，一次。</span><span class="sxs-lookup"><span data-stu-id="f0d76-156">For the user who can view and edit all suppliers, the DetailsView will support paging, allowing the user to step through the supplier information one record at a time.</span></span> <span data-ttu-id="f0d76-157">如果使用者適用於特定供應商，不過，DetailsView 會顯示該特定供應商的資訊，將不會包含分頁介面。</span><span class="sxs-lookup"><span data-stu-id="f0d76-157">If the user works for a particular supplier, however, the DetailsView will show only that particular supplier s information and will not include a paging interface.</span></span> <span data-ttu-id="f0d76-158">在任一情況下，DetailsView 需要允許使用者編輯供應商 s 地址、 縣市和國家/地區欄位。</span><span class="sxs-lookup"><span data-stu-id="f0d76-158">In either case, the DetailsView needs to allow the user to edit the supplier s address, city, and country fields.</span></span>

<span data-ttu-id="f0d76-159">加入至頁面下方的 DetailsView `Suppliers` DropDownList，設定其`ID`屬性`SupplierDetails`，並將它繫結`AllSuppliersDataSource`ObjectDataSource 先前步驟中建立。</span><span class="sxs-lookup"><span data-stu-id="f0d76-159">Add a DetailsView to the page beneath the `Suppliers` DropDownList, set its `ID` property to `SupplierDetails`, and bind it to the `AllSuppliersDataSource` ObjectDataSource created in the previous step.</span></span> <span data-ttu-id="f0d76-160">接下來，檢查從 DetailsView s 智慧標籤啟用分頁，並啟用編輯核取方塊。</span><span class="sxs-lookup"><span data-stu-id="f0d76-160">Next, check the Enable Paging and Enable Editing checkboxes from the DetailsView s smart tag.</span></span>

> [!NOTE]
> <span data-ttu-id="f0d76-161">如果您不要看到智慧 s 的 DetailsView 中啟用編輯選項標記 s 因為未對應 ObjectDataSource s`Update()`方法`SuppliersBLL`類別的`UpdateSupplierAddress`方法。</span><span class="sxs-lookup"><span data-stu-id="f0d76-161">If you don t see an Enable Editing option in the DetailsView s smart tag it s because you did not map the ObjectDataSource s `Update()` method to the `SuppliersBLL` class s `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="f0d76-162">請花一點時間回頭進行此設定變更之後, 啟用編輯 選項應該會出現在 DetailsView s 智慧標籤。</span><span class="sxs-lookup"><span data-stu-id="f0d76-162">Take a moment to go back and make this configuration change, after which the Enable Editing option should appear in the DetailsView s smart tag.</span></span>


<span data-ttu-id="f0d76-163">因為`SuppliersBLL`類別 s`UpdateSupplierAddress`方法只會接受四個參數- `supplierID`， `address`， `city`，和`country`-修改 DetailsView 的 BoundFields 以便`CompanyName`和`Phone`BoundFields 處於唯讀狀態。</span><span class="sxs-lookup"><span data-stu-id="f0d76-163">Since the `SuppliersBLL` class s `UpdateSupplierAddress` method only accepts four parameters - `supplierID`, `address`, `city`, and `country` - modify the DetailsView s BoundFields so that the `CompanyName` and `Phone` BoundFields are read-only.</span></span> <span data-ttu-id="f0d76-164">此外，移除`SupplierID`BoundField 完全。</span><span class="sxs-lookup"><span data-stu-id="f0d76-164">Additionally, remove the `SupplierID` BoundField altogether.</span></span> <span data-ttu-id="f0d76-165">最後， `AllSuppliersDataSource` ObjectDataSource 目前具有其`OldValuesParameterFormatString`屬性設定為`original_{0}`。</span><span class="sxs-lookup"><span data-stu-id="f0d76-165">Finally, the `AllSuppliersDataSource` ObjectDataSource currently has its `OldValuesParameterFormatString` property set to `original_{0}`.</span></span> <span data-ttu-id="f0d76-166">請花一點時間從宣告式語法完全中，移除此屬性設定值，或將它設定為預設值， `{0}`。</span><span class="sxs-lookup"><span data-stu-id="f0d76-166">Take a moment to remove this property setting from the declarative syntax altogether, or set it to the default value, `{0}`.</span></span>

<span data-ttu-id="f0d76-167">設定之後`SupplierDetails`DetailsView 和`AllSuppliersDataSource`ObjectDataSource，我們將會在下列的宣告式標記：</span><span class="sxs-lookup"><span data-stu-id="f0d76-167">After configuring the `SupplierDetails` DetailsView and `AllSuppliersDataSource` ObjectDataSource, we will have the following declarative markup:</span></span>


[!code-aspx[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample2.aspx)]

<span data-ttu-id="f0d76-168">此時 DetailsView 可以透過分頁，並選取供應商的位址資訊可以更新，不論所做的選擇`Suppliers`DropDownList （請參閱圖 6）。</span><span class="sxs-lookup"><span data-stu-id="f0d76-168">At this point the DetailsView can be paged through and the selected supplier s address information can be updated, regardless of the selection made in the `Suppliers` DropDownList (see Figure 6).</span></span>


<span data-ttu-id="f0d76-169">[![您可以檢視任何供應商的資訊，且其位址更新](limiting-data-modification-functionality-based-on-the-user-vb/_static/image17.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-169">[![Any Suppliers Information Can Be Viewed, and Its Address Updated](limiting-data-modification-functionality-based-on-the-user-vb/_static/image17.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image16.png)</span></span>

<span data-ttu-id="f0d76-170">**圖 6**: Any 供應商可以檢視資訊，並更新其位址 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-170">**Figure 6**: Any Suppliers Information Can Be Viewed, and Its Address Updated ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image18.png))</span></span>


## <a name="step-3-displaying-only-the-selected-supplier-s-information"></a><span data-ttu-id="f0d76-171">步驟 3： 顯示只將選取的供應商的資訊</span><span class="sxs-lookup"><span data-stu-id="f0d76-171">Step 3: Displaying Only the Selected Supplier s Information</span></span>

<span data-ttu-id="f0d76-172">目前我們的頁面就會顯示的資訊，不論是否已從選取特定供應商的所有供應商`Suppliers`DropDownList。</span><span class="sxs-lookup"><span data-stu-id="f0d76-172">Our page currently displays the information for all suppliers regardless of whether a particular supplier has been selected from the `Suppliers` DropDownList.</span></span> <span data-ttu-id="f0d76-173">若要顯示供應商資訊選取供應商我們要將另一個 ObjectDataSource 加入至我們的頁面上，擷取特定供應商的相關資訊的其中一個。</span><span class="sxs-lookup"><span data-stu-id="f0d76-173">In order to display just the supplier information for the selected supplier we need to add another ObjectDataSource to our page, one that retrieves information about a particular supplier.</span></span>

<span data-ttu-id="f0d76-174">加入新 ObjectDataSource 頁面上，其命名為`SingleSupplierDataSource`。</span><span class="sxs-lookup"><span data-stu-id="f0d76-174">Add a new ObjectDataSource to the page, naming it `SingleSupplierDataSource`.</span></span> <span data-ttu-id="f0d76-175">從其智慧標籤上，按一下 設定資料來源連結，並讓它使用`SuppliersBLL`類別的`GetSupplierBySupplierID(supplierID)`方法。</span><span class="sxs-lookup"><span data-stu-id="f0d76-175">From its smart tag, click the Configure Data Source link and have it use the `SuppliersBLL` class s `GetSupplierBySupplierID(supplierID)` method.</span></span> <span data-ttu-id="f0d76-176">如同`AllSuppliersDataSource`ObjectDataSource，具有`SingleSupplierDataSource`ObjectDataSource s`Update()`方法對應到`SuppliersBLL`類別的`UpdateSupplierAddress`方法。</span><span class="sxs-lookup"><span data-stu-id="f0d76-176">As with the `AllSuppliersDataSource` ObjectDataSource, have the `SingleSupplierDataSource` ObjectDataSource s `Update()` method mapped to the `SuppliersBLL` class s `UpdateSupplierAddress` method.</span></span>


<span data-ttu-id="f0d76-177">[![設定為使用 GetSupplierBySupplierID(supplierID) 方法 SingleSupplierDataSource ObjectDataSource](limiting-data-modification-functionality-based-on-the-user-vb/_static/image20.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-177">[![Configure the SingleSupplierDataSource ObjectDataSource to Use the GetSupplierBySupplierID(supplierID) Method](limiting-data-modification-functionality-based-on-the-user-vb/_static/image20.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image19.png)</span></span>

<span data-ttu-id="f0d76-178">**圖 7**： 設定`SingleSupplierDataSource`使用 ObjectDataSource`GetSupplierBySupplierID(supplierID)`方法 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-178">**Figure 7**: Configure the `SingleSupplierDataSource` ObjectDataSource to Use the `GetSupplierBySupplierID(supplierID)` Method ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image21.png))</span></span>


<span data-ttu-id="f0d76-179">接下來，我們重新系統提示您指定的參數來源`GetSupplierBySupplierID(supplierID)`方法的`supplierID`輸入的參數。</span><span class="sxs-lookup"><span data-stu-id="f0d76-179">Next, we re prompted to specify the parameter source for the `GetSupplierBySupplierID(supplierID)` method s `supplierID` input parameter.</span></span> <span data-ttu-id="f0d76-180">因為我們想要顯示的資訊從 DropDownList，使用選取的供應商`Suppliers`DropDownList 的`SelectedValue`屬性做為參數的來源。</span><span class="sxs-lookup"><span data-stu-id="f0d76-180">Since we want to show the information for the supplier selected from the DropDownList, use the `Suppliers` DropDownList s `SelectedValue` property as the parameter source.</span></span>


<span data-ttu-id="f0d76-181">[![供應商 DropDownList 做 supplierID 參數來源](limiting-data-modification-functionality-based-on-the-user-vb/_static/image23.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-181">[![Use the Suppliers DropDownList as the supplierID Parameter Source](limiting-data-modification-functionality-based-on-the-user-vb/_static/image23.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image22.png)</span></span>

<span data-ttu-id="f0d76-182">**圖 8**： 使用`Suppliers`為 DropDownList`supplierID`參數來源 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-182">**Figure 8**: Use the `Suppliers` DropDownList as the `supplierID` Parameter Source ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image24.png))</span></span>


<span data-ttu-id="f0d76-183">加入這個第二個 ObjectDataSource，即使有 DetailsView 控制項目前設定為一律使用`AllSuppliersDataSource`ObjectDataSource。</span><span class="sxs-lookup"><span data-stu-id="f0d76-183">Even with this second ObjectDataSource added, the DetailsView control is currently configured to always use the `AllSuppliersDataSource` ObjectDataSource.</span></span> <span data-ttu-id="f0d76-184">我們需要加入邏輯，以調整 DetailsView 取決於所使用的資料來源`Suppliers`選取 DropDownList 項目。</span><span class="sxs-lookup"><span data-stu-id="f0d76-184">We need to add logic to adjust the data source used by the DetailsView depending on the `Suppliers` DropDownList item selected.</span></span> <span data-ttu-id="f0d76-185">若要達成此目的，建立`SelectedIndexChanged`供應商 DropDownList 的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="f0d76-185">To accomplish this, create a `SelectedIndexChanged` event handler for the Suppliers DropDownList.</span></span> <span data-ttu-id="f0d76-186">這最容易建立按兩下設計工具中的 DropDownList。</span><span class="sxs-lookup"><span data-stu-id="f0d76-186">This can most easily be created by double-clicking the DropDownList in the Designer.</span></span> <span data-ttu-id="f0d76-187">這個事件處理常式必須決定要使用何種資料來源，且必須重新繫結在 detailsview 的資料。</span><span class="sxs-lookup"><span data-stu-id="f0d76-187">This event handler needs to determine what data source to use and must rebind the data to the DetailsView.</span></span> <span data-ttu-id="f0d76-188">使用下列程式碼完成這個動作：</span><span class="sxs-lookup"><span data-stu-id="f0d76-188">This is accomplished with the following code:</span></span>


[!code-vb[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample3.vb)]

<span data-ttu-id="f0d76-189">此事件處理常式一開始會判斷是否已選取 「 顯示或編輯所有供應商 」 選項。</span><span class="sxs-lookup"><span data-stu-id="f0d76-189">The event handler begins by determining whether the "Show/Edit ALL Suppliers" option was selected.</span></span> <span data-ttu-id="f0d76-190">如果是，它會設定`SupplierDetails`DetailsView s`DataSourceID`至`AllSuppliersDataSource`並傳回給供應商的集合中第一筆記錄的使用者，藉由設定`PageIndex`屬性設為 0。</span><span class="sxs-lookup"><span data-stu-id="f0d76-190">If it was, it sets the `SupplierDetails` DetailsView s `DataSourceID` to `AllSuppliersDataSource` and returns the user to the first record in the set of suppliers by setting the `PageIndex` property to 0.</span></span> <span data-ttu-id="f0d76-191">不過，使用者已選取 特定供應商的 DropDownList DetailsView s 從`DataSourceID`指派給`SingleSuppliersDataSource`。</span><span class="sxs-lookup"><span data-stu-id="f0d76-191">If, however, the user has selected a particular supplier from the DropDownList, the DetailsView s `DataSourceID` is assigned to `SingleSuppliersDataSource`.</span></span> <span data-ttu-id="f0d76-192">無論何種資料來源使用，`SuppliersDetails`模式會還原到唯讀模式且資料會重新繫結至 DetailsView 呼叫`SuppliersDetails`控制項的`DataBind()`方法。</span><span class="sxs-lookup"><span data-stu-id="f0d76-192">Regardless of what data source is used, the `SuppliersDetails` mode is reverted back to the read-only mode and the data is rebound to the DetailsView by a call to the `SuppliersDetails` control s `DataBind()` method.</span></span>

<span data-ttu-id="f0d76-193">與就地此事件處理常式，DetailsView 控制項現在會顯示所選的供應商，除非已選取 「 顯示或編輯所有供應商 」 選項，在此情況下的所有供應商可以檢視透過分頁介面。</span><span class="sxs-lookup"><span data-stu-id="f0d76-193">With this event handler in place, the DetailsView control now shows the selected supplier, unless the "Show/Edit ALL Suppliers" option was selected, in which case all of the suppliers can be viewed through the paging interface.</span></span> <span data-ttu-id="f0d76-194">圖 9 顯示頁面 」 顯示或編輯所有供應商 」 選取的選項。請注意，分頁介面，讓使用者瀏覽並更新任何供應商。</span><span class="sxs-lookup"><span data-stu-id="f0d76-194">Figure 9 shows the page with the "Show/Edit ALL Suppliers" option selected; note that the paging interface is present, allowing the user to visit and update any supplier.</span></span> <span data-ttu-id="f0d76-195">圖 10 顯示頁面以選取錦供應商。</span><span class="sxs-lookup"><span data-stu-id="f0d76-195">Figure 10 shows the page with the Ma Maison supplier selected.</span></span> <span data-ttu-id="f0d76-196">錦的資訊會在此情況下是可檢視和編輯。</span><span class="sxs-lookup"><span data-stu-id="f0d76-196">Only Ma Maison s information is viewable and editable in this case.</span></span>


<span data-ttu-id="f0d76-197">[![所有供應商資訊可以檢視和編輯](limiting-data-modification-functionality-based-on-the-user-vb/_static/image26.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-197">[![All of the Suppliers Information Can Be Viewed and Edited](limiting-data-modification-functionality-based-on-the-user-vb/_static/image26.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image25.png)</span></span>

<span data-ttu-id="f0d76-198">**圖 9**： 的所有供應商資訊檢視和編輯 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-198">**Figure 9**: All of the Suppliers Information Can Be Viewed and Edited ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image27.png))</span></span>


<span data-ttu-id="f0d76-199">[![可以檢視和編輯選取的供應商的資訊](limiting-data-modification-functionality-based-on-the-user-vb/_static/image29.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-199">[![Only the Selected Supplier s Information Can Be Viewed and Edited](limiting-data-modification-functionality-based-on-the-user-vb/_static/image29.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image28.png)</span></span>

<span data-ttu-id="f0d76-200">**圖 10**： 只有選取的供應商 s 資訊可以 Viewed 和編輯 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-200">**Figure 10**: Only the Selected Supplier s Information Can Be Viewed and Edited ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image30.png))</span></span>


> [!NOTE]
> <span data-ttu-id="f0d76-201">本教學課程，DropDownList 和 DetailsView 控制 s`EnableViewState`必須設為`true`（預設值） 因為 DropDownList s`SelectedIndex`和 DetailsView 的`DataSourceID`屬性的變更必須記住在回傳。</span><span class="sxs-lookup"><span data-stu-id="f0d76-201">For this tutorial, both the DropDownList and DetailsView control s `EnableViewState` must be set to `true` (the default) because the DropDownList s `SelectedIndex` and the DetailsView s `DataSourceID` property s changes must be remembered across postbacks.</span></span>


## <a name="step-4-listing-the-suppliers-products-in-an-editable-gridview"></a><span data-ttu-id="f0d76-202">步驟 4： 列出供應商產品的可編輯的 GridView</span><span class="sxs-lookup"><span data-stu-id="f0d76-202">Step 4: Listing the Suppliers Products in an Editable GridView</span></span>

<span data-ttu-id="f0d76-203">完成 DetailsView 下一步是包含可編輯的 GridView 會列出所選取的供應商提供的產品。</span><span class="sxs-lookup"><span data-stu-id="f0d76-203">With the DetailsView complete, our next step is to include an editable GridView that lists those products provided by the selected supplier.</span></span> <span data-ttu-id="f0d76-204">此 GridView 應該允許編輯，只能`ProductName`和`QuantityPerUnit`欄位。</span><span class="sxs-lookup"><span data-stu-id="f0d76-204">This GridView should allow edits to only the `ProductName` and `QuantityPerUnit` fields.</span></span> <span data-ttu-id="f0d76-205">此外，如果使用者瀏覽頁面是來自特定供應商，它應該只允許這些產品的更新*不*已停止。</span><span class="sxs-lookup"><span data-stu-id="f0d76-205">Moreover, if the user visiting the page is from a particular supplier, it should only allow updates to those products that are *not* discontinued.</span></span> <span data-ttu-id="f0d76-206">若要完成此我們需要先新增的多載`ProductsBLL`類別 s`UpdateProducts`中採用的方法只`ProductID`， `ProductName`，和`QuantityPerUnit`做為輸入的欄位。</span><span class="sxs-lookup"><span data-stu-id="f0d76-206">To accomplish this we'll need to first add an overload of the `ProductsBLL` class s `UpdateProducts` method that takes in just the `ProductID`, `ProductName`, and `QuantityPerUnit` fields as inputs.</span></span> <span data-ttu-id="f0d76-207">我們已事先在許多教學課程中，會逐步執行此程序讓 s 一下這裡的程式碼，應該會加入到`ProductsBLL`:</span><span class="sxs-lookup"><span data-stu-id="f0d76-207">We ve stepped through this process beforehand in numerous tutorials, so let s just look at the code here, which should be added to `ProductsBLL`:</span></span>


[!code-vb[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample4.vb)]

<span data-ttu-id="f0d76-208">使用這個多載建立，我們將 GridView 控制項和其相關聯的 ObjectDataSource 準備好。</span><span class="sxs-lookup"><span data-stu-id="f0d76-208">With this overload created, we re ready to add the GridView control and its associated ObjectDataSource.</span></span> <span data-ttu-id="f0d76-209">將新的 GridView 加入頁面，設定其`ID`屬性`ProductsBySupplier`，並將它設定為使用名為新 ObjectDataSource `ProductsBySupplierDataSource`。</span><span class="sxs-lookup"><span data-stu-id="f0d76-209">Add a new GridView to the page, set its `ID` property to `ProductsBySupplier`, and configure it to use a new ObjectDataSource named `ProductsBySupplierDataSource`.</span></span> <span data-ttu-id="f0d76-210">因為我們想要這個 GridView 列出所選取的供應商的那些產品，請使用`ProductsBLL`類別的`GetProductsBySupplierID(supplierID)`方法。</span><span class="sxs-lookup"><span data-stu-id="f0d76-210">Since we want this GridView to list those products by the selected supplier, use the `ProductsBLL` class s `GetProductsBySupplierID(supplierID)` method.</span></span> <span data-ttu-id="f0d76-211">也會將對應`Update()`方法，以新`UpdateProduct`剛才所建立的多載。</span><span class="sxs-lookup"><span data-stu-id="f0d76-211">Also map the `Update()` method to the new `UpdateProduct` overload we just created.</span></span>


<span data-ttu-id="f0d76-212">[![設定要使用剛才建立的 UpdateProduct 多載 ObjectDataSource](limiting-data-modification-functionality-based-on-the-user-vb/_static/image32.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-212">[![Configure the ObjectDataSource to Use the UpdateProduct Overload Just Created](limiting-data-modification-functionality-based-on-the-user-vb/_static/image32.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image31.png)</span></span>

<span data-ttu-id="f0d76-213">**圖 11**： 設定要使用 ObjectDataSource`UpdateProduct`多載剛建立 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-213">**Figure 11**: Configure the ObjectDataSource to Use the `UpdateProduct` Overload Just Created ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image33.png))</span></span>


<span data-ttu-id="f0d76-214">我們 re 提示您選取的參數來源`GetProductsBySupplierID(supplierID)`方法的`supplierID`輸入的參數。</span><span class="sxs-lookup"><span data-stu-id="f0d76-214">We re prompted to select the parameter source for the `GetProductsBySupplierID(supplierID)` method s `supplierID` input parameter.</span></span> <span data-ttu-id="f0d76-215">因為我們想要顯示的產品中 DetailsView，使用選取的供應商`SuppliersDetails`DetailsView 控制項的`SelectedValue`屬性做為參數的來源。</span><span class="sxs-lookup"><span data-stu-id="f0d76-215">Since we want to show the products for the supplier selected in the DetailsView, use the `SuppliersDetails` DetailsView control s `SelectedValue` property as the parameter source.</span></span>


<span data-ttu-id="f0d76-216">[![在 SuppliersDetails DetailsView 的 SelectedValue 屬性做為參數來源](limiting-data-modification-functionality-based-on-the-user-vb/_static/image35.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-216">[![Use the SuppliersDetails DetailsView s SelectedValue Property as the Parameter Source](limiting-data-modification-functionality-based-on-the-user-vb/_static/image35.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image34.png)</span></span>

<span data-ttu-id="f0d76-217">**圖 12**： 使用`SuppliersDetails`DetailsView s`SelectedValue`做為參數的來源屬性 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-217">**Figure 12**: Use the `SuppliersDetails` DetailsView s `SelectedValue` Property as the Parameter Source ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image36.png))</span></span>


<span data-ttu-id="f0d76-218">返回 GridView 中移除所有的 GridView 欄位除外`ProductName`， `QuantityPerUnit`，和`Discontinued`、 標記`Discontinued`CheckBoxField 以唯讀狀態。</span><span class="sxs-lookup"><span data-stu-id="f0d76-218">Returning to the GridView, remove all of the GridView fields except for `ProductName`, `QuantityPerUnit`, and `Discontinued`, marking the `Discontinued` CheckBoxField as read-only.</span></span> <span data-ttu-id="f0d76-219">另請檢查 GridView s 智慧標籤的 啟用編輯選項。</span><span class="sxs-lookup"><span data-stu-id="f0d76-219">Also, check the Enable Editing option from the GridView s smart tag.</span></span> <span data-ttu-id="f0d76-220">在進行這些變更之後，GridView 和 ObjectDataSource 的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="f0d76-220">After these changes have been made, the declarative markup for the GridView and ObjectDataSource should look similar to the following:</span></span>


[!code-aspx[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample5.aspx)]

<span data-ttu-id="f0d76-221">如同我們先前 ObjectDataSources 這個一個 s`OldValuesParameterFormatString`屬性設定為`original_{0}`，嘗試更新產品的名稱或每個單位的數量時，這樣將會造成問題。</span><span class="sxs-lookup"><span data-stu-id="f0d76-221">As with our previous ObjectDataSources, this one s `OldValuesParameterFormatString` property is set to `original_{0}`, which will cause problems when attempting to update a product s name or quantity per unit.</span></span> <span data-ttu-id="f0d76-222">完全移除這個屬性的宣告式語法，或將它設定為其預設`{0}`。</span><span class="sxs-lookup"><span data-stu-id="f0d76-222">Remove this property from the declarative syntax altogether or set it to its default, `{0}`.</span></span>

<span data-ttu-id="f0d76-223">此設定完成後，我們的頁面現在會列出供應商在 GridView 中選取所提供的產品 （請參閱圖 13）。</span><span class="sxs-lookup"><span data-stu-id="f0d76-223">With this configuration complete, our page now lists the products provided by the supplier selected in the GridView (see Figure 13).</span></span> <span data-ttu-id="f0d76-224">目前*任何*更新產品的名稱或每個單位的數量。</span><span class="sxs-lookup"><span data-stu-id="f0d76-224">Currently *any* product s name or quantity per unit can be updated.</span></span> <span data-ttu-id="f0d76-225">不過，我們需要更新網頁邏輯，使這類功能禁止使用的特定供應商相關聯的使用者不再生產的產品。</span><span class="sxs-lookup"><span data-stu-id="f0d76-225">However, we need to update our page logic so that such functionality is prohibited for discontinued products for users associated with a particular supplier.</span></span> <span data-ttu-id="f0d76-226">我們將會處理這個步驟 5 中的最後一段。</span><span class="sxs-lookup"><span data-stu-id="f0d76-226">We'll tackle this final piece in Step 5.</span></span>


<span data-ttu-id="f0d76-227">[![會顯示所選取的供應商提供的產品](limiting-data-modification-functionality-based-on-the-user-vb/_static/image38.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-227">[![The Products Provided by the Selected Supplier are Displayed](limiting-data-modification-functionality-based-on-the-user-vb/_static/image38.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image37.png)</span></span>

<span data-ttu-id="f0d76-228">**圖 13**： 會顯示所選取的供應商的產品提供 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-228">**Figure 13**: The Products Provided by the Selected Supplier are Displayed ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image39.png))</span></span>


> [!NOTE]
> <span data-ttu-id="f0d76-229">這可以讓您編輯 GridView 加入`Suppliers`DropDownList 的`SelectedIndexChanged`應該更新事件處理常式，以傳回 GridView 唯讀狀態。</span><span class="sxs-lookup"><span data-stu-id="f0d76-229">With the addition of this editable GridView the `Suppliers` DropDownList s `SelectedIndexChanged` event handler should be updated to return the GridView to a read-only state.</span></span> <span data-ttu-id="f0d76-230">否則，如果仍執行時編輯產品資訊中選取不同的供應商，則新的供應商的 GridView 中對應的索引也會編輯。</span><span class="sxs-lookup"><span data-stu-id="f0d76-230">Otherwise, if a different supplier is selected while in the middle of editing product information, the corresponding index in the GridView for the new supplier will also be editable.</span></span> <span data-ttu-id="f0d76-231">若要避免這個問題，只要設定 GridView s`EditIndex`屬性`-1`中`SelectedIndexChanged`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="f0d76-231">To prevent this, simply set the GridView s `EditIndex` property to `-1` in the `SelectedIndexChanged` event handler.</span></span>


<span data-ttu-id="f0d76-232">此外，請記住，它是很重要的 GridView 的檢視狀態是啟用 （預設行為）。</span><span class="sxs-lookup"><span data-stu-id="f0d76-232">Also, recall that it is important that the GridView s view state be enabled (the default behavior).</span></span> <span data-ttu-id="f0d76-233">如果您將 GridView s`EnableViewState`屬性`false`，執行並行的使用者不小心刪除或編輯記錄的風險。</span><span class="sxs-lookup"><span data-stu-id="f0d76-233">If you set the GridView s `EnableViewState` property to `false`, you run the risk of having concurrent users unintentionally deleting or editing records.</span></span> <span data-ttu-id="f0d76-234">請參閱[警告： 已停用並行問題與 ASP.NET 2.0 GridViews/DetailsView/FormViews 該支援編輯和/或刪除與的檢視狀態](http://scottonwriting.net/sowblog/posts/10054.aspx)如需詳細資訊。</span><span class="sxs-lookup"><span data-stu-id="f0d76-234">See [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/posts/10054.aspx) for more information.</span></span>

## <a name="step-5-disallow-editing-for-discontinued-products-when-showedit-all-suppliers-is-not-selected"></a><span data-ttu-id="f0d76-235">步驟 5： 不允許編輯已停止的產品時顯示或編輯所有供應商是未選取</span><span class="sxs-lookup"><span data-stu-id="f0d76-235">Step 5: Disallow Editing for Discontinued Products When Show/Edit ALL Suppliers is Not Selected</span></span>

<span data-ttu-id="f0d76-236">雖然`ProductsBySupplier`GridView 可完整運作，它目前太多存取權授與這些使用者從特定供應商。</span><span class="sxs-lookup"><span data-stu-id="f0d76-236">While the `ProductsBySupplier` GridView is fully functional, it currently grants too much access to those users who are from a particular supplier.</span></span> <span data-ttu-id="f0d76-237">根據我們的商務規則，這類使用者應無法更新不再生產的產品。</span><span class="sxs-lookup"><span data-stu-id="f0d76-237">Per our business rules, such users should not be able to update discontinued products.</span></span> <span data-ttu-id="f0d76-238">若要強制執行這種情況，我們可以隱藏 （或停用） 在不再生產的產品時所瀏覽頁面時由使用者從供應商的 GridView 資料列中的 [編輯] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="f0d76-238">To enforce this, we can hide (or disable) the Edit button in those GridView rows with discontinued products when the page is being visited by a user from a supplier.</span></span>

<span data-ttu-id="f0d76-239">建立事件處理常式 GridView s`RowDataBound`事件。</span><span class="sxs-lookup"><span data-stu-id="f0d76-239">Create an event handler for the GridView s `RowDataBound` event.</span></span> <span data-ttu-id="f0d76-240">此事件處理常式中，我們需要判斷使用者是否為特定的供應商，而這在此教學課程中，可以決定藉由檢查供應商 DropDownList s 相關聯`SelectedValue`屬性--如果它是 s 以外的項目-1，則使用者與特定供應商相關聯。</span><span class="sxs-lookup"><span data-stu-id="f0d76-240">In this event handler we need to determine whether or not the user is associated with a particular supplier, which, for this tutorial, can be determined by checking the Suppliers DropDownList s `SelectedValue` property - if it s something other than -1, then the user is associated with a particular supplier.</span></span> <span data-ttu-id="f0d76-241">這類使用者，我們再需要判斷產品已停止。</span><span class="sxs-lookup"><span data-stu-id="f0d76-241">For such users, we then need to determine whether or not the product is discontinued.</span></span> <span data-ttu-id="f0d76-242">我們可以抓取參考實際`ProductRow`執行個體繫結至 GridView 資料列，以透過`e.Row.DataItem`屬性，如下所述[ *GridView 的頁尾中顯示摘要資訊*](../custom-formatting/displaying-summary-information-in-the-gridview-s-footer-vb.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="f0d76-242">We can grab a reference to the actual `ProductRow` instance bound to the GridView row via the `e.Row.DataItem` property, as discussed in the [*Displaying Summary Information in the GridView s Footer*](../custom-formatting/displaying-summary-information-in-the-gridview-s-footer-vb.md) tutorial.</span></span> <span data-ttu-id="f0d76-243">如果產品停用，我們可以抓取 GridView s CommandField 使用先前的教學課程中所討論的技術中的 [編輯] 按鈕的程式設計參考[*新增用戶端確認時刪除*](adding-client-side-confirmation-when-deleting-vb.md).</span><span class="sxs-lookup"><span data-stu-id="f0d76-243">If the product is discontinued, we can grab a programmatic reference to the Edit button in the GridView s CommandField using the techniques discussed in the previous tutorial, [*Adding Client-Side Confirmation When Deleting*](adding-client-side-confirmation-when-deleting-vb.md).</span></span> <span data-ttu-id="f0d76-244">一旦我們可以隱藏或停用按鈕的參考。</span><span class="sxs-lookup"><span data-stu-id="f0d76-244">Once we have a reference we can then hide or disable the button.</span></span>


[!code-vb[Main](limiting-data-modification-functionality-based-on-the-user-vb/samples/sample6.vb)]

<span data-ttu-id="f0d76-245">與此事件處理常式的位置時瀏覽此頁面為使用者特定供應商的已停用這些產品是不能編輯，, [編輯] 按鈕以隱藏這些產品。</span><span class="sxs-lookup"><span data-stu-id="f0d76-245">With this event handler in place, when visiting this page as a user from a specific supplier those products that are discontinued are not editable, as the Edit button is hidden for these products.</span></span> <span data-ttu-id="f0d76-246">例如，Chef Anton 的 Gumbo 混合是新增奧良印地安歡樂供應商停售的產品。</span><span class="sxs-lookup"><span data-stu-id="f0d76-246">For example, Chef Anton s Gumbo Mix is a discontinued product for the New Orleans Cajun Delights supplier.</span></span> <span data-ttu-id="f0d76-247">當瀏覽這個特定供應商的頁面，看不到隱藏這項產品的 [編輯] 按鈕 （請參閱圖 14）。</span><span class="sxs-lookup"><span data-stu-id="f0d76-247">When visiting the page for this particular supplier, the Edit button for this product is hidden from sight (see Figure 14).</span></span> <span data-ttu-id="f0d76-248">不過，瀏覽使用 「 顯示或編輯所有供應商 」，[編輯] 按鈕時使用 （請參閱圖 15）。</span><span class="sxs-lookup"><span data-stu-id="f0d76-248">However, when visiting using the "Show/Edit ALL Suppliers," the Edit button is available (see Figure 15).</span></span>


<span data-ttu-id="f0d76-249">[![Chef Anton 的 Gumbo 混合的 [編輯] 按鈕是隱藏的供應商特有的使用者](limiting-data-modification-functionality-based-on-the-user-vb/_static/image41.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-249">[![For Supplier-Specific Users the Edit Button for Chef Anton s Gumbo Mix is Hidden](limiting-data-modification-functionality-based-on-the-user-vb/_static/image41.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image40.png)</span></span>

<span data-ttu-id="f0d76-250">**圖 14**： 針對供應商特有的使用者隱藏 Chef Anton 的 Gumbo 混合的 [編輯] 按鈕 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-250">**Figure 14**: For Supplier-Specific Users the Edit Button for Chef Anton s Gumbo Mix is Hidden ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image42.png))</span></span>


<span data-ttu-id="f0d76-251">[![顯示或編輯的所有供應商使用者，會顯示 [編輯] 按鈕，Chef Anton s Gumbo 混合](limiting-data-modification-functionality-based-on-the-user-vb/_static/image44.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="f0d76-251">[![For Show/Edit ALL Suppliers Users, the Edit Button for Chef Anton s Gumbo Mix is Displayed](limiting-data-modification-functionality-based-on-the-user-vb/_static/image44.png)](limiting-data-modification-functionality-based-on-the-user-vb/_static/image43.png)</span></span>

<span data-ttu-id="f0d76-252">**圖 15**： 為顯示或編輯所有供應商的使用者、 Chef Anton s Gumbo 混合會顯示 [編輯] 按鈕 ([按一下以檢視完整大小的影像](limiting-data-modification-functionality-based-on-the-user-vb/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="f0d76-252">**Figure 15**: For Show/Edit ALL Suppliers Users, the Edit Button for Chef Anton s Gumbo Mix is Displayed ([Click to view full-size image](limiting-data-modification-functionality-based-on-the-user-vb/_static/image45.png))</span></span>


## <a name="checking-for-access-rights-in-the-business-logic-layer"></a><span data-ttu-id="f0d76-253">檢查商務邏輯層中的存取權限</span><span class="sxs-lookup"><span data-stu-id="f0d76-253">Checking for Access Rights in the Business Logic Layer</span></span>

<span data-ttu-id="f0d76-254">在本教學課程將 ASP.NET 頁面會處理使用者可以看到哪些資訊與所有邏輯而且他可以更新哪些產品。</span><span class="sxs-lookup"><span data-stu-id="f0d76-254">In this tutorial the ASP.NET page handles all logic with regards to what information the user can see and what products he can update.</span></span> <span data-ttu-id="f0d76-255">在理想情況下，這個邏輯也會出現在商務邏輯層。</span><span class="sxs-lookup"><span data-stu-id="f0d76-255">Ideally, this logic would also be present at the Business Logic Layer.</span></span> <span data-ttu-id="f0d76-256">例如，`SuppliersBLL`類別 s`GetSuppliers()`方法 （可傳回所有供應商） 可能會包含檢查，以確定目前登入的使用者是*不*特定供應商相關聯。</span><span class="sxs-lookup"><span data-stu-id="f0d76-256">For example, the `SuppliersBLL` class s `GetSuppliers()` method (which returns all suppliers) might include a check to ensure that the currently logged on user is *not* associated with a specific supplier.</span></span> <span data-ttu-id="f0d76-257">同樣地，`UpdateSupplierAddress`方法可能包括檢查，以確認目前登入的使用者是本公司的工作 （及可以更新所有供應商的位址資訊） 或其資料正在更新供應商相關聯。</span><span class="sxs-lookup"><span data-stu-id="f0d76-257">Likewise, the `UpdateSupplierAddress` method could include a check to ensure that the currently logged on user either worked for our company (and therefore can update all suppliers address information) or is associated with the supplier whose data is being updated.</span></span>

<span data-ttu-id="f0d76-258">因為在我們的教學課程中，使用者 s 權限由在頁面上，無法存取 BLL 類別 DropDownList 我不包含這類 BLL 層檢查。</span><span class="sxs-lookup"><span data-stu-id="f0d76-258">I did not include such BLL-layer checks here because in our tutorial the user s rights are determined by a DropDownList on the page, which the BLL classes cannot access.</span></span> <span data-ttu-id="f0d76-259">使用成員資格系統，或其中一個 （例如 Windows 驗證），ASP.NET 所提供的方塊外的驗證配置時目前登入的使用者的資訊及角色資訊可從存取 BLL，因此這類存取權限檢查可能在簡報和 BLL 圖層。</span><span class="sxs-lookup"><span data-stu-id="f0d76-259">When using the membership system or one of the out-of-the box authentication schemes provided by ASP.NET (such as Windows authentication), the currently logged on user s information and roles information can be accessed from the BLL, thereby making such access rights checks possible at both the presentation and BLL layers.</span></span>

## <a name="summary"></a><span data-ttu-id="f0d76-260">總結</span><span class="sxs-lookup"><span data-stu-id="f0d76-260">Summary</span></span>

<span data-ttu-id="f0d76-261">提供使用者帳戶的大部分站台需要自訂登入的使用者為基礎的資料修改介面。</span><span class="sxs-lookup"><span data-stu-id="f0d76-261">Most sites that provide user accounts need to customize the data modification interface based upon the logged in user.</span></span> <span data-ttu-id="f0d76-262">系統管理使用者可以刪除和編輯任何筆記錄，而非系統管理使用者可能會限制為僅更新或刪除自己建立的記錄。</span><span class="sxs-lookup"><span data-stu-id="f0d76-262">Administrative users may be able to delete and edit any record, whereas non-administrative users may be limited to only updating or deleting records they created themselves.</span></span> <span data-ttu-id="f0d76-263">任何案例可能是，Web 控制項，ObjectDataSource，資料和商務邏輯層類別可以擴充來新增或拒絕登入的使用者為基礎的特定功能。</span><span class="sxs-lookup"><span data-stu-id="f0d76-263">Whatever the scenario may be, the data Web controls, ObjectDataSource, and Business Logic Layer classes can be extended to add or deny certain functionality based on the logged on user.</span></span> <span data-ttu-id="f0d76-264">在本教學課程中，我們看到如何限制根據使用者是否為特定供應商相關聯，或如果他們的工作我們公司的檢視和編輯資料。</span><span class="sxs-lookup"><span data-stu-id="f0d76-264">In this tutorial we saw how to limit the viewable and editable data depending on whether the user was associated with a particular supplier or if they worked for our company.</span></span>

<span data-ttu-id="f0d76-265">本教學課程結束時，我們檢驗插入、 更新和刪除使用 GridView、 DetailsView 和 FormView 控制項的資料。</span><span class="sxs-lookup"><span data-stu-id="f0d76-265">This tutorial concludes our examination of inserting, updating, and deleting data using the GridView, DetailsView, and FormView controls.</span></span> <span data-ttu-id="f0d76-266">從開始下一個教學課程，我們將會開啟我們注意到新增分頁和排序的支援。</span><span class="sxs-lookup"><span data-stu-id="f0d76-266">Starting with the next tutorial, we'll turn our attention to adding paging and sorting support.</span></span>

<span data-ttu-id="f0d76-267">祝您程式設計 ！</span><span class="sxs-lookup"><span data-stu-id="f0d76-267">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="f0d76-268">關於作者</span><span class="sxs-lookup"><span data-stu-id="f0d76-268">About the Author</span></span>

<span data-ttu-id="f0d76-269">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP/ASP.NET 書籍和的創辦[4GuysFromRolla.com](http://www.4guysfromrolla.com)，已從 1998 年使用 Microsoft Web 技術。</span><span class="sxs-lookup"><span data-stu-id="f0d76-269">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="f0d76-270">Scott 可做為獨立顧問、 訓練和寫入器。</span><span class="sxs-lookup"><span data-stu-id="f0d76-270">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="f0d76-271">他最新的活頁簿[ *Sam 教導您自己 ASP.NET 2.0 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="f0d76-271">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="f0d76-272">他可以在達到[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)或透過他的部落格，這可以在找到[ http://ScottOnWriting.NET ](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="f0d76-272">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="f0d76-273">上一步</span><span class="sxs-lookup"><span data-stu-id="f0d76-273">Previous</span></span>](adding-client-side-confirmation-when-deleting-vb.md)
