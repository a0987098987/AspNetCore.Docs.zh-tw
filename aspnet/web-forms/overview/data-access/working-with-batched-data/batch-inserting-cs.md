---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
title: 批次插入 (C#) |Microsoft Docs
author: rick-anderson
description: 了解如何在單一作業中插入多個資料庫的記錄。 在使用者介面層，我們會擴充以允許使用者輸入多個 n GridView...
ms.author: riande
ms.date: 06/26/2007
ms.assetid: cf025e08-48fc-4385-b176-8610aa7b5565
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-cs
msc.type: authoredcontent
ms.openlocfilehash: 561acc9b473bac7d39e7ed4d511d8b979657131d
ms.sourcegitcommit: 45ac74e400f9f2b7dbded66297730f6f14a4eb25
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 08/16/2018
ms.locfileid: "41824952"
---
<a name="batch-inserting-c"></a><span data-ttu-id="89433-104">批次插入 (C#)</span><span class="sxs-lookup"><span data-stu-id="89433-104">Batch Inserting (C#)</span></span>
====================
<span data-ttu-id="89433-105">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="89433-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="89433-106">[下載程式碼](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip)或[下載 PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="89433-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_CS.zip) or [Download PDF](batch-inserting-cs/_static/datatutorial66cs1.pdf)</span></span>

> <span data-ttu-id="89433-107">了解如何在單一作業中插入多個資料庫的記錄。</span><span class="sxs-lookup"><span data-stu-id="89433-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="89433-108">在使用者介面層，我們會擴充 GridView，以允許使用者輸入多個新的記錄。</span><span class="sxs-lookup"><span data-stu-id="89433-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="89433-109">資料存取層中，我們換行以確保所有插入作業成功，或所有插入作業會回復在交易內的多個 Insert 作業的內容。</span><span class="sxs-lookup"><span data-stu-id="89433-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>


## <a name="introduction"></a><span data-ttu-id="89433-110">簡介</span><span class="sxs-lookup"><span data-stu-id="89433-110">Introduction</span></span>

<span data-ttu-id="89433-111">在 [批次更新](batch-updating-cs.md)教學課程中我們探討了自訂 GridView 控制項來呈現可編輯多筆記錄所在的介面。</span><span class="sxs-lookup"><span data-stu-id="89433-111">In the [Batch Updating](batch-updating-cs.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="89433-112">瀏覽頁面的使用者無法進行一系列的變更，然後，使用單一按鈕點選，執行批次更新。</span><span class="sxs-lookup"><span data-stu-id="89433-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="89433-113">針對使用者經常更新一次的多筆記錄的情況下，這類介面可以節省無數的按下滑鼠和鍵盤-滑鼠內容切換，相較於預設每個資料列編輯功能，已先瀏覽回到[插入、 更新和刪除資料的概觀](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="89433-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md) tutorial.</span></span>

<span data-ttu-id="89433-114">新增記錄時，也可以套用這個概念。</span><span class="sxs-lookup"><span data-stu-id="89433-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="89433-115">想像一下，這裡 Northwind traders 我們常收到寄送包含許多特定類別的產品的供應商。</span><span class="sxs-lookup"><span data-stu-id="89433-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="89433-116">例如，我們可能會收到東京 Traders 六個不同的茶和 coffee 產品的出貨。</span><span class="sxs-lookup"><span data-stu-id="89433-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="89433-117">如果使用者輸入六個產品一次透過 DetailsView 控制項，它們必須不斷地選擇許多相同的值： 他們需要選擇相同的類別目錄 （飲料），相同的供應商 (東京 Traders)、 已停止的相同值 （False)，和相同的單位，順序值 (0)。</span><span class="sxs-lookup"><span data-stu-id="89433-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="89433-118">這個重複的資料項目不只會耗費時間，但很容易發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="89433-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="89433-119">我們可以很輕鬆地建立批次插入介面，可讓使用者選擇的供應商和類別目錄一次，輸入一系列的產品名稱和單價，，然後按一下 加入資料庫中的新產品的按鈕 （請參閱 圖 1）。</span><span class="sxs-lookup"><span data-stu-id="89433-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="89433-120">增加每個產品，其`ProductName`並`UnitPrice`資料欄位指派的文字方塊中輸入的值時其`CategoryID`和`SupplierID`值從在最上層的表單 fo dropdownlist 進行指派的值。</span><span class="sxs-lookup"><span data-stu-id="89433-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="89433-121">`Discontinued`並`UnitsOnOrder`值都會設為硬式編碼值`false`和 0，分別。</span><span class="sxs-lookup"><span data-stu-id="89433-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `false` and 0, respectively.</span></span>


<span data-ttu-id="89433-122">[![批次插入介面](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="89433-122">[![The Batch Inserting Interface](batch-inserting-cs/_static/image2.png)](batch-inserting-cs/_static/image1.png)</span></span>

<span data-ttu-id="89433-123">**圖 1**: 批次插入介面 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="89433-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-cs/_static/image3.png))</span></span>


<span data-ttu-id="89433-124">在本教學課程中，我們將建立會實作批次插入介面 [圖 1] 所示的頁面。</span><span class="sxs-lookup"><span data-stu-id="89433-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="89433-125">為先前的兩個教學課程中，我們會確保不可部分完成交易範圍內包裝插入。</span><span class="sxs-lookup"><span data-stu-id="89433-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="89433-126">讓 s 開始 ！</span><span class="sxs-lookup"><span data-stu-id="89433-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="89433-127">步驟 1： 建立顯示介面</span><span class="sxs-lookup"><span data-stu-id="89433-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="89433-128">本教學課程會組成的單一頁面分為兩個區域： 顯示區域和插入的區域。</span><span class="sxs-lookup"><span data-stu-id="89433-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="89433-129">顯示介面，我們將建立在此步驟中，在 GridView 中顯示的產品，並包含標題為處理程序產品出貨的按鈕。</span><span class="sxs-lookup"><span data-stu-id="89433-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="89433-130">按一下此按鈕時，就會顯示介面取代插入介面後，圖 1 所示。</span><span class="sxs-lookup"><span data-stu-id="89433-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="89433-131">顯示介面傳回之後新增的產品出貨，或按一下 [取消] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="89433-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="89433-132">我們將在步驟 2 中建立的插入的介面。</span><span class="sxs-lookup"><span data-stu-id="89433-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="89433-133">當建立頁面有兩個介面，其中只有一個會顯示一次，每個介面通常會放置內[面板 Web 控制項](http://www.w3schools.com/aspnet/control_panel.asp)，做為其他控制項的容器。</span><span class="sxs-lookup"><span data-stu-id="89433-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="89433-134">因此，我們的頁面上會有兩個面板控制項一個針對每個介面。</span><span class="sxs-lookup"><span data-stu-id="89433-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="89433-135">首先開啟`BatchInsert.aspx`頁面中`BatchData`資料夾，然後從 工具箱 拖曳至設計工具拖曳面板 （請參閱 圖 2）。</span><span class="sxs-lookup"><span data-stu-id="89433-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="89433-136">設定面板 s`ID`屬性設`DisplayInterface`。</span><span class="sxs-lookup"><span data-stu-id="89433-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="89433-137">當將面板加入至設計工具中，其`Height`和`Width`屬性分別設定為 50px 和 125px。</span><span class="sxs-lookup"><span data-stu-id="89433-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="89433-138">清除這些屬性值，從 [屬性] 視窗。</span><span class="sxs-lookup"><span data-stu-id="89433-138">Clear out these property values from the Properties window.</span></span>


<span data-ttu-id="89433-139">[![從 [工具箱] 拖曳至設計工具拖曳面板](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="89433-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-cs/_static/image5.png)](batch-inserting-cs/_static/image4.png)</span></span>

<span data-ttu-id="89433-140">**圖 2**： 從 [工具箱] 拖曳至設計工具拖曳面板 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="89433-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-cs/_static/image6.png))</span></span>


<span data-ttu-id="89433-141">接下來，將按鈕和 GridView 控制項拖曳到 [面板] 中。</span><span class="sxs-lookup"><span data-stu-id="89433-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="89433-142">設定 [s] 按鈕`ID`屬性，以`ProcessShipment`及其`Text`程序產品出貨的屬性。</span><span class="sxs-lookup"><span data-stu-id="89433-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="89433-143">設定 GridView s`ID`屬性，以`ProductsGrid`和它的智慧標籤，從繫結至名為新 ObjectDataSource `ProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="89433-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="89433-144">設定提取其資料從 ObjectDataSource`ProductsBLL`類別的`GetProducts`方法。</span><span class="sxs-lookup"><span data-stu-id="89433-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="89433-145">因為此 GridView 只用於顯示資料，設定下拉式清單中更新、 插入和刪除為 [（無）] 索引標籤。</span><span class="sxs-lookup"><span data-stu-id="89433-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="89433-146">按一下 完成 以完成設定資料來源精靈。</span><span class="sxs-lookup"><span data-stu-id="89433-146">Click Finish to complete the Configure Data Source wizard.</span></span>


<span data-ttu-id="89433-147">[![顯示從 ProductsBLL 類別的 GetProducts 方法傳回的資料](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="89433-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-cs/_static/image8.png)](batch-inserting-cs/_static/image7.png)</span></span>

<span data-ttu-id="89433-148">**圖 3**： 顯示從傳回的資料`ProductsBLL`類別 s`GetProducts`方法 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="89433-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-cs/_static/image9.png))</span></span>


<span data-ttu-id="89433-149">[![設定下拉式清單中更新、 插入和刪除 （無） 索引標籤](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="89433-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-cs/_static/image11.png)](batch-inserting-cs/_static/image10.png)</span></span>

<span data-ttu-id="89433-150">**圖 4**： 設定下拉式清單中更新、 插入和刪除索引標籤為 （無） ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="89433-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-cs/_static/image12.png))</span></span>


<span data-ttu-id="89433-151">完成 ObjectDataSource 精靈之後，Visual Studio 會將 BoundFields 及其產品資料欄位。</span><span class="sxs-lookup"><span data-stu-id="89433-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="89433-152">移除以外的所有`ProductName`， `CategoryName`， `SupplierName`， `UnitPrice`，和`Discontinued`欄位。</span><span class="sxs-lookup"><span data-stu-id="89433-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="89433-153">隨意美觀的任何自訂。</span><span class="sxs-lookup"><span data-stu-id="89433-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="89433-154">我決定來格式化`UnitPrice`欄位為貨幣值時，重新排列欄位，並重新命名數個欄位`HeaderText`值。</span><span class="sxs-lookup"><span data-stu-id="89433-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="89433-155">也設定 GridView，以包含分頁和排序支援，藉由檢查 GridView s 智慧標籤啟用分頁，並按一下 啟用排序核取方塊。</span><span class="sxs-lookup"><span data-stu-id="89433-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="89433-156">加入面板、 按鈕、 GridView 和 ObjectDataSource 控制項，並自訂 GridView 的欄位之後, 您頁面 s 宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="89433-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](batch-inserting-cs/samples/sample1.aspx)]

<span data-ttu-id="89433-157">請注意，按鈕和 GridView 的標記出現在開頭和結尾`<asp:Panel>`標記。</span><span class="sxs-lookup"><span data-stu-id="89433-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="89433-158">因為這些控制項全都位於`DisplayInterface`面板中，我們可以隱藏它們只需要設定 [s] 面板`Visible`屬性設`false`。</span><span class="sxs-lookup"><span data-stu-id="89433-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `false`.</span></span> <span data-ttu-id="89433-159">步驟 3 會查看以程式設計方式變更面板的`Visible`屬性，以回應按鈕按一下以顯示一個介面，同時隱藏其他。</span><span class="sxs-lookup"><span data-stu-id="89433-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="89433-160">請花一點時間檢閱我們透過瀏覽器的進度。</span><span class="sxs-lookup"><span data-stu-id="89433-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="89433-161">如 圖 5 所示，您應該會看到上述的 GridView 會列出產品 10 次的程序產品出貨 按鈕。</span><span class="sxs-lookup"><span data-stu-id="89433-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>


<span data-ttu-id="89433-162">[![GridView 列出產品，並提供排序和分頁功能](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="89433-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-cs/_static/image14.png)](batch-inserting-cs/_static/image13.png)</span></span>

<span data-ttu-id="89433-163">**圖 5**: GridView 列出的產品和提供排序和分頁功能 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="89433-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-cs/_static/image15.png))</span></span>


## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="89433-164">步驟 2： 建立插入介面</span><span class="sxs-lookup"><span data-stu-id="89433-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="89433-165">顯示介面完成後，我們準備好建立插入的介面。</span><span class="sxs-lookup"><span data-stu-id="89433-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="89433-166">本教學課程中，讓建立插入介面提示您輸入單一的供應商和類別值，然後可讓使用者輸入最多五個產品名稱和單位價格值。</span><span class="sxs-lookup"><span data-stu-id="89433-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="89433-167">使用這個介面，使用者可以新增一到五個新產品的所有共用相同的類別和供應商，但擁有唯一的產品名稱和價格。</span><span class="sxs-lookup"><span data-stu-id="89433-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="89433-168">開始從工具箱拖曳至設計工具中，將它放在下方現有拖曳面板`DisplayInterface`面板。</span><span class="sxs-lookup"><span data-stu-id="89433-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="89433-169">設定`ID`屬性的新加入的面板`InsertingInterface`並設定其`Visible`屬性設`false`。</span><span class="sxs-lookup"><span data-stu-id="89433-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `false`.</span></span> <span data-ttu-id="89433-170">我們將新增程式碼，以設定`InsertingInterface`面板 s`Visible`屬性設`true`在步驟 3 中。</span><span class="sxs-lookup"><span data-stu-id="89433-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `true` in Step 3.</span></span> <span data-ttu-id="89433-171">也會清除面板 s`Height`和`Width`屬性值。</span><span class="sxs-lookup"><span data-stu-id="89433-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="89433-172">接下來，我們需要建立可在 圖 1 所示的插入介面。</span><span class="sxs-lookup"><span data-stu-id="89433-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="89433-173">您可以透過各種不同的 HTML 的技術，建立此介面，但我們將使用一個相當簡單： 四個資料行中，七個資料列的資料表。</span><span class="sxs-lookup"><span data-stu-id="89433-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="89433-174">輸入標記的 HTML 時`<table>`項目，我想要使用的來源檢視。</span><span class="sxs-lookup"><span data-stu-id="89433-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="89433-175">雖然 Visual Studio 沒有新增的工具`<table>`透過設計工具的項目，設計工具似乎所有太願意將如蠢`style`到標記的設定。</span><span class="sxs-lookup"><span data-stu-id="89433-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="89433-176">當我建立`<table>`標記中，我通常返回設計工具來新增 Web 控制項，並設定其屬性。</span><span class="sxs-lookup"><span data-stu-id="89433-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="89433-177">建立具有預先決定的資料行和資料列的資料表時我比較喜歡用靜態 HTML 而非[資料表 Web 控制項](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx)因為任何放置在資料表 Web 控制項內的 Web 控制項只能存取使用`FindControl("controlID")`模式。</span><span class="sxs-lookup"><span data-stu-id="89433-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="89433-178">我，不過，使用資料表 Web 控制項的動態調整大小的資料表 （而是其資料列或資料行根據部分資料庫或使用者指定的準則），因為資料表 Web 控制項可以用來以程式設計方式建構。</span><span class="sxs-lookup"><span data-stu-id="89433-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>


<span data-ttu-id="89433-179">輸入下列標記內`<asp:Panel>`標記`InsertingInterface`面板：</span><span class="sxs-lookup"><span data-stu-id="89433-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>


[!code-html[Main](batch-inserting-cs/samples/sample2.html)]

<span data-ttu-id="89433-180">這`<table>`標記不包含任何 Web 控制項，但我們會將這些新增立刻顯示。</span><span class="sxs-lookup"><span data-stu-id="89433-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="89433-181">請注意，每個`<tr>`項目包含特定的 CSS 類別設定：`BatchInsertHeaderRow`標頭資料列的供應商和類別目錄 dropdownlist 進行位置;`BatchInsertFooterRow`新增的產品出貨和取消按鈕位置; 頁尾資料列和替代`BatchInsertRow`和`BatchInsertAlternatingRow`值的資料列將包含產品和單位價格文字方塊控制項。</span><span class="sxs-lookup"><span data-stu-id="89433-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="89433-182">我已建立對應的 CSS 類別，在`Styles.css`檔案，以提供插入介面外觀類似的 GridView 和 DetailsView 控制項我們已在整個這些教學課程中使用。</span><span class="sxs-lookup"><span data-stu-id="89433-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="89433-183">這些的 CSS 類別如下所示。</span><span class="sxs-lookup"><span data-stu-id="89433-183">These CSS classes are shown below.</span></span>


[!code-css[Main](batch-inserting-cs/samples/sample3.css)]

<span data-ttu-id="89433-184">此標記中，輸入，以返回 [設計] 檢視。</span><span class="sxs-lookup"><span data-stu-id="89433-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="89433-185">這`<table>`應該要顯示的四個資料行中，七個資料列的資料表，在設計師中，如 圖 6 所示。</span><span class="sxs-lookup"><span data-stu-id="89433-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>


<span data-ttu-id="89433-186">[![插入介面由所組成的四資料行，七個資料列的資料表](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="89433-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-cs/_static/image17.png)](batch-inserting-cs/_static/image16.png)</span></span>

<span data-ttu-id="89433-187">**圖 6**: 插入介面由所組成的四資料行，七個資料列的資料表 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="89433-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-cs/_static/image18.png))</span></span>


<span data-ttu-id="89433-188">我們重新現在已準備好將 Web 控制項新增至插入的介面。</span><span class="sxs-lookup"><span data-stu-id="89433-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="89433-189">從 [工具箱] 將兩個 dropdownlist 進行拖曳表其中一個用於供應商，一個用於類別目錄中適當的資料格。</span><span class="sxs-lookup"><span data-stu-id="89433-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="89433-190">設定供應商 DropDownList s`ID`屬性，以`Suppliers`並將它繫結至名為新 ObjectDataSource `SuppliersDataSource`。</span><span class="sxs-lookup"><span data-stu-id="89433-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="89433-191">設定要擷取其資料的新 ObjectDataSource`SuppliersBLL`類別的`GetSuppliers`方法，並設定更新索引標籤為 （無） s 下拉式清單。</span><span class="sxs-lookup"><span data-stu-id="89433-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="89433-192">按一下 完成 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="89433-192">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="89433-193">[![設定為使用 SuppliersBLL 類別的 GetSuppliers 方法的 ObjectDataSource](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="89433-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-cs/_static/image20.png)](batch-inserting-cs/_static/image19.png)</span></span>

<span data-ttu-id="89433-194">**圖 7**： 設定要使用 ObjectDataSource`SuppliersBLL`類別 s`GetSuppliers`方法 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="89433-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-cs/_static/image21.png))</span></span>


<span data-ttu-id="89433-195">已`Suppliers`DropDownList 顯示器`CompanyName`資料欄位並使用`SupplierID`資料欄位做為其`ListItem`的值。</span><span class="sxs-lookup"><span data-stu-id="89433-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>


<span data-ttu-id="89433-196">[![顯示 供應商資料欄位和 SupplierID 做為值](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="89433-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-cs/_static/image23.png)](batch-inserting-cs/_static/image22.png)</span></span>

<span data-ttu-id="89433-197">**圖 8**： 顯示`CompanyName`資料欄位並使用`SupplierID`做為值 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="89433-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-cs/_static/image24.png))</span></span>


<span data-ttu-id="89433-198">命名第二個 DropDownList`Categories`並將它繫結至名為新 ObjectDataSource `CategoriesDataSource`。</span><span class="sxs-lookup"><span data-stu-id="89433-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="89433-199">設定`CategoriesDataSource`若要使用的 ObjectDataSource`CategoriesBLL`類別的`GetCategories`方法; 設定下拉式清單會列出在 更新和刪除的索引標籤，為 （無），然後按一下 完成 以完成精靈。</span><span class="sxs-lookup"><span data-stu-id="89433-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="89433-200">最後，有 DropDownList 顯示器`CategoryName`資料欄位並使用`CategoryID`做為值。</span><span class="sxs-lookup"><span data-stu-id="89433-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="89433-201">已新增並繫結至適當地設定 ObjectDataSources 這些兩個 dropdownlist 進行之後，您的畫面看起來應該類似於 圖 9。</span><span class="sxs-lookup"><span data-stu-id="89433-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>


<span data-ttu-id="89433-202">[![標頭資料列現在包含供應商和類別 dropdownlist 進行](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="89433-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-cs/_static/image26.png)](batch-inserting-cs/_static/image25.png)</span></span>

<span data-ttu-id="89433-203">**圖 9**: 標頭資料列現在包含`Suppliers`並`Categories`dropdownlist 進行 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="89433-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-cs/_static/image27.png))</span></span>


<span data-ttu-id="89433-204">我們現在需要建立文字方塊來收集每個新的產品價格與名稱。</span><span class="sxs-lookup"><span data-stu-id="89433-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="89433-205">將 TextBox 控制項從 [工具箱] 拖曳至設計工具拖曳每五個產品名稱和價格資料列。</span><span class="sxs-lookup"><span data-stu-id="89433-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="89433-206">設定`ID`屬性的文字方塊來`ProductName1`， `UnitPrice1`， `ProductName2`， `UnitPrice2`， `ProductName3`， `UnitPrice3`，依此類推。</span><span class="sxs-lookup"><span data-stu-id="89433-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="89433-207">在每個單位價格文字方塊中，設定新增 CompareValidator`ControlToValidate`屬性為適當`ID`。</span><span class="sxs-lookup"><span data-stu-id="89433-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="89433-208">Ssprop_param_table_default`Operator`屬性，以`GreaterThanEqual`，`ValueToCompare`為 0，和`Type`到`Currency`。</span><span class="sxs-lookup"><span data-stu-id="89433-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="89433-209">這些設定會指示 CompareValidator，以確保價格中，如果輸入有效的貨幣值大於或等於零，這個值。</span><span class="sxs-lookup"><span data-stu-id="89433-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="89433-210">設定`Text`屬性，以\*，和`ErrorMessage`價格必須大於或等於零。</span><span class="sxs-lookup"><span data-stu-id="89433-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="89433-211">此外，請省略任何貨幣符號。</span><span class="sxs-lookup"><span data-stu-id="89433-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="89433-212">插入介面並未包含任何 RequiredFieldValidator 控制項，即使`ProductName`欄位中`Products`資料庫資料表不允許`NULL`值。</span><span class="sxs-lookup"><span data-stu-id="89433-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="89433-213">這是因為我們想要讓使用者輸入最多五個產品。</span><span class="sxs-lookup"><span data-stu-id="89433-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="89433-214">比方說，如果使用者提供的產品名稱和單位價格的前三個資料列，將最後兩個資料列留為空白，我們的 d 加入三個新的產品系統。</span><span class="sxs-lookup"><span data-stu-id="89433-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="89433-215">因為`ProductName`是必要，不過，我們必須以程式設計方式檢查，確保當單價輸入，提供對應的產品名稱值。</span><span class="sxs-lookup"><span data-stu-id="89433-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="89433-216">我們將會處理在步驟 4 中的這項檢查。</span><span class="sxs-lookup"><span data-stu-id="89433-216">We'll tackle this check in Step 4.</span></span>


<span data-ttu-id="89433-217">當驗證的使用者的輸入，CompareValidator 會報告無效的資料，如果值包含貨幣符號。</span><span class="sxs-lookup"><span data-stu-id="89433-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="89433-218">新增 $ 前面每單位價格做為視覺提示，指示使用者輸入價格時省略的貨幣符號的文字方塊。</span><span class="sxs-lookup"><span data-stu-id="89433-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="89433-219">最後，將 ValidationSummary 控制項內新增`InsertingInterface`面板中，設定其`ShowMessageBox`屬性設`true`及其`ShowSummary`屬性設`false`。</span><span class="sxs-lookup"><span data-stu-id="89433-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `true` and its `ShowSummary` property to `false`.</span></span> <span data-ttu-id="89433-220">使用這些設定，如果使用者輸入無效的單位價格值，星號就會顯示違規的 TextBox 控制項旁邊，ValidationSummary 會顯示用戶端訊息方塊會顯示我們稍早指定的錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="89433-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="89433-221">此時，您的畫面應該看起來類似 圖 10。</span><span class="sxs-lookup"><span data-stu-id="89433-221">At this point, your screen should look similar to Figure 10.</span></span>


<span data-ttu-id="89433-222">[![插入介面現在包含文字方塊的產品名稱和價格](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="89433-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-cs/_static/image29.png)](batch-inserting-cs/_static/image28.png)</span></span>

<span data-ttu-id="89433-223">**圖 10**: 插入介面現在包含文字方塊的產品名稱和價格 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="89433-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-cs/_static/image30.png))</span></span>


<span data-ttu-id="89433-224">接下來我們要新增的產品出貨和取消按鈕加入頁尾資料列。</span><span class="sxs-lookup"><span data-stu-id="89433-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="89433-225">將按鈕拖曳兩個控制項從 [工具箱] 的頁尾插入介面中，設定按鈕`ID`屬性，以`AddProducts`並`CancelButton`和`Text`產品出貨與 [取消]，將它分別加入的屬性。</span><span class="sxs-lookup"><span data-stu-id="89433-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="89433-226">此外，設定`CancelButton`控制 s`CausesValidation`屬性設`false`。</span><span class="sxs-lookup"><span data-stu-id="89433-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="89433-227">最後，我們需要新增的標籤 Web 控制項，將會顯示兩個介面的狀態訊息。</span><span class="sxs-lookup"><span data-stu-id="89433-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="89433-228">比方說，當使用者成功地將新的出貨的產品，我們想要傳回以顯示介面，並顯示確認訊息。</span><span class="sxs-lookup"><span data-stu-id="89433-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="89433-229">如果，不過，使用者提供 新的產品，但結束的產品名稱的價格，我們要顯示的警告訊息，因為`ProductName`是必填欄位。</span><span class="sxs-lookup"><span data-stu-id="89433-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="89433-230">因為我們需要針對這兩個介面顯示此訊息，請將它放在外部面板頁面頂端。</span><span class="sxs-lookup"><span data-stu-id="89433-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="89433-231">標籤 Web 控制項從工具箱拖曳至設計工具中頁面的頂端。</span><span class="sxs-lookup"><span data-stu-id="89433-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="89433-232">設定`ID`屬性，以`StatusLabel`，清除出`Text`屬性，並設定`Visible`並`EnableViewState`屬性，以`false`。</span><span class="sxs-lookup"><span data-stu-id="89433-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `false`.</span></span> <span data-ttu-id="89433-233">如我們所見先前教學課程中，設定`EnableViewState`屬性設`false`讓我們能夠以程式設計方式變更標籤的屬性值，並讓它們自動還原成其預設值，在後續的回傳。</span><span class="sxs-lookup"><span data-stu-id="89433-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `false` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="89433-234">這可簡化的程式碼顯示狀態訊息，以在後續的回傳會消失的某些使用者動作的回應。</span><span class="sxs-lookup"><span data-stu-id="89433-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="89433-235">最後，設定`StatusLabel`控制 s`CssClass`為 [警告] 的 CSS 類別名稱的屬性定義於`Styles.css`會以大型、 斜體、 粗體、 紅色字型顯示的文字。</span><span class="sxs-lookup"><span data-stu-id="89433-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="89433-236">圖 11 顯示 Visual Studio 設計工具，標籤已新增並設定之後。</span><span class="sxs-lookup"><span data-stu-id="89433-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>


<span data-ttu-id="89433-237">[![將 statuslabel 設控制項在兩個面板控制項上方放置](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="89433-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-cs/_static/image32.png)](batch-inserting-cs/_static/image31.png)</span></span>

<span data-ttu-id="89433-238">**圖 11**： 的地方`StatusLabel`控制上述兩個面板控制項 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="89433-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-cs/_static/image33.png))</span></span>


## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="89433-239">步驟 3： 顯示之間切換，並插入介面</span><span class="sxs-lookup"><span data-stu-id="89433-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="89433-240">現在我們已完成我們的顯示和插入介面，但我們重新仍處於具有兩個工作的標記：</span><span class="sxs-lookup"><span data-stu-id="89433-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="89433-241">切換顯示和插入介面</span><span class="sxs-lookup"><span data-stu-id="89433-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="89433-242">加入到資料庫次出貨的產品</span><span class="sxs-lookup"><span data-stu-id="89433-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="89433-243">目前，顯示介面會顯示，但是隱藏插入的介面。</span><span class="sxs-lookup"><span data-stu-id="89433-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="89433-244">這是因為`DisplayInterface`面板 s`Visible`屬性設定為`true`（預設值），而`InsertingInterface`面板 s`Visible`屬性設定為`false`。</span><span class="sxs-lookup"><span data-stu-id="89433-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `true` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `false`.</span></span> <span data-ttu-id="89433-245">我們只需要將切換 s 的每個控制項的兩個介面之間切換`Visible`屬性值。</span><span class="sxs-lookup"><span data-stu-id="89433-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="89433-246">我們想要按一下處理程序產品出貨按鈕時，從顯示的介面移至插入的介面。</span><span class="sxs-lookup"><span data-stu-id="89433-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="89433-247">因此，建立事件處理常式，此按鈕 s`Click`事件，其中包含下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="89433-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample4.cs)]

<span data-ttu-id="89433-248">此程式碼只會隱藏`DisplayInterface`面板，並顯示`InsertingInterface`面板。</span><span class="sxs-lookup"><span data-stu-id="89433-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="89433-249">插入介面中的出貨和 [取消] 按鈕控制項中的新增產品，接下來，建立事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="89433-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="89433-250">按一下任一個按鈕時，我們需要回復成顯示介面。</span><span class="sxs-lookup"><span data-stu-id="89433-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="89433-251">建立`Click`兩個事件處理常式按鈕控制項，好讓它們呼叫`ReturnToDisplayInterface`，我們會暫時新增的方法。</span><span class="sxs-lookup"><span data-stu-id="89433-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="89433-252">除了隱藏`InsertingInterface`面板，並顯示`DisplayInterface` 面板中，`ReturnToDisplayInterface`方法需要傳回 Web 控制項為其預先編輯的狀態。</span><span class="sxs-lookup"><span data-stu-id="89433-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="89433-253">這需要設定 dropdownlist 進行`SelectedIndex`屬性為 0，而且清除`Text`文字方塊控制項的屬性。</span><span class="sxs-lookup"><span data-stu-id="89433-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="89433-254">請考慮可能會發生什麼事如果我們嘛 t 回復到其預先編輯狀態控制項，然後再回到 顯示介面。</span><span class="sxs-lookup"><span data-stu-id="89433-254">Consider what might happen if we didn t return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="89433-255">使用者可能按一下處理程序產品出貨] 按鈕，輸入的產品出貨，，然後按一下 [新增出貨的產品。</span><span class="sxs-lookup"><span data-stu-id="89433-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="89433-256">這會將產品加入，並返回顯示介面中的使用者。</span><span class="sxs-lookup"><span data-stu-id="89433-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="89433-257">此時使用者可能會想要新增另一個出貨。</span><span class="sxs-lookup"><span data-stu-id="89433-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="89433-258">按一下 [處理程序產品出貨] 按鈕就會傳回插入的介面，但 DropDownList 選取項目和文字方塊值會仍填入其先前的值。</span><span class="sxs-lookup"><span data-stu-id="89433-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample5.cs)]

<span data-ttu-id="89433-259">兩者`Click`只要呼叫事件處理常式`ReturnToDisplayInterface`方法，雖然我們會返回新增的產品出貨從`Click`事件處理常式，在步驟 4，並加入程式碼來儲存產品。</span><span class="sxs-lookup"><span data-stu-id="89433-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="89433-260">`ReturnToDisplayInterface` 一開始會傳回`Suppliers`和`Categories`dropdownlist 進行其第一個選項。</span><span class="sxs-lookup"><span data-stu-id="89433-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="89433-261">兩個常數`firstControlID`並`lastControlID`標記的起始和結束用來命名的產品名稱和單位價格中插入文字方塊介面，並使用的界限內的控制項索引值`for`設定的迴圈`Text`文字方塊控制項的屬性後為空字串。</span><span class="sxs-lookup"><span data-stu-id="89433-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `for` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="89433-262">最後，面板`Visible`屬性重設，以便隱藏插入的介面和顯示介面所示。</span><span class="sxs-lookup"><span data-stu-id="89433-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="89433-263">請花一點時間來測試此頁面在瀏覽器中。</span><span class="sxs-lookup"><span data-stu-id="89433-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="89433-264">第一次造訪網頁時應該會看到顯示介面，如 [圖 5] 顯示中。</span><span class="sxs-lookup"><span data-stu-id="89433-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="89433-265">按一下 [處理程序產品出貨] 按鈕。</span><span class="sxs-lookup"><span data-stu-id="89433-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="89433-266">頁面會回傳，您現在應該看到插入的介面，如 圖 12 所示。</span><span class="sxs-lookup"><span data-stu-id="89433-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="89433-267">按一下任一個新增的產品出貨 或 取消 按鈕返回顯示介面。</span><span class="sxs-lookup"><span data-stu-id="89433-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="89433-268">檢視時插入的介面，請花一點時間來測試 CompareValidators 單價的文字方塊上。</span><span class="sxs-lookup"><span data-stu-id="89433-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="89433-269">您應該會看到用戶端 messagebox 時按一下 新增產品出貨按鈕具有無效的貨幣值或值小於零的價格從出現的警告。</span><span class="sxs-lookup"><span data-stu-id="89433-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>


<span data-ttu-id="89433-270">[![按一下處理程序的產品出貨按鈕後顯示插入介面](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="89433-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-cs/_static/image35.png)](batch-inserting-cs/_static/image34.png)</span></span>

<span data-ttu-id="89433-271">**圖 12**： 按一下處理程序的產品出貨按鈕後顯示的插入介面 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="89433-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-cs/_static/image36.png))</span></span>


## <a name="step-4-adding-the-products"></a><span data-ttu-id="89433-272">步驟 4： 加入產品</span><span class="sxs-lookup"><span data-stu-id="89433-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="89433-273">全部保留本教學課程是要新增的產品中的資料庫中儲存的產品出貨按鈕 s`Click`事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="89433-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="89433-274">這可藉由建立`ProductsDataTable`並新增`ProductsRow`提供的產品名稱的每個執行個體。</span><span class="sxs-lookup"><span data-stu-id="89433-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="89433-275">一次這些`ProductsRow`已加入，我們將呼叫`ProductsBLL`類別 s`UpdateWithTransaction`方法並傳入`ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="89433-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="89433-276">請記得，`UpdateWithTransaction`方法，以建立回到[資料庫修改包裝在交易](wrapping-database-modifications-within-a-transaction-cs.md)教學課程中，傳遞`ProductsDataTable`來`ProductsTableAdapter`s`UpdateWithTransaction`方法。</span><span class="sxs-lookup"><span data-stu-id="89433-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter` s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="89433-277">從該處啟動 ADO.NET 交易和 TableAdatper 問題`INSERT`陳述式之資料庫的每個已加入`ProductsRow`DataTable 中。</span><span class="sxs-lookup"><span data-stu-id="89433-277">From there, an ADO.NET transaction is started and the TableAdatper issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="89433-278">假設所有產品會都加入不會發生錯誤，就會認可交易，否則它會回復。</span><span class="sxs-lookup"><span data-stu-id="89433-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="89433-279">出貨按鈕 s 中的新增產品的程式碼`Click`事件處理常式也需要執行一些錯誤檢查。</span><span class="sxs-lookup"><span data-stu-id="89433-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="89433-280">因為沒有用於插入介面沒有 RequiredFieldValidators，使用者無法輸入價格的產品時省略其名稱。</span><span class="sxs-lookup"><span data-stu-id="89433-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="89433-281">因為產品的名稱是必要的如果事件發生這種情況我們需要提醒使用者並不會進行插入。</span><span class="sxs-lookup"><span data-stu-id="89433-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="89433-282">完整`Click`事件處理常式程式碼如下：</span><span class="sxs-lookup"><span data-stu-id="89433-282">The complete `Click` event handler code follows:</span></span>


[!code-csharp[Main](batch-inserting-cs/samples/sample6.cs)]

<span data-ttu-id="89433-283">事件處理常式一開始會確保`Page.IsValid`屬性傳回的值`true`。</span><span class="sxs-lookup"><span data-stu-id="89433-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `true`.</span></span> <span data-ttu-id="89433-284">如果它傳回`false`，然後這表示一個或多個 CompareValidators 報告無效的資料; 在此情況下我們不想要嘗試插入輸入的產品或就會出現的例外狀況時嘗試指派的使用者輸入的單價值`ProductsRow`s`UnitPrice`屬性。</span><span class="sxs-lookup"><span data-stu-id="89433-284">If it returns `false`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="89433-285">接下來，新`ProductsDataTable`會建立執行個體 (`products`)。</span><span class="sxs-lookup"><span data-stu-id="89433-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="89433-286">A`for`迴圈來逐一查看的產品名稱和單位價格的文字方塊和`Text`屬性會讀取至區域變數`productName`和`unitPrice`。</span><span class="sxs-lookup"><span data-stu-id="89433-286">A `for` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="89433-287">如果使用者輸入值的單位價格但沒有對應的產品名稱，`StatusLabel`顯示訊息，如果您提供一個單位價格，您也必須包含的產品名稱和結束事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="89433-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="89433-288">如果未提供的產品名稱，新`ProductsRow`執行個體使用建立`ProductsDataTable`s`NewProductsRow`方法。</span><span class="sxs-lookup"><span data-stu-id="89433-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="89433-289">這個新`ProductsRow`執行個體 s`ProductName`屬性設定為目前的產品名稱時的文字方塊`SupplierID`並`CategoryID`屬性指派給`SelectedValue`dropdownlist 進行插入介面 s 標頭中的屬性。</span><span class="sxs-lookup"><span data-stu-id="89433-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="89433-290">如果使用者輸入的產品的價格的值，將它指派給`ProductsRow`執行個體 s`UnitPrice`屬性; 否則屬性是左側未指定，這會導致`NULL`值`UnitPrice`資料庫中。</span><span class="sxs-lookup"><span data-stu-id="89433-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="89433-291">最後，`Discontinued`並`UnitsOnOrder`屬性會指派為硬式編碼值`false`和 0，分別。</span><span class="sxs-lookup"><span data-stu-id="89433-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `false` and 0, respectively.</span></span>

<span data-ttu-id="89433-292">屬性已指派給之後`ProductsRow`執行個體，它會新增至`ProductsDataTable`。</span><span class="sxs-lookup"><span data-stu-id="89433-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="89433-293">在完成`for`迴圈中，我們會檢查是否已新增的任何產品。</span><span class="sxs-lookup"><span data-stu-id="89433-293">At the completion of the `for` loop, we check whether any products have been added.</span></span> <span data-ttu-id="89433-294">使用者可能在所有情況下，按一下新增的產品出貨之前輸入的任何產品名稱或價格。</span><span class="sxs-lookup"><span data-stu-id="89433-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="89433-295">如果沒有至少一個產品中的`ProductsDataTable`，則`ProductsBLL`類別的`UpdateWithTransaction`呼叫方法。</span><span class="sxs-lookup"><span data-stu-id="89433-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="89433-296">接下來，資料會重新繫結至`ProductsGrid`GridView，因此新加入的產品會出現在顯示介面。</span><span class="sxs-lookup"><span data-stu-id="89433-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="89433-297">`StatusLabel`更新為顯示確認訊息和`ReturnToDisplayInterface`叫用時，隱藏插入介面和顯示顯示介面。</span><span class="sxs-lookup"><span data-stu-id="89433-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="89433-298">如果不輸入任何產品，插入介面仍然能夠保持顯示但沒有產品已新增的訊息。</span><span class="sxs-lookup"><span data-stu-id="89433-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="89433-299">請輸入產品名稱，並顯示於文字方塊中的單位價格。</span><span class="sxs-lookup"><span data-stu-id="89433-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="89433-300">圖 13、 14 及 15 顯示插入和顯示作用中的介面。</span><span class="sxs-lookup"><span data-stu-id="89433-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="89433-301">[圖 13] 中的使用者輸入不含對應的產品名稱的單位價格值。</span><span class="sxs-lookup"><span data-stu-id="89433-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="89433-302">圖 14 顯示顯示介面之後三個新產品已經成功加入，而 圖 15 所顯示的是兩個新加入的產品在 gridview 裡 （在前一個頁面是第三個）。</span><span class="sxs-lookup"><span data-stu-id="89433-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>


<span data-ttu-id="89433-303">[![產品名稱是必要時輸入單位價格](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="89433-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-cs/_static/image38.png)](batch-inserting-cs/_static/image37.png)</span></span>

<span data-ttu-id="89433-304">**圖 13**: 產品名稱是必要時輸入單位價格 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="89433-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-cs/_static/image39.png))</span></span>


<span data-ttu-id="89433-305">[![已新增三個新 Veggies 供應商 Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="89433-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-cs/_static/image41.png)](batch-inserting-cs/_static/image40.png)</span></span>

<span data-ttu-id="89433-306">**圖 14**： 三個新 Veggies 已新增供應商 Mayumi s ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="89433-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-cs/_static/image42.png))</span></span>


<span data-ttu-id="89433-307">[![新的產品可在 GridView 的最後一頁](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="89433-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-cs/_static/image44.png)](batch-inserting-cs/_static/image43.png)</span></span>

<span data-ttu-id="89433-308">**圖 15**: 新產品可在 GridView 的最後一頁 ([按一下以檢視完整大小的影像](batch-inserting-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="89433-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-cs/_static/image45.png))</span></span>


> [!NOTE]
> <span data-ttu-id="89433-309">批次插入此教學課程中使用的邏輯包裝插入的交易範圍內。</span><span class="sxs-lookup"><span data-stu-id="89433-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="89433-310">若要確認，故意放入資料庫層級錯誤。</span><span class="sxs-lookup"><span data-stu-id="89433-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="89433-311">比方說，而不是指派的新`ProductsRow`執行個體 s`CategoryID`屬性設為所選的值，在`Categories`下拉式清單中，指派其值，例如`i * 5`。</span><span class="sxs-lookup"><span data-stu-id="89433-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="89433-312">這裡`i`迴圈索引子，且具有範圍從 1 到 5 的值。</span><span class="sxs-lookup"><span data-stu-id="89433-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="89433-313">因此，當加入批次中的兩個或多個產品放入第一次的產品必須是有效`CategoryID`值 (5)，但後續的產品會有`CategoryID`最多不相符的值`CategoryID`中的值`Categories`資料表。</span><span class="sxs-lookup"><span data-stu-id="89433-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="89433-314">結果是，在第一個`INSERT`會成功，後續的項目將會失敗與外部索引鍵條件約束違規。</span><span class="sxs-lookup"><span data-stu-id="89433-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="89433-315">由於是不可部分完成的批次插入第一個`INSERT`將會回復，傳回其之前的批次插入程序的狀態資料庫開始。</span><span class="sxs-lookup"><span data-stu-id="89433-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>


## <a name="summary"></a><span data-ttu-id="89433-316">總結</span><span class="sxs-lookup"><span data-stu-id="89433-316">Summary</span></span>

<span data-ttu-id="89433-317">這和先前的兩個教學課程中，我們已建立介面，允許更新、 刪除和插入的資料批次，全部都使用我們新增資料存取層中的交易支援[包裝資料庫修改在交易內](wrapping-database-modifications-within-a-transaction-cs.md)教學課程。</span><span class="sxs-lookup"><span data-stu-id="89433-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-cs.md) tutorial.</span></span> <span data-ttu-id="89433-318">某些情況下，這類批次的處理使用者介面大幅提升終端使用者的效率由縮減下數按、 回傳和鍵盤-滑鼠內容切換，同時維持資料完整性的基礎。</span><span class="sxs-lookup"><span data-stu-id="89433-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="89433-319">本教學課程中完成我們看看使用批次的資料。</span><span class="sxs-lookup"><span data-stu-id="89433-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="89433-320">教學課程的下一組探索各種進階的資料存取層案例，包括使用預存程序在 TableAdapter 的方法中，連接和命令層級設定在 DAL、 加密的連接字串和更多功能 ！</span><span class="sxs-lookup"><span data-stu-id="89433-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="89433-321">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="89433-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="89433-322">關於作者</span><span class="sxs-lookup"><span data-stu-id="89433-322">About the Author</span></span>

<span data-ttu-id="89433-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的七個 ASP 書籍和的創辦人[4GuysFromRolla.com](http://www.4guysfromrolla.com)，自 1998 年從事 Microsoft Web 技術工作。</span><span class="sxs-lookup"><span data-stu-id="89433-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="89433-324">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="89433-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="89433-325">他最新的著作是[ *Sams 教導您自己 ASP.NET 2.0 在 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="89433-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="89433-326">他可以在觸達[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="89433-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span> <span data-ttu-id="89433-327">或透過他的部落格，這位於 [http://ScottOnWriting.NET](http://ScottOnWriting.NET)。</span><span class="sxs-lookup"><span data-stu-id="89433-327">or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="89433-328">特別感謝</span><span class="sxs-lookup"><span data-stu-id="89433-328">Special Thanks To</span></span>

<span data-ttu-id="89433-329">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="89433-329">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="89433-330">導致檢閱者針對本教學課程已 Hilton giesenow 將和 S ren Jacob Lauritsen。</span><span class="sxs-lookup"><span data-stu-id="89433-330">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="89433-331">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="89433-331">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="89433-332">如果是這樣，psychic 在[ mitchell@4GuysFromRolla.com。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="89433-332">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="89433-333">[上一頁](batch-deleting-cs.md)
> [下一頁](wrapping-database-modifications-within-a-transaction-vb.md)</span><span class="sxs-lookup"><span data-stu-id="89433-333">[Previous](batch-deleting-cs.md)
[Next](wrapping-database-modifications-within-a-transaction-vb.md)</span></span>
