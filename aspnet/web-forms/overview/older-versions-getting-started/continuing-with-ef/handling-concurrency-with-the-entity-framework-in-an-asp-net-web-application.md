---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application
title: 處理使用 Entity Framework 4.0 ASP.NET 4 Web 應用程式中的並行 |Microsoft Docs
author: tdykstra
description: 本教學課程系列由開始使用 Entity Framework 4.0 的教學課程系列的 Contoso 大學 web 應用程式為基礎。 我...
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/26/2011
ms.topic: article
ms.assetid: a5aa22a6-fb7f-4f41-9c7f-addda151940b
ms.technology: dotnet-webforms
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application
msc.type: authoredcontent
ms.openlocfilehash: c22f06e68b15d3fbf13e9f2af0e19631abe076ec
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/03/2018
ms.locfileid: "37392733"
---
<a name="handling-concurrency-with-the-entity-framework-40-in-an-aspnet-4-web-application"></a><span data-ttu-id="782fa-104">使用 Entity Framework 4.0 ASP.NET 4 Web 應用程式中處理並行</span><span class="sxs-lookup"><span data-stu-id="782fa-104">Handling Concurrency with the Entity Framework 4.0 in an ASP.NET 4 Web Application</span></span>
====================
<span data-ttu-id="782fa-105">藉由[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="782fa-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="782fa-106">本教學課程系列是根據所建立的 Contoso 大學 web 應用程式[Getting Started with Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started)教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="782fa-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="782fa-107">如果您未完成先前的教學課程，為本教學課程的起始點即可[下載應用程式](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a)您會建立。</span><span class="sxs-lookup"><span data-stu-id="782fa-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="782fa-108">您也可以[下載應用程式](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa)，它由完整的教學課程系列。</span><span class="sxs-lookup"><span data-stu-id="782fa-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="782fa-109">如果您有疑問的教學課程，您可以張貼他們[ASP.NET Entity Framework 論壇](https://forums.asp.net/1227.aspx)。</span><span class="sxs-lookup"><span data-stu-id="782fa-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>


<span data-ttu-id="782fa-110">您在上一個教學課程中學會如何排序和篩選資料使用`ObjectDataSource`控制項和 Entity Framework。</span><span class="sxs-lookup"><span data-stu-id="782fa-110">In the previous tutorial you learned how to sort and filter data using the `ObjectDataSource` control and the Entity Framework.</span></span> <span data-ttu-id="782fa-111">本教學課程會示範處理中使用 Entity Framework 的 ASP.NET web 應用程式的並行存取的選項。</span><span class="sxs-lookup"><span data-stu-id="782fa-111">This tutorial shows options for handling concurrency in an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="782fa-112">您將建立新的網頁，專門用來更新講師的辦公室指派。</span><span class="sxs-lookup"><span data-stu-id="782fa-112">You will create a new web page that's dedicated to updating instructor office assignments.</span></span> <span data-ttu-id="782fa-113">您將會處理在該頁面，並在您稍早建立的 [部門] 頁面的並行處理問題。</span><span class="sxs-lookup"><span data-stu-id="782fa-113">You'll handle concurrency issues in that page and in the Departments page that you created earlier.</span></span>

<span data-ttu-id="782fa-114">[![Image06](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-114">[![Image06](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span></span>

<span data-ttu-id="782fa-115">[![Image01](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-115">[![Image01](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span></span>

## <a name="concurrency-conflicts"></a><span data-ttu-id="782fa-116">並行衝突</span><span class="sxs-lookup"><span data-stu-id="782fa-116">Concurrency Conflicts</span></span>

<span data-ttu-id="782fa-117">當一位使用者編輯一筆記錄，並另一位使用者第一位使用者的變更寫入到資料庫前，請編輯同一筆記錄時，就會發生並行衝突。</span><span class="sxs-lookup"><span data-stu-id="782fa-117">A concurrency conflict occurs when one user edits a record and another user edits the same record before the first user's change is written to the database.</span></span> <span data-ttu-id="782fa-118">如果您沒有設定 Entity Framework 來偵測這類衝突，只要更新資料庫最後會覆寫其他使用者的變更。</span><span class="sxs-lookup"><span data-stu-id="782fa-118">If you don't set up the Entity Framework to detect such conflicts, whoever updates the database last overwrites the other user's changes.</span></span> <span data-ttu-id="782fa-119">在許多應用程式，此風險是可接受的而您不需要設定應用程式，以處理可能的並行存取衝突。</span><span class="sxs-lookup"><span data-stu-id="782fa-119">In many applications, this risk is acceptable, and you don't have to configure the application to handle possible concurrency conflicts.</span></span> <span data-ttu-id="782fa-120">(如果有幾個使用者或幾項更新，或如果不是真的很重要的某些變更會覆寫時，如果並行的程式設計成本可能會超過好處。)如果您不需要擔心並行衝突，您可以略過本教學課程中;其餘的兩個教學課程系列中不需依賴您在此影片中所建立的任何項目。</span><span class="sxs-lookup"><span data-stu-id="782fa-120">(If there are few users, or few updates, or if isn't really critical if some changes are overwritten, the cost of programming for concurrency might outweigh the benefit.) If you don't need to worry about concurrency conflicts, you can skip this tutorial; the remaining two tutorials in the series don't depend on anything you build in this one.</span></span>

### <a name="pessimistic-concurrency-locking"></a><span data-ttu-id="782fa-121">封閉式並行存取 （鎖定）</span><span class="sxs-lookup"><span data-stu-id="782fa-121">Pessimistic Concurrency (Locking)</span></span>

<span data-ttu-id="782fa-122">若您的應用程式確實需要防止在並行案例下發生的意外資料遺失，其中一個方法便是使用資料庫鎖定。</span><span class="sxs-lookup"><span data-stu-id="782fa-122">If your application does need to prevent accidental data loss in concurrency scenarios, one way to do that is to use database locks.</span></span> <span data-ttu-id="782fa-123">這就叫做*封閉式並行存取*。</span><span class="sxs-lookup"><span data-stu-id="782fa-123">This is called *pessimistic concurrency*.</span></span> <span data-ttu-id="782fa-124">例如，在您從資料庫讀取一個資料列之前，您會要求唯讀鎖定或更新存取鎖定。</span><span class="sxs-lookup"><span data-stu-id="782fa-124">For example, before you read a row from a database, you request a lock for read-only or for update access.</span></span> <span data-ttu-id="782fa-125">若您鎖定了一個資料列以進行更新存取，其他使用者便無法為了唯讀或更新存取而鎖定該資料列，因為他們會取得一個正在進行變更之資料的複本。</span><span class="sxs-lookup"><span data-stu-id="782fa-125">If you lock a row for update access, no other users are allowed to lock the row either for read-only or update access, because they would get a copy of data that's in the process of being changed.</span></span> <span data-ttu-id="782fa-126">若您鎖定資料列以進行唯讀存取，其他使用者也可以為了唯讀存取將其鎖定，但無法進行更新。</span><span class="sxs-lookup"><span data-stu-id="782fa-126">If you lock a row for read-only access, others can also lock it for read-only access but not for update.</span></span>

<span data-ttu-id="782fa-127">管理鎖定有一些缺點。</span><span class="sxs-lookup"><span data-stu-id="782fa-127">Managing locks has some disadvantages.</span></span> <span data-ttu-id="782fa-128">其程式可能相當複雜。</span><span class="sxs-lookup"><span data-stu-id="782fa-128">It can be complex to program.</span></span> <span data-ttu-id="782fa-129">它需要大量的資料庫管理資源，以及它會導致效能問題的應用程式的使用者數目會增加 （亦即，將無法妥善調整）。</span><span class="sxs-lookup"><span data-stu-id="782fa-129">It requires significant database management resources, and it can cause performance problems as the number of users of an application increases (that is, it doesn't scale well).</span></span> <span data-ttu-id="782fa-130">基於這些理由，不是所有的資料庫管理系統都支援封閉式並行存取。</span><span class="sxs-lookup"><span data-stu-id="782fa-130">For these reasons, not all database management systems support pessimistic concurrency.</span></span> <span data-ttu-id="782fa-131">Entity Framework 提供的內建支援，而本教學課程不會顯示您如何實作它。</span><span class="sxs-lookup"><span data-stu-id="782fa-131">The Entity Framework provides no built-in support for it, and this tutorial doesn't show you how to implement it.</span></span>

### <a name="optimistic-concurrency"></a><span data-ttu-id="782fa-132">開放式並行存取</span><span class="sxs-lookup"><span data-stu-id="782fa-132">Optimistic Concurrency</span></span>

<span data-ttu-id="782fa-133">封閉式並行存取的替代方案是*開放式並行存取*。</span><span class="sxs-lookup"><span data-stu-id="782fa-133">The alternative to pessimistic concurrency is *optimistic concurrency*.</span></span> <span data-ttu-id="782fa-134">開放式並行存取表示允許並行衝突發生，然後在衝突發生時適當的做出反應。</span><span class="sxs-lookup"><span data-stu-id="782fa-134">Optimistic concurrency means allowing concurrency conflicts to happen, and then reacting appropriately if they do.</span></span> <span data-ttu-id="782fa-135">比方說，John 執行*Department.aspx*頁面上，按下**編輯**連結記錄部門，並減少**預算**$1,000,000.00 $ 的數量125,000.00。</span><span class="sxs-lookup"><span data-stu-id="782fa-135">For example, John runs the *Department.aspx* page, clicks the **Edit** link for the History department, and reduces the **Budget** amount from $1,000,000.00 to $125,000.00.</span></span> <span data-ttu-id="782fa-136">（John 管理競爭的部門的而且想要釋出為自己的部門）。</span><span class="sxs-lookup"><span data-stu-id="782fa-136">(John administers a competing department and wants to free up money for his own department.)</span></span>

<span data-ttu-id="782fa-137">[![Image07](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-137">[![Image07](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span></span>

<span data-ttu-id="782fa-138">John 按之前**更新**，Jane 執行相同的頁面，按一下**編輯**連結記錄部門，然後變更**Start Date**從 2011 年 1 月 10 日欄位設為 1/1 /1999。</span><span class="sxs-lookup"><span data-stu-id="782fa-138">Before John clicks **Update**, Jane runs the same page, clicks the **Edit** link for the History department, and then changes the **Start Date** field from 1/10/2011 to 1/1/1999.</span></span> <span data-ttu-id="782fa-139">（Jane 管理歷程記錄部門的而且想要為它提供更多的 seniority）。</span><span class="sxs-lookup"><span data-stu-id="782fa-139">(Jane administers the History department and wants to give it more seniority.)</span></span>

<span data-ttu-id="782fa-140">[![Image08](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-140">[![Image08](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span></span>

<span data-ttu-id="782fa-141">John 按**更新**第一次，然後 Jane 按一下**更新**。</span><span class="sxs-lookup"><span data-stu-id="782fa-141">John clicks **Update** first, then Jane clicks **Update**.</span></span> <span data-ttu-id="782fa-142">Jane 的瀏覽器目前清單**預算**量 $1,000,000.00，但這不正確，因為量已由 John 變更 $125,000.00。</span><span class="sxs-lookup"><span data-stu-id="782fa-142">Jane's browser now lists the **Budget** amount as $1,000,000.00, but this is incorrect because the amount has been changed by John to $125,000.00.</span></span>

<span data-ttu-id="782fa-143">在此案例中，您可以採取的動作包括下列：</span><span class="sxs-lookup"><span data-stu-id="782fa-143">Some of the actions you can take in this scenario include the following:</span></span>

- <span data-ttu-id="782fa-144">您可以追蹤使用者修改的屬性，然後僅在資料庫中更新相對應的資料行。</span><span class="sxs-lookup"><span data-stu-id="782fa-144">You can keep track of which property a user has modified and update only the corresponding columns in the database.</span></span> <span data-ttu-id="782fa-145">在範例案例中，將不會發生資料遺失，因為兩名使用者更新的屬性不同。</span><span class="sxs-lookup"><span data-stu-id="782fa-145">In the example scenario, no data would be lost, because different properties were updated by the two users.</span></span> <span data-ttu-id="782fa-146">在下一次有人瀏覽歷程記錄部門，他們會看到 1/1/1999年和 $125,000.00。</span><span class="sxs-lookup"><span data-stu-id="782fa-146">The next time someone browses the History department, they will see 1/1/1999 and $125,000.00.</span></span> 

    <span data-ttu-id="782fa-147">這是 Entity Framework 中的預設行為，它可以大幅減少可能會導致資料遺失的衝突數目。</span><span class="sxs-lookup"><span data-stu-id="782fa-147">This is the default behavior in the Entity Framework, and it can substantially reduce the number of conflicts that could result in data loss.</span></span> <span data-ttu-id="782fa-148">不過，此行為不會避免資料遺失，如果遭到變更的實體相同的屬性。</span><span class="sxs-lookup"><span data-stu-id="782fa-148">However, this behavior doesn't avoid data loss if competing changes are made to the same property of an entity.</span></span> <span data-ttu-id="782fa-149">此外，此行為不一定可行的;當您將預存程序對應至的實體類型時，所有實體的屬性會更新任何實體變更時在資料庫中。</span><span class="sxs-lookup"><span data-stu-id="782fa-149">In addition, this behavior isn't always possible; when you map stored procedures to an entity type, all of an entity's properties are updated when any changes to the entity are made in the database.</span></span>
- <span data-ttu-id="782fa-150">您可以讓 Jane 的變更覆寫 John 所作出的變更。</span><span class="sxs-lookup"><span data-stu-id="782fa-150">You can let Jane's change overwrite John's change.</span></span> <span data-ttu-id="782fa-151">Jane 按一下後**更新**，則**預算**數量會回到 $1,000,000.00。</span><span class="sxs-lookup"><span data-stu-id="782fa-151">After Jane clicks **Update**, the **Budget** amount goes back to $1,000,000.00.</span></span> <span data-ttu-id="782fa-152">這稱之為「用戶端獲勝 (Client Wins)」或「最後寫入為準 (Last in Wins)」案例。</span><span class="sxs-lookup"><span data-stu-id="782fa-152">This is called a *Client Wins* or *Last in Wins* scenario.</span></span> <span data-ttu-id="782fa-153">（用戶端的值優先於功能的資料存放區。）</span><span class="sxs-lookup"><span data-stu-id="782fa-153">(The client's values take precedence over what's in the data store.)</span></span>
- <span data-ttu-id="782fa-154">您可以防止資料庫中的更新 Jane 的變更。</span><span class="sxs-lookup"><span data-stu-id="782fa-154">You can prevent Jane's change from being updated in the database.</span></span> <span data-ttu-id="782fa-155">一般而言，您會顯示錯誤訊息、 她的目前狀態的資料，並允許她在重新輸入她的變更，如果她仍然想要讓它們。</span><span class="sxs-lookup"><span data-stu-id="782fa-155">Typically, you would display an error message, show her the current state of the data, and allow her to reenter her changes if she still wants to make them.</span></span> <span data-ttu-id="782fa-156">您可以進一步自動化程序，儲存其輸入，並提供她有機會重新套用它，而不必重新輸入。</span><span class="sxs-lookup"><span data-stu-id="782fa-156">You could further automate the process by saving her input and giving her an opportunity to reapply it without having to reenter it.</span></span> <span data-ttu-id="782fa-157">這稱之為「存放區獲勝 (Store Wins)」案例。</span><span class="sxs-lookup"><span data-stu-id="782fa-157">This is called a *Store Wins* scenario.</span></span> <span data-ttu-id="782fa-158">(資料存放區的值會優先於用戶端所提交的值。)</span><span class="sxs-lookup"><span data-stu-id="782fa-158">(The data-store values take precedence over the values submitted by the client.)</span></span>

### <a name="detecting-concurrency-conflicts"></a><span data-ttu-id="782fa-159">偵測並行衝突</span><span class="sxs-lookup"><span data-stu-id="782fa-159">Detecting Concurrency Conflicts</span></span>

<span data-ttu-id="782fa-160">在 Entity Framework 中，您可以解決衝突，藉由處理`OptimisticConcurrencyException`Entity Framework 擲回的例外狀況。</span><span class="sxs-lookup"><span data-stu-id="782fa-160">In the Entity Framework, you can resolve conflicts by handling `OptimisticConcurrencyException` exceptions that the Entity Framework throws.</span></span> <span data-ttu-id="782fa-161">若要得知何時應擲回這些例外狀況，Entity Framework 必須能夠偵測衝突。</span><span class="sxs-lookup"><span data-stu-id="782fa-161">In order to know when to throw these exceptions, the Entity Framework must be able to detect conflicts.</span></span> <span data-ttu-id="782fa-162">因此，您必須適當的設定資料庫及資料模型。</span><span class="sxs-lookup"><span data-stu-id="782fa-162">Therefore, you must configure the database and the data model appropriately.</span></span> <span data-ttu-id="782fa-163">一部分啟用衝突偵測的選項包括下列選項：</span><span class="sxs-lookup"><span data-stu-id="782fa-163">Some options for enabling conflict detection include the following:</span></span>

- <span data-ttu-id="782fa-164">在資料庫中，包含可用來判斷何時已變更的資料列的資料表資料行。</span><span class="sxs-lookup"><span data-stu-id="782fa-164">In the database, include a table column that can be used to determine when a row has been changed.</span></span> <span data-ttu-id="782fa-165">接著，您可以設定要包含在該資料行的 Entity Framework`Where`子句的 SQL`Update`或`Delete`命令。</span><span class="sxs-lookup"><span data-stu-id="782fa-165">You can then configure the Entity Framework to include that column in the `Where` clause of SQL `Update` or `Delete` commands.</span></span>

    <span data-ttu-id="782fa-166">這是目的`Timestamp`中的資料行`OfficeAssignment`資料表。</span><span class="sxs-lookup"><span data-stu-id="782fa-166">That's the purpose of the `Timestamp` column in the `OfficeAssignment` table.</span></span>

    <span data-ttu-id="782fa-167">[![Image09](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-167">[![Image09](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span></span>

    <span data-ttu-id="782fa-168">資料類型`Timestamp`資料行也稱為`Timestamp`。</span><span class="sxs-lookup"><span data-stu-id="782fa-168">The data type of the `Timestamp` column is also called `Timestamp`.</span></span> <span data-ttu-id="782fa-169">不過，資料行實際上並不包含日期或時間值。</span><span class="sxs-lookup"><span data-stu-id="782fa-169">However, the column doesn't actually contain a date or time value.</span></span> <span data-ttu-id="782fa-170">相反地，值會是一個循序號碼，都會遞增每個資料列更新的時間。</span><span class="sxs-lookup"><span data-stu-id="782fa-170">Instead, the value is a sequential number that's incremented each time the row is updated.</span></span> <span data-ttu-id="782fa-171">在 `Update`或是`Delete`命令，`Where`子句會包含原始`Timestamp`值。</span><span class="sxs-lookup"><span data-stu-id="782fa-171">In an `Update` or `Delete` command, the `Where` clause includes the original `Timestamp` value.</span></span> <span data-ttu-id="782fa-172">如果要更新的資料列已由另一位使用者中的值變更`Timestamp`不同於原始值，因此`Where`子句會傳回任何資料列更新。</span><span class="sxs-lookup"><span data-stu-id="782fa-172">If the row being updated has been changed by another user, the value in `Timestamp` is different than the original value, so the `Where` clause returns no row to update.</span></span> <span data-ttu-id="782fa-173">當 Entity Framework 會尋找目前尚未更新任何資料列`Update`或`Delete`命令 （也就是當受影響的資料列數目為零），它會解譯為並行衝突。</span><span class="sxs-lookup"><span data-stu-id="782fa-173">When the Entity Framework finds that no rows have been updated by the current `Update` or `Delete` command (that is, when the number of affected rows is zero), it interprets that as a concurrency conflict.</span></span>
- <span data-ttu-id="782fa-174">設定要包含的資料表中的每個資料行的原始值的 Entity Framework`Where`子句`Update`和`Delete`命令。</span><span class="sxs-lookup"><span data-stu-id="782fa-174">Configure the Entity Framework to include the original values of every column in the table in the `Where` clause of `Update` and `Delete` commands.</span></span>

    <span data-ttu-id="782fa-175">第一個選項，如果資料列中的任何項目已變更因為這是第一個讀取的資料列，如同`Where`子句不會可解譯為並行衝突的 Entity Framework 傳回資料列來更新。</span><span class="sxs-lookup"><span data-stu-id="782fa-175">As in the first option, if anything in the row has changed since the row was first read, the `Where` clause won't return a row to update, which the Entity Framework interprets as a concurrency conflict.</span></span> <span data-ttu-id="782fa-176">這個方法是，更有效率的方式使用`Timestamp`欄位，但可能會沒有效率。</span><span class="sxs-lookup"><span data-stu-id="782fa-176">This method is as effective as using a `Timestamp` field, but can be inefficient.</span></span> <span data-ttu-id="782fa-177">針對資料庫有許多資料行的資料表，它可能會導致非常大`Where`子句，而且 web 應用程式中它可能需要您維持大量的狀態。</span><span class="sxs-lookup"><span data-stu-id="782fa-177">For database tables that have many columns, it can result in very large `Where` clauses, and in a web application it can require that you maintain large amounts of state.</span></span> <span data-ttu-id="782fa-178">維持大量的狀態可能會影響應用程式效能，因為它需要伺服器資源 （例如，工作階段狀態），或必須包含在網頁中 （例如，檢視狀態）。</span><span class="sxs-lookup"><span data-stu-id="782fa-178">Maintaining large amounts of state can affect application performance because it either requires server resources (for example, session state) or must be included in the web page itself (for example, view state).</span></span>

<span data-ttu-id="782fa-179">在本教學課程中，您會將錯誤處理開放式並行存取衝突的實體又沒有追蹤屬性 (`Department`實體) 並沒有追蹤屬性的實體 (`OfficeAssignment`實體)。</span><span class="sxs-lookup"><span data-stu-id="782fa-179">In this tutorial you will add error handling for optimistic concurrency conflicts for an entity that doesn't have a tracking property (the `Department` entity) and for an entity that does have a tracking property (the `OfficeAssignment` entity).</span></span>

## <a name="handling-optimistic-concurrency-without-a-tracking-property"></a><span data-ttu-id="782fa-180">處理開放式並行存取，而且沒有追蹤屬性</span><span class="sxs-lookup"><span data-stu-id="782fa-180">Handling Optimistic Concurrency Without a Tracking Property</span></span>

<span data-ttu-id="782fa-181">若要實作的開放式並行存取`Department`沒有追蹤的實體 (`Timestamp`) 屬性，您將完成下列工作：</span><span class="sxs-lookup"><span data-stu-id="782fa-181">To implement optimistic concurrency for the `Department` entity, which doesn't have a tracking (`Timestamp`) property, you will complete the following tasks:</span></span>

- <span data-ttu-id="782fa-182">變更資料模型，以啟用追蹤的並行存取`Department`實體。</span><span class="sxs-lookup"><span data-stu-id="782fa-182">Change the data model to enable concurrency tracking for `Department` entities.</span></span>
- <span data-ttu-id="782fa-183">在 `SchoolRepository`類別，控制代碼中的並行存取例外狀況`SaveChanges`方法。</span><span class="sxs-lookup"><span data-stu-id="782fa-183">In the `SchoolRepository` class, handle concurrency exceptions in the `SaveChanges` method.</span></span>
- <span data-ttu-id="782fa-184">在  *Departments.aspx*頁面上，顯示訊息警告不成功的嘗試的變更使用者的處理並行例外狀況。</span><span class="sxs-lookup"><span data-stu-id="782fa-184">In the *Departments.aspx* page, handle concurrency exceptions by displaying a message to the user warning that the attempted changes were unsuccessful.</span></span> <span data-ttu-id="782fa-185">然後使用者可以看到目前的值，並仍然需要它們時的重試，一次所做的變更。</span><span class="sxs-lookup"><span data-stu-id="782fa-185">The user can then see the current values and retry the changes if they are still needed.</span></span>

### <a name="enabling-concurrency-tracking-in-the-data-model"></a><span data-ttu-id="782fa-186">啟用追蹤的資料模型中的並行存取</span><span class="sxs-lookup"><span data-stu-id="782fa-186">Enabling Concurrency Tracking in the Data Model</span></span>

<span data-ttu-id="782fa-187">在 Visual Studio 中，開啟您已在此系列的上一個教學課程中使用的 Contoso 大學 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="782fa-187">In Visual Studio, open the Contoso University web application that you were working with in the previous tutorial in this series.</span></span>

<span data-ttu-id="782fa-188">開啟*SchoolModel.edmx*，在資料模型設計工具中，以滑鼠右鍵按一下`Name`中的屬性`Department`實體，然後按一下**屬性**。</span><span class="sxs-lookup"><span data-stu-id="782fa-188">Open *SchoolModel.edmx*, and in the data model designer, right-click the `Name` property in the `Department` entity and then click **Properties**.</span></span> <span data-ttu-id="782fa-189">在 **屬性**視窗中，變更`ConcurrencyMode`屬性設`Fixed`。</span><span class="sxs-lookup"><span data-stu-id="782fa-189">In the **Properties** window, change the `ConcurrencyMode` property to `Fixed`.</span></span>

<span data-ttu-id="782fa-190">[![Image16](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-190">[![Image16](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span></span>

<span data-ttu-id="782fa-191">這麼做的其他非主要金鑰純量屬性 (`Budget`， `StartDate`，和`Administrator`。)（您無法執行此導覽屬性。）這會指定，每當 Entity Framework 會產生`Update`或是`Delete`SQL 命令來更新`Department`資料庫中的實體，這些值的資料行 （原始） 必須包含在`Where`子句。</span><span class="sxs-lookup"><span data-stu-id="782fa-191">Do the same for the other non-primary-key scalar properties (`Budget`, `StartDate`, and `Administrator`.) (You can't do this for navigation properties.) This specifies that whenever the Entity Framework generates a `Update` or `Delete` SQL command to update the `Department` entity in the database, these columns (with original values) must be included in the `Where` clause.</span></span> <span data-ttu-id="782fa-192">如果不找到任何資料列何時`Update`或`Delete`命令執行時，Entity Framework 將會擲回開放式並行存取例外狀況。</span><span class="sxs-lookup"><span data-stu-id="782fa-192">If no row is found when the `Update` or `Delete` command executes, the Entity Framework will throw an optimistic-concurrency exception.</span></span>

<span data-ttu-id="782fa-193">儲存並關閉資料模型。</span><span class="sxs-lookup"><span data-stu-id="782fa-193">Save and close the data model.</span></span>

### <a name="handling-concurrency-exceptions-in-the-dal"></a><span data-ttu-id="782fa-194">DAL 中處理並行例外狀況</span><span class="sxs-lookup"><span data-stu-id="782fa-194">Handling Concurrency Exceptions in the DAL</span></span>

<span data-ttu-id="782fa-195">開啟*SchoolRepository.cs*並新增下列`using`陳述式`System.Data`命名空間：</span><span class="sxs-lookup"><span data-stu-id="782fa-195">Open *SchoolRepository.cs* and add the following `using` statement for the `System.Data` namespace:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample1.cs)]

<span data-ttu-id="782fa-196">新增下列新`SaveChanges`方法，用來處理開放式並行存取例外狀況：</span><span class="sxs-lookup"><span data-stu-id="782fa-196">Add the following new `SaveChanges` method, which handles optimistic concurrency exceptions:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample2.cs)]

<span data-ttu-id="782fa-197">如果呼叫這個方法時，就會發生並行錯誤，就會在記憶體中實體的屬性值取代目前資料庫中的值。</span><span class="sxs-lookup"><span data-stu-id="782fa-197">If a concurrency error occurs when this method is called, the property values of the entity in memory are replaced with the values currently in the database.</span></span> <span data-ttu-id="782fa-198">並行存取例外狀況重新擲回，好讓網頁可以處理它。</span><span class="sxs-lookup"><span data-stu-id="782fa-198">The concurrency exception is rethrown so that the web page can handle it.</span></span>

<span data-ttu-id="782fa-199">在 `DeleteDepartment`並`UpdateDepartment`方法，會取代現有的呼叫`context.SaveChanges()`藉由呼叫`SaveChanges()`才能叫用新的方法。</span><span class="sxs-lookup"><span data-stu-id="782fa-199">In the `DeleteDepartment` and `UpdateDepartment` methods, replace the existing call to `context.SaveChanges()` with a call to `SaveChanges()` in order to invoke the new method.</span></span>

### <a name="handling-concurrency-exceptions-in-the-presentation-layer"></a><span data-ttu-id="782fa-200">展示層中的並行存取例外狀況處理</span><span class="sxs-lookup"><span data-stu-id="782fa-200">Handling Concurrency Exceptions in the Presentation Layer</span></span>

<span data-ttu-id="782fa-201">開啟*Departments.aspx*並加入`OnDeleted="DepartmentsObjectDataSource_Deleted"`屬性設定為`DepartmentsObjectDataSource`控制項。</span><span class="sxs-lookup"><span data-stu-id="782fa-201">Open *Departments.aspx* and add an `OnDeleted="DepartmentsObjectDataSource_Deleted"` attribute to the `DepartmentsObjectDataSource` control.</span></span> <span data-ttu-id="782fa-202">控制項的開頭標記現在會類似下列的範例。</span><span class="sxs-lookup"><span data-stu-id="782fa-202">The opening tag for the control will now resemble the following example.</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample3.aspx)]

<span data-ttu-id="782fa-203">在 `DepartmentsGridView`控制項，指定所有的資料表資料行`DataKeyNames`屬性，如下列範例所示。</span><span class="sxs-lookup"><span data-stu-id="782fa-203">In the `DepartmentsGridView` control, specify all of the table columns in the `DataKeyNames` attribute, as shown in the following example.</span></span> <span data-ttu-id="782fa-204">請注意，這會建立非常大的檢視狀態欄位，這是其中一個原因為何使用追蹤欄位通常是較好的方法追蹤並行存取衝突。</span><span class="sxs-lookup"><span data-stu-id="782fa-204">Note that this will create very large view state fields, which is one reason why using a tracking field is generally the preferred way to track concurrency conflicts.</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample4.aspx)]

<span data-ttu-id="782fa-205">開啟*Departments.aspx.cs*並新增下列`using`陳述式`System.Data`命名空間：</span><span class="sxs-lookup"><span data-stu-id="782fa-205">Open *Departments.aspx.cs* and add the following `using` statement for the `System.Data` namespace:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample5.cs)]

<span data-ttu-id="782fa-206">新增下列新方法，從資料來源控制項，您會呼叫`Updated`和`Deleted`處理並行例外狀況的事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="782fa-206">Add the following new method, which you will call from the data source control's `Updated` and `Deleted` event handlers for handling concurrency exceptions:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample6.cs)]

<span data-ttu-id="782fa-207">此程式碼會檢查例外狀況類型，以及如果是並行例外狀況，程式碼以動態方式建立`CustomValidator`接著會顯示在訊息的控制項`ValidationSummary`控制項。</span><span class="sxs-lookup"><span data-stu-id="782fa-207">This code checks the exception type, and if it's a concurrency exception, the code dynamically creates a `CustomValidator` control that in turn displays a message in the `ValidationSummary` control.</span></span>

<span data-ttu-id="782fa-208">呼叫新方法，從`Updated`您先前加入的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="782fa-208">Call the new method from the `Updated` event handler that you added earlier.</span></span> <span data-ttu-id="782fa-209">此外，建立 新`Deleted`呼叫相同方法 （但不會執行任何其他項目） 的事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="782fa-209">In addition, create a new `Deleted` event handler that calls the same method (but doesn't do anything else):</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample7.cs)]

### <a name="testing-optimistic-concurrency-in-the-departments-page"></a><span data-ttu-id="782fa-210">在 [部門] 頁面測試開放式並行存取</span><span class="sxs-lookup"><span data-stu-id="782fa-210">Testing Optimistic Concurrency in the Departments Page</span></span>

<span data-ttu-id="782fa-211">執行*Departments.aspx*頁面。</span><span class="sxs-lookup"><span data-stu-id="782fa-211">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="782fa-212">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-212">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span></span>

<span data-ttu-id="782fa-213">按一下 **編輯**資料列中，並在值變更**預算**資料行。</span><span class="sxs-lookup"><span data-stu-id="782fa-213">Click **Edit** in a row and change the value in the **Budget** column.</span></span> <span data-ttu-id="782fa-214">(請記住，您可以只編輯記錄，您已建立本教學課程中，因為現有`School`資料庫記錄包含一些無效的資料。</span><span class="sxs-lookup"><span data-stu-id="782fa-214">(Remember that you can only edit records that you've created for this tutorial, because the existing `School` database records contain some invalid data.</span></span> <span data-ttu-id="782fa-215">經濟效益部門的記錄是安全地試驗）。</span><span class="sxs-lookup"><span data-stu-id="782fa-215">The record for the Economics department is a safe one to experiment with.)</span></span>

<span data-ttu-id="782fa-216">[![Image18](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-216">[![Image18](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span></span>

<span data-ttu-id="782fa-217">開啟新的瀏覽器視窗並執行頁面一次 （複製的 URL 從第一個瀏覽器視窗的 [網址] 方塊的第二個瀏覽器視窗）。</span><span class="sxs-lookup"><span data-stu-id="782fa-217">Open a new browser window and run the page again (copy the URL from the first browser window's address box to the second browser window).</span></span>

<span data-ttu-id="782fa-218">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-218">[![Image17](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span></span>

<span data-ttu-id="782fa-219">按一下 **編輯**在同一個資料列您稍早編輯並變更**預算**為不同的值。</span><span class="sxs-lookup"><span data-stu-id="782fa-219">Click **Edit** in the same row you edited earlier and change the **Budget** value to something different.</span></span>

<span data-ttu-id="782fa-220">[![Image19](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-220">[![Image19](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span></span>

<span data-ttu-id="782fa-221">在第二個瀏覽器視窗中，按一下**更新**。</span><span class="sxs-lookup"><span data-stu-id="782fa-221">In the second browser window, click **Update**.</span></span> <span data-ttu-id="782fa-222">**預算**量已成功變更為這個新值。</span><span class="sxs-lookup"><span data-stu-id="782fa-222">The **Budget** amount is successfully changed to this new value.</span></span>

<span data-ttu-id="782fa-223">[![Image20](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-223">[![Image20](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span></span>

<span data-ttu-id="782fa-224">在第一個瀏覽器視窗中，按一下**更新**。</span><span class="sxs-lookup"><span data-stu-id="782fa-224">In the first browser window, click **Update**.</span></span> <span data-ttu-id="782fa-225">更新會失敗。</span><span class="sxs-lookup"><span data-stu-id="782fa-225">The update fails.</span></span> <span data-ttu-id="782fa-226">**預算**數量會重新顯示，使用您在第二個瀏覽器視窗中，設定的值，您會看到一則錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="782fa-226">The **Budget** amount is redisplayed using the value you set in the second browser window, and you see an error message.</span></span>

<span data-ttu-id="782fa-227">[![Image21](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-227">[![Image21](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span></span>

## <a name="handling-optimistic-concurrency-using-a-tracking-property"></a><span data-ttu-id="782fa-228">使用 追蹤屬性處理開放式並行存取</span><span class="sxs-lookup"><span data-stu-id="782fa-228">Handling Optimistic Concurrency Using a Tracking Property</span></span>

<span data-ttu-id="782fa-229">若要處理的追蹤屬性的實體的開放式並行存取，您將完成下列工作：</span><span class="sxs-lookup"><span data-stu-id="782fa-229">To handle optimistic concurrency for an entity that has a tracking property, you will complete the following tasks:</span></span>

- <span data-ttu-id="782fa-230">將預存程序新增至資料模型，來管理`OfficeAssignment`實體。</span><span class="sxs-lookup"><span data-stu-id="782fa-230">Add stored procedures to the data model to manage `OfficeAssignment` entities.</span></span> <span data-ttu-id="782fa-231">（沒有同時使用 追蹤屬性和預存程序，它們只群組在一起此處為了說明）。</span><span class="sxs-lookup"><span data-stu-id="782fa-231">(Tracking properties and stored procedures don't have to be used together; they're just grouped together here for illustration.)</span></span>
- <span data-ttu-id="782fa-232">CRUD 方法加入 DAL 和的 BLL`OfficeAssignment`實體，包括程式碼來處理 DAL 中的開放式並行存取例外狀況。</span><span class="sxs-lookup"><span data-stu-id="782fa-232">Add CRUD methods to the DAL and the BLL for `OfficeAssignment` entities, including code to handle optimistic concurrency exceptions in the DAL.</span></span>
- <span data-ttu-id="782fa-233">建立 office 指派網頁。</span><span class="sxs-lookup"><span data-stu-id="782fa-233">Create an office-assignments web page.</span></span>
- <span data-ttu-id="782fa-234">測試新的 web 網頁中開放式並行存取。</span><span class="sxs-lookup"><span data-stu-id="782fa-234">Test optimistic concurrency in the new web page.</span></span>

### <a name="adding-officeassignment-stored-procedures-to-the-data-model"></a><span data-ttu-id="782fa-235">新增 OfficeAssignment 預存程序的資料模型</span><span class="sxs-lookup"><span data-stu-id="782fa-235">Adding OfficeAssignment Stored Procedures to the Data Model</span></span>

<span data-ttu-id="782fa-236">開啟*SchoolModel.edmx*檔案在模型設計師中，以滑鼠右鍵按一下設計介面上，按一下 **從資料庫更新模型**。</span><span class="sxs-lookup"><span data-stu-id="782fa-236">Open the *SchoolModel.edmx* file in the model designer, right-click the design surface, and click **Update Model from Database**.</span></span> <span data-ttu-id="782fa-237">在**新增**索引標籤**選擇您的資料庫物件**對話方塊方塊中，展開**預存程序**，然後選取三個`OfficeAssignment`預存程序 (請參閱下列螢幕擷取畫面），然後按一下**完成**。</span><span class="sxs-lookup"><span data-stu-id="782fa-237">In the **Add** tab of the **Choose Your Database Objects** dialog box, expand **Stored Procedures** and select the three `OfficeAssignment` stored procedures (see the following screenshot), and then click **Finish**.</span></span> <span data-ttu-id="782fa-238">（這些預存程序均已存在於資料庫當您下載或使用指令碼加以建立。）</span><span class="sxs-lookup"><span data-stu-id="782fa-238">(These stored procedures were already in the database when you downloaded or created it using a script.)</span></span>

<span data-ttu-id="782fa-239">[![Image02](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-239">[![Image02](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span></span>

<span data-ttu-id="782fa-240">以滑鼠右鍵按一下`OfficeAssignment`實體，然後選取**預存程序對應**。</span><span class="sxs-lookup"><span data-stu-id="782fa-240">Right-click the `OfficeAssignment` entity and select **Stored Procedure Mapping**.</span></span>

<span data-ttu-id="782fa-241">[![Image03](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-241">[![Image03](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span></span>

<span data-ttu-id="782fa-242">設定**插入**，**更新**，並**刪除**函式來使用其對應預存程序。</span><span class="sxs-lookup"><span data-stu-id="782fa-242">Set the **Insert**, **Update**, and **Delete** functions to use their corresponding stored procedures.</span></span> <span data-ttu-id="782fa-243">針對`OrigTimestamp`的參數`Update`函式中，設定**屬性**來`Timestamp`，然後選取**使用原始值**選項。</span><span class="sxs-lookup"><span data-stu-id="782fa-243">For the `OrigTimestamp` parameter of the `Update` function, set the **Property** to `Timestamp` and select the **Use Original Value** option.</span></span>

<span data-ttu-id="782fa-244">[![Image04](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image30.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-244">[![Image04](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image30.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image29.png)</span></span>

<span data-ttu-id="782fa-245">當 Entity Framework 會呼叫`UpdateOfficeAssignment`預存程序，它會將傳遞的原始值`Timestamp`中的資料行`OrigTimestamp`參數。</span><span class="sxs-lookup"><span data-stu-id="782fa-245">When the Entity Framework calls the `UpdateOfficeAssignment` stored procedure, it will pass the original value of the `Timestamp` column in the `OrigTimestamp` parameter.</span></span> <span data-ttu-id="782fa-246">預存程序會使用此參數以其`Where`子句：</span><span class="sxs-lookup"><span data-stu-id="782fa-246">The stored procedure uses this parameter in its `Where` clause:</span></span>

[!code-sql[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample8.sql)]

<span data-ttu-id="782fa-247">預存程序也會選取新的值`Timestamp`更新後的資料行，以便可以讓 Entity Framework`OfficeAssignment`會在記憶體中與對應的資料庫資料列的同步處理的實體。</span><span class="sxs-lookup"><span data-stu-id="782fa-247">The stored procedure also selects the new value of the `Timestamp` column after the update so that the Entity Framework can keep the `OfficeAssignment` entity that's in memory in sync with the corresponding database row.</span></span>

<span data-ttu-id="782fa-248">(請注意，刪除辦公室指派的預存程序沒有`OrigTimestamp`參數。</span><span class="sxs-lookup"><span data-stu-id="782fa-248">(Note that the stored procedure for deleting an office assignment doesn't have an `OrigTimestamp` parameter.</span></span> <span data-ttu-id="782fa-249">因此，Entity Framework 無法確認實體不變，然後再刪除它。）</span><span class="sxs-lookup"><span data-stu-id="782fa-249">Because of this, the Entity Framework can't verify that an entity is unchanged before deleting it.)</span></span>

<span data-ttu-id="782fa-250">儲存並關閉資料模型。</span><span class="sxs-lookup"><span data-stu-id="782fa-250">Save and close the data model.</span></span>

### <a name="adding-officeassignment-methods-to-the-dal"></a><span data-ttu-id="782fa-251">將 OfficeAssignment 方法加入至 DAL</span><span class="sxs-lookup"><span data-stu-id="782fa-251">Adding OfficeAssignment Methods to the DAL</span></span>

<span data-ttu-id="782fa-252">開啟*ISchoolRepository.cs*並加入下列的 CRUD 方法`OfficeAssignment`實體集：</span><span class="sxs-lookup"><span data-stu-id="782fa-252">Open *ISchoolRepository.cs* and add the following CRUD methods for the `OfficeAssignment` entity set:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample9.cs)]

<span data-ttu-id="782fa-253">加入下列新方法，來*SchoolRepository.cs*。</span><span class="sxs-lookup"><span data-stu-id="782fa-253">Add the following new methods to *SchoolRepository.cs*.</span></span> <span data-ttu-id="782fa-254">在 `UpdateOfficeAssignment`方法，呼叫本機`SaveChanges`方法，而非`context.SaveChanges`。</span><span class="sxs-lookup"><span data-stu-id="782fa-254">In the `UpdateOfficeAssignment` method, you call the local `SaveChanges` method instead of `context.SaveChanges`.</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample10.cs)]

<span data-ttu-id="782fa-255">在測試專案中，開啟*MockSchoolRepository.cs*並新增下列`OfficeAssignment`集合和它的 CRUD 方法。</span><span class="sxs-lookup"><span data-stu-id="782fa-255">In the test project, open *MockSchoolRepository.cs* and add the following `OfficeAssignment` collection and CRUD methods to it.</span></span> <span data-ttu-id="782fa-256">（模擬儲存機制必須實作儲存機制的介面，或解決方案不會編譯）。</span><span class="sxs-lookup"><span data-stu-id="782fa-256">(The mock repository must implement the repository interface, or the solution won't compile.)</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample11.cs)]

### <a name="adding-officeassignment-methods-to-the-bll"></a><span data-ttu-id="782fa-257">將 OfficeAssignment 方法加入至 BLL</span><span class="sxs-lookup"><span data-stu-id="782fa-257">Adding OfficeAssignment Methods to the BLL</span></span>

<span data-ttu-id="782fa-258">在主專案中，開啟*SchoolBL.cs*並加入下列的 CRUD 方法`OfficeAssignment`給它的實體集：</span><span class="sxs-lookup"><span data-stu-id="782fa-258">In the main project, open *SchoolBL.cs* and add the following CRUD methods for the `OfficeAssignment` entity set to it:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample12.cs)]

## <a name="creating-an-officeassignments-web-page"></a><span data-ttu-id="782fa-259">建立 OfficeAssignments Web 網頁</span><span class="sxs-lookup"><span data-stu-id="782fa-259">Creating an OfficeAssignments Web Page</span></span>

<span data-ttu-id="782fa-260">建立會使用新網頁*Site.Master*主版頁面，然後將它命名*OfficeAssignments.aspx*。</span><span class="sxs-lookup"><span data-stu-id="782fa-260">Create a new web page that uses the *Site.Master* master page and name it *OfficeAssignments.aspx*.</span></span> <span data-ttu-id="782fa-261">新增下列標記，即可`Content`控制項，名為`Content2`:</span><span class="sxs-lookup"><span data-stu-id="782fa-261">Add the following markup to the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample13.aspx)]

<span data-ttu-id="782fa-262">請注意，在`DataKeyNames`屬性，指定標記`Timestamp`屬性，以及記錄的索引鍵 (`InstructorID`)。</span><span class="sxs-lookup"><span data-stu-id="782fa-262">Notice that in the `DataKeyNames` attribute, the markup specifies the `Timestamp` property as well as the record key (`InstructorID`).</span></span> <span data-ttu-id="782fa-263">指定屬性中的`DataKeyNames`屬性使控制項將它們儲存在控制項的狀態 （也就是類似於檢視狀態），以讓回傳的處理期間會使用原始值。</span><span class="sxs-lookup"><span data-stu-id="782fa-263">Specifying properties in the `DataKeyNames` attribute causes the control to save them in control state (which is similar to view state) so that the original values are available during postback processing.</span></span>

<span data-ttu-id="782fa-264">如果您未儲存`Timestamp`值，Entity Framework 不會有它`Where`子句的 sql`Update`命令。</span><span class="sxs-lookup"><span data-stu-id="782fa-264">If you didn't save the `Timestamp` value, the Entity Framework would not have it for the `Where` clause of the SQL `Update` command.</span></span> <span data-ttu-id="782fa-265">因此不會找到更新。</span><span class="sxs-lookup"><span data-stu-id="782fa-265">Consequently nothing would be found to update.</span></span> <span data-ttu-id="782fa-266">如此一來，Entity Framework 會擲回例外狀況開放式並行存取每次`OfficeAssignment`更新實體。</span><span class="sxs-lookup"><span data-stu-id="782fa-266">As a result, the Entity Framework would throw an optimistic concurrency exception every time an `OfficeAssignment` entity is updated.</span></span>

<span data-ttu-id="782fa-267">開啟*OfficeAssignments.aspx.cs*並新增下列`using`資料存取層的陳述式：</span><span class="sxs-lookup"><span data-stu-id="782fa-267">Open *OfficeAssignments.aspx.cs* and add the following `using` statement for the data access layer:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample14.cs)]

<span data-ttu-id="782fa-268">新增下列`Page_Init`方法，可讓動態資料功能。</span><span class="sxs-lookup"><span data-stu-id="782fa-268">Add the following `Page_Init` method, which enables Dynamic Data functionality.</span></span> <span data-ttu-id="782fa-269">也將新增的下列處理常式`ObjectDataSource`控制項的`Updated`事件，檢查是否有並行存取錯誤：</span><span class="sxs-lookup"><span data-stu-id="782fa-269">Also add the following handler for the `ObjectDataSource` control's `Updated` event in order to check for concurrency errors:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample15.cs)]

### <a name="testing-optimistic-concurrency-in-the-officeassignments-page"></a><span data-ttu-id="782fa-270">測試 [OfficeAssignments] 頁面中的開放式並行存取</span><span class="sxs-lookup"><span data-stu-id="782fa-270">Testing Optimistic Concurrency in the OfficeAssignments Page</span></span>

<span data-ttu-id="782fa-271">執行*OfficeAssignments.aspx*頁面。</span><span class="sxs-lookup"><span data-stu-id="782fa-271">Run the *OfficeAssignments.aspx* page.</span></span>

<span data-ttu-id="782fa-272">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image32.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-272">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image32.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image31.png)</span></span>

<span data-ttu-id="782fa-273">按一下 **編輯**資料列中，並在值變更**位置**資料行。</span><span class="sxs-lookup"><span data-stu-id="782fa-273">Click **Edit** in a row and change the value in the **Location** column.</span></span>

<span data-ttu-id="782fa-274">[![Image11](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image34.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-274">[![Image11](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image34.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image33.png)</span></span>

<span data-ttu-id="782fa-275">開啟新的瀏覽器視窗並執行頁面一次 （複製的 URL 從第一個瀏覽器視窗的第二個瀏覽器視窗）。</span><span class="sxs-lookup"><span data-stu-id="782fa-275">Open a new browser window and run the page again (copy the URL from the first browser window to the second browser window).</span></span>

<span data-ttu-id="782fa-276">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image36.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-276">[![Image10](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image36.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image35.png)</span></span>

<span data-ttu-id="782fa-277">按一下 **編輯**在同一個資料列您稍早編輯並變更**位置**為不同的值。</span><span class="sxs-lookup"><span data-stu-id="782fa-277">Click **Edit** in the same row you edited earlier and change the **Location** value to something different.</span></span>

<span data-ttu-id="782fa-278">[![Image12](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image38.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-278">[![Image12](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image38.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image37.png)</span></span>

<span data-ttu-id="782fa-279">在第二個瀏覽器視窗中，按一下**更新**。</span><span class="sxs-lookup"><span data-stu-id="782fa-279">In the second browser window, click **Update**.</span></span>

<span data-ttu-id="782fa-280">[![Image13](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image40.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image39.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-280">[![Image13](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image40.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image39.png)</span></span>

<span data-ttu-id="782fa-281">切換的第一個瀏覽器視窗，然後按一下**更新**。</span><span class="sxs-lookup"><span data-stu-id="782fa-281">Switch to the first browser window and click **Update**.</span></span>

<span data-ttu-id="782fa-282">[![Image15](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image42.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image41.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-282">[![Image15](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image42.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image41.png)</span></span>

<span data-ttu-id="782fa-283">您會看到一則錯誤訊息和**位置**值已更新為您在第二個瀏覽器視窗中，變更才會顯示值。</span><span class="sxs-lookup"><span data-stu-id="782fa-283">You see an error message and the **Location** value has been updated to show the value you changed it to in the second browser window.</span></span>

## <a name="handling-concurrency-with-the-entitydatasource-control"></a><span data-ttu-id="782fa-284">處理並行與 EntityDataSource 控制項</span><span class="sxs-lookup"><span data-stu-id="782fa-284">Handling Concurrency with the EntityDataSource Control</span></span>

<span data-ttu-id="782fa-285">`EntityDataSource`控制項包含可辨識資料模型中的並行設定的內建邏輯和處理更新，並據此刪除作業。</span><span class="sxs-lookup"><span data-stu-id="782fa-285">The `EntityDataSource` control includes built-in logic that recognizes the concurrency settings in the data model and handles update and delete operations accordingly.</span></span> <span data-ttu-id="782fa-286">不過，如同所有的例外狀況，您必須處理`OptimisticConcurrencyException`例外狀況自行以提供使用者易記錯誤訊息。</span><span class="sxs-lookup"><span data-stu-id="782fa-286">However, as with all exceptions, you must handle `OptimisticConcurrencyException` exceptions yourself in order to provide a user-friendly error message.</span></span>

<span data-ttu-id="782fa-287">接下來，您會設定*Courses.aspx*網頁 (使用`EntityDataSource`控制項) 允許更新和刪除作業，並顯示錯誤訊息，如果發生並行衝突。</span><span class="sxs-lookup"><span data-stu-id="782fa-287">Next, you will configure the *Courses.aspx* page (which uses an `EntityDataSource` control) to allow update and delete operations and to display an error message if a concurrency conflict occurs.</span></span> <span data-ttu-id="782fa-288">`Course`實體沒有追蹤的資料行，所以您將使用相同的方法與並行`Department`實體： 追蹤所有的非索引鍵屬性的值。</span><span class="sxs-lookup"><span data-stu-id="782fa-288">The `Course` entity doesn't have a concurrency tracking column, so you will use the same method that you did with the `Department` entity: track the values of all non-key properties.</span></span>

<span data-ttu-id="782fa-289">開啟*SchoolModel.edmx*檔案。</span><span class="sxs-lookup"><span data-stu-id="782fa-289">Open the *SchoolModel.edmx* file.</span></span> <span data-ttu-id="782fa-290">非索引鍵屬性的`Course`實體 (`Title`， `Credits`，以及`DepartmentID`)，將**並行模式**屬性設`Fixed`。</span><span class="sxs-lookup"><span data-stu-id="782fa-290">For the non-key properties of the `Course` entity (`Title`, `Credits`, and `DepartmentID`), set the **Concurrency Mode** property to `Fixed`.</span></span> <span data-ttu-id="782fa-291">然後儲存並關閉資料模型。</span><span class="sxs-lookup"><span data-stu-id="782fa-291">Then save and close the data model.</span></span>

<span data-ttu-id="782fa-292">開啟*Courses.aspx*頁面並進行下列變更：</span><span class="sxs-lookup"><span data-stu-id="782fa-292">Open the *Courses.aspx* page and make the following changes:</span></span>

- <span data-ttu-id="782fa-293">在 `CoursesEntityDataSource`控制項，新增`EnableUpdate="true"`和`EnableDelete="true"`屬性。</span><span class="sxs-lookup"><span data-stu-id="782fa-293">In the `CoursesEntityDataSource` control, add `EnableUpdate="true"` and `EnableDelete="true"` attributes.</span></span> <span data-ttu-id="782fa-294">該控制項的開頭標記現在會類似下列範例：</span><span class="sxs-lookup"><span data-stu-id="782fa-294">The opening tag for that control now resembles the following example:</span></span>

    [!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample16.aspx)]
- <span data-ttu-id="782fa-295">在 `CoursesGridView`控制項，變更`DataKeyNames`屬性值來`"CourseID,Title,Credits,DepartmentID"`。</span><span class="sxs-lookup"><span data-stu-id="782fa-295">In the `CoursesGridView` control, change the `DataKeyNames` attribute value to `"CourseID,Title,Credits,DepartmentID"`.</span></span> <span data-ttu-id="782fa-296">然後新增`CommandField`項目`Columns`顯示的項目**編輯**並**刪除**按鈕 (`<asp:CommandField ShowEditButton="True" ShowDeleteButton="True" />`)。</span><span class="sxs-lookup"><span data-stu-id="782fa-296">Then add a `CommandField` element to the `Columns` element that shows **Edit** and **Delete** buttons (`<asp:CommandField ShowEditButton="True" ShowDeleteButton="True" />`).</span></span> <span data-ttu-id="782fa-297">`GridView`控制項現在會類似下列範例：</span><span class="sxs-lookup"><span data-stu-id="782fa-297">The `GridView` control now resembles the following example:</span></span>

    [!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample17.aspx)]

<span data-ttu-id="782fa-298">執行網頁並建立衝突情況，如同您先前在 [部門] 頁面中。</span><span class="sxs-lookup"><span data-stu-id="782fa-298">Run the page and create a conflict situation as you did before in the Departments page.</span></span> <span data-ttu-id="782fa-299">在兩個瀏覽器視窗中執行的頁面中，按一下**編輯**在同一個列在每個視窗中，並在每個不同的變更。</span><span class="sxs-lookup"><span data-stu-id="782fa-299">Run the page in two browser windows, click **Edit** in the same line in each window, and make a different change in each one.</span></span> <span data-ttu-id="782fa-300">按一下 **更新**在一個視窗，然後按一下**更新**在其他視窗中。</span><span class="sxs-lookup"><span data-stu-id="782fa-300">Click **Update** in one window and then click **Update** in the other window.</span></span> <span data-ttu-id="782fa-301">當您按一下 **更新**第二個階段中，您會看到錯誤頁面所產生的未處理的並行存取例外狀況。</span><span class="sxs-lookup"><span data-stu-id="782fa-301">When you click **Update** the second time, you see the error page that results from an unhandled concurrency exception.</span></span>

<span data-ttu-id="782fa-302">[![Image22](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image44.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-302">[![Image22](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image44.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image43.png)</span></span>

<span data-ttu-id="782fa-303">處理此錯誤，非常類似於您對它所做的處理方式`ObjectDataSource`控制項。</span><span class="sxs-lookup"><span data-stu-id="782fa-303">You handle this error in a manner very similar to how you handled it for the `ObjectDataSource` control.</span></span> <span data-ttu-id="782fa-304">開啟*Courses.aspx*頁面上，然後在`CoursesEntityDataSource`控制項，指定的處理常式`Deleted`和`Updated`事件。</span><span class="sxs-lookup"><span data-stu-id="782fa-304">Open the *Courses.aspx* page, and in the `CoursesEntityDataSource` control, specify handlers for the `Deleted` and `Updated` events.</span></span> <span data-ttu-id="782fa-305">控制項的開頭標記現在會類似下列範例：</span><span class="sxs-lookup"><span data-stu-id="782fa-305">The opening tag of the control now resembles the following example:</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample18.aspx)]

<span data-ttu-id="782fa-306">再`CoursesGridView`控制項，新增下列`ValidationSummary`控制項：</span><span class="sxs-lookup"><span data-stu-id="782fa-306">Before the `CoursesGridView` control, add the following `ValidationSummary` control:</span></span>

[!code-aspx[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample19.aspx)]

<span data-ttu-id="782fa-307">在  *Courses.aspx.cs*，新增`using`陳述式`System.Data`命名空間新增一個方法，檢查並行存取例外狀況，以及加入處理常式`EntityDataSource`控制項的`Updated`和`Deleted`處理常式。</span><span class="sxs-lookup"><span data-stu-id="782fa-307">In *Courses.aspx.cs*, add a `using` statement for the `System.Data` namespace, add a method that checks for concurrency exceptions, and add handlers for the `EntityDataSource` control's `Updated` and `Deleted` handlers.</span></span> <span data-ttu-id="782fa-308">程式碼看起來如下所示：</span><span class="sxs-lookup"><span data-stu-id="782fa-308">The code will look like the following:</span></span>

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample20.cs)]

[!code-csharp[Main](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/samples/sample21.cs)]

<span data-ttu-id="782fa-309">這個程式碼，您對唯一的差別`ObjectDataSource`控制項，不在此情況下的並行存取例外狀況都是`Exception`屬性的事件引數物件中，而不是在該例外狀況`InnerException`屬性。</span><span class="sxs-lookup"><span data-stu-id="782fa-309">The only difference between this code and what you did for the `ObjectDataSource` control is that in this case the concurrency exception is in the `Exception` property of the event arguments object rather than in that exception's `InnerException` property.</span></span>

<span data-ttu-id="782fa-310">執行頁面，然後重新建立並行衝突。</span><span class="sxs-lookup"><span data-stu-id="782fa-310">Run the page and create a concurrency conflict again.</span></span> <span data-ttu-id="782fa-311">此時您會看到一則錯誤訊息：</span><span class="sxs-lookup"><span data-stu-id="782fa-311">This time you see an error message:</span></span>

<span data-ttu-id="782fa-312">[![Image23](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image46.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image45.png)</span><span class="sxs-lookup"><span data-stu-id="782fa-312">[![Image23](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image46.png)](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application/_static/image45.png)</span></span>

<span data-ttu-id="782fa-313">如此即完成了處理並行衝突的簡介。</span><span class="sxs-lookup"><span data-stu-id="782fa-313">This completes the introduction to handling concurrency conflicts.</span></span> <span data-ttu-id="782fa-314">下一個教學課程將提供有關如何在使用 Entity Framework 的 web 應用程式中改善效能的指引。</span><span class="sxs-lookup"><span data-stu-id="782fa-314">The next tutorial will provide guidance on how to improve performance in a web application that uses the Entity Framework.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="782fa-315">[上一頁](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)
> [下一頁](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application.md)</span><span class="sxs-lookup"><span data-stu-id="782fa-315">[Previous](using-the-entity-framework-and-the-objectdatasource-control-part-3-sorting-and-filtering.md)
[Next](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application.md)</span></span>
