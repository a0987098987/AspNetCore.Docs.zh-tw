---
uid: web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-content-page-from-the-master-page-cs
title: 內容從與頁面互動主版頁面 (C#) |Microsoft Docs
author: rick-anderson
description: 檢驗如何呼叫方法時，由主版頁面的程式碼中設定屬性的 [內容] 頁面等等。
ms.author: aspnetcontent
ms.date: 07/11/2008
ms.assetid: 3282df5e-516c-4972-8666-313828b90fb5
msc.legacyurl: /web-forms/overview/older-versions-getting-started/master-pages/interacting-with-the-content-page-from-the-master-page-cs
msc.type: authoredcontent
ms.openlocfilehash: 293e4dab6142393c9d57836a2f04244388e54cec
ms.sourcegitcommit: b28cd0313af316c051c2ff8549865bff67f2fbb4
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/05/2018
ms.locfileid: "37808362"
---
<a name="interacting-with-the-content-page-from-the-master-page-c"></a><span data-ttu-id="1bbfd-103">內容從與頁面互動主版頁面 (C#)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-103">Interacting with the Content Page from the Master Page (C#)</span></span>
====================
<span data-ttu-id="1bbfd-104">藉由[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="1bbfd-105">[下載程式碼](http://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_07_CS.zip)或[下載 PDF](http://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_07_CS.pdf)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-105">[Download Code](http://download.microsoft.com/download/1/8/4/184e24fa-fcc8-47fa-ac99-4b6a52d41e97/ASPNET_MasterPages_Tutorial_07_CS.zip) or [Download PDF](http://download.microsoft.com/download/e/b/4/eb4abb10-c416-4ba4-9899-32577715b1bd/ASPNET_MasterPages_Tutorial_07_CS.pdf)</span></span>

> <span data-ttu-id="1bbfd-106">檢驗如何呼叫方法時，由主版頁面的程式碼中設定屬性的 [內容] 頁面等等。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-106">Examines how to call methods, set properties, etc. of the Content Page from code in the Master Page.</span></span>


## <a name="introduction"></a><span data-ttu-id="1bbfd-107">簡介</span><span class="sxs-lookup"><span data-stu-id="1bbfd-107">Introduction</span></span>

<span data-ttu-id="1bbfd-108">前述教學課程檢驗如何讓 [內容] 頁面，以程式設計方式與其主版頁面互動。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-108">The preceding tutorial examined how to have the content page programmatically interact with its master page.</span></span> <span data-ttu-id="1bbfd-109">我們已更新以包含列出五個最近的 GridView 控制項的主版頁面的重新叫用加入產品。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-109">Recall that we updated the master page to include a GridView control that listed the five most recently added products.</span></span> <span data-ttu-id="1bbfd-110">然後，我們會建立內容頁面的使用者可以加入新的產品。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-110">We then created a content page from which the user could add a new product.</span></span> <span data-ttu-id="1bbfd-111">在新的產品，[內容] 頁面所需以指示主版頁面重新整理其 GridView，使它會包含剛加入的產品。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-111">Upon adding a new product, the content page needed to instruct the master page to refresh its GridView so that it would include the just-added product.</span></span> <span data-ttu-id="1bbfd-112">這項功能被透過將公用方法新增至主版頁面，重新整理資料繫結至 GridView，，然後叫用該方法，從 [內容] 頁面。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-112">This functionality was accomplished by adding a public method to the master page that refreshed the data bound to the GridView, and then invoking that method from the content page.</span></span>

<span data-ttu-id="1bbfd-113">最常見的內容和主版頁面互動形式源自於 [內容] 頁面。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-113">The most common form of content and master page interaction originates from the content page.</span></span> <span data-ttu-id="1bbfd-114">不過，可能成可採取行動，rouse 目前的內容頁面的主版頁面，而且可能需要這類功能，如果主版頁面包含使用者介面項目，讓使用者能夠修改也會顯示在 [內容] 頁面的資料。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-114">However, it is possible for the master page to rouse the current content page into action, and such functionality may be needed if the master page contains user interface elements that enable users to modify data that is also displayed on the content page.</span></span> <span data-ttu-id="1bbfd-115">請考慮內容頁面，顯示產品資訊，在 GridView 控制項和主版頁面，其中包含一個按鈕控制項，按下時，所有產品的價格將增加一倍。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-115">Consider a content page that displays the products information in a GridView control and a master page that includes a Button control that, when clicked, doubles the prices of all products.</span></span> <span data-ttu-id="1bbfd-116">如同先前的教學課程的範例，GridView 需要重新整理 double 的價格，以顯示新的價格，按下按鈕之後，但在此案例中，它是主版頁面需要 rouse 成可採取行動的 [內容] 頁面。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-116">Much like the example in the preceding tutorial, the GridView needs to be refreshed after the double price Button is clicked so that it displays the new prices, but in this scenario it's the master page that needs to rouse the content page into action.</span></span>

<span data-ttu-id="1bbfd-117">本教學課程將探討如何叫用功能，在 [內容] 頁面中定義的主版頁面。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-117">This tutorial explores how to have the master page invoke functionality defined in the content page.</span></span>

### <a name="instigating-programmatic-interaction-via-an-event-and-event-handlers"></a><span data-ttu-id="1bbfd-118">透過事件和事件處理常式進行程式設計互動</span><span class="sxs-lookup"><span data-stu-id="1bbfd-118">Instigating Programmatic Interaction via an Event and Event Handlers</span></span>

<span data-ttu-id="1bbfd-119">叫用的主版頁面的內容頁面功能是比反過來要好更具挑戰性。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-119">Invoking content page functionality from a master page is more challenging than the other way around.</span></span> <span data-ttu-id="1bbfd-120">因為內容頁面時進行程式設計互動，從 [內容] 頁面，具有單一的主版頁面中，我們知道公用方法與屬性，供我們運用。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-120">Because a content page has a single master page, when instigating the programmatic interaction from the content page we know what public methods and properties are at our disposal.</span></span> <span data-ttu-id="1bbfd-121">不過，主版頁面，可以有許多不同內容頁面，各有自己一組屬性和方法。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-121">A master page, however, can have many different content pages, each with its own set of properties and methods.</span></span> <span data-ttu-id="1bbfd-122">我們要如何，然後撰寫程式碼主版頁面，以在其內容頁面中執行某些動作，當我們不知道哪些內容的頁面將會叫用，直到執行階段中？</span><span class="sxs-lookup"><span data-stu-id="1bbfd-122">How, then, can we write code in the master page to perform some action in its content page when we don't know what content page will be invoked until runtime?</span></span>

<span data-ttu-id="1bbfd-123">請考慮為 ASP.NET Web 控制項，例如按鈕控制項。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-123">Consider an ASP.NET Web control, such as the Button control.</span></span> <span data-ttu-id="1bbfd-124">按鈕控制項可以顯示在任意數目的 ASP.NET 網頁，而且需要用它可以警示頁面，它已按下的機制。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-124">A Button control can appear on any number of ASP.NET pages and needs a mechanism by which it can alert the page that it has been clicked.</span></span> <span data-ttu-id="1bbfd-125">這利用完成*事件*。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-125">This is accomplished using *events*.</span></span> <span data-ttu-id="1bbfd-126">特別是，按鈕控制項會引發其`Click`事件按一下; 時，包含按鈕的 ASP.NET 網頁 （選擇性） 可以回應透過該通知*事件處理常式*。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-126">In particular, the Button control raises its `Click` event when it is clicked; the ASP.NET page that contains the Button can optionally respond to that notification via an *event handler*.</span></span>

<span data-ttu-id="1bbfd-127">這個相同的模式可用來在其內容頁面的主版頁面觸發程序功能：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-127">This same pattern can be used to have a master page trigger functionality in its content pages:</span></span>

1. <span data-ttu-id="1bbfd-128">加入主版頁面中的事件。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-128">Add an event to the master page.</span></span>
2. <span data-ttu-id="1bbfd-129">引發事件，每當需要其內容的頁面與通訊的主版頁面。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-129">Raise the event whenever the master page needs to communicate with its content page.</span></span> <span data-ttu-id="1bbfd-130">比方說，如果主版頁面需要提醒其內容的頁面使用者加倍價格，其事件就會引發緊接著價格超過一倍。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-130">For example, if the master page needs to alert its content page that the user has doubled the prices, its event would be raised immediately after the prices have been doubled.</span></span>
3. <span data-ttu-id="1bbfd-131">在需要採取某些動作的內容頁面中的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-131">Create an event handler in those content pages that need to take some action.</span></span>

<span data-ttu-id="1bbfd-132">本教學課程的其餘部分會實作簡介; 中所述的範例也就是列出資料庫中的產品內容頁面和主版頁面，其中包含一個按鈕控制價格的兩倍。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-132">This remainder of this tutorial implements the example outlined in the Introduction; namely, a content page that lists the products in the database and a master page that includes a Button control to double the prices.</span></span>

## <a name="step-1-displaying-products-in-a-content-page"></a><span data-ttu-id="1bbfd-133">步驟 1： 在內容上顯示的產品</span><span class="sxs-lookup"><span data-stu-id="1bbfd-133">Step 1: Displaying Products in a Content Page</span></span>

<span data-ttu-id="1bbfd-134">我們第一要務是建立內容的頁面，其中列出 Northwind 資料庫中的產品。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-134">Our first order of business is to create a content page that lists the products from the Northwind database.</span></span> <span data-ttu-id="1bbfd-135">(我們在先前的教學課程中，加入至專案的 Northwind 資料庫[*與主版頁面，從內容頁互動*](interacting-with-the-master-page-from-the-content-page-cs.md)。)藉由新增新的 ASP.NET 頁面，以啟動`~/Admin`名為資料夾`Products.aspx`，並確定將它繫結`Site.master`主版頁面。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-135">(We added the Northwind database to the project in the preceding tutorial, [*Interacting with the Master Page from the Content Page*](interacting-with-the-master-page-from-the-content-page-cs.md).) Start by adding a new ASP.NET page to the `~/Admin` folder named `Products.aspx`, making sure to bind it to the `Site.master` master page.</span></span> <span data-ttu-id="1bbfd-136">此頁面已加入至網站之後，圖 1 顯示 方案總管。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-136">Figure 1 shows the Solution Explorer after this page has been added to the website.</span></span>


<span data-ttu-id="1bbfd-137">[![將新的 ASP.NET 網頁新增至 [Admin] 資料夾](interacting-with-the-content-page-from-the-master-page-cs/_static/image2.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-137">[![Add a New ASP.NET Page to the Admin Folder](interacting-with-the-content-page-from-the-master-page-cs/_static/image2.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image1.png)</span></span>

<span data-ttu-id="1bbfd-138">**圖 01**： 加入新的 ASP.NET 頁面，以便`Admin`資料夾 ([按一下以檢視完整大小的影像](interacting-with-the-content-page-from-the-master-page-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="1bbfd-138">**Figure 01**: Add a New ASP.NET Page to the `Admin` Folder ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image3.png))</span></span>


<span data-ttu-id="1bbfd-139">請注意，在[*指定主版頁面的標題、 中繼標籤及其他 HTML 標頭*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md)教學課程中我們建立名為自訂的基底頁面類別`BasePage`如果不是產生頁面的標題明確地設定。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-139">Recall that in the [*Specifying the Title, Meta Tags, and Other HTML Headers in the Master Page*](specifying-the-title-meta-tags-and-other-html-headers-in-the-master-page-cs.md) tutorial we created a custom base page class named `BasePage` that generates the page's title if it is not explicitly set.</span></span> <span data-ttu-id="1bbfd-140">移至`Products.aspx`頁面的程式碼後置類別，並讓它衍生自`BasePage`(而不是從`System.Web.UI.Page`)。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-140">Go to the `Products.aspx` page's code-behind class and have it derive from `BasePage` (instead of from `System.Web.UI.Page`).</span></span>

<span data-ttu-id="1bbfd-141">最後，更新`Web.sitemap`檔案，以包含這一課中的項目。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-141">Finally, update the `Web.sitemap` file to include an entry for this lesson.</span></span> <span data-ttu-id="1bbfd-142">加入下列標記下方`<siteMapNode>`針對至主版頁面互動課程內容：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-142">Add the following markup beneath the `<siteMapNode>` for the Content to Master Page Interaction lesson:</span></span>


[!code-xml[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample1.xml)]

<span data-ttu-id="1bbfd-143">這個加法`<siteMapNode>`項目會反映在課程清單 （請參閱 [圖 5]）。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-143">The addition of this `<siteMapNode>` element is reflected in the Lessons list (see Figure 5).</span></span>

<span data-ttu-id="1bbfd-144">返回`Products.aspx`。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-144">Return to `Products.aspx`.</span></span> <span data-ttu-id="1bbfd-145">在適用於內容的控制項`MainContent`，將 GridView 控制項並命名它`ProductsGrid`。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-145">In the Content control for `MainContent`, add a GridView control and name it `ProductsGrid`.</span></span> <span data-ttu-id="1bbfd-146">繫結至新的 SqlDataSource 控制項，名為的 GridView `ProductsDataSource`。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-146">Bind the GridView to a new SqlDataSource control named `ProductsDataSource`.</span></span>


<span data-ttu-id="1bbfd-147">[![繫結至新的 SqlDataSource 控制項的 GridView](interacting-with-the-content-page-from-the-master-page-cs/_static/image5.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-147">[![Bind the GridView to a New SqlDataSource Control](interacting-with-the-content-page-from-the-master-page-cs/_static/image5.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image4.png)</span></span>

<span data-ttu-id="1bbfd-148">**圖 02**： 將 GridView 繫結至新的 SqlDataSource 控制項 ([按一下以檢視完整大小的影像](interacting-with-the-content-page-from-the-master-page-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="1bbfd-148">**Figure 02**: Bind the GridView to a New SqlDataSource Control  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image6.png))</span></span>


<span data-ttu-id="1bbfd-149">因此，它會使用 Northwind 資料庫，請設定精靈。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-149">Configure the wizard so that it uses the Northwind database.</span></span> <span data-ttu-id="1bbfd-150">如果您已完成上一個教學課程，則您應該已經有名稱為的連接字串`NorthwindConnectionString`在`Web.config`。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-150">If you worked through the previous tutorial then you should already have a connection string named `NorthwindConnectionString` in `Web.config`.</span></span> <span data-ttu-id="1bbfd-151">圖 3 所示，請從下拉式清單中，選擇此連接字串。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-151">Choose this connection string from the drop-down list, as shown in Figure 3.</span></span>


<span data-ttu-id="1bbfd-152">[![設定為使用 Northwind 資料庫 SqlDataSource](interacting-with-the-content-page-from-the-master-page-cs/_static/image8.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-152">[![Configure the SqlDataSource to Use the Northwind Database](interacting-with-the-content-page-from-the-master-page-cs/_static/image8.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image7.png)</span></span>

<span data-ttu-id="1bbfd-153">**圖 03**： 設定為使用 Northwind 資料庫 SqlDataSource ([按一下以檢視完整大小的影像](interacting-with-the-content-page-from-the-master-page-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="1bbfd-153">**Figure 03**: Configure the SqlDataSource to Use the Northwind Database  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image9.png))</span></span>


<span data-ttu-id="1bbfd-154">接下來，指定資料來源控制項的`SELECT`陳述式，從下拉式清單中選擇 產品 資料表，並傳回`ProductName`和`UnitPrice`（請參閱 圖 4） 的資料行。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-154">Next, specify the data source control's `SELECT` statement by choosing the Products table from the drop-down list and returning the `ProductName` and `UnitPrice` columns (see Figure 4).</span></span> <span data-ttu-id="1bbfd-155">按一下 下一步，然後完成 以完成設定資料來源精靈</span><span class="sxs-lookup"><span data-stu-id="1bbfd-155">Click Next and then Finish to complete the Configure Data Source wizard.</span></span>


<span data-ttu-id="1bbfd-156">[![傳回從 Products 資料表的 [ProductName] 和 UnitPrice 欄位](interacting-with-the-content-page-from-the-master-page-cs/_static/image11.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-156">[![Return the ProductName and UnitPrice Fields from the Products Table](interacting-with-the-content-page-from-the-master-page-cs/_static/image11.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image10.png)</span></span>

<span data-ttu-id="1bbfd-157">**圖 04**： 傳回`ProductName`並`UnitPrice`欄位從`Products`資料表 ([按一下以檢視完整大小的影像](interacting-with-the-content-page-from-the-master-page-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="1bbfd-157">**Figure 04**: Return the `ProductName` and `UnitPrice` Fields from the `Products` Table  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image12.png))</span></span>


<span data-ttu-id="1bbfd-158">這樣就完成了 ！</span><span class="sxs-lookup"><span data-stu-id="1bbfd-158">That's all there is to it!</span></span> <span data-ttu-id="1bbfd-159">完成精靈之後 Visual Studio 會將兩個 BoundFields 加入至 GridView，以鏡像 SqlDataSource 控制項所傳回的兩個欄位。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-159">After completing the wizard Visual Studio adds two BoundFields to the GridView to mirror the two fields returned by the SqlDataSource control.</span></span> <span data-ttu-id="1bbfd-160">GridView 和 SqlDataSource 控制項的標記會遵循。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-160">The GridView and SqlDataSource controls' markup follows.</span></span> <span data-ttu-id="1bbfd-161">[圖 5] 顯示透過瀏覽器檢視時的結果。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-161">Figure 5 shows the results when viewed through a browser.</span></span>


[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample2.aspx)]


<span data-ttu-id="1bbfd-162">[![每個產品而其價格則列於 GridView](interacting-with-the-content-page-from-the-master-page-cs/_static/image14.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-162">[![Each Product and its Price is Listed in the GridView](interacting-with-the-content-page-from-the-master-page-cs/_static/image14.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image13.png)</span></span>

<span data-ttu-id="1bbfd-163">**圖 05**： 每個產品而其價格則列於 GridView ([按一下以檢視完整大小的影像](interacting-with-the-content-page-from-the-master-page-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="1bbfd-163">**Figure 05**: Each Product and its Price is Listed in the GridView  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image15.png))</span></span>


> [!NOTE]
> <span data-ttu-id="1bbfd-164">請放心清除 GridView 的外觀。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-164">Feel free to clean up the appearance of the GridView.</span></span> <span data-ttu-id="1bbfd-165">一些建議包括格式化為貨幣顯示的 UnitPrice 值和使用背景色彩和字型來改善格線的外觀。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-165">Some suggestions include formatting the displayed UnitPrice value as a currency and using background colors and fonts to improve the grid's appearance.</span></span> <span data-ttu-id="1bbfd-166">如需有關顯示和設定在 ASP.NET 中的資料格式的詳細資訊，請參閱我[使用資料的教學課程系列](../../data-access/index.md)。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-166">For more information on displaying and formatting data in ASP.NET, refer to my [Working with Data tutorial series](../../data-access/index.md).</span></span>


## <a name="step-2-adding-a-double-prices-button-to-the-master-page"></a><span data-ttu-id="1bbfd-167">步驟 2： 將 Double 的價格按鈕新增至主版頁面</span><span class="sxs-lookup"><span data-stu-id="1bbfd-167">Step 2: Adding a Double Prices Button to the Master Page</span></span>

<span data-ttu-id="1bbfd-168">下一步是將按鈕 Web 控制項至主要頁面上，按一下時，將兩倍的資料庫中的所有產品的價格。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-168">Our next task is to add a Button Web control to the master page that, when clicked, will double the price of all products in the database.</span></span> <span data-ttu-id="1bbfd-169">開啟`Site.master`主版頁面，並從工具箱拖曳至設計工具中，放置下方拖曳一個按鈕`RecentProductsDataSource`我們在上一個教學課程中新增的 SqlDataSource 控制項。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-169">Open the `Site.master` master page and drag a Button from the Toolbox onto the Designer, placing it beneath the `RecentProductsDataSource` SqlDataSource control we added in the previous tutorial.</span></span> <span data-ttu-id="1bbfd-170">將按鈕的`ID`屬性，以`DoublePrice`及其`Text`"Double 產品價格 」 的屬性。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-170">Set the Button's `ID` property to `DoublePrice` and its `Text` property to "Double Product Prices".</span></span>

<span data-ttu-id="1bbfd-171">接下來，將 SqlDataSource 控制項新增至主版頁面，並將它命名為`DoublePricesDataSource`。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-171">Next, add a SqlDataSource control to the master page, naming it `DoublePricesDataSource`.</span></span> <span data-ttu-id="1bbfd-172">將用來執行此 SqlDataSource`UPDATE`所有價格的兩倍的陳述式。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-172">This SqlDataSource will be used to execute the `UPDATE` statement to double all prices.</span></span> <span data-ttu-id="1bbfd-173">具體來說，我們要設定其`ConnectionString`並`UpdateCommand`屬性，以適當的連接字串和`UPDATE`陳述式。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-173">Specifically, we need to set its `ConnectionString` and `UpdateCommand` properties to the appropriate connection string and `UPDATE` statement.</span></span> <span data-ttu-id="1bbfd-174">然後我們要呼叫此 SqlDataSource 控制項的`Update`方法時`DoublePrice`按一下按鈕時。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-174">Then we need to call this SqlDataSource control's `Update` method when the `DoublePrice` Button is clicked.</span></span> <span data-ttu-id="1bbfd-175">若要設定`ConnectionString`和`UpdateCommand`屬性，選取 SqlDataSource 控制項，然後移至 [屬性] 視窗。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-175">To set the `ConnectionString` and `UpdateCommand` properties, select the SqlDataSource control and then go to the Properties window.</span></span> <span data-ttu-id="1bbfd-176">`ConnectionString`屬性會列出已儲存在這些連接字串`Web.config`在下拉式清單中，選擇`NorthwindConnectionString`選項，如 [圖 6] 所示。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-176">The `ConnectionString` property lists those connection strings already stored in `Web.config` in a drop-down list; choose the `NorthwindConnectionString` option as shown in Figure 6.</span></span>


<span data-ttu-id="1bbfd-177">[![設定要使用 NorthwindConnectionString SqlDataSource](interacting-with-the-content-page-from-the-master-page-cs/_static/image17.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-177">[![Configure the SqlDataSource to Use the NorthwindConnectionString](interacting-with-the-content-page-from-the-master-page-cs/_static/image17.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image16.png)</span></span>

<span data-ttu-id="1bbfd-178">**圖 06**： 設定要使用 SqlDataSource `NorthwindConnectionString` ([按一下以檢視完整大小的影像](interacting-with-the-content-page-from-the-master-page-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="1bbfd-178">**Figure 06**: Configure the SqlDataSource to Use the `NorthwindConnectionString` ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image18.png))</span></span>


<span data-ttu-id="1bbfd-179">若要設定`UpdateCommand`屬性，在 [屬性] 視窗中找出 UpdateQuery 選項。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-179">To set the `UpdateCommand` property, locate the UpdateQuery option in the Properties window.</span></span> <span data-ttu-id="1bbfd-180">選取時，這個屬性會顯示具有省略符號; 的按鈕按一下此按鈕即可顯示 [圖 7] 所示的命令及參數編輯器對話方塊。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-180">This property, when selected, displays a button with ellipses; click this button to display the Command and Parameter Editor dialog box shown in Figure 7.</span></span> <span data-ttu-id="1bbfd-181">輸入下列命令`UPDATE`陳述式，在對話方塊的文字方塊：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-181">Type the following `UPDATE` statement into the dialog box's textbox:</span></span>


[!code-sql[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample3.sql)]

<span data-ttu-id="1bbfd-182">此陳述式，在執行時，將會加倍`UnitPrice`值中的每一筆記錄`Products`資料表。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-182">This statement, when executed, will double the `UnitPrice` value for each record in the `Products` table.</span></span>


<span data-ttu-id="1bbfd-183">[![設定 SqlDataSource 的 UpdateCommand 屬性](interacting-with-the-content-page-from-the-master-page-cs/_static/image20.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-183">[![Set SqlDataSource's UpdateCommand Property](interacting-with-the-content-page-from-the-master-page-cs/_static/image20.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image19.png)</span></span>

<span data-ttu-id="1bbfd-184">**圖 07**： 設定 SqlDataSource`UpdateCommand`屬性 ([按一下以檢視完整大小的影像](interacting-with-the-content-page-from-the-master-page-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="1bbfd-184">**Figure 07**: Set SqlDataSource's `UpdateCommand` Property  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image21.png))</span></span>


<span data-ttu-id="1bbfd-185">設定這些屬性之後, 您按鈕和 SqlDataSource 控制項的宣告式標記看起來應該如下所示：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-185">After setting these properties, your Button and SqlDataSource controls' declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample4.aspx)]

<span data-ttu-id="1bbfd-186">是呼叫其`Update`方法時`DoublePrice`按一下按鈕時。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-186">All that remains is to call its `Update` method when the `DoublePrice` Button is clicked.</span></span> <span data-ttu-id="1bbfd-187">建立`Click`事件處理常式`DoublePrice` 按鈕，並新增下列程式碼：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-187">Create a `Click` event handler for the `DoublePrice` Button and add the following code:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample5.cs)]

<span data-ttu-id="1bbfd-188">若要測試這項功能，請瀏覽`~/Admin/Products.aspx`我們在步驟 1 中建立，然後按一下 「 雙重產品價格 」 按鈕的頁面。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-188">To test this functionality, visit the `~/Admin/Products.aspx` page we created in Step 1 and click the "Double Product Prices" button.</span></span> <span data-ttu-id="1bbfd-189">按一下此按鈕會導致回傳，執行`DoublePrice`按鈕的`Click`事件處理常式，使所有產品的價格加倍。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-189">Clicking the button causes a postback and executes the `DoublePrice` Button's `Click` event handler, doubling the prices of all products.</span></span> <span data-ttu-id="1bbfd-190">然後重新轉譯頁面的標記會傳回並重新顯示在瀏覽器中。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-190">The page is then re-rendered and the markup is returned and re-displayed in the browser.</span></span> <span data-ttu-id="1bbfd-191">GridView，在 [內容] 頁面中，不過，會列出相同的價格為"Double 的產品價格 」 之前所按的按鈕。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-191">The GridView in the content page, however, lists the same prices as before the "Double Product Prices" button was clicked.</span></span> <span data-ttu-id="1bbfd-192">這是因為一開始載入 GridView 內的資料必須儲存在檢視狀態，因此除非另有指示否則，它不會在回傳時載入其狀態。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-192">This is because the data initially loaded in the GridView had its state stored in view state, so it's not reloaded on postbacks unless instructed otherwise.</span></span> <span data-ttu-id="1bbfd-193">如果您瀏覽不同的頁面，然後再傳回給`~/Admin/Products.aspx`頁面，您會看到更新的價格。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-193">If you visit a different page and then return to the `~/Admin/Products.aspx` page you'll see the updated prices.</span></span>

## <a name="step-3-raising-an-event-when-the-prices-are-doubled"></a><span data-ttu-id="1bbfd-194">步驟 3： 引發事件時的價格會增加一倍</span><span class="sxs-lookup"><span data-stu-id="1bbfd-194">Step 3: Raising an Event When the Prices are Doubled</span></span>

<span data-ttu-id="1bbfd-195">因為在 GridView`~/Admin/Products.aspx`頁面不會立即反映價格加倍，使用者可以理解的是認為，它們沒有按一下 「 雙重產品價格 」 按鈕，或無法運作。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-195">Because the GridView in the `~/Admin/Products.aspx` page does not immediately reflect the price doubling, a user may understandably think that they did not click the "Double Product Prices" button, or that it didn't work.</span></span> <span data-ttu-id="1bbfd-196">它們可能嘗試按一下按鈕多次，一再使價格加倍的幾個。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-196">They may try clicking the button a few more times, doubling the prices again and again.</span></span> <span data-ttu-id="1bbfd-197">若要修正此我們要在內容中的方格頁面會顯示新的價格，它們會增加一倍之後，立即。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-197">To fix this we need to have the grid in the content page display the new prices immediately after they are doubled.</span></span>

<span data-ttu-id="1bbfd-198">如稍早在本教學課程中所述，我們需要引發事件，主版頁面中的，每當使用者按一下`DoublePrice` 按鈕。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-198">As discussed earlier in this tutorial, we need to raise an event in the master page whenever the user clicks the `DoublePrice` Button.</span></span> <span data-ttu-id="1bbfd-199">事件是一個類別 （事件發行者） 的方式通知另一組有趣的東西發生其他類別 （事件訂閱者）。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-199">An event is a way for one class (an event publisher) to notify another a set of other classes (the event subscribers) that something interesting has occurred.</span></span> <span data-ttu-id="1bbfd-200">在此範例中，主版頁面是 「 事件發行者 」;這些內容頁面時關心`DoublePrice` 按鈕便是訂閱者。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-200">In this example, the master page is the event publisher; those content pages that care about when the `DoublePrice` Button is clicked are the subscribers.</span></span>

<span data-ttu-id="1bbfd-201">藉由建立訂閱事件的類別*事件處理常式*，這是執行以回應所引發的事件的方法。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-201">A class subscribes to an event by creating an *event handler*, which is a method that is executed in response to the event being raised.</span></span> <span data-ttu-id="1bbfd-202">發行者會定義他藉由定義所引發的事件*事件委派*。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-202">The publisher defines the events he raises by defining an *event delegate*.</span></span> <span data-ttu-id="1bbfd-203">事件委派指定的事件處理常式必須接受輸入的參數。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-203">The event delegate specifies what input parameters the event handler must accept.</span></span> <span data-ttu-id="1bbfd-204">在.NET Framework 中，事件委派執行不傳回任何值，並接受兩個輸入的參數：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-204">In the .NET Framework, event delegates do not return any value and accept two input parameters:</span></span>

- <span data-ttu-id="1bbfd-205">`Object`，這會識別事件來源，以及</span><span class="sxs-lookup"><span data-stu-id="1bbfd-205">An `Object`, which identifies the event source, and</span></span>
- <span data-ttu-id="1bbfd-206">衍生自的類別 `System.EventArgs`</span><span class="sxs-lookup"><span data-stu-id="1bbfd-206">A class derived from `System.EventArgs`</span></span>

<span data-ttu-id="1bbfd-207">傳遞給事件處理常式的第二個參數可以包含事件相關的其他資訊。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-207">The second parameter passed to an event handler can include additional information about the event.</span></span> <span data-ttu-id="1bbfd-208">雖然基底`EventArgs`類別不傳遞任何資訊、.NET Framework 包含數個擴充的類別`EventArgs`並包含其他屬性。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-208">While the base `EventArgs` class does not pass along any information, the .NET Framework includes a number of classes that extend `EventArgs` and encompass additional properties.</span></span> <span data-ttu-id="1bbfd-209">例如，`CommandEventArgs`執行個體傳遞至回應的事件處理常式`Command`事件，並包含兩個參考的屬性：`CommandArgument`和`CommandName`。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-209">For example, a `CommandEventArgs` instance is passed to event handlers that respond to the `Command` event, and includes two informational properties: `CommandArgument` and `CommandName`.</span></span>

> [!NOTE]
> <span data-ttu-id="1bbfd-210">如需有關如何建立的詳細資訊，提高，以及處理事件，請參閱[事件與委派](https://msdn.microsoft.com/library/17sde2xt.aspx)並[簡單 english 的事件委派](http://www.codeproject.com/KB/cs/eventdelegates.aspx)。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-210">For more information on creating, raising, and handling events, see [Events and Delegates](https://msdn.microsoft.com/library/17sde2xt.aspx) and [Event Delegates in Simple English](http://www.codeproject.com/KB/cs/eventdelegates.aspx).</span></span>


<span data-ttu-id="1bbfd-211">若要定義事件，請使用下列語法：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-211">To define an event use the following syntax:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample6.cs)]

<span data-ttu-id="1bbfd-212">因為我們只需要時使用者按下 [警示內容] 頁面`DoublePrice`按鈕並不需要傳遞任何額外的資訊，我們可以使用事件委派`EventHandler`，其為第二個定義可接受的事件處理常式參數型別的物件`System.EventArgs`。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-212">Because we only need to alert the content page when the user has clicked the `DoublePrice` Button and do not need to pass along any other additional information, we can use the event delegate `EventHandler`, which defines an event handler that accepts as its second parameter an object of type `System.EventArgs`.</span></span> <span data-ttu-id="1bbfd-213">若要建立主版頁面中的事件，請將下列程式碼行加入主版頁面的程式碼後置類別：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-213">To create the event in the master page, add the following line of code to the master page's code-behind class:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample7.cs)]

<span data-ttu-id="1bbfd-214">上述程式碼會將名為的主版頁面中的公用事件`PricesDoubled`。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-214">The above code adds a public event to the master page named `PricesDoubled`.</span></span> <span data-ttu-id="1bbfd-215">我們現在需要之後會引發這個事件價格超過一倍。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-215">We now need to raise this event after the prices have been doubled.</span></span> <span data-ttu-id="1bbfd-216">若要引發事件會使用下列語法：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-216">To raise an event use the following syntax:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample8.cs)]

<span data-ttu-id="1bbfd-217">何處*寄件者*並*eventArgs*是您想要傳遞給訂閱者的事件處理常式的值。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-217">Where *sender* and *eventArgs* are the values you want to pass to the subscriber's event handler.</span></span>

<span data-ttu-id="1bbfd-218">更新`DoublePrice``Click`為下列程式碼的事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-218">Update the `DoublePrice` `Click` event handler with the following code:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample9.cs)]

<span data-ttu-id="1bbfd-219">同樣地，`Click`事件處理常式會啟動，藉由呼叫`DoublePricesDataSource`SqlDataSource 控制項`Update`方法的所有產品價格的兩倍。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-219">As before, the `Click` event handler starts by calling the `DoublePricesDataSource` SqlDataSource control's `Update` method to double the prices of all products.</span></span> <span data-ttu-id="1bbfd-220">之後，有兩個事件處理常式新增項目。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-220">Following that there are two additions to the event handler.</span></span> <span data-ttu-id="1bbfd-221">首先， `RecentProducts` GridView 的資料重新整理。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-221">First, the `RecentProducts` GridView's data is refreshed.</span></span> <span data-ttu-id="1bbfd-222">此 GridView 已新增至主版頁面前述教學課程中，並顯示最新加入的五種產品。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-222">This GridView was added to the master page in the preceding tutorial and displays the five most recently-added products.</span></span> <span data-ttu-id="1bbfd-223">我們需要重新整理此方格，使它顯示這些五種產品的只是兩個價格。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-223">We need to refresh this grid so that it shows the just-doubled prices for these five products.</span></span> <span data-ttu-id="1bbfd-224">接下來，`PricesDoubled`就會引發事件。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-224">Following that, the `PricesDoubled` event is raised.</span></span> <span data-ttu-id="1bbfd-225">主版頁面本身的參考 (`this`) 會傳送至事件處理常式，為事件來源，並為空`EventArgs`物件傳送做為事件引數。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-225">A reference to the master page itself (`this`) is sent to the event handler as the event source and an empty `EventArgs` object is sent as the event arguments.</span></span>

## <a name="step-4-handling-the-event-in-the-content-page"></a><span data-ttu-id="1bbfd-226">步驟 4： 處理的 [內容] 頁面中的事件</span><span class="sxs-lookup"><span data-stu-id="1bbfd-226">Step 4: Handling the Event in the Content Page</span></span>

<span data-ttu-id="1bbfd-227">目前主版頁面會引發其`PricesDoubled`事件時`DoublePrice`按一下按鈕控制項。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-227">At this point the master page raises its `PricesDoubled` event whenever the `DoublePrice` Button control is clicked.</span></span> <span data-ttu-id="1bbfd-228">不過，這是只有一半-我們仍必須處理 「 訂閱者 」 中的事件。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-228">However, this is only half the battle - we still need to handle the event in the subscriber.</span></span> <span data-ttu-id="1bbfd-229">這牽涉到兩個步驟： 建立事件處理常式，並加入事件連接程式碼，以便在引發事件時執行的事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-229">This involves two steps: creating the event handler and adding event wiring code so that when the event is raised the event handler is executed.</span></span>

<span data-ttu-id="1bbfd-230">建立名為事件處理常式著手`Master_PricesDoubled`。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-230">Start by creating an event handler named `Master_PricesDoubled`.</span></span> <span data-ttu-id="1bbfd-231">因為我們所定義的方式`PricesDoubled`主版頁面中的事件的事件處理常式的兩個輸入的參數必須是類型`Object`和`EventArgs`分別。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-231">Because of how we defined the `PricesDoubled` event in the master page the event handler's two input parameters must be of types `Object` and `EventArgs`, respectively.</span></span> <span data-ttu-id="1bbfd-232">在 事件處理常式呼叫`ProductsGrid`GridView 的`DataBind`重新繫結至方格的資料的方法。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-232">In the event handler call the `ProductsGrid` GridView's `DataBind` method to rebind the data to the grid.</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample10.cs)]

<span data-ttu-id="1bbfd-233">事件處理常式的程式碼已完成，但我們至今還連線的主版頁面`PricesDoubled`這個事件處理常式的事件。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-233">The code for the event handler is complete but we've yet to wire the master page's `PricesDoubled` event to this event handler.</span></span> <span data-ttu-id="1bbfd-234">訂閱者將事件的事件處理常式，透過下列語法：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-234">The subscriber wires an event to an event handler via the following syntax:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample11.cs)]

<span data-ttu-id="1bbfd-235">*發行者*會提供事件物件的參考*eventName*，以及*methodName*是訂閱者端有對應的簽章中所定義的事件處理常式的名稱*eventDelegate*。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-235">*publisher* is a reference to the object that offers the event *eventName*, and *methodName* is the name of the event handler defined in the subscriber that has a signature corresponding to the *eventDelegate*.</span></span> <span data-ttu-id="1bbfd-236">也就是說，事件委派是否`EventHandler`，然後*methodName*必須是 「 訂閱者 」 不會傳回值，並接受兩個輸入參數的型別中的方法名稱`Object`和`EventArgs`，分別。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-236">In other words, if the event delegate is `EventHandler`, then *methodName* must be the name of a method in the subscriber that does not return a value and accepts two input parameters of types `Object` and `EventArgs`, respectively.</span></span>

<span data-ttu-id="1bbfd-237">此事件的連接程式碼必須執行的第一個頁面瀏覽和後續回傳時，以及應該在前面可能會引發事件時的頁面週期中的某一點。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-237">This event wiring code must be executed on the first page visit and subsequent postbacks and should occur at a point in the page lifecycle that precedes when the event may be raised.</span></span> <span data-ttu-id="1bbfd-238">加入事件連接程式碼的好時機是在 PreInit 階段中，在網頁生命週期非常早期，就會發生。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-238">A good time to add event wiring code is in the PreInit stage, which occurs very early in the page lifecycle.</span></span>

<span data-ttu-id="1bbfd-239">開啟`~/Admin/Products.aspx`並建立`Page_PreInit`事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-239">Open `~/Admin/Products.aspx` and create a `Page_PreInit` event handler:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample12.cs)]

<span data-ttu-id="1bbfd-240">若要完成此連接程式碼中，我們需要從 [內容] 頁面的主版頁面的程式設計參考。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-240">In order to complete this wiring code we need a programmatic reference to the master page from the content page.</span></span> <span data-ttu-id="1bbfd-241">如先前的教學課程中所述，有兩種方式可以執行這項操作：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-241">As noted in the previous tutorial, there are two ways to do this:</span></span>

- <span data-ttu-id="1bbfd-242">轉換鬆散型別`Page.Master`屬性，適當的主版頁面的型別，或</span><span class="sxs-lookup"><span data-stu-id="1bbfd-242">By casting the loosely-typed `Page.Master` property to the appropriate master page type, or</span></span>
- <span data-ttu-id="1bbfd-243">藉由新增`@MasterType`指示詞`.aspx`頁面，然後使用 強型別`Master`屬性。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-243">By adding a `@MasterType` directive in the `.aspx` page and then using the strongly-typed `Master` property.</span></span>

<span data-ttu-id="1bbfd-244">讓我們使用第二種方法。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-244">Let's use the latter approach.</span></span> <span data-ttu-id="1bbfd-245">新增下列`@MasterType`指示詞加入頁面的宣告式標記的頂端：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-245">Add the following `@MasterType` directive to the top of the page's declarative markup:</span></span>


[!code-aspx[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample13.aspx)]

<span data-ttu-id="1bbfd-246">然後加入下列事件連接程式碼，在`Page_PreInit`事件處理常式：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-246">Then add the following event wiring code in the `Page_PreInit` event handler:</span></span>


[!code-csharp[Main](interacting-with-the-content-page-from-the-master-page-cs/samples/sample14.cs)]

<span data-ttu-id="1bbfd-247">GridView 內容頁面中的重新整理與此程式碼就緒之後，每當`DoublePrice`按一下按鈕時。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-247">With this code in place, the GridView in the content page is refreshed whenever the `DoublePrice` Button is clicked.</span></span>

<span data-ttu-id="1bbfd-248">圖 8 和 9 說明這項行為。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-248">Figures 8 and 9 illustrate this behavior.</span></span> <span data-ttu-id="1bbfd-249">圖 8 顯示當第一次瀏覽的頁面。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-249">Figure 8 shows the page when first visited.</span></span> <span data-ttu-id="1bbfd-250">請注意，在價格值`RecentProducts`（在主版頁面的左側資料行） 的 GridView 和`ProductsGrid`GridView （在 [內容] 頁面中）。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-250">Note that price values in both the `RecentProducts` GridView (in the left column of the master page) and the `ProductsGrid` GridView (in the content page).</span></span> <span data-ttu-id="1bbfd-251">圖 9 顯示相同畫面之後立即`DoublePrice`按下按鈕。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-251">Figure 9 shows the same screen immediately after the `DoublePrice` Button has been clicked.</span></span> <span data-ttu-id="1bbfd-252">如您所見，這兩個 Gridview 會立即會反映新的價格。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-252">As you can see, the new prices are instantaneously reflected in both GridViews.</span></span>


<span data-ttu-id="1bbfd-253">[![初始的價格值](interacting-with-the-content-page-from-the-master-page-cs/_static/image23.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-253">[![The Initial Price Values](interacting-with-the-content-page-from-the-master-page-cs/_static/image23.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image22.png)</span></span>

<span data-ttu-id="1bbfd-254">**圖 08**: 初始的價格值 ([按一下以檢視完整大小的影像](interacting-with-the-content-page-from-the-master-page-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="1bbfd-254">**Figure 08**: The Initial Price Values  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image24.png))</span></span>


<span data-ttu-id="1bbfd-255">[![Just-Doubled 價格會顯示在 Gridview](interacting-with-the-content-page-from-the-master-page-cs/_static/image26.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-255">[![The Just-Doubled Prices are Displayed in the GridViews](interacting-with-the-content-page-from-the-master-page-cs/_static/image26.png)](interacting-with-the-content-page-from-the-master-page-cs/_static/image25.png)</span></span>

<span data-ttu-id="1bbfd-256">**圖 09**: The Just-Doubled 價格會顯示在 Gridview 中 ([按一下以檢視完整大小的影像](interacting-with-the-content-page-from-the-master-page-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="1bbfd-256">**Figure 09**: The Just-Doubled Prices are Displayed in the GridViews  ([Click to view full-size image](interacting-with-the-content-page-from-the-master-page-cs/_static/image27.png))</span></span>


## <a name="summary"></a><span data-ttu-id="1bbfd-257">總結</span><span class="sxs-lookup"><span data-stu-id="1bbfd-257">Summary</span></span>

<span data-ttu-id="1bbfd-258">在理想情況下，主版頁面和其內容的頁面是完全獨立的另一個，並需要互動的任何層級。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-258">Ideally, a master page and its content pages are completely separate from one another and require no level of interaction.</span></span> <span data-ttu-id="1bbfd-259">不過，如果您有主版頁面或內容頁面，以顯示可從主版頁面或內容頁面中修改的資料，則您可能需要具有警示內容頁面 （或相反的） 主版頁面的資料修改時，讓您可以更新顯示。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-259">However, if you have a master page or content page that displays data that can be modified from the master page or content page, then you may need to have the master page alert the content page (or vice-a-versa) when data is modified so that the display can be updated.</span></span> <span data-ttu-id="1bbfd-260">在先前的教學課程中，我們看到如何以程式設計的方式互動其主版頁面; 的內容頁面在本教學課程中，我們討論過如何互動的主版頁面起始。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-260">In the preceding tutorial we saw how to have a content page programmatically interact with its master page; in this tutorial we looked at how to have a master page initiate the interaction.</span></span>

<span data-ttu-id="1bbfd-261">雖然程式設計內容和主版頁面之間的互動可能來自的內容 」 或 「 主版頁面，使用互動模式取決於原始。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-261">While programmatic interaction between a content and master page can originate from either the content or master page, the interaction pattern used depends on the origination.</span></span> <span data-ttu-id="1bbfd-262">差異是因為，內容頁面具有單一主要頁面，但主版頁面可以有許多不同的內容頁面。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-262">The differences are due to the fact that a content page has a single master page, but a master page can have many different content pages.</span></span> <span data-ttu-id="1bbfd-263">而不需要直接互動內容頁面的主版頁面，更好的方法是能夠引發事件，以表示某些動作都已經發生的主版頁面。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-263">Rather than having a master page directly interact with a content page, a better approach is to have the master page raise an event to signal that some action has taken place.</span></span> <span data-ttu-id="1bbfd-264">這些動作所關心的內容頁面可以建立事件處理常式。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-264">Those content pages that care about the action can create event handlers.</span></span>

<span data-ttu-id="1bbfd-265">快樂地寫程式 ！</span><span class="sxs-lookup"><span data-stu-id="1bbfd-265">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="1bbfd-266">進一步閱讀</span><span class="sxs-lookup"><span data-stu-id="1bbfd-266">Further Reading</span></span>

<span data-ttu-id="1bbfd-267">如需有關在本教學課程所討論的主題的詳細資訊，請參閱下列資源：</span><span class="sxs-lookup"><span data-stu-id="1bbfd-267">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="1bbfd-268">存取及更新在 ASP.NET 中的資料</span><span class="sxs-lookup"><span data-stu-id="1bbfd-268">Accessing and Updating Data in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="1bbfd-269">事件與委派</span><span class="sxs-lookup"><span data-stu-id="1bbfd-269">Events and Delegates</span></span>](https://msdn.microsoft.com/library/17sde2xt.aspx)
- [<span data-ttu-id="1bbfd-270">內容與主版頁面之間傳遞資訊</span><span class="sxs-lookup"><span data-stu-id="1bbfd-270">Passing Information Between Content and Master Pages</span></span>](http://aspnet.4guysfromrolla.com/articles/013107-1.aspx)
- [<span data-ttu-id="1bbfd-271">在 ASP.NET 教學課程中使用的資料</span><span class="sxs-lookup"><span data-stu-id="1bbfd-271">Working with Data in ASP.NET Tutorials</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="1bbfd-272">關於作者</span><span class="sxs-lookup"><span data-stu-id="1bbfd-272">About the Author</span></span>

<span data-ttu-id="1bbfd-273">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)，作者的多個 ASP 本書籍，他是 4GuysFromRolla.com 的創辦人，一直從事 Microsoft Web 技術自 1998 年。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-273">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="1bbfd-274">Scott 會擔任獨立的顧問、 培訓講師和作家。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-274">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="1bbfd-275">他最新的著作是[ *Sams 教導您自己 ASP.NET 3.5 24 小時內*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco)。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-275">His latest book is [*Sams Teach Yourself ASP.NET 3.5 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672329972/4guysfromrollaco).</span></span> <span data-ttu-id="1bbfd-276">Scott 要聯絡[ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com)或透過他的部落格[ http://ScottOnWriting.NET ](http://scottonwriting.net/)。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-276">Scott can be reached at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="1bbfd-277">特別感謝</span><span class="sxs-lookup"><span data-stu-id="1bbfd-277">Special Thanks To</span></span>

<span data-ttu-id="1bbfd-278">本教學課程系列是由許多實用的檢閱者檢閱。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-278">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="1bbfd-279">本教學課程中的潛在客戶檢閱者已 Suchi Banerjee。</span><span class="sxs-lookup"><span data-stu-id="1bbfd-279">Lead reviewer for this tutorial was Suchi Banerjee.</span></span> <span data-ttu-id="1bbfd-280">有興趣檢閱我即將推出的 MSDN 文章嗎？</span><span class="sxs-lookup"><span data-stu-id="1bbfd-280">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="1bbfd-281">如果是這樣，psychic 在 [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-281">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="1bbfd-282">[上一頁](interacting-with-the-master-page-from-the-content-page-cs.md)
> [下一頁](master-pages-and-asp-net-ajax-cs.md)</span><span class="sxs-lookup"><span data-stu-id="1bbfd-282">[Previous](interacting-with-the-master-page-from-the-content-page-cs.md)
[Next](master-pages-and-asp-net-ajax-cs.md)</span></span>
