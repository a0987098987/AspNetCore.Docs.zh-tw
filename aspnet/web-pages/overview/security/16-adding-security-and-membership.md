---
uid: web-pages/overview/security/16-adding-security-and-membership
title: "安全性與成員資格中加入 ASP.NET Web Pages (Razor) 站台 |Microsoft 文件"
author: tfitzmac
description: "這一章會示範如何保護您的網站，這樣的部分頁面則只提供給登入的人。 （您也會看到如何建立頁面 tha..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/24/2014
ms.topic: article
ms.assetid: 7a77c2c0-deea-4290-a9c3-97958891758e
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/security/16-adding-security-and-membership
msc.type: authoredcontent
ms.openlocfilehash: af2eeb128cff554e7ae3d903e2117861087344e9
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 01/24/2018
---
<a name="adding-security-and-membership-to-an-aspnet-web-pages-razor-site"></a><span data-ttu-id="b4ff1-104">加入 ASP.NET Web Pages (Razor) 站台的安全性和成員資格</span><span class="sxs-lookup"><span data-stu-id="b4ff1-104">Adding Security and Membership to an ASP.NET Web Pages (Razor) Site</span></span>
====================
<span data-ttu-id="b4ff1-105">由[Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="b4ff1-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="b4ff1-106">本文說明如何保護 ASP.NET Web Pages (Razor) 網站，這樣的部分頁面則只提供給登入的人。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-106">This article explains how to secure an ASP.NET Web Pages (Razor) website so that some of the pages are available only to people who log in.</span></span> <span data-ttu-id="b4ff1-107">（您也會看到如何建立的任何人都可以存取的網頁）。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-107">(You'll also see how to create pages that anyone can access.)</span></span>
> 
> <span data-ttu-id="b4ff1-108">**您將學習：**</span><span class="sxs-lookup"><span data-stu-id="b4ff1-108">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="b4ff1-109">如何建立具有註冊頁面和登入頁面，讓某些頁中，您可以限制為只有成員存取的網站。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-109">How to create a website that has a registration page and a login page so that for some pages you can limit access to only members.</span></span>
> - <span data-ttu-id="b4ff1-110">如何建立公用和成員專用頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-110">How to create public and member-only pages.</span></span>
> - <span data-ttu-id="b4ff1-111">如何定義角色是在您的網站具有不同的安全性權限的群組，以及如何將使用者指派至角色。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-111">How to define roles, which are groups that have different security permissions on your site, and how to assign users to a role.</span></span>
> - <span data-ttu-id="b4ff1-112">如何使用 CAPTCHA 可防止自動的程式 (bot) 建立成員帳戶。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-112">How to use CAPTCHA to prevent automated programs (bots) from creating member accounts.</span></span>
>   
> 
> <span data-ttu-id="b4ff1-113">這些是發行項中所引進的 ASP.NET 功能：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-113">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="b4ff1-114">WebMatrix**入門網站**範本。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-114">The WebMatrix **Starter Site** template.</span></span>
> - <span data-ttu-id="b4ff1-115">`WebSecurity` Helper 和`Roles`類別。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-115">The `WebSecurity` helper and `Roles` class.</span></span>
> - <span data-ttu-id="b4ff1-116">`ReCaptcha`協助程式。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-116">The `ReCaptcha` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="b4ff1-117">在本教學課程中使用的軟體版本</span><span class="sxs-lookup"><span data-stu-id="b4ff1-117">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="b4ff1-118">ASP.NET Web Pages (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="b4ff1-118">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="b4ff1-119">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="b4ff1-119">WebMatrix 3</span></span>
> - <span data-ttu-id="b4ff1-120">ASP.NET Web Helpers Library</span><span class="sxs-lookup"><span data-stu-id="b4ff1-120">ASP.NET Web Helpers Library</span></span>


<span data-ttu-id="b4ff1-121">您可以設定您的網站，讓使用者可以登入它 &#8212;也就是，讓站台支援*成員資格*。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-121">You can set up your website so that users can log into it &#8212; that is, so that the site supports *membership*.</span></span> <span data-ttu-id="b4ff1-122">這非常適合有許多原因。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-122">This can be useful for many reasons.</span></span> <span data-ttu-id="b4ff1-123">例如，您的網站可能應該只能用於成員的頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-123">For example, your site might have pages that should be available only to members.</span></span> <span data-ttu-id="b4ff1-124">在某些情況下，您可能需要使用者登入，才能傳送意見反應，或保留註解。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-124">In some cases, you might require users to log in in order to send you feedback or leave a comment.</span></span>

<span data-ttu-id="b4ff1-125">即使您的網站支援的成員資格，使用者不一定需要登入，才在站台上使用的部分頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-125">Even if your website supports membership, users aren't necessarily required to log in before they use some of the pages on the site.</span></span> <span data-ttu-id="b4ff1-126">未登入的使用者稱為*匿名使用者*。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-126">Users who aren't logged in are known as *anonymous users*.</span></span>

<span data-ttu-id="b4ff1-127">使用者可以註冊您的網站上，而且可以網站然後登入。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-127">A user can register on your website and can then log in to the site.</span></span> <span data-ttu-id="b4ff1-128">網站需要使用者名稱 （電子郵件地址） 和密碼以確認使用者是他們所宣告的身分。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-128">The website requires a user name (an email address) and a password to confirm that users are who they claim to be.</span></span> <span data-ttu-id="b4ff1-129">這個程序的登入，並確認使用者的身分識別稱為*驗證*。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-129">This process of logging in and confirming a user's identity is known as *authentication*.</span></span>

<span data-ttu-id="b4ff1-130">您可以在不同的方式設定安全性和成員資格：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-130">You can set up security and membership in different ways:</span></span>

- <span data-ttu-id="b4ff1-131">如果您使用的 WebMatrix，一個簡單的方法是建立為基礎的新站台**入門網站**範本。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-131">If you're using WebMatrix, an easy way is to create as new site based on the **Starter Site** template.</span></span> <span data-ttu-id="b4ff1-132">此範本已設定的安全性和成員資格，且已註冊頁面、 登入頁面上，等等。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-132">This template is already configured for security and membership and already has a registration page, a login page, and so on.</span></span>

    <span data-ttu-id="b4ff1-133">範本所建立的站台也會有的選項，讓使用者使用 Facebook、 Google、 像外部網站登入或 Twitter。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-133">The site created by the template also has an option to let users log in using an external site like Facebook, Google, or Twitter.</span></span>
- <span data-ttu-id="b4ff1-134">如果您想要將安全性新增至現有的網站，或如果您不想要使用**入門網站**範本，您可以建立您自己註冊 頁面上，登入頁面上，以及等等。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-134">If you want to add security to an existing site, or if you don't want to use the **Starter Site** template, you can create your own registration page, login page, and so on.</span></span>

<span data-ttu-id="b4ff1-135">本文著重在第一個選項&mdash;如何藉由新增安全性**入門網站**範本。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-135">This article focuses on the first option &mdash; how to add security by using the **Starter Site** template.</span></span> <span data-ttu-id="b4ff1-136">它也會提供有關如何實作您自己的安全性的一些基本資訊，並提供有關如何執行此作業的詳細資訊連結。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-136">It also provides some basic information about how to implement your own security and then provides links to more information about how to do that.</span></span> <span data-ttu-id="b4ff1-137">也是有關如何啟用外部登入，個別的文件中的更多詳細資料中所述的資訊。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-137">There is also information about how to enable external logins, which is described in more detail in a separate article.</span></span>

## <a name="creating-website-security-using-the-starter-site-template"></a><span data-ttu-id="b4ff1-138">使用入門網站範本建立網站安全性</span><span class="sxs-lookup"><span data-stu-id="b4ff1-138">Creating Website Security Using the Starter Site Template</span></span>

<span data-ttu-id="b4ff1-139">在 WebMatrix 中，您可以使用**入門網站**範本來建立包含下列網站：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-139">In WebMatrix, you can use the **Starter Site** template to create a website that contains the following:</span></span>

- <span data-ttu-id="b4ff1-140">用來儲存使用者名稱和密碼為成員資料庫。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-140">A database that's used to store user names and passwords for your members.</span></span>
- <span data-ttu-id="b4ff1-141">註冊頁面 （新增） 的匿名使用者可以註冊其中。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-141">A registration page where anonymous (new) users can register.</span></span>
- <span data-ttu-id="b4ff1-142">登入和登出的頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-142">A login and logout page.</span></span>
- <span data-ttu-id="b4ff1-143">密碼復原和重設頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-143">A password recovery and reset page.</span></span>

<span data-ttu-id="b4ff1-144">下列程序描述如何建立站台並加以設定。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-144">The following procedure describes how to create the site and configure it.</span></span>

1. <span data-ttu-id="b4ff1-145">啟動 WebMatrix 和**快速入門**頁面上，選取**網站從範本**。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-145">Start WebMatrix and in the **Quick Start** page, select **Site From Template**.</span></span>
2. <span data-ttu-id="b4ff1-146">選取**入門網站**範本，然後按一下 **確定**。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-146">Select the **Starter Site** template and then click **OK**.</span></span> <span data-ttu-id="b4ff1-147">WebMatrix 會建立新的站台。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-147">WebMatrix creates a new site.</span></span>
3. <span data-ttu-id="b4ff1-148">在左窗格中，按一下 **檔案**工作區選取器。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-148">In the left pane, click the **Files** workspace selector.</span></span>
4. <span data-ttu-id="b4ff1-149">在您的網站的根資料夾中，開啟 *\_AppStart.cshtml*檔案，這是用來包含通用設定的特殊檔案。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-149">In the root folder of your website, open the *\_AppStart.cshtml* file, which is a special file that's used to contain global settings.</span></span> <span data-ttu-id="b4ff1-150">它包含標記為註解使用某些陳述式`//`字元：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-150">It contains some statements that are commented out using the `//` characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample1.cs)]

    <span data-ttu-id="b4ff1-151">這些陳述式設定`WebMail`協助程式，可以用來傳送電子郵件。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-151">These statements configure the `WebMail` helper, which can be used to send email.</span></span> <span data-ttu-id="b4ff1-152">成員資格系統可以使用電子郵件，當使用者註冊，或要變更其密碼時，傳送確認訊息。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-152">The membership system can use email to send confirmation messages when users register or when they want to change their passwords.</span></span> <span data-ttu-id="b4ff1-153">（例如，使用者註冊後，它們取得電子郵件，其中包含使用者可以按一下以完成註冊程序的連結。）</span><span class="sxs-lookup"><span data-stu-id="b4ff1-153">(For example, after users register, they get an email that includes a link that they can click in order to finish the registration process.)</span></span>

    <span data-ttu-id="b4ff1-154">傳送電子郵件中所述，需要存取 SMTP 伺服器，[新增電子郵件給 ASP.NET Web Pages 站台中](https://go.microsoft.com/fwlink/?LinkId=202899)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-154">Sending email requires access to an SMTP server, as described in [Adding Email to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202899).</span></span> <span data-ttu-id="b4ff1-155">這個中央中所儲存的電子郵件設定 *\_AppStart.cshtml*檔案，所以您不必重複碼成可以傳送電子郵件的每個頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-155">You'll store the email settings in this central *\_AppStart.cshtml* file so that you don't have to code them repeatedly into each page that can send email.</span></span> <span data-ttu-id="b4ff1-156">（您不需要設定 SMTP 設定，來設定註冊資料庫; 您只需要 SMTP 設定，如果您想要驗證使用者從他們的電子郵件別名，並且讓使用者重設忘記的密碼）。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-156">(You don't need to configure SMTP settings to set up a registration database; you only need SMTP settings if you want to validate users from their email alias and let users reset a forgotten password.)</span></span>
5. <span data-ttu-id="b4ff1-157">取消註解陳述式移除`//`每一個前面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-157">Uncomment the statements by removing `//` from in front of each one.</span></span>

    <span data-ttu-id="b4ff1-158">如果您不想要設定電子郵件確認，您可以略過此步驟和下一個步驟。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-158">If you do not want to set up email confirmation, you can skip this step and the next step.</span></span> <span data-ttu-id="b4ff1-159">如果未設定 SMTP 值，新的帳戶是立即可以在沒有確認電子郵件。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-159">If the SMTP values are not set, the new account is immediately available without a confirmation email.</span></span>
6. <span data-ttu-id="b4ff1-160">修改程式碼中的下列電子郵件相關設定：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-160">Modify the following email-related settings in the code:</span></span>

    - <span data-ttu-id="b4ff1-161">設定`WebMail.SmtpServer`您具有存取權的 SMTP 伺服器的名稱。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-161">Set `WebMail.SmtpServer` to the name of the SMTP server that you have access to.</span></span>
    - <span data-ttu-id="b4ff1-162">保留`WebMail.EnableSsl`設`true`。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-162">Leave `WebMail.EnableSsl` set to `true`.</span></span> <span data-ttu-id="b4ff1-163">這項設定會保護加密將會傳送到 SMTP 伺服器的認證。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-163">This setting secures the credentials that are sent to the SMTP server by encrypting them.</span></span>
    - <span data-ttu-id="b4ff1-164">設定`WebMail.UserName`至您的 SMTP 伺服器帳戶的使用者名稱。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-164">Set `WebMail.UserName` to the user name for your SMTP server account.</span></span>
    - <span data-ttu-id="b4ff1-165">設定`WebMail.Password`您的 SMTP 伺服器帳戶的密碼。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-165">Set `WebMail.Password` to the password for your SMTP server account.</span></span>
    - <span data-ttu-id="b4ff1-166">設定`WebMail.From`您自己的電子郵件地址。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-166">Set `WebMail.From` to your own email address.</span></span> <span data-ttu-id="b4ff1-167">這是從訊息傳送的電子郵件地址。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-167">This is the email address that the message is sent from.</span></span>

    > [!NOTE] 
    > 
    > <span data-ttu-id="b4ff1-168">**提示**如需有關這些屬性值的詳細資訊，請參閱[設定電子郵件設定](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings)中[自訂全站台的行為的 ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-168">**Tip** For additional information about the values for these properties, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span></span>
7. <span data-ttu-id="b4ff1-169">儲存並關閉 *\_AppStart.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-169">Save and close *\_AppStart.cshtml*.</span></span>
8. <span data-ttu-id="b4ff1-170">執行*Default.cshtml*瀏覽器中的。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-170">Run the *Default.cshtml* page in a browser.</span></span>

    ![security-membership-2](16-adding-security-and-membership/_static/image1.png)

    > [!NOTE]
    > <span data-ttu-id="b4ff1-172">如果您看到錯誤，告訴您屬性必須是執行個體`ExtendedMembershipProvider`，站台可能不會設定為使用 ASP.NET Web Pages 成員資格系統 (SimpleMembership)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-172">If you see an error that tells you that a property must be an instance of `ExtendedMembershipProvider`, the site might not be configured to use the ASP.NET Web Pages membership system (SimpleMembership).</span></span> <span data-ttu-id="b4ff1-173">如果裝載提供者的伺服器設定方式不同於您的本機伺服器時，這有時會發生。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-173">This can sometimes occur if a hosting provider's server is configured differently than your local server.</span></span> <span data-ttu-id="b4ff1-174">若要修正此問題，將下列項目加入站台的*Web.config*檔案：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-174">To fix this, add the following element to the site's *Web.config* file:</span></span>
    > 
    > [!code-xml[Main](16-adding-security-and-membership/samples/sample2.xml)]
    > 
    > <span data-ttu-id="b4ff1-175">將這個項目新增為子系`<configuration>`項目，以及對等`<system.web>`項目。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-175">Add this element as a child of the `<configuration>` element and as a peer of the `<system.web>` element.</span></span>
9. <span data-ttu-id="b4ff1-176">在頁面的右上角，按一下 **註冊**連結。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-176">In the upper-right corner of the page, click the **Register** link.</span></span> <span data-ttu-id="b4ff1-177">*Register.cshtml*頁面隨即顯示。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-177">The *Register.cshtml* page is displayed.</span></span>
10. <span data-ttu-id="b4ff1-178">輸入使用者名稱和密碼，然後按一下**註冊**。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-178">Enter a user name and password and then click **Register**.</span></span>

    ![security-membership-3](16-adding-security-and-membership/_static/image2.png)

    <span data-ttu-id="b4ff1-180">當您建立網站，從**入門網站**範本，名為資料庫*StarterSite.sdf*是在站台的*應用程式\_資料*資料夾。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-180">When you created the website from the **Starter Site** template, a database named *StarterSite.sdf* was created in the site's *App\_Data* folder.</span></span> <span data-ttu-id="b4ff1-181">在註冊期間，您的使用者資訊加入至資料庫。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-181">During registration, your user information is added to the database.</span></span> <span data-ttu-id="b4ff1-182">如果您設定的 SMTP 值時，訊息會傳送電子郵件地址使用讓您可以完成註冊。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-182">If you set the SMTP values, a message is sent to the email address you used so you can finish registering.</span></span>

    ![security-membership-4](16-adding-security-and-membership/_static/image3.png)
11. <span data-ttu-id="b4ff1-184">移至您的電子郵件程式，並尋找訊息，其中將包含您的確認碼和超連結至網站。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-184">Go to your email program and find the message, which will have your confirmation code and a hyperlink to the site.</span></span>
12. <span data-ttu-id="b4ff1-185">按一下此超連結可啟用您的帳戶。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-185">Click the hyperlink to activate your account.</span></span> <span data-ttu-id="b4ff1-186">確認超連結會開啟 [登錄] 確認頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-186">The confirmation hyperlink opens a registration confirmation page.</span></span>

    ![security-membership-5](16-adding-security-and-membership/_static/image4.png)
- <span data-ttu-id="b4ff1-188">按一下**登入**連結，然後再登入使用您註冊的帳戶。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-188">Click the **Login** link, and then log in using the account that you registered.</span></span>

    <span data-ttu-id="b4ff1-189">您登入之後,**登入**和**註冊**連結來取代**登出**連結。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-189">After you log in, the **Login** and **Register** links are replaced by a **Logout** link.</span></span> <span data-ttu-id="b4ff1-190">登入名稱會顯示為連結。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-190">Your login name is displayed as a link.</span></span> <span data-ttu-id="b4ff1-191">（此連結可跳到頁面中您可以在其中變更您的密碼。）</span><span class="sxs-lookup"><span data-stu-id="b4ff1-191">(The link lets you go to a page where you can change your password.)</span></span>

    ![security-membership-6](16-adding-security-and-membership/_static/image5.png)

    > [!NOTE]
    > <span data-ttu-id="b4ff1-193">根據預設，ASP.NET web pages 傳送認證到伺服器以純文字 （做為人類看得懂的文字）。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-193">By default, ASP.NET web pages send credentials to the server in clear text (as human-readable text).</span></span> <span data-ttu-id="b4ff1-194">生產網站應該使用安全 HTTP (https:// 也稱為*安全通訊端層*或 SSL) 來加密機密資訊會與伺服器進行交換。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-194">A production site should use secure HTTP (https://, also known as the *secure sockets layer* or SSL) to encrypt sensitive information that's exchanged with the server.</span></span> <span data-ttu-id="b4ff1-195">您可以需要電子郵件傳送訊息給設定使用 SSL`WebMail.EnableSsl=true`如同先前的範例。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-195">You can required email messages to be sent using SSL by setting `WebMail.EnableSsl=true` as in the previous example.</span></span> <span data-ttu-id="b4ff1-196">如需有關 SSL 的詳細資訊，請參閱[保護 Web 通訊： 憑證、 SSL 及 https://](https://go.microsoft.com/fwlink/?LinkId=208660)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-196">For more information about SSL, see [Securing Web Communications: Certificates, SSL, and https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span></span>

## <a name="additional-membership-functionality-in-the-site"></a><span data-ttu-id="b4ff1-197">在站台的其他成員資格功能</span><span class="sxs-lookup"><span data-stu-id="b4ff1-197">Additional Membership Functionality in the Site</span></span>

<span data-ttu-id="b4ff1-198">您的網站包含其他功能，可讓使用者管理他們的帳戶。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-198">Your site contains other functionality that lets users manage their accounts.</span></span> <span data-ttu-id="b4ff1-199">使用者可以執行下列作業：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-199">Users can do the following:</span></span>

- <span data-ttu-id="b4ff1-200">變更密碼。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-200">Change their passwords.</span></span> <span data-ttu-id="b4ff1-201">登入之後，使用者可以按一下使用者名稱 （這是連結）。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-201">After logging in, they can click the user name (which is a link).</span></span> <span data-ttu-id="b4ff1-202">這將他們帶往頁面他們可以在其中建立新的密碼 (*Account/ChangePassword.cshtml*)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-202">This takes them to a page where they can create a new password (*Account/ChangePassword.cshtml*).</span></span>
- <span data-ttu-id="b4ff1-203">復原忘記的密碼。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-203">Recover a forgotten password.</span></span> <span data-ttu-id="b4ff1-204">在登入頁面上，會連結 (**您是否忘記您的密碼？**)，會將使用者引導至頁面 (*Account/ForgotPassword.cshtml*) 可以在其中輸入電子郵件地址。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-204">On the login page, there's a link (**Did you forget your password?**) that takes users to a page (*Account/ForgotPassword.cshtml*) where they can enter an email address.</span></span> <span data-ttu-id="b4ff1-205">站台傳送的電子郵件，有一個連結，他們就可以按一下以設定新的密碼 (*Account/PasswordReset.cshtml*)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-205">The site sends them an email message that has a link that they can click in order to set a new password (*Account/PasswordReset.cshtml*).</span></span>

<span data-ttu-id="b4ff1-206">您也可以讓使用者也可以使用外部網站，登入如稍後所說明。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-206">You can also let users can also log in using an external site, as explained later.</span></span>

<a id="Creating_a_Members-Only_Page"></a>
## <a name="creating-a-members-only-page"></a><span data-ttu-id="b4ff1-207">建立僅限成員頁面</span><span class="sxs-lookup"><span data-stu-id="b4ff1-207">Creating a Members-Only Page</span></span>

<span data-ttu-id="b4ff1-208">時間之外，任何人都可以瀏覽在您的網站。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-208">For the time being, anyone can browse to any page in your website.</span></span> <span data-ttu-id="b4ff1-209">但您可能想要有僅適用於已登入的人的頁面 (也就是成員)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-209">But you might want to have pages that are available only to people who have logged in (that is, to members).</span></span> <span data-ttu-id="b4ff1-210">ASP.NET 可讓您建立只有登入的成員可存取的頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-210">ASP.NET lets you create pages that can be accessed only by logged-in members.</span></span> <span data-ttu-id="b4ff1-211">一般而言，匿名使用者嘗試存取僅限成員頁面時，如果您重新導向至登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-211">Typically, if anonymous users try to access a members-only page, you redirect them to the login page.</span></span>

<span data-ttu-id="b4ff1-212">在此程序，您將建立資料夾將包含僅適用於登入之使用者的頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-212">In this procedure, you'll create a folder that will contain pages that are available only to logged-in users.</span></span>

1. <span data-ttu-id="b4ff1-213">在站台根目錄中，建立新的資料夾。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-213">At the root of the site, create a new folder.</span></span> <span data-ttu-id="b4ff1-214">(在 功能區中，按一下下方的箭號**新增**，然後選擇 **新資料夾**。)</span><span class="sxs-lookup"><span data-stu-id="b4ff1-214">(In the ribbon, click the arrow underneath **New** and then choose **New Folder**.)</span></span>
2. <span data-ttu-id="b4ff1-215">將新的資料夾命名*成員*。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-215">Name the new folder *Members*.</span></span>
3. <span data-ttu-id="b4ff1-216">內部*成員*資料夾中，建立新的頁面，並將它命名為*MembersInformation.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-216">Inside the *Members* folder, create a new page and named it *MembersInformation.cshtml*.</span></span>
4. <span data-ttu-id="b4ff1-217">下列程式碼和標記取代現有的內容：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-217">Replace the existing content with the following code and markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample3.cshtml)]

    <span data-ttu-id="b4ff1-218">此程式碼測試`IsAuthenticated`屬性`WebSecurity`物件，它會傳回`true`如果使用者已登入。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-218">This code tests the `IsAuthenticated` property of the `WebSecurity` object, which returns `true` if the user has logged in.</span></span> <span data-ttu-id="b4ff1-219">如果使用者未登入程式碼會呼叫`Response.Redirect`傳送使用者*Login.cshtml*頁面*帳戶*資料夾。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-219">If the user is not logged in, the code calls `Response.Redirect` to send the user to the *Login.cshtml* page in the *Account* folder.</span></span>

    <span data-ttu-id="b4ff1-220">重新導向 URL 包含`returnUrl`查詢所使用的字串值`Request.Url.LocalPath`設定目前頁面的路徑。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-220">The URL of the redirection includes a `returnUrl` query string value that uses `Request.Url.LocalPath` to set the path of the current page.</span></span> <span data-ttu-id="b4ff1-221">如果您設定`returnUrl`像這樣的查詢字串中的值 （和傳回 URL 如果是本機路徑），登入頁面將會傳回使用者至這個頁面之後在登入時。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-221">If you set the `returnUrl` value in the query string like this (and if the return URL is a local path), the login page will return users to this page after they log in.</span></span>

    <span data-ttu-id="b4ff1-222">程式碼也會設定 *\_SiteLayout.cshtml*其版面配置頁的頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-222">The code also sets *\_SiteLayout.cshtml* page as its layout page.</span></span> <span data-ttu-id="b4ff1-223">(如需詳細資訊版面配置頁面，請參閱[ASP.NET Web Pages 站台中建立一致的版面配置](https://go.microsoft.com/fwlink/?LinkId=202891)。)</span><span class="sxs-lookup"><span data-stu-id="b4ff1-223">(For more about layout pages, see [Creating a Consistent Layout in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202891).)</span></span>
5. <span data-ttu-id="b4ff1-224">執行站台。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-224">Run the site.</span></span> <span data-ttu-id="b4ff1-225">如果您仍登入，請按一下**登出**在頁面頂端的按鈕。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-225">If you're still logged in, click the **Logout** button at the top of the page.</span></span>
6. <span data-ttu-id="b4ff1-226">在瀏覽器要求網頁*/成員/MembersInformation*。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-226">In the browser, request the page */Members/MembersInformation*.</span></span> <span data-ttu-id="b4ff1-227">例如，URL 看起來可能像這樣：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-227">For example, the URL might look like this:</span></span>

    `http://localhost:38366/Members/MembersInformation`

    <span data-ttu-id="b4ff1-228">（連接埠號碼 (38366) 可能會在您的 URL 不同。）</span><span class="sxs-lookup"><span data-stu-id="b4ff1-228">(The port number (38366) will probably be different in your URL.)</span></span>

    <span data-ttu-id="b4ff1-229">正在重新導向至*Login.cshtml*頁面上，因為您未登入。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-229">You're redirected to the *Login.cshtml* page, because you aren't logged in.</span></span>
- <span data-ttu-id="b4ff1-230">使用您稍早建立的帳戶登入。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-230">Log in using the account you created earlier.</span></span> <span data-ttu-id="b4ff1-231">正在重新導向回到*MembersInformation*頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-231">You're redirected back to the *MembersInformation* page.</span></span> <span data-ttu-id="b4ff1-232">因為您登入，這次您看到的頁面內容。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-232">Because you're logged in, this time you see the page contents.</span></span>

<span data-ttu-id="b4ff1-233">若要保護存取多個頁面，您可以：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-233">To secure access to multiple pages, you can do this:</span></span>

- <span data-ttu-id="b4ff1-234">加入至每個頁面的安全性檢查。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-234">Add the security check to each page.</span></span>
- <span data-ttu-id="b4ff1-235">建立 *\_PageStart.cshtml*您保留受保護的頁面，並新增安全性檢查的資料夾中的頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-235">Create a *\_PageStart.cshtml* page in the folder where you keep protected pages, and add the security check there.</span></span> <span data-ttu-id="b4ff1-236">*\_PageStart.cshtml*頁面做為一種通用資料夾中的所有頁面的頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-236">The *\_PageStart.cshtml* page acts as a kind of global page for all the pages in the folder.</span></span> <span data-ttu-id="b4ff1-237">這項技術會更詳細地說明[自訂全站台的行為的 ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-237">This technique is explained in more detail in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span></span>

## <a name="creating-security-for-groups-of-users-roles"></a><span data-ttu-id="b4ff1-238">建立群組的使用者 （角色） 的安全性</span><span class="sxs-lookup"><span data-stu-id="b4ff1-238">Creating Security for Groups of Users (Roles)</span></span>

<span data-ttu-id="b4ff1-239">如果您的網站有大量成員，它不有效率個別檢查每個使用者的權限之前您讓他們會看到一個頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-239">If your site has a lot of members, it's not efficient to check permission for each user individually before you let them see a page.</span></span> <span data-ttu-id="b4ff1-240">您可以執行是建立群組，或*角色*，個別成員隸屬於。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-240">What you can do instead is to create groups, or *roles*, that individual members belong to.</span></span> <span data-ttu-id="b4ff1-241">接著，您可以查看根據角色的權限。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-241">You can then check permissions based on role.</span></span> <span data-ttu-id="b4ff1-242">在本節中，您將建立&quot;admin&quot;角色，然後建立的使用者可以存取的頁面中 （屬於） 該角色。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-242">In this section, you'll create an &quot;admin&quot; role and then create a page that's accessible to users who are in (who belong to) that role.</span></span>

<span data-ttu-id="b4ff1-243">ASP.NET 成員資格系統設定來支援角色。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-243">The ASP.NET membership system is set up to support roles.</span></span> <span data-ttu-id="b4ff1-244">不過，不同於成員資格註冊和登入，**入門網站**範本未包含頁面來協助您管理角色。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-244">However, unlike membership registration and login, the **Starter Site** template does not contain pages that help you manage roles.</span></span> <span data-ttu-id="b4ff1-245">（管理角色是管理工作，而不是使用者工作）。不過，您可以直接在 WebMatrix 中的成員資格資料庫中加入群組。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-245">(Managing roles is an administrative task rather than a user task.) However, you can add groups directly in the membership database in WebMatrix.</span></span>

1. <span data-ttu-id="b4ff1-246">在 WebMatrix 中，按一下 **資料庫**工作區選取器。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-246">In WebMatrix, click the **Databases** workspace selector.</span></span>
2. <span data-ttu-id="b4ff1-247">在左窗格中，開啟*StarterSite.sdf*節點，開啟**資料表** 節點，然後再按兩下*網頁\_角色*資料表。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-247">In the left pane, open the *StarterSite.sdf* node, open the **Tables** node, and then double-click the *webpages\_Roles* table.</span></span>

    ![security-membership-7](16-adding-security-and-membership/_static/image6.png)
3. <span data-ttu-id="b4ff1-249">新增名為角色&quot;admin&quot;。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-249">Add a role named &quot;admin&quot;.</span></span> <span data-ttu-id="b4ff1-250">*RoleId*欄位會自動填入。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-250">The *RoleId* field is filled in automatically.</span></span> <span data-ttu-id="b4ff1-251">(它是主索引鍵，而且已為識別欄位中，設定中所述[簡介使用 ASP.NET Web Pages 站台中的資料庫](https://go.microsoft.com/fwlink/?LinkId=202893)。)</span><span class="sxs-lookup"><span data-stu-id="b4ff1-251">(It's the primary key and has been set to be an identify field, as explained in [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).)</span></span>
4. <span data-ttu-id="b4ff1-252">記下這個值是給*RoleId*欄位。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-252">Take note of what the value is for the *RoleId* field.</span></span> <span data-ttu-id="b4ff1-253">（如果這是您正在定義的第一個角色，它會是 1）。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-253">(If this is the first role you're defining, it will be 1.)</span></span>

    ![security-membership-8](16-adding-security-and-membership/_static/image7.png)
5. <span data-ttu-id="b4ff1-255">關閉*網頁\_角色*資料表。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-255">Close the *webpages\_Roles* table.</span></span>
6. <span data-ttu-id="b4ff1-256">開啟*UserProfile*資料表。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-256">Open the *UserProfile* table.</span></span>
7. <span data-ttu-id="b4ff1-257">請記下*UserId*值的一或多個資料表，然後關閉資料表中的使用者。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-257">Make a note of the *UserId* value of one or more of the users in the table and then close the table.</span></span>
8. <span data-ttu-id="b4ff1-258">開啟*網頁\_UserInRoles*資料表，並輸入*UserID*和*RoleID*值插入資料表。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-258">Open the *webpages\_UserInRoles* table and enter a *UserID* and a *RoleID* value into the table.</span></span> <span data-ttu-id="b4ff1-259">例如，若要將放入的使用者 2 &quot;admin&quot;角色，您會輸入這些值：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-259">For example, to put user 2 into the &quot;admin&quot; role, you'd enter these values:</span></span>

    ![security-membership-9](16-adding-security-and-membership/_static/image8.png)
9. <span data-ttu-id="b4ff1-261">關閉*網頁\_為 UsersInRoles*資料表。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-261">Close the *webpages\_UsersInRoles* table.</span></span>

    <span data-ttu-id="b4ff1-262">既然您已定義的角色，您可以設定該角色在使用者存取的頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-262">Now that you have roles defined, you can configure a page that's accessible to users who are in that role.</span></span>
10. <span data-ttu-id="b4ff1-263">在網站的根資料夾中，建立名為的新頁面*AdminError.cshtml* ，並以下列程式碼取代現有的內容。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-263">In the website root folder, create a new page named *AdminError.cshtml* and replace the existing content with the following code.</span></span> <span data-ttu-id="b4ff1-264">這是使用者重新導向至如果它們不允許存取網頁的網頁。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-264">This will be the page that users are redirected to if they aren't allowed access to a page.</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample4.cshtml)]
11. <span data-ttu-id="b4ff1-265">在網站的根資料夾中，建立名為的新頁面*AdminOnly.cshtml* ，並以下列程式碼取代現有的程式碼：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-265">In the website root folder, create a new page named *AdminOnly.cshtml* and replace the existing code with the following code:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample5.cshtml)]

    <span data-ttu-id="b4ff1-266">`Roles.IsUserInRole`方法會傳回`true`如果目前的使用者是指定之角色 （在此情況下，「 管理員 」 角色） 的成員。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-266">The `Roles.IsUserInRole` method returns `true` if the current user is a member of the specified role (in this case, the "admin" role).</span></span>
12. <span data-ttu-id="b4ff1-267">執行*Default.cshtml*瀏覽器，但未登入。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-267">Run *Default.cshtml* in a browser, but don't log in.</span></span> <span data-ttu-id="b4ff1-268">（如果您已經登入，登出。）</span><span class="sxs-lookup"><span data-stu-id="b4ff1-268">(If you're already logged in, log out.)</span></span>
13. <span data-ttu-id="b4ff1-269">在瀏覽器的網址列中加入*AdminOnly*在 URL 中。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-269">In the browser's address bar, add *AdminOnly* in the URL.</span></span> <span data-ttu-id="b4ff1-270">(換句話說，要求*AdminOnly.cshtml*檔案。)正在重新導向至*AdminError.cshtml*頁面上，因為您不目前登入中的使用者身分&quot;admin&quot;角色。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-270">(In other words, request the *AdminOnly.cshtml* file.) You're redirected to the *AdminError.cshtml* page, because you aren't currently logged in as a user in the &quot;admin&quot; role.</span></span>
14. <span data-ttu-id="b4ff1-271">返回*Default.cshtml*並以您要新增的使用者登入&quot;admin&quot;角色。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-271">Return to *Default.cshtml* and log in as the user you added to the &quot;admin&quot; role.</span></span>
15. <span data-ttu-id="b4ff1-272">瀏覽至*AdminOnly.cshtml*頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-272">Browse to *AdminOnly.cshtml* page.</span></span> <span data-ttu-id="b4ff1-273">此時您會看到的頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-273">This time you see the page.</span></span>

## <a name="preventing-automated-programs-from-joining-your-website"></a><span data-ttu-id="b4ff1-274">防止自動的程式加入您的網站</span><span class="sxs-lookup"><span data-stu-id="b4ff1-274">Preventing Automated Programs from Joining Your Website</span></span>

<span data-ttu-id="b4ff1-275">登入頁面將不會停止自動的程式 (有時稱為*web robots*或*bot*) 登錄到您的網站。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-275">The login page will not stop automated programs (sometimes referred to as *web robots* or *bots*) from registering with your website.</span></span> <span data-ttu-id="b4ff1-276">此程序描述如何啟用 [註冊] 頁面的 ReCaptcha 測試。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-276">This procedure describes how to enable a ReCaptcha test for the registration page.</span></span>

![/media/38777/ch16securitymembership-18.jpg](16-adding-security-and-membership/_static/image1.jpg)

1. <span data-ttu-id="b4ff1-278">註冊您的網站，在 ([http://recaptcha.net](http://recaptcha.net))。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-278">Register your website at ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span></span> <span data-ttu-id="b4ff1-279">當您已經完成註冊時，您會取得公開金鑰和私密金鑰。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-279">When you've completed registration, you'll get a public key and a private key.</span></span>
2. <span data-ttu-id="b4ff1-280">中所述，您的網站加入 ASP.NET Web Helpers Library[安裝 ASP.NET Web Pages 站台中的協助程式](https://go.microsoft.com/fwlink/?LinkId=252372)，如果您還沒有這麼做。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-280">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already.</span></span>
3. <span data-ttu-id="b4ff1-281">在*帳戶*資料夾中，開啟的檔案命名為*Register.cshtml*。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-281">In the *Account* folder, open the file named *Register.cshtml*.</span></span>
4. <span data-ttu-id="b4ff1-282">在頁面頂端的程式碼，找出下列幾行，並取消其藉由移除註解`//`註解字元：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-282">In the code at the top of the page, find the following lines and uncomment them by removing the `//` comment characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample6.cs)]
5. <span data-ttu-id="b4ff1-283">取代`PRIVATE_KEY`ReCaptcha 私用金鑰。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-283">Replace `PRIVATE_KEY` with your own ReCaptcha private key.</span></span>
6. <span data-ttu-id="b4ff1-284">在網頁標記中，移除`@*`和`*@`從網頁標記中的下列程式周圍的註解字元：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-284">In the markup of the page, remove the `@*` and `*@` commenting characters from around the following lines in the page markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample7.cshtml)]
7. <span data-ttu-id="b4ff1-285">取代`PUBLIC_KEY`與您的金鑰。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-285">Replace `PUBLIC_KEY` with your key.</span></span>
8. <span data-ttu-id="b4ff1-286">如果您沒有已移除，移除`<div>`包含開頭為 「 若要啟用 CAPTCHA 驗證..."的文字項目。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-286">If you haven't removed it already, remove the `<div>` element that contains text that starts with "To enable CAPTCHA verification ...".</span></span> <span data-ttu-id="b4ff1-287">(移除整個`<div>`項目和其內容。)</span><span class="sxs-lookup"><span data-stu-id="b4ff1-287">(Remove the entire `<div>` element and its contents.)</span></span>

1. <span data-ttu-id="b4ff1-288">執行*Default.cshtml*瀏覽器中。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-288">Run *Default.cshtml* in a browser.</span></span> <span data-ttu-id="b4ff1-289">如果您登入網站，按一下**登出**連結。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-289">If you're logged into the site, click the **Logout** link.</span></span>
2. <span data-ttu-id="b4ff1-290">按一下**註冊**連結和測試使用 CAPTCHA 測試的註冊。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-290">Click the **Register** link and test the registration using the CAPTCHA test.</span></span>

    ![security-membership-10](16-adding-security-and-membership/_static/image9.png)

<span data-ttu-id="b4ff1-292">如需有關`ReCaptcha`協助程式，請參閱[防止自動程式 (Bot) 從使用您的 ASP.NET 網站使用 CATPCHA](https://go.microsoft.com/fwlink/?LinkId=251967)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-292">For more information about the `ReCaptcha` helper, see [Using a CATPCHA to Prevent Automated Programs (Bots) from Using Your ASP.NET Web Site](https://go.microsoft.com/fwlink/?LinkId=251967).</span></span>

<a id="Additional_Resources"></a>
## <a name="letting-users-log-in-using-an-external-site"></a><span data-ttu-id="b4ff1-293">讓使用者能夠登入使用外部站台</span><span class="sxs-lookup"><span data-stu-id="b4ff1-293">Letting Users Log In Using an External Site</span></span>

<span data-ttu-id="b4ff1-294">**入門網站**範本包含程式碼和標記，可讓使用者使用 Facebook、 Windows Live、 Twitter、 Google 或 Yahoo 登入。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-294">The **Starter Site** template includes code and markup that lets users log in using Facebook, Windows Live, Twitter, Google, or Yahoo.</span></span> <span data-ttu-id="b4ff1-295">根據預設，未啟用這項功能。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-295">By default, this functionality is not enabled.</span></span> <span data-ttu-id="b4ff1-296">一般的程序的使用讓使用者使用這些外部提供者登入這是：</span><span class="sxs-lookup"><span data-stu-id="b4ff1-296">The general procedure for using letting users log in using these external providers is this:</span></span>

- <span data-ttu-id="b4ff1-297">決定您想要支援哪些外部站台。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-297">Decide which of the external sites you want to support.</span></span>
- <span data-ttu-id="b4ff1-298">如有需要，請移至該站台，並設定登入應用程式。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-298">If required, go to that site and set up a login app.</span></span> <span data-ttu-id="b4ff1-299">（例如，您需要執行此動作以允許 Facebook 登入。）</span><span class="sxs-lookup"><span data-stu-id="b4ff1-299">(For example, you have to do this in order to allow Facebook logins.)</span></span>
- <span data-ttu-id="b4ff1-300">在您的網站中設定提供者。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-300">In your site, configure the provider.</span></span> <span data-ttu-id="b4ff1-301">在大部分情況下，您只需要取消註解中的某些程式碼 *\_AppStart.cshtml*檔案。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-301">In most cases, you just have to uncomment some code in the *\_AppStart.cshtml* file.</span></span>
- <span data-ttu-id="b4ff1-302">將標記加入至 [註冊] 頁面，可讓使用者登入的外部網站的連結。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-302">Add markup to the registration page that lets people link to the external site for logging in.</span></span> <span data-ttu-id="b4ff1-303">您通常可以複製的標記，您需要並稍有變更的文字。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-303">You can usually copy the markup you need and change the text slightly.</span></span>

<span data-ttu-id="b4ff1-304">您可以找到逐步解說主題中的 <<c0> [ 啟用登入，從 ASP.NET Web Pages 網站中的外部站台](https://go.microsoft.com/fwlink/?LinkId=251969)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-304">You can find step-by-step instructions in the topic [Enabling Login from External Sites in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=251969).</span></span>

<span data-ttu-id="b4ff1-305">在使用者登入從另一個站台後，使用者就會傳回至您的網站和*關聯*該登入與您的網站。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-305">After a user logs in from another site, the user returns to your site and *associates* that login with your site.</span></span> <span data-ttu-id="b4ff1-306">作用中，這會建立成員資格項目在使用者的外部登入網站。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-306">In effect, this creates a membership entry in your site for the user's external login.</span></span> <span data-ttu-id="b4ff1-307">這可讓您使用具有外部登入 （例如角色） 的成員資格的一般功能。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-307">This lets you use the normal facilities of membership (such as roles) with the external login.</span></span>

## <a name="adding-security-to-an-existing-website"></a><span data-ttu-id="b4ff1-308">將安全性新增至現有的網站</span><span class="sxs-lookup"><span data-stu-id="b4ff1-308">Adding Security to an Existing Website</span></span>

<span data-ttu-id="b4ff1-309">本文章中稍早程序依賴使用**入門網站**範本做為網站安全性的基礎。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-309">The procedure earlier in this article relies on using the **Starter Site** template as the basis for website security.</span></span> <span data-ttu-id="b4ff1-310">如果看不到適合您開始從**入門網站**範本或若要從該範本為基礎的站台複製相關頁面，您可以相同的安全性類型中實作您自己的網站透過編碼自己。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-310">If it isn't practical for you to start from the **Starter Site** template or to copy the relevant pages from a site based on that template, you can implement the same type of security in your own site by coding it yourself.</span></span> <span data-ttu-id="b4ff1-311">建立相同類型的頁面，註冊、 登入，以及其他，然後使用 helper 和類別，來設定成員資格。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-311">You create the same types of pages — registration, login, and so on — and then use helpers and classes to set up membership.</span></span>

<span data-ttu-id="b4ff1-312">基本程序所述的部落格文章[最基本的方式來實作 ASP.NET Razor 安全性](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-312">The basic process is described in the blog post [THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span></span> <span data-ttu-id="b4ff1-313">大部分的工作是使用下列方法和屬性`WebSecurity`helper:</span><span class="sxs-lookup"><span data-stu-id="b4ff1-313">Most of the work is done using the following methods and properties of the `WebSecurity` helper:</span></span>

- <span data-ttu-id="b4ff1-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx)， [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span></span> <span data-ttu-id="b4ff1-315">這些方法可讓您判斷是否有人已登錄並加以註冊。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-315">These methods let you determine whether someone is already registered and to register them.</span></span>
- <span data-ttu-id="b4ff1-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="b4ff1-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span></span> <span data-ttu-id="b4ff1-317">這個屬性可讓您決定是否要將目前的使用者登入。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-317">This property lets you determine whether the current user is logged in.</span></span> <span data-ttu-id="b4ff1-318">這非常有用，如果使用者沒有已登入，將使用者重新導向至登入頁面。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-318">This is useful to redirect users to a login page if they have not already logged in.</span></span>
- <span data-ttu-id="b4ff1-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx)， [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span></span> <span data-ttu-id="b4ff1-320">這些方法，將使用者登入或簽出。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-320">These methods log a user in or out.</span></span>
- <span data-ttu-id="b4ff1-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="b4ff1-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span></span> <span data-ttu-id="b4ff1-322">這個屬性是適用於顯示目前使用者的登入名稱 （如果使用者已登入）。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-322">This property is useful for displaying the current user's logged-in name (if the user is logged in).</span></span>
- <span data-ttu-id="b4ff1-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="b4ff1-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span></span> <span data-ttu-id="b4ff1-324">這個方法很有用，如果您設定註冊的電子郵件確認。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-324">This method is useful if you set up email confirmation for registration.</span></span> <span data-ttu-id="b4ff1-325">(部落格文章中說明的詳細資料[使用 ASP.NET Web Pages 安全性確認功能](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267)。)</span><span class="sxs-lookup"><span data-stu-id="b4ff1-325">(Details are described in the blog post [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span></span>

<span data-ttu-id="b4ff1-326">若要管理角色，您可以使用[角色](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx)和[成員資格](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx)類別，部落格文章中所述。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-326">To manage roles, you can use the [Roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) and [Membership](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) classes, as described in the blog entry.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="b4ff1-327">其他資源</span><span class="sxs-lookup"><span data-stu-id="b4ff1-327">Additional Resources</span></span>

- [<span data-ttu-id="b4ff1-328">自訂全網站行為</span><span class="sxs-lookup"><span data-stu-id="b4ff1-328">Customizing Site-Wide Behavior</span></span>](https://go.microsoft.com/fwlink/?LinkId=202906)
- [<span data-ttu-id="b4ff1-329">保護 Web 通訊： 憑證、 SSL 及 https://</span><span class="sxs-lookup"><span data-stu-id="b4ff1-329">Securing Web Communications: Certificates, SSL, and https://</span></span>](https://go.microsoft.com/fwlink/?LinkId=208660)
- <span data-ttu-id="b4ff1-330">[最基本的方式來實作 ASP.NET Razor 安全性](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240)和[使用 ASP.NET Web Pages 安全性確認功能](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267)。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-330">[THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) and [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span></span> <span data-ttu-id="b4ff1-331">這些是部落格文章說明如何實作 ASP.NET 成員資格功能，而不使用**入門網站**範本。</span><span class="sxs-lookup"><span data-stu-id="b4ff1-331">These are blog posts that describe how to implement ASP.NET membership features without using the **Starter Site** template.</span></span>
- [<span data-ttu-id="b4ff1-332">在 ASP.NET Web Pages 網站中啟用外部網站的登入</span><span class="sxs-lookup"><span data-stu-id="b4ff1-332">Enabling Login from External Sites in an ASP.NET Web Pages Site</span></span>](https://go.microsoft.com/fwlink/?LinkId=251969)
- <span data-ttu-id="b4ff1-333">[WebSecurity 類別 API 參考](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="b4ff1-333">[WebSecurity Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="b4ff1-334">[SimpleRoleProvider 類別 API 參考](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="b4ff1-334">[SimpleRoleProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="b4ff1-335">[SimpleMembershipProvider 類別 API 參考](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="b4ff1-335">[SimpleMembershipProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span></span>
