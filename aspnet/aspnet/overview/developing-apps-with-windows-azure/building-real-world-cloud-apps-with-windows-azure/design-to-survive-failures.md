---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
title: 設計存留失敗 （使用 Azure 建置真實世界的雲端應用程式） |Microsoft Docs
author: MikeWasson
description: 建置真實世界雲端應用程式與 Azure 的電子書是以 Scott Guthrie 所開發的簡報為依據。 它說明 13 模式與做法，他可以...
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/12/2014
ms.topic: article
ms.assetid: 364ce84e-5af8-4e08-afc9-75a512b01f84
ms.technology: ''
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
msc.type: authoredcontent
ms.openlocfilehash: db7398cfd9ed51d716cb595d977b482fd0da131e
ms.sourcegitcommit: 953ff9ea4369f154d6fd0239599279ddd3280009
ms.translationtype: MT
ms.contentlocale: zh-TW
ms.lasthandoff: 07/03/2018
ms.locfileid: "37372458"
---
<a name="design-to-survive-failures-building-real-world-cloud-apps-with-azure"></a><span data-ttu-id="a209e-104">設計存留失敗 （使用 Azure 建置真實世界的雲端應用程式）</span><span class="sxs-lookup"><span data-stu-id="a209e-104">Design to Survive Failures (Building Real-World Cloud Apps with Azure)</span></span>
====================
<span data-ttu-id="a209e-105">藉由[Mike Wasson](https://github.com/MikeWasson)， [Rick Anderson](https://github.com/Rick-Anderson)， [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="a209e-105">by [Mike Wasson](https://github.com/MikeWasson), [Rick Anderson](https://github.com/Rick-Anderson), [Tom Dykstra](https://github.com/tdykstra)</span></span>

<span data-ttu-id="a209e-106">[下載修正此問題的專案](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)或[下載電子書](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span><span class="sxs-lookup"><span data-stu-id="a209e-106">[Download Fix It Project](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4) or [Download E-book](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)</span></span>

> <span data-ttu-id="a209e-107">**建置真實世界雲端應用程式與 Azure**電子書以 Scott Guthrie 所開發的簡報為依據。</span><span class="sxs-lookup"><span data-stu-id="a209e-107">The **Building Real World Cloud Apps with Azure** e-book is based on a presentation developed by Scott Guthrie.</span></span> <span data-ttu-id="a209e-108">它說明 13 的模式，並可協助您的作法是成功開發適用於雲端的 web 應用程式。</span><span class="sxs-lookup"><span data-stu-id="a209e-108">It explains 13 patterns and practices that can help you be successful developing web apps for the cloud.</span></span> <span data-ttu-id="a209e-109">電子書的相關資訊，請參閱[第 1 章](introduction.md)。</span><span class="sxs-lookup"><span data-stu-id="a209e-109">For information about the e-book, see [the first chapter](introduction.md).</span></span>


<span data-ttu-id="a209e-110">您需要思考如何當您建置任何應用程式，但特別是在其中有許多人會使用到它，雲端中執行的其中一種的事情之一是如何設計應用程式，讓它可以正常處理失敗，並繼續提供價值高達可能的。</span><span class="sxs-lookup"><span data-stu-id="a209e-110">One of the things you have to think about when you build any type of application, but especially one that will run in the cloud where lots of people will be using it, is how to design the app so that it can gracefully handle failures and continue to deliver value as much as possible.</span></span> <span data-ttu-id="a209e-111">有足夠的時間，項目會在任何環境或任何軟體系統中發生錯誤。</span><span class="sxs-lookup"><span data-stu-id="a209e-111">Given enough time, things are going to go wrong in any environment or any software system.</span></span> <span data-ttu-id="a209e-112">您的應用程式如何處理這些情況下決定您的客戶會收到如何不滿，以及多少時間花費分析及修正問題。</span><span class="sxs-lookup"><span data-stu-id="a209e-112">How your app handles those situations determines how upset your customers will get and how much time you have to spend analyzing and fixing problems.</span></span>

## <a name="types-of-failures"></a><span data-ttu-id="a209e-113">失敗類型</span><span class="sxs-lookup"><span data-stu-id="a209e-113">Types of failures</span></span>

<span data-ttu-id="a209e-114">有兩種基本的類別，您會想要以不同方式處理的失敗：</span><span class="sxs-lookup"><span data-stu-id="a209e-114">There are two basic categories of failures that you'll want to handle differently:</span></span>

- <span data-ttu-id="a209e-115">暫時性、 自我修復失敗，例如間歇性的網路連線問題。</span><span class="sxs-lookup"><span data-stu-id="a209e-115">Transient, self-healing failures such as intermittent network connectivity issues.</span></span>
- <span data-ttu-id="a209e-116">根需要介入。</span><span class="sxs-lookup"><span data-stu-id="a209e-116">Enduring failures that require intervention.</span></span>

<span data-ttu-id="a209e-117">針對暫時性失敗，您可以實作重試原則，以確保大部分的應用程式在快速且自動復原的時間。</span><span class="sxs-lookup"><span data-stu-id="a209e-117">For transient failures, you can implement a retry policy to ensure that most of the time the app recovers quickly and automatically.</span></span> <span data-ttu-id="a209e-118">您的客戶可能會注意到略長回應時間，但否則它們不會受到影響。</span><span class="sxs-lookup"><span data-stu-id="a209e-118">Your customers might notice slightly longer response time, but otherwise they won't be affected.</span></span> <span data-ttu-id="a209e-119">我們將示範如何處理這些錯誤[暫時性錯誤處理的一章](transient-fault-handling.md)。</span><span class="sxs-lookup"><span data-stu-id="a209e-119">We'll show some ways to handle these errors in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

<span data-ttu-id="a209e-120">針對持續發生失敗，您可以實作監視和記錄功能，當發生問題，並進行根本原因分析時立即通知您。</span><span class="sxs-lookup"><span data-stu-id="a209e-120">For enduring failures, you can implement monitoring and logging functionality that notifies you promptly when issues arise and that facilitates root cause analysis.</span></span> <span data-ttu-id="a209e-121">我們將示範可協助您掌握這類錯誤，在某些方面[監視和遙測章節](monitoring-and-telemetry.md)。</span><span class="sxs-lookup"><span data-stu-id="a209e-121">We'll show some ways to help you stay on top of these kinds of errors in the [Monitoring and Telemetry chapter](monitoring-and-telemetry.md).</span></span>

## <a name="failure-scope"></a><span data-ttu-id="a209e-122">失敗的範圍</span><span class="sxs-lookup"><span data-stu-id="a209e-122">Failure scope</span></span>

<span data-ttu-id="a209e-123">您也必須考慮失敗範圍 – 是否會影響單一機器，或完整的服務，例如 SQL Database、 儲存體或整個區域。</span><span class="sxs-lookup"><span data-stu-id="a209e-123">You also have to think about failure scope – whether a single machine is affected, a whole service such as SQL Database or Storage, or an entire region.</span></span>

![失敗的範圍](design-to-survive-failures/_static/image1.png)

### <a name="machine-failures"></a><span data-ttu-id="a209e-125">機器失敗</span><span class="sxs-lookup"><span data-stu-id="a209e-125">Machine failures</span></span>

<span data-ttu-id="a209e-126">在 Azure 中，新的連線，都會自動取代故障的伺服器，並從這種失敗會自動並快速復原的設計良好的雲端應用程式。</span><span class="sxs-lookup"><span data-stu-id="a209e-126">In Azure, a failed server is automatically replaced by a new one, and a well-designed cloud app recovers from this kind of failure automatically and quickly.</span></span> <span data-ttu-id="a209e-127">我們稍早強調的無狀態 web 層的延展性優勢，並輕鬆復原，從失敗的伺服器是無狀態的另一個優點。</span><span class="sxs-lookup"><span data-stu-id="a209e-127">Earlier we stressed the scalability benefits of a stateless web tier, and ease of recovery from a failed server is another benefit of statelessness.</span></span> <span data-ttu-id="a209e-128">輕鬆復原也是其中一個平台為-即服務 (PaaS) 功能，例如 SQL Database 和 Azure App Service Web Apps 的優點。</span><span class="sxs-lookup"><span data-stu-id="a209e-128">Ease of recovery is also one of the benefits of platform-as-a-service (PaaS) features such as SQL Database and Azure App Service Web Apps.</span></span> <span data-ttu-id="a209e-129">硬體失敗較為罕見，但發生這些服務，而處理它們您甚至不必撰寫程式碼來處理機器失敗，當您使用上述其中一個服務。</span><span class="sxs-lookup"><span data-stu-id="a209e-129">Hardware failures are rare, but when they occur these services handle them automatically; you don't even have to write code to handle machine failures when you're using one of these services.</span></span>

### <a name="service-failures"></a><span data-ttu-id="a209e-130">服務失敗</span><span class="sxs-lookup"><span data-stu-id="a209e-130">Service failures</span></span>

<span data-ttu-id="a209e-131">雲端應用程式通常會使用多個服務。</span><span class="sxs-lookup"><span data-stu-id="a209e-131">Cloud apps typically use multiple services.</span></span> <span data-ttu-id="a209e-132">比方說，它修正應用程式使用 SQL Database 服務，儲存體服務和 web 應用程式部署至 Azure App Service。</span><span class="sxs-lookup"><span data-stu-id="a209e-132">For example, the Fix It app uses the SQL Database service, the Storage service, and the web app is deployed to Azure App Service.</span></span> <span data-ttu-id="a209e-133">將您的應用程式做什麼如果其中一個您依賴的服務失敗？</span><span class="sxs-lookup"><span data-stu-id="a209e-133">What will your app do if one of the services you depend on fails?</span></span> <span data-ttu-id="a209e-134">某些服務失敗的易記 「 很抱歉，稍後再試 」 訊息可能是的最好的方式。</span><span class="sxs-lookup"><span data-stu-id="a209e-134">For some service failures a friendly "sorry, try again later" message might be the best you can do.</span></span> <span data-ttu-id="a209e-135">但在許多情況下您可以執行更好。</span><span class="sxs-lookup"><span data-stu-id="a209e-135">But in many scenarios you can do better.</span></span> <span data-ttu-id="a209e-136">比方說，當您的後端資料存放區已關閉，您可以接受使用者輸入、 顯示 「 已收到您的要求 」，並儲存其他某處輸入暫時;然後服務時，您需要 operational 同樣地，您可以擷取輸入，並加以處理。</span><span class="sxs-lookup"><span data-stu-id="a209e-136">For example, when your back-end data store is down, you can accept user input, display "your request has been received," and store the input someplace else temporarily; then when the service you need is operational again, you can retrieve the input and process it.</span></span>

<span data-ttu-id="a209e-137">[佇列為中心的工作模式](queue-centric-work-pattern.md)章節示範一種方式處理這種情況。</span><span class="sxs-lookup"><span data-stu-id="a209e-137">The [Queue-centric Work Pattern](queue-centric-work-pattern.md) chapter shows one way to handle this scenario.</span></span> <span data-ttu-id="a209e-138">修正其應用程式會將工作儲存在 SQL Database 中，但不一定要結束使用 SQL Database 已關閉時。</span><span class="sxs-lookup"><span data-stu-id="a209e-138">The Fix It app stores tasks in SQL Database, but it doesn't have to quit working when SQL Database is down.</span></span> <span data-ttu-id="a209e-139">在該章節中，我們將了解如何在佇列中，儲存工作的使用者輸入，並使用背景工作處理序讀取佇列，並更新的工作。</span><span class="sxs-lookup"><span data-stu-id="a209e-139">In that chapter we'll see how to store user input for a task in a queue, and use a worker process to read the queue and update the task.</span></span> <span data-ttu-id="a209e-140">如果 SQL 已關閉，建立 It 工作的能力不受影響;背景工作處理序可以等候，並使用 SQL Database 時，處理新的工作。</span><span class="sxs-lookup"><span data-stu-id="a209e-140">If SQL is down, the ability to create Fix It tasks is unaffected; the worker process can wait and process new tasks when SQL Database is available.</span></span>

### <a name="region-failures"></a><span data-ttu-id="a209e-141">區域失敗</span><span class="sxs-lookup"><span data-stu-id="a209e-141">Region failures</span></span>

<span data-ttu-id="a209e-142">整個區域可能會失敗。</span><span class="sxs-lookup"><span data-stu-id="a209e-142">Entire regions may fail.</span></span> <span data-ttu-id="a209e-143">天然災害可能會損毀的資料中心，它可能會取得壓平合併的 meteor，埋藏 backhoe 等等 cow farmer 無法剪下主幹行的資料中心。如果應的資料中心內裝載您的應用程式該怎麼辦？</span><span class="sxs-lookup"><span data-stu-id="a209e-143">A natural disaster might destroy a data center, it might get flattened by a meteor, the trunk line into the datacenter could be cut by a farmer burying a cow with a backhoe, etc. If your app is hosted in the stricken datacenter what do you do?</span></span> <span data-ttu-id="a209e-144">可以設定您的應用程式，在 Azure 中多個區域中同時執行，以便如果在一個沒有嚴重損壞，您就會繼續在另一個區域中執行。</span><span class="sxs-lookup"><span data-stu-id="a209e-144">It's possible to set up your app in Azure to run in multiple regions simultaneously so that if there's a disaster in one, you continue running in another region.</span></span> <span data-ttu-id="a209e-145">這類失敗極為罕見的事件，而且大部分的應用程式不會跳過必須確保不中斷的服務，透過這類失敗關卡。</span><span class="sxs-lookup"><span data-stu-id="a209e-145">Such failures are extremely rare occurrences, and most apps don't jump through the hoops necessary to ensure uninterrupted service through failures of this sort.</span></span> <span data-ttu-id="a209e-146">請參閱 [資源] 區段，如需有關如何讓您的應用程式甚至透過區域失敗資訊的章節的結尾。</span><span class="sxs-lookup"><span data-stu-id="a209e-146">See the Resources section at the end of the chapter for information about how to keep your app available even through a region failure.</span></span>

<span data-ttu-id="a209e-147">Azure 的目標是要處理所有這類問題來得簡單許多，，您會看到我們的表現如何，在以下章節中的一些範例。</span><span class="sxs-lookup"><span data-stu-id="a209e-147">A goal of Azure is to make handling all of these kinds of failures a lot easier, and you'll see some examples of how we're doing that in the following chapters.</span></span>

## <a name="slas"></a><span data-ttu-id="a209e-148">Sla</span><span class="sxs-lookup"><span data-stu-id="a209e-148">SLAs</span></span>

<span data-ttu-id="a209e-149">人們通常會聽聽雲端環境中的服務等級協定 (Sla)。</span><span class="sxs-lookup"><span data-stu-id="a209e-149">People often hear about service-level agreements (SLAs) in the cloud environment.</span></span> <span data-ttu-id="a209e-150">基本上，這些是如何可靠服務的相關公司做出的承諾。</span><span class="sxs-lookup"><span data-stu-id="a209e-150">Basically these are promises that companies make about how reliable their service is.</span></span> <span data-ttu-id="a209e-151">99.9 %sla 意謂著您應該會正常運作時間達 99.9%的服務。</span><span class="sxs-lookup"><span data-stu-id="a209e-151">A 99.9% SLA means you should expect the service to be working correctly 99.9% of the time.</span></span> <span data-ttu-id="a209e-152">這是相當常見的 sla 值和聽起來很高的數字，但您可能不知道多少停機時間。 實際總計為的 1%。</span><span class="sxs-lookup"><span data-stu-id="a209e-152">That's a fairly typical value for an SLA and it sounds like a very high number, but you might not realize how much down time .1% actually amounts to.</span></span> <span data-ttu-id="a209e-153">以下是資料表，其中顯示各種 SLA 百分比相當透過一年、 月和週多少停機時間。</span><span class="sxs-lookup"><span data-stu-id="a209e-153">Here's a table that shows how much downtime various SLA percentages amount to over a year, a month, and a week.</span></span>

![SLA 資料表](design-to-survive-failures/_static/image2.png)

<span data-ttu-id="a209e-155">因此 99.9 %sla 表示您的服務可能已關閉 8.76 個小時一年或每月 43.2 分鐘。</span><span class="sxs-lookup"><span data-stu-id="a209e-155">So a 99.9% SLA means your service could be down 8.76 hours a year or 43.2 minutes a month.</span></span> <span data-ttu-id="a209e-156">這是更停機時間比大多數人。</span><span class="sxs-lookup"><span data-stu-id="a209e-156">That's more down time than most people realize.</span></span> <span data-ttu-id="a209e-157">因此，身為開發人員要注意一段停機時間，很有可能以正常方式處理它。</span><span class="sxs-lookup"><span data-stu-id="a209e-157">So as a developer you want to be aware that a certain amount of down time is possible and handle it in a graceful way.</span></span> <span data-ttu-id="a209e-158">在某個時間點有人會想要使用您的應用程式和服務即將停止運作，而且您想將客戶的負面影響降至最低。</span><span class="sxs-lookup"><span data-stu-id="a209e-158">At some point someone is going to be using your app, and a service is going to be down, and you want to minimize the negative impact of that on the customer.</span></span>

<span data-ttu-id="a209e-159">您應該了解 SLA 的一點是它參考到哪些時間範圍： 沒有時鐘會重設每週、 每個月或每年嗎？</span><span class="sxs-lookup"><span data-stu-id="a209e-159">One thing you should know about an SLA is what time-frame it refers to: does the clock get reset every week, every month, or every year?</span></span> <span data-ttu-id="a209e-160">在 Azure 中我們重設時鐘每個月，這是您比每年的 SLA，更好的因為每年的 SLA 可以隱藏不好的月份的表徵它們使用一系列的很好的幾個月。</span><span class="sxs-lookup"><span data-stu-id="a209e-160">In Azure we reset the clock every month, which is better for you than a yearly SLA, since a yearly SLA could hide bad months by offsetting them with a series of good months.</span></span>

<span data-ttu-id="a209e-161">當然我們永遠渴望比 SLA; 更好嗎通常，您會關閉，遠不如。</span><span class="sxs-lookup"><span data-stu-id="a209e-161">Of course we always aspire to do better than the SLA; usually you'll be down much less than that.</span></span> <span data-ttu-id="a209e-162">承諾是如果我們曾向下的時間停機時間的最大值超過您可以要求退款。</span><span class="sxs-lookup"><span data-stu-id="a209e-162">The promise is that if we're ever down for longer than the maximum down time you can ask for money back.</span></span> <span data-ttu-id="a209e-163">您會取得可能的金額不全額補償您的停機時間，過多的商務影響，但 SLA 的這個部分做為 強制執行原則，並可讓您知道，我們執行非常認真看待。</span><span class="sxs-lookup"><span data-stu-id="a209e-163">The amount of money you get back probably wouldn't fully compensate you for the business impact of the excess down time, but that aspect of the SLA acts as an enforcement policy and lets you know that we do take it very seriously.</span></span>

### <a name="composite-slas"></a><span data-ttu-id="a209e-164">複合 Sla</span><span class="sxs-lookup"><span data-stu-id="a209e-164">Composite SLAs</span></span>

<span data-ttu-id="a209e-165">考慮您要尋找在 Sla 的重點是在應用程式中使用多個服務，每個服務具有不同的 SLA 的影響。</span><span class="sxs-lookup"><span data-stu-id="a209e-165">An important thing to think about when you're looking at SLAs is the impact of using multiple services in an app, with each service having a separate SLA.</span></span> <span data-ttu-id="a209e-166">比方說，它修正應用程式所使用的 Azure App Service Web Apps、 Azure 儲存體和 SQL Database。</span><span class="sxs-lookup"><span data-stu-id="a209e-166">For example, the Fix It app uses Azure App Service Web Apps, Azure Storage, and SQL Database.</span></span> <span data-ttu-id="a209e-167">以下是本電子書正在寫入在 2013 年 12 月，日其 SLA 號碼：</span><span class="sxs-lookup"><span data-stu-id="a209e-167">Here are their SLA numbers as of the date this e-book is being written in December, 2013:</span></span>

![SLA 的網站，儲存體、 SQL Database](design-to-survive-failures/_static/image3.png)

<span data-ttu-id="a209e-169">停機時間會預期這些服務的 Sla 為基礎的應用程式的最大值是什麼？</span><span class="sxs-lookup"><span data-stu-id="a209e-169">What is the maximum down time you would expect for the app based on these service SLAs?</span></span> <span data-ttu-id="a209e-170">您可能會認為，您的停機時間會等於最差的 SLA 百分比或有 99.9%在此情況下。</span><span class="sxs-lookup"><span data-stu-id="a209e-170">You might think that your down time would be equal to the worst SLA percentage, or 99.9% in this case.</span></span> <span data-ttu-id="a209e-171">如果這三種服務永遠無法在此同時，但這並不一定是實際發生什麼事，那就是，則為 true。</span><span class="sxs-lookup"><span data-stu-id="a209e-171">That would be true if all three services always failed at the same time, but that isn't necessarily what actually happens.</span></span> <span data-ttu-id="a209e-172">在不同的時間，因此您需要個別的 SLA 個數字相乘的複合 SLA 來計算每個服務可能獨立失敗。</span><span class="sxs-lookup"><span data-stu-id="a209e-172">Each service may fail independently at different times, so you have to calculate the composite SLA by multiplying the individual SLA numbers.</span></span>

![複合 SLA](design-to-survive-failures/_static/image4.png)

<span data-ttu-id="a209e-174">讓您的應用程式可能會關閉不只是 43.2 分鐘的時間的月份，3 次數量，一個月 – 108 分鐘，並仍是 Azure SLA 的限制範圍內。</span><span class="sxs-lookup"><span data-stu-id="a209e-174">So your app could be down not just 43.2 minutes a month but 3 times that amount, 108 minutes a month – and still be within the Azure SLA limits.</span></span>

<span data-ttu-id="a209e-175">這個問題並非 Azure 獨有的。</span><span class="sxs-lookup"><span data-stu-id="a209e-175">This issue is not unique to Azure.</span></span> <span data-ttu-id="a209e-176">實際上，我們提供最佳的雲端，任何雲端服務的 Sla，而且也有類似的問題，如果您使用任何廠商的雲端服務處理。</span><span class="sxs-lookup"><span data-stu-id="a209e-176">We actually provide the best cloud SLAs of any cloud service available, and you'll have similar issues to deal with if you use any vendor's cloud services.</span></span> <span data-ttu-id="a209e-177">這所強調是思考如何設計您的應用程式，以依正常程序，處理無可避免的服務失敗，因為它們可能經常會影響客戶或使用者的重要性。</span><span class="sxs-lookup"><span data-stu-id="a209e-177">What this highlights is the importance of thinking about how you can design your app to handle the inevitable service failures gracefully, because they might happen often enough to impact your customers or users.</span></span>

### <a name="cloud-slas-compared-to-enterprise-down-time-experience"></a><span data-ttu-id="a209e-178">相較於企業的停機時間體驗雲端 Sla</span><span class="sxs-lookup"><span data-stu-id="a209e-178">Cloud SLAs compared to enterprise down-time experience</span></span>

<span data-ttu-id="a209e-179">人們有時說 「 我的企業應用程式在我永遠不會有這些問題。 」</span><span class="sxs-lookup"><span data-stu-id="a209e-179">People sometimes say, "In my enterprise app I never have these problems."</span></span> <span data-ttu-id="a209e-180">如果您問多少停機時間，一個月他們實際上有，他們通常會說 「，它會偶爾。 」</span><span class="sxs-lookup"><span data-stu-id="a209e-180">If you ask how much down time a month they actually have, they usually say, "Well, it happens occasionally."</span></span> <span data-ttu-id="a209e-181">如果您要求頻率，請他們承認和 「 有時候我們需要備份或安裝新的伺服器或更新軟體 」。</span><span class="sxs-lookup"><span data-stu-id="a209e-181">And if you ask how often, they admit that "Sometimes we do need to back up or install a new server or update software."</span></span> <span data-ttu-id="a209e-182">當然，計算在停機時間。</span><span class="sxs-lookup"><span data-stu-id="a209e-182">Of course, that counts as down time.</span></span> <span data-ttu-id="a209e-183">大部分的企業應用程式除非特別任務關鍵性實際上是時間的向下多個服務 Sla 所允許量。</span><span class="sxs-lookup"><span data-stu-id="a209e-183">Most enterprise apps unless they are especially mission-critical are actually down for more than the amount of time allowed by our service SLAs.</span></span> <span data-ttu-id="a209e-184">但當它是您的伺服器和基礎結構，您必須負責它，然後在它的控制項，通常覺得較少的秘密，停機時間。</span><span class="sxs-lookup"><span data-stu-id="a209e-184">But when it's your server and your infrastructure and you're responsible for it and in control of it, you tend to feel less angst about down times.</span></span> <span data-ttu-id="a209e-185">在雲端環境中您是相依於其他人，而且您不知道發生什麼情況，因此您可能會變得更擔心。</span><span class="sxs-lookup"><span data-stu-id="a209e-185">In a cloud environment you're dependent on someone else and you don't know what's going on, so you might tend to get more worried about it.</span></span>

<span data-ttu-id="a209e-186">當企業達成更高的執行時間百分比比從雲端 SLA 時，請勿在硬體上花費更多的錢。</span><span class="sxs-lookup"><span data-stu-id="a209e-186">When an enterprise achieves a greater up-time percentage than you get from a cloud SLA, they do it by spending a lot more money on hardware.</span></span> <span data-ttu-id="a209e-187">雲端服務可以進行，但會有費用為其服務的更多。</span><span class="sxs-lookup"><span data-stu-id="a209e-187">A cloud service could do that but would have to charge much more for its services.</span></span> <span data-ttu-id="a209e-188">相反地，您會利用符合成本效益的服務，並設計您的軟體，讓無可避免的失敗會造成最小的中斷，給您的客戶。</span><span class="sxs-lookup"><span data-stu-id="a209e-188">Instead, you take advantage of a cost-effective service and design your software so that the inevitable failures cause minimum disruption to your customers.</span></span> <span data-ttu-id="a209e-189">您為雲端應用程式的設計工具的作業不是這麼避免失敗，避免發生災難，您的做法是將焦點放在不是在硬體上的軟體。</span><span class="sxs-lookup"><span data-stu-id="a209e-189">Your job as a cloud app designer is not so much to avoid failure as to avoid catastrophe, and you do that by focusing on software, not on hardware.</span></span> <span data-ttu-id="a209e-190">平均失敗時間發揮最大努力企業應用程式，而雲端應用程式會努力復原的平均時間降至最低。</span><span class="sxs-lookup"><span data-stu-id="a209e-190">Whereas enterprise apps strive to maximize mean time between failures, cloud apps strive to minimize mean time to recover.</span></span>

### <a name="not-all-cloud-services-have-slas"></a><span data-ttu-id="a209e-191">並非所有的雲端服務會有 Sla</span><span class="sxs-lookup"><span data-stu-id="a209e-191">Not all cloud services have SLAs</span></span>

<span data-ttu-id="a209e-192">也請注意，並非每個雲端服務甚至會有 SLA。</span><span class="sxs-lookup"><span data-stu-id="a209e-192">Be aware also that not every cloud service even has an SLA.</span></span> <span data-ttu-id="a209e-193">如果您的應用程式相依於具有無法正常運作時間保證的服務，您可能會關閉比您想像的還要長。</span><span class="sxs-lookup"><span data-stu-id="a209e-193">If your app is dependent on a service with no up-time guarantee, you could be down far longer than you might imagine.</span></span> <span data-ttu-id="a209e-194">比方說，如果您啟用登入您使用 Facebook 或 Twitter 等社交提供者的網站時，檢查以了解，是否有 SLA，而且您可能會發現有不是其中一個服務提供者。</span><span class="sxs-lookup"><span data-stu-id="a209e-194">For example, if you enable log-in to your site using a social provider such as Facebook or Twitter, check with the service provider to find out if there is an SLA, and you might find out there isn't one.</span></span> <span data-ttu-id="a209e-195">但是，如果驗證服務停止運作或無法支援您在它擲回的要求數量，您的客戶會鎖定您的應用程式。</span><span class="sxs-lookup"><span data-stu-id="a209e-195">But if the authentication service goes down or is unable to support the volume of requests you throw at it, your customers are locked out of your app.</span></span> <span data-ttu-id="a209e-196">天或更久，可能是向下。</span><span class="sxs-lookup"><span data-stu-id="a209e-196">You could be down for days or longer.</span></span> <span data-ttu-id="a209e-197">一個新的應用程式的建立者必須處理數億個下載項目和 Facebook 驗證 – 不採取相依性但未向 Facebook 再即時與探索到太晚發生該服務不提供任何 SLA。</span><span class="sxs-lookup"><span data-stu-id="a209e-197">The creators of one new app expected hundreds of millions of downloads and took a dependency on Facebook authentication – but didn't talk to Facebook before going live and discovered too late that there was no SLA for that service.</span></span>

### <a name="not-all-downtime-counts-toward-slas"></a><span data-ttu-id="a209e-198">並非所有的停機時間項目計 Sla</span><span class="sxs-lookup"><span data-stu-id="a209e-198">Not all downtime counts toward SLAs</span></span>

<span data-ttu-id="a209e-199">如果您的應用程式過度使用，某些雲端服務可能會刻意拒絕服務。</span><span class="sxs-lookup"><span data-stu-id="a209e-199">Some cloud services may deliberately deny service if your app over-uses them.</span></span> <span data-ttu-id="a209e-200">這就叫做*節流*。</span><span class="sxs-lookup"><span data-stu-id="a209e-200">This is called *throttling*.</span></span> <span data-ttu-id="a209e-201">如果服務有 SLA，它應該狀態下您可能會進行節流處理，以及您應用程式的設計應該避免這種情況，並做出適當回應節流，如果發生的條件。</span><span class="sxs-lookup"><span data-stu-id="a209e-201">If a service has an SLA, it should state the conditions under which you might be throttled, and your app design should avoid those conditions and react appropriately to the throttling if it happens.</span></span> <span data-ttu-id="a209e-202">比方說，如果服務要求會開始失敗，當您超過每秒特定數目時，您要確定不要太快，它們會導致節流來繼續發生自動重試。</span><span class="sxs-lookup"><span data-stu-id="a209e-202">For example, if requests to a service start to fail when you exceed a certain number per second, you want to make sure automatic retries don't happen so fast that they cause the throttling to continue.</span></span> <span data-ttu-id="a209e-203">我們必須進一步中的節流[暫時性錯誤處理的一章](transient-fault-handling.md)。</span><span class="sxs-lookup"><span data-stu-id="a209e-203">We'll have more to say about throttling in the [Transient Fault Handling chapter](transient-fault-handling.md).</span></span>

## <a name="summary"></a><span data-ttu-id="a209e-204">總結</span><span class="sxs-lookup"><span data-stu-id="a209e-204">Summary</span></span>

<span data-ttu-id="a209e-205">這一章已嘗試協助您了解為什麼真實世界的雲端應用程式必須設計成依正常程序存留失敗。</span><span class="sxs-lookup"><span data-stu-id="a209e-205">This chapter has tried to help you realize why a real world cloud app has to be designed to survive failures gracefully.</span></span> <span data-ttu-id="a209e-206">開頭[下一步 一章](monitoring-and-telemetry.md)，其餘的模式，在這一系列移到一些策略，若要這樣做，您可以使用更多詳細資料：</span><span class="sxs-lookup"><span data-stu-id="a209e-206">Starting with the [next chapter](monitoring-and-telemetry.md), the remaining patterns in this series go into more detail about some strategies you can use to do that:</span></span>

- <span data-ttu-id="a209e-207">有好[監視和遙測](monitoring-and-telemetry.md)，以便您快速找出有關失敗需要介入，並有足夠的資訊來解決這些問題。</span><span class="sxs-lookup"><span data-stu-id="a209e-207">Have good [monitoring and telemetry](monitoring-and-telemetry.md), so that you find out quickly about failures that require intervention, and you have sufficient information to resolve them.</span></span>
- <span data-ttu-id="a209e-208">[處理暫時性失敗](transient-fault-handling.md)藉由實作智慧性重試邏輯，使您的應用程式會自動復原時可以並回到[斷路器](transient-fault-handling.md#circuitbreakers)邏輯時它無法。</span><span class="sxs-lookup"><span data-stu-id="a209e-208">[Handle transient faults](transient-fault-handling.md) by implementing intelligent retry logic, so that your app recovers automatically when it can and falls back to [circuit breaker](transient-fault-handling.md#circuitbreakers) logic when it can't.</span></span>
- <span data-ttu-id="a209e-209">使用[分散式快取](distributed-caching.md)以便與資料庫存取權的輸送量、 延遲和連線問題降至最低。</span><span class="sxs-lookup"><span data-stu-id="a209e-209">Use [distributed caching](distributed-caching.md) in order to minimize throughput, latency, and connection problems with database access.</span></span>
- <span data-ttu-id="a209e-210">鬆散耦合透過實作[佇列為中心的工作模式](queue-centric-work-pattern.md)，如此一來，您的應用程式後端可以繼續使用後端已關閉時。</span><span class="sxs-lookup"><span data-stu-id="a209e-210">Implement loose coupling via the [queue-centric work pattern](queue-centric-work-pattern.md), so that your app front end can continue to work when the back end is down.</span></span>

## <a name="resources"></a><span data-ttu-id="a209e-211">資源</span><span class="sxs-lookup"><span data-stu-id="a209e-211">Resources</span></span>

<span data-ttu-id="a209e-212">如需詳細資訊，請參閱本電子書和下列資源中的後續章節。</span><span class="sxs-lookup"><span data-stu-id="a209e-212">For more information, see later chapters in this e-book and the following resources.</span></span>

<span data-ttu-id="a209e-213">文件：</span><span class="sxs-lookup"><span data-stu-id="a209e-213">Documentation:</span></span>

- <span data-ttu-id="a209e-214">[Failsafe︰ 恢復雲端架構指引](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a209e-214">[Failsafe: Guidance for Resilient Cloud Architectures](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx).</span></span> <span data-ttu-id="a209e-215">Marc Mercuri、 Ulrich Homann 和 Andrew Townhill 詘躩裛。</span><span class="sxs-lookup"><span data-stu-id="a209e-215">White paper by Marc Mercuri, Ulrich Homann, and Andrew Townhill.</span></span> <span data-ttu-id="a209e-216">FailSafe 影片系列的網頁版本。</span><span class="sxs-lookup"><span data-stu-id="a209e-216">Web page version of the FailSafe video series.</span></span>
- <span data-ttu-id="a209e-217">[Azure 雲端服務上大規模服務設計的最佳作法](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a209e-217">[Best Practices for the Design of Large-Scale Services on Azure Cloud Services](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx).</span></span> <span data-ttu-id="a209e-218">Mark Simms 和 Michael Thomassy 詘躩裛。</span><span class="sxs-lookup"><span data-stu-id="a209e-218">White paper by Mark Simms and Michael Thomassy.</span></span>
- <span data-ttu-id="a209e-219">[Azure 業務續航力技術指引](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a209e-219">[Azure Business Continuity Technical Guidance](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx).</span></span> <span data-ttu-id="a209e-220">Patrick Wickline 和 Jason Roth 詘躩裛。</span><span class="sxs-lookup"><span data-stu-id="a209e-220">White paper by Patrick Wickline and Jason Roth.</span></span>
- <span data-ttu-id="a209e-221">[災害復原和高可用性 Azure 應用程式的](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a209e-221">[Disaster Recovery and High Availability for Azure Applications](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx).</span></span> <span data-ttu-id="a209e-222">Michael McKeown、 Hanu Kommalapati 和 Jason Roth 詘躩裛。</span><span class="sxs-lookup"><span data-stu-id="a209e-222">White paper by Michael McKeown, Hanu Kommalapati, and Jason Roth.</span></span>
- <span data-ttu-id="a209e-223">[Microsoft Patterns and Practices-Azure 指引](https://msdn.microsoft.com/library/dn568099.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a209e-223">[Microsoft Patterns and Practices - Azure Guidance](https://msdn.microsoft.com/library/dn568099.aspx).</span></span> <span data-ttu-id="a209e-224">多資料中心部署指導方針，斷路器模式，請參閱。</span><span class="sxs-lookup"><span data-stu-id="a209e-224">See Multi Data Center Deployment guidance, Circuit breaker pattern.</span></span>
- <span data-ttu-id="a209e-225">[Azure 支援-服務等級協定](https://azure.microsoft.com/support/legal/sla/)。</span><span class="sxs-lookup"><span data-stu-id="a209e-225">[Azure Support - Service Level Agreements](https://azure.microsoft.com/support/legal/sla/).</span></span>
- <span data-ttu-id="a209e-226">[Azure SQL Database 的業務續航力](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a209e-226">[Business Continuity in Azure SQL Database](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx).</span></span> <span data-ttu-id="a209e-227">SQL Database 高可用性和災害復原功能相關的文件。</span><span class="sxs-lookup"><span data-stu-id="a209e-227">Documentation about SQL Database high availability and disaster recovery features.</span></span>
- <span data-ttu-id="a209e-228">[高可用性和災害復原 Azure 虛擬機器中的 SQL Server](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx)。</span><span class="sxs-lookup"><span data-stu-id="a209e-228">[High Availability and Disaster Recovery for SQL Server in Azure Virtual Machines](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx).</span></span>

<span data-ttu-id="a209e-229">影片：</span><span class="sxs-lookup"><span data-stu-id="a209e-229">Videos:</span></span>

- <span data-ttu-id="a209e-230">[FailSafe︰ 建置可擴充、 彈性的雲端服務](https://channel9.msdn.com/Series/FailSafe)。</span><span class="sxs-lookup"><span data-stu-id="a209e-230">[FailSafe: Building Scalable, Resilient Cloud Services](https://channel9.msdn.com/Series/FailSafe).</span></span> <span data-ttu-id="a209e-231">Ulrich Homann、 Marc Mercuri 和 Mark Simms、 包含九部組件系列。</span><span class="sxs-lookup"><span data-stu-id="a209e-231">Nine-part series by Ulrich Homann, Marc Mercuri, and Mark Simms.</span></span> <span data-ttu-id="a209e-232">提供高階的概念和架構原則非常可存取且有趣的方式，取自 Microsoft 客戶諮詢團隊 (CAT) 體驗，與實際客戶的劇本。</span><span class="sxs-lookup"><span data-stu-id="a209e-232">Presents high-level concepts and architectural principles in a very accessible and interesting way, with stories drawn from Microsoft Customer Advisory Team (CAT) experience with actual customers.</span></span> <span data-ttu-id="a209e-233">1 到 8 影片深入了解進入設計雲端應用程式不受失敗的原因。</span><span class="sxs-lookup"><span data-stu-id="a209e-233">Episodes 1 and 8 go in depth into the reasons for designing cloud apps to survive failures.</span></span> <span data-ttu-id="a209e-234">另請參閱後續追蹤的第 2 集開始 49:57 的失敗點和失敗模式，在第 2 集開始 56:05，討論，在第 3 集開始 40:55 斷路器的討論中的節流討論。</span><span class="sxs-lookup"><span data-stu-id="a209e-234">See also the follow-up discussion of throttling in episode 2 starting at 49:57, the discussion of failure points and failure modes in episode 2 starting at 56:05, and the discussion of circuit breakers in episode 3 starting at 40:55.</span></span>
- <span data-ttu-id="a209e-235">[建置大型： 從 Azure 的客戶-第 ii 部分 Lessons learned](https://channel9.msdn.com/Events/Build/2012/3-030)。</span><span class="sxs-lookup"><span data-stu-id="a209e-235">[Building Big: Lessons learned from Azure customers - Part II](https://channel9.msdn.com/Events/Build/2012/3-030).</span></span> <span data-ttu-id="a209e-236">Mark Simms 將討論如何針對失敗設計及檢測所有項目。</span><span class="sxs-lookup"><span data-stu-id="a209e-236">Mark Simms talks about designing for failure and instrumenting everything.</span></span> <span data-ttu-id="a209e-237">類似於保全數列但作法的詳細說明。</span><span class="sxs-lookup"><span data-stu-id="a209e-237">Similar to the Failsafe series but goes into more how-to details.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="a209e-238">[上一頁](unstructured-blob-storage.md)
> [下一頁](monitoring-and-telemetry.md)</span><span class="sxs-lookup"><span data-stu-id="a209e-238">[Previous](unstructured-blob-storage.md)
[Next](monitoring-and-telemetry.md)</span></span>
